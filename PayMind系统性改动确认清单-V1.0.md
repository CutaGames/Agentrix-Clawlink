# PayMind 系统性改动确认清单 V1.0
## 支付、Marketplace、联盟等模块改动确认

**版本**: 1.0  
**日期**: 2025年1月  
**状态**: 待确认

---

## 📋 目录

1. [改动范围确认](#1-改动范围确认)
2. [业务规则确认](#2-业务规则确认)
3. [技术架构确认](#3-技术架构确认)
4. [数据迁移确认](#4-数据迁移确认)
5. [分阶段实施确认](#5-分阶段实施确认)
6. [测试和验收确认](#6-测试和验收确认)
7. [用户体验确认](#7-用户体验确认)
8. [性能和安全性确认](#8-性能和安全性确认)

---

## 1. 改动范围确认

### 1.1 支付模块改动

#### ✅ 需要确认的问题

**问题1.1.1：佣金比例改动**
- [ ] 实体商品佣金：3%（PayMind 0.5% + 其他 2.5%）- **已确认**
- [ ] 服务类佣金：5%（PayMind 1% + 其他 4%）- **已确认**
- [ ] 链上资产佣金：根据场景不同（2.5%、1.5%、0.3%、0.15%等）- **已确认**
- [ ] 是否需要支持商户在范围内调整佣金比例？
  - **建议**：初期固定，后期允许有限调整（±2%）

**问题1.1.2：通道费用处理**
- [ ] 通道费用由商户承担 - **已确认**
- [ ] 通道费用在佣金计算前扣除 - **已确认**
- [ ] 是否需要在前端显示通道费用给用户？
  - **建议**：可选显示，默认不显示（商户承担）

**问题1.1.3：智能路由改动**
- [ ] 支持根据商户设置的价格（国家、通道）进行路由 - **已确认**
- [ ] 支持QuickPay快速通道 - **已确认**
- [ ] 支持KYC引导流程 - **已确认**
- [ ] 是否需要支持用户选择支付通道？
  - **建议**：默认智能推荐，允许用户手动选择

**问题1.1.4：国际化定价**
- [ ] 支持多国家定价 - **已确认**
- [ ] 支持税费计算（VAT、GST、销售税等）- **已确认**
- [ ] 税费由商户自缴，平台提供工具 - **已确认**
- [ ] 是否需要支持税费代扣？
  - **建议**：初期不支持，后期根据需求添加

### 1.2 Marketplace模块改动

#### ✅ 需要确认的问题

**问题1.2.1：资产聚合机制**
- [ ] 平台早期聚合：通过API接口或链上数据聚合 - **已确认**
- [ ] 用户自发：用户自己发行和交易 - **已确认**
- [ ] 是否需要区分"平台早期聚合"和"用户自发"的展示？
  - **建议**：需要区分，显示资产来源标识

**问题1.2.2：收入模式**
- [ ] 有合作伙伴关系：平台分佣模式（0.3-0.5%）- **已确认**
- [ ] 无合作伙伴关系：用户付费模式（2.5%）- **已确认**
- [ ] 是否需要支持混合模式（同时支持两种）？
  - **建议**：支持混合模式，根据资产来源自动选择

**问题1.2.3：游戏资产和RWA**
- [ ] 支持游戏资产聚合和交易 - **已确认**
- [ ] 支持RWA聚合和交易 - **已确认**
- [ ] 游戏资产佣金：平台聚合2%，用户自发1.2% - **已确认**
- [ ] RWA佣金：根据类型不同（1-2%）- **已确认**

**问题1.2.4：资产分类和展示**
- [ ] 是否需要按资产类型分类展示（NFT、FT、游戏资产、RWA）？
  - **建议**：需要，提供筛选和分类功能
- [ ] 是否需要显示资产来源（OpenSea、Magic Eden、用户自发等）？
  - **建议**：需要，显示资产来源标识

### 1.3 联盟模块改动

#### ✅ 需要确认的问题

**问题1.3.1：佣金分配规则**
- [ ] 实体商品：总佣金3%（推荐Agent 0.9% + 执行Agent 2.1% + PayMind 0.5%）- **已确认**
- [ ] 服务类：总佣金5%（推荐Agent 1.5% + 执行Agent 3.5% + PayMind 1%）- **已确认**
- [ ] 推广Agent永久佣金：商户GMV × 0.5% - **已确认**
- [ ] 用户推荐奖励：新用户首笔 × 1% - **已确认**

**问题1.3.2：Agent ID体系**
- [ ] 支持ERC 8004协议 - **已确认**
- [ ] 支持多链兼容 - **已确认**
- [ ] 是否需要支持DID等其他协议？
  - **建议**：初期支持ERC 8004，后期扩展DID

**问题1.3.3：SLA治理机制**
- [ ] 支持SLA指标记录和监控 - **已确认**
- [ ] 支持三层ID体系（User ID、Agent ID、Session ID）- **已确认**
- [ ] 是否需要支持SLA自动处罚机制？
  - **建议**：初期只记录，后期根据需求添加处罚机制

---

## 2. 业务规则确认

### 2.1 佣金计算规则

#### ✅ 需要确认的问题

**问题2.1.1：佣金计算基础**
- [ ] 佣金计算基于商户税前价格 - **已确认**
- [ ] 通道费用在佣金计算前扣除 - **已确认**
- [ ] 税费不影响佣金计算 - **已确认**
- [ ] 是否需要支持佣金计算后调整？
  - **建议**：不支持，佣金计算后不可调整

**问题2.1.2：多Agent协作**
- [ ] 推荐Agent：总佣金 × 30% - **已确认**
- [ ] 执行Agent：总佣金 × 70% - **已确认**
- [ ] 推广Agent：商户GMV × 0.5%（永久）- **已确认**
- [ ] 如果只有执行Agent，如何分配？
  - **建议**：执行Agent获得全部佣金（2.5%或4%）

**问题2.1.3：结算周期**
- [ ] Agent佣金：T+1结算 - **已确认**
- [ ] 推广Agent佣金：T+7结算 - **已确认**
- [ ] 用户推荐奖励：T+1结算 - **已确认**
- [ ] 是否需要支持实时结算？
  - **建议**：初期不支持，后期根据需求添加

### 2.2 定价规则

#### ✅ 需要确认的问题

**问题2.2.1：多国家定价**
- [ ] 支持基础价格 + 国家特定价格 - **已确认**
- [ ] 支持区域定价（如欧盟）- **已确认**
- [ ] 是否需要支持货币自动转换？
  - **建议**：需要，根据用户所在国家自动转换货币

**问题2.2.2：税费计算**
- [ ] 支持VAT、GST、销售税等 - **已确认**
- [ ] 税费由商户自缴 - **已确认**
- [ ] 平台提供税费报表工具 - **已确认**
- [ ] 是否需要支持税费代扣？
  - **建议**：初期不支持，后期根据需求添加

**问题2.2.3：通道费用**
- [ ] 通道费用由商户承担 - **已确认**
- [ ] 通道费用在佣金计算前扣除 - **已确认**
- [ ] 是否需要支持商户设置不同通道的价格？
  - **建议**：需要，商户可以为不同通道设置不同价格

---

## 3. 技术架构确认

### 3.1 后端改动

#### ✅ 需要确认的问题

**问题3.1.1：数据库改动**
- [ ] 是否需要新增表结构（产品价格、国家价格、税费等）？
  - **建议**：需要，新增`product_prices`、`product_country_prices`、`tax_rates`等表
- [ ] 是否需要修改现有表结构？
  - **建议**：需要，修改`products`、`payments`、`commissions`等表
- [ ] 是否需要数据迁移脚本？
  - **建议**：需要，创建数据迁移脚本

**问题3.1.2：API改动**
- [ ] 是否需要新增API接口？
  - **建议**：需要，新增价格查询、税费计算、佣金查询等接口
- [ ] 是否需要修改现有API接口？
  - **建议**：需要，修改支付、佣金计算等接口
- [ ] 是否需要保持向后兼容？
  - **建议**：需要，保持向后兼容，使用版本控制

**问题3.1.3：服务改动**
- [ ] 佣金计算服务：需要修改计算逻辑 - **已确认**
- [ ] 智能路由服务：需要支持商户价格设置 - **已确认**
- [ ] 支付服务：需要支持多国家定价和税费 - **已确认**
- [ ] Marketplace服务：需要支持资产聚合和收入模式 - **已确认**

### 3.2 前端改动

#### ✅ 需要确认的问题

**问题3.2.1：UI改动**
- [ ] 支付流程UI：需要支持多步骤支付流程 - **已确认**
- [ ] 价格显示：需要支持多国家价格和税费显示 - **已确认**
- [ ] 佣金显示：需要支持佣金明细显示 - **已确认**
- [ ] Marketplace：需要支持资产分类和来源显示 - **已确认**

**问题3.2.2：用户体验**
- [ ] 是否需要支持多语言？
  - **建议**：初期支持中英文，后期扩展
- [ ] 是否需要支持响应式设计？
  - **建议**：需要，支持移动端和桌面端
- [ ] 是否需要支持暗色模式？
  - **建议**：可选，根据优先级决定

### 3.3 合约改动

#### ✅ 需要确认的问题

**问题3.3.1：佣金合约**
- [ ] 是否需要修改佣金记录和结算逻辑？
  - **建议**：需要，支持新的佣金分配规则
- [ ] 是否需要支持多链佣金结算？
  - **建议**：需要，支持多链结算

**问题3.3.2：支付路由合约**
- [ ] 是否需要修改支付路由逻辑？
  - **建议**：需要，支持新的路由规则
- [ ] 是否需要支持X402协议？
  - **建议**：需要，支持X402协议

### 3.4 SDK改动

#### ✅ 需要确认的问题

**问题3.4.1：API改动**
- [ ] 是否需要新增SDK方法？
  - **建议**：需要，新增价格查询、税费计算、佣金查询等方法
- [ ] 是否需要修改现有SDK方法？
  - **建议**：需要，修改支付、佣金计算等方法
- [ ] 是否需要保持向后兼容？
  - **建议**：需要，保持向后兼容，使用版本控制

**问题3.4.2：文档更新**
- [ ] 是否需要更新SDK文档？
  - **建议**：需要，更新API文档和使用示例
- [ ] 是否需要提供迁移指南？
  - **建议**：需要，提供从旧版本迁移到新版本的指南

---

## 4. 数据迁移确认

### 4.1 现有数据迁移

#### ✅ 需要确认的问题

**问题4.1.1：产品数据迁移**
- [ ] 现有产品是否需要迁移到新的价格体系？
  - **建议**：需要，将现有产品价格迁移到新的价格表
- [ ] 是否需要设置默认国家价格？
  - **建议**：需要，使用现有价格作为默认价格

**问题4.1.2：佣金数据迁移**
- [ ] 现有佣金记录是否需要迁移？
  - **建议**：不需要，保持现有佣金记录不变
- [ ] 是否需要重新计算历史佣金？
  - **建议**：不需要，只对新交易使用新规则

**问题4.1.3：用户数据迁移**
- [ ] 现有用户数据是否需要迁移？
  - **建议**：不需要，保持现有用户数据不变
- [ ] 是否需要更新用户权限和设置？
  - **建议**：需要，更新用户权限和设置以支持新功能

### 4.2 兼容性处理

#### ✅ 需要确认的问题

**问题4.2.1：API兼容性**
- [ ] 是否需要保持旧API接口可用？
  - **建议**：需要，保持旧API接口可用，但标记为废弃
- [ ] 是否需要提供API版本控制？
  - **建议**：需要，使用`/api/v1/`、`/api/v2/`等版本控制

**问题4.2.2：数据兼容性**
- [ ] 是否需要支持旧数据格式？
  - **建议**：需要，支持旧数据格式，但推荐使用新格式
- [ ] 是否需要提供数据转换工具？
  - **建议**：需要，提供数据转换工具和脚本

---

## 5. 分阶段实施确认

### 5.1 实施阶段划分

#### ✅ 需要确认的问题

**问题5.1.1：阶段划分**
- [ ] 阶段1：核心功能改动（支付、佣金、定价）- **建议2-3周**
- [ ] 阶段2：Marketplace功能改动（资产聚合、收入模式）- **建议2-3周**
- [ ] 阶段3：联盟功能改动（Agent ID、SLA）- **建议1-2周**
- [ ] 阶段4：优化和测试（性能优化、安全测试）- **建议1-2周**
- [ ] 是否需要调整阶段划分？
  - **建议**：根据实际情况调整

**问题5.1.2：优先级**
- [ ] 哪些功能是P0（必须）？
  - **建议**：支付、佣金计算、定价是P0
- [ ] 哪些功能是P1（重要）？
  - **建议**：Marketplace、联盟是P1
- [ ] 哪些功能是P2（可选）？
  - **建议**：高级功能、优化是P2

### 5.2 实施计划

#### ✅ 需要确认的问题

**问题5.2.1：时间安排**
- [ ] 预计总工期是多少？
  - **建议**：6-10周（根据团队规模调整）
- [ ] 是否需要并行开发？
  - **建议**：可以，前端和后端可以并行开发

**问题5.2.2：资源分配**
- [ ] 需要多少开发人员？
  - **建议**：后端2-3人，前端2-3人，合约1-2人，测试1-2人
- [ ] 是否需要外部支持？
  - **建议**：根据实际情况决定

---

## 6. 测试和验收确认

### 6.1 测试范围

#### ✅ 需要确认的问题

**问题6.1.1：单元测试**
- [ ] 是否需要为所有改动编写单元测试？
  - **建议**：需要，覆盖率至少80%
- [ ] 是否需要测试佣金计算逻辑？
  - **建议**：需要，测试各种场景的佣金计算

**问题6.1.2：集成测试**
- [ ] 是否需要测试支付流程？
  - **建议**：需要，测试完整的支付流程
- [ ] 是否需要测试Marketplace功能？
  - **建议**：需要，测试资产聚合和交易功能

**问题6.1.3：E2E测试**
- [ ] 是否需要E2E测试？
  - **建议**：需要，测试关键用户流程
- [ ] 是否需要性能测试？
  - **建议**：需要，测试系统性能和并发能力

### 6.2 验收标准

#### ✅ 需要确认的问题

**问题6.2.1：功能验收**
- [ ] 佣金计算是否正确？
  - **建议**：需要，验证各种场景的佣金计算
- [ ] 支付流程是否正常？
  - **建议**：需要，验证支付流程的完整性
- [ ] Marketplace功能是否正常？
  - **建议**：需要，验证资产聚合和交易功能

**问题6.2.2：性能验收**
- [ ] 系统响应时间是否满足要求？
  - **建议**：API响应时间 < 500ms
- [ ] 系统并发能力是否满足要求？
  - **建议**：支持至少1000并发用户

---

## 7. 用户体验确认

### 7.1 用户界面

#### ✅ 需要确认的问题

**问题7.1.1：支付界面**
- [ ] 支付流程是否清晰？
  - **建议**：需要，提供清晰的支付步骤和提示
- [ ] 价格和费用是否透明？
  - **建议**：需要，清晰显示价格、税费、佣金等

**问题7.1.2：Marketplace界面**
- [ ] 资产分类是否清晰？
  - **建议**：需要，提供清晰的资产分类和筛选
- [ ] 资产信息是否完整？
  - **建议**：需要，显示资产来源、价格、库存等信息

### 7.2 用户反馈

#### ✅ 需要确认的问题

**问题7.2.1：用户测试**
- [ ] 是否需要用户测试？
  - **建议**：需要，邀请真实用户测试新功能
- [ ] 是否需要收集用户反馈？
  - **建议**：需要，收集用户反馈并优化

---

## 8. 性能和安全性确认

### 8.1 性能优化

#### ✅ 需要确认的问题

**问题8.1.1：数据库优化**
- [ ] 是否需要优化数据库查询？
  - **建议**：需要，优化慢查询和索引
- [ ] 是否需要使用缓存？
  - **建议**：需要，使用Redis缓存热点数据

**问题8.1.2：API优化**
- [ ] 是否需要API限流？
  - **建议**：需要，防止API滥用
- [ ] 是否需要API缓存？
  - **建议**：需要，缓存不经常变化的数据

### 8.2 安全性

#### ✅ 需要确认的问题

**问题8.2.1：数据安全**
- [ ] 是否需要加密敏感数据？
  - **建议**：需要，加密用户支付信息等敏感数据
- [ ] 是否需要数据备份？
  - **建议**：需要，定期备份重要数据

**问题8.2.2：API安全**
- [ ] 是否需要API认证？
  - **建议**：需要，使用JWT或OAuth认证
- [ ] 是否需要API授权？
  - **建议**：需要，使用RBAC权限控制

---

## 9. 总结

### 9.1 关键问题汇总

**必须确认的问题**：
1. ✅ 佣金比例：实体商品3%，服务类5%，链上资产根据场景不同
2. ✅ 通道费用：由商户承担，在佣金计算前扣除
3. ✅ 定价模式：支持多国家定价和税费计算
4. ✅ 资产聚合：支持平台早期聚合和用户自发
5. ✅ 收入模式：支持平台分佣和用户付费混合模式
6. ✅ Agent ID：支持ERC 8004和多链兼容
7. ✅ SLA治理：支持三层ID体系和SLA监控

**需要进一步确认的问题**：
1. ❓ 是否需要支持商户在范围内调整佣金比例？
2. ❓ 是否需要在前端显示通道费用给用户？
3. ❓ 是否需要支持税费代扣？
4. ❓ 是否需要支持实时结算？
5. ❓ 是否需要支持多语言？
6. ❓ 是否需要保持向后兼容？
7. ❓ 预计总工期和资源分配？

### 9.2 下一步行动

1. **确认关键问题**：回答上述需要进一步确认的问题
2. **制定详细计划**：根据确认的问题制定详细的实施计划
3. **开始实施**：按照计划开始系统改动
4. **持续沟通**：在实施过程中持续沟通和调整

---

**请确认以上问题，以便我们开始系统改动。**

