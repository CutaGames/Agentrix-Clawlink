# PayMind V3.0 测试指南

## ✅ 已完成功能

### 1. 支付流程优化 ✅
- ✅ 手续费计算逻辑（根据商品类型和是否有Agent）
- ✅ 智能路由增强（总手续费和汇率）
- ✅ 前端显示优化（简化显示）
- ✅ 支付聚合服务商集成
- ✅ 统一支付流程

---

## 🧪 测试步骤

### 1. 启动服务

#### 后端服务
```bash
cd backend
npm run start:dev
```

#### 前端服务
```bash
cd paymindfrontend
npm run dev
```

### 2. 测试支付流程

#### 步骤1：访问支付演示页面
1. 打开浏览器，访问：`http://localhost:3000/payment-demo`
2. 点击"体验统一支付流程"按钮

#### 步骤2：测试场景1 - 法币支付（实体商品，无Agent）
1. 创建支付请求：
   - 金额：100元
   - 订单类型：product（实体商品）
   - 无Agent
2. 查看支付选项：
   - ✅ 总手续费应显示：3.5%
   - ✅ 汇率应显示：1 CNY = 0.142 USDC
   - ✅ 显示KYC要求（如果需要）
   - ✅ 显示QuickPay授权状态（如果已授权）

#### 步骤3：测试场景2 - 法币支付（服务/数字资产，有Agent）
1. 创建支付请求：
   - 金额：100元
   - 订单类型：service（服务）
   - 有Agent（传递agentId）
2. 查看支付选项：
   - ✅ 总手续费应显示：7%
   - ✅ 汇率应显示：1 CNY = 0.142 USDC
   - ✅ 显示KYC要求（如果需要）

#### 步骤4：测试场景3 - 数字货币直接支付（实体商品，无Agent）
1. 创建支付请求：
   - 金额：100 USDC
   - 订单类型：product（实体商品）
   - 无Agent
2. 查看支付选项：
   - ✅ 总手续费应显示：0.5%
   - ✅ 无汇率显示（不涉及转换）

#### 步骤5：测试场景4 - 数字货币直接支付（服务/数字资产，有Agent）
1. 创建支付请求：
   - 金额：100 USDC
   - 订单类型：service（服务）
   - 有Agent（传递agentId）
2. 查看支付选项：
   - ✅ 总手续费应显示：4%
   - ✅ 无汇率显示（不涉及转换）

---

## 📋 测试检查清单

### 前端显示
- [ ] 总手续费显示正确（百分比格式）
- [ ] 汇率显示正确（如果涉及转换）
- [ ] KYC要求显示正确
- [ ] QuickPay授权状态显示正确
- [ ] 支付选项描述正确（是否需要转换）

### 后端API
- [ ] `/api/payments/routing` 返回总手续费
- [ ] `/api/payments/routing` 返回汇率信息（如果涉及转换）
- [ ] 手续费计算正确
- [ ] 汇率计算正确

### 支付流程
- [ ] 法币支付 → 数字货币结算流程正常
- [ ] 数字货币直接支付流程正常
- [ ] 货币转换逻辑正确
- [ ] 分成计算正确

---

## 🐛 常见问题

### 问题1：总手续费显示不正确
**解决方法**：
- 检查订单类型是否正确传递
- 检查是否有Agent ID
- 检查后端日志中的手续费计算

### 问题2：汇率显示不正确
**解决方法**：
- 检查是否涉及法币和数字货币转换
- 检查后端日志中的汇率计算

### 问题3：支付选项不显示
**解决方法**：
- 检查商家收款方式配置
- 检查前端API调用
- 检查后端日志

---

## 📝 测试结果记录

**测试日期**: ___________

**测试人员**: ___________

**测试结果**:
- 通过: ___________
- 失败: ___________
- 问题: ___________

**备注**:
___________

