# MPC é’±åŒ…è‡ªå»ºæŠ€æœ¯æ–¹æ¡ˆ - ç®€åŒ–ç‰ˆ

**ç‰ˆæœ¬**: V1.0  
**æ—¥æœŸ**: 2025å¹´1æœˆ  
**ç›®æ ‡**: ä¸ºå•†æˆ·æä¾›ç®€åŒ–ç‰ˆ MPC é’±åŒ…ï¼Œå®ç°éæ‰˜ç®¡æ”¯ä»˜

---

## ğŸ“‹ ç›®å½•

1. [æ–¹æ¡ˆæ¦‚è¿°](#1-æ–¹æ¡ˆæ¦‚è¿°)
2. [æŠ€æœ¯æ¶æ„](#2-æŠ€æœ¯æ¶æ„)
3. [æ ¸å¿ƒåŠŸèƒ½å®ç°](#3-æ ¸å¿ƒåŠŸèƒ½å®ç°)
4. [å®‰å…¨è€ƒè™‘](#4-å®‰å…¨è€ƒè™‘)
5. [å®æ–½è®¡åˆ’](#5-å®æ–½è®¡åˆ’)

---

## 1. æ–¹æ¡ˆæ¦‚è¿°

### 1.1 è®¾è®¡ç›®æ ‡

**ç®€åŒ–ç‰ˆ MPC é’±åŒ…ç‰¹ç‚¹**:
- âœ… åªæ”¯æŒå•†æˆ·ä½¿ç”¨ï¼ˆä¸éœ€è¦ç”¨æˆ·é’±åŒ…ï¼‰
- âœ… åªæ”¯æŒ BSC é“¾ï¼ˆå•é“¾ï¼‰
- âœ… åªæ”¯æŒ USDCï¼ˆå•ä¸€å¸ç§ï¼‰
- âœ… åŸºç¡€åŠŸèƒ½ï¼šåˆ›å»ºã€ç­¾åã€æ¢å¤
- âœ… 2/3 ç­¾åæœºåˆ¶

### 1.2 åŠŸèƒ½èŒƒå›´

**æ ¸å¿ƒåŠŸèƒ½**:
1. é’±åŒ…åˆ›å»ºï¼ˆç”Ÿæˆ 3 ä¸ªç§é’¥åˆ†ç‰‡ï¼‰
2. 2/3 ç­¾åï¼ˆæ”¯æŒä¸åŒåœºæ™¯ï¼‰
3. ä½™é¢æŸ¥è¯¢
4. è½¬è´¦åŠŸèƒ½
5. é’±åŒ…æ¢å¤

**ä¸åŒ…å«åŠŸèƒ½**:
- âŒ å¤šé“¾æ”¯æŒ
- âŒ å¤šå¸ç§æ”¯æŒ
- âŒ å¤æ‚ DeFi äº¤äº’
- âŒ æ‰¹é‡äº¤æ˜“ä¼˜åŒ–

---

## 2. æŠ€æœ¯æ¶æ„

### 2.1 ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å•†æˆ· MPC é’±åŒ…ç³»ç»Ÿ                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    â”‚             â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”
â”‚ å‰ç«¯  â”‚    â”‚ åç«¯  â”‚
â”‚       â”‚    â”‚       â”‚
â”‚åˆ†ç‰‡ A â”‚    â”‚åˆ†ç‰‡ B â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜    â””â”€â”€â”€â”¬â”€â”€â”€â”˜
    â”‚            â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
           â”‚
      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
      â”‚ åˆ†ç‰‡ C  â”‚
      â”‚ (å¤‡ä»½)  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æŠ€æœ¯æ ˆ

**å‰ç«¯**:
- React/Next.js
- `ethers.js` - ä»¥å¤ªåŠé’±åŒ…æ“ä½œ
- `crypto-js` - AES åŠ å¯†
- `localStorage` - åˆ†ç‰‡ A å­˜å‚¨

**åç«¯**:
- NestJS
- `ethers.js` - é’±åŒ…æ“ä½œ
- `shamir-secret-sharing` - ç§é’¥åˆ†ç‰‡
- PostgreSQL - åˆ†ç‰‡ B å­˜å‚¨

**æ™ºèƒ½åˆçº¦**:
- Solidity
- OpenZeppelin - å®‰å…¨åº“

---

## 3. æ ¸å¿ƒåŠŸèƒ½å®ç°

### 3.1 ç§é’¥åˆ†ç‰‡ç”Ÿæˆ

#### 3.1.1 ä½¿ç”¨ Shamir Secret Sharing

```typescript
// å®‰è£…ä¾èµ–
npm install shamir-secret-sharing
npm install @types/shamir-secret-sharing

// åç«¯æœåŠ¡
import { SecretSharing } from 'shamir-secret-sharing';
import { Wallet } from 'ethers';

@Injectable()
export class MPCWalletService {
  /**
   * ç”Ÿæˆ MPC é’±åŒ…
   */
  async generateMPCWallet(merchantId: string): Promise<{
    walletAddress: string;
    shardA: string;  // è¿”å›ç»™å‰ç«¯
    shardB: string;  // å­˜å‚¨åœ¨æ•°æ®åº“
    shardC: string;  // è¿”å›ç»™å•†æˆ·å¤‡ä»½
  }> {
    // 1. ç”Ÿæˆéšæœºç§é’¥
    const wallet = Wallet.createRandom();
    const privateKey = wallet.privateKey;
    
    // 2. ä½¿ç”¨ Shamir Secret Sharing åˆ†æˆ 3 ä»½ï¼Œéœ€è¦ 2 ä»½æ¢å¤
    const shards = SecretSharing.split(
      privateKey.substring(2), // å»æ‰ 0x å‰ç¼€
      3,  // æ€»ä»½æ•°
      2   // éœ€è¦ 2 ä»½æ‰èƒ½æ¢å¤
    );
    
    // 3. åŠ å¯†å­˜å‚¨åˆ†ç‰‡ B
    const encryptedShardB = this.encryptShard(shards[1], merchantId);
    
    // 4. ä¿å­˜åˆ°æ•°æ®åº“
    await this.saveShardB(merchantId, encryptedShardB, wallet.address);
    
    return {
      walletAddress: wallet.address,
      shardA: this.encryptShard(shards[0], merchantId), // åŠ å¯†åè¿”å›å‰ç«¯
      shardB: encryptedShardB, // å­˜å‚¨åœ¨æ•°æ®åº“
      shardC: this.encryptShard(shards[2], merchantId), // è¿”å›ç»™å•†æˆ·å¤‡ä»½
    };
  }
  
  /**
   * åŠ å¯†åˆ†ç‰‡ï¼ˆAES-256ï¼‰
   */
  private encryptShard(shard: string, password: string): string {
    const CryptoJS = require('crypto-js');
    return CryptoJS.AES.encrypt(shard, password).toString();
  }
  
  /**
   * è§£å¯†åˆ†ç‰‡
   */
  private decryptShard(encryptedShard: string, password: string): string {
    const CryptoJS = require('crypto-js');
    const bytes = CryptoJS.AES.decrypt(encryptedShard, password);
    return bytes.toString(CryptoJS.enc.Utf8);
  }
}
```

#### 3.1.2 å‰ç«¯å­˜å‚¨åˆ†ç‰‡ A

```typescript
// å‰ç«¯æœåŠ¡
class MPCWalletClient {
  /**
   * ä¿å­˜åˆ†ç‰‡ A åˆ°æœ¬åœ°
   */
  async saveShardA(encryptedShardA: string, password: string): Promise<void> {
    // 1. ä½¿ç”¨ç”¨æˆ·å¯†ç å†æ¬¡åŠ å¯†
    const doubleEncrypted = this.encrypt(encryptedShardA, password);
    
    // 2. å­˜å‚¨åˆ° localStorage
    localStorage.setItem('mpc_shard_a', doubleEncrypted);
    
    // 3. ç”ŸæˆåŠ©è®°è¯å¤‡ä»½ï¼ˆå¯é€‰ï¼‰
    const mnemonic = this.generateMnemonic(encryptedShardA);
    // æç¤ºç”¨æˆ·ä¿å­˜åŠ©è®°è¯
  }
  
  /**
   * ä»æœ¬åœ°è¯»å–åˆ†ç‰‡ A
   */
  async loadShardA(password: string): Promise<string | null> {
    const encrypted = localStorage.getItem('mpc_shard_a');
    if (!encrypted) return null;
    
    try {
      const decrypted = this.decrypt(encrypted, password);
      return decrypted;
    } catch (error) {
      console.error('Failed to decrypt shard A:', error);
      return null;
    }
  }
}
```

### 3.2 2/3 ç­¾åæœºåˆ¶

#### 3.2.1 ç­¾ååœºæ™¯

**åœºæ™¯ 1: å•†æˆ·ä¸»åŠ¨æ”¯ä»˜ï¼ˆéœ€è¦åˆ†ç‰‡ A + Bï¼‰**

```typescript
// å•†æˆ·åœ¨å‰ç«¯ç­¾åï¼ŒAgentrix åœ¨åç«¯ç­¾å
async signWithShardAAndB(
  merchantId: string,
  to: string,
  amount: bigint,
  merchantPassword: string
): Promise<string> {
  // 1. å‰ç«¯ï¼šå•†æˆ·ä½¿ç”¨åˆ†ç‰‡ A ç­¾å
  const shardA = await this.loadShardA(merchantPassword);
  const partialSigA = await this.signWithShard(shardA, to, amount);
  
  // 2. åç«¯ï¼šAgentrix ä½¿ç”¨åˆ†ç‰‡ B ç­¾åï¼ˆéœ€è¦å•†æˆ·æˆæƒï¼‰
  const shardB = await this.getShardB(merchantId);
  const partialSigB = await this.signWithShard(shardB, to, amount);
  
  // 3. ç»„åˆç­¾å
  return this.combineSignatures(partialSigA, partialSigB);
}
```

**åœºæ™¯ 2: è‡ªåŠ¨åˆ†è´¦ï¼ˆéœ€è¦åˆ†ç‰‡ B + Cï¼‰**

```typescript
// Agentrix è‡ªåŠ¨åˆ†è´¦åˆ°å•†æˆ·é’±åŒ…
async signWithShardBAndC(
  merchantId: string,
  to: string,
  amount: bigint
): Promise<string> {
  // 1. è·å–åˆ†ç‰‡ B
  const shardB = await this.getShardB(merchantId);
  
  // 2. è·å–åˆ†ç‰‡ Cï¼ˆéœ€è¦å•†æˆ·é¢„å…ˆæˆæƒè‡ªåŠ¨åˆ†è´¦ï¼‰
  const shardC = await this.getAutoAuthorizedShardC(merchantId);
  
  // 3. ç­¾å
  const partialSigB = await this.signWithShard(shardB, to, amount);
  const partialSigC = await this.signWithShard(shardC, to, amount);
  
  // 4. ç»„åˆç­¾å
  return this.combineSignatures(partialSigB, partialSigC);
}
```

**åœºæ™¯ 3: å•†æˆ·æç°ï¼ˆéœ€è¦åˆ†ç‰‡ A + Cï¼‰**

```typescript
// å•†æˆ·æç°ï¼Œä¸éœ€è¦ Agentrix
async signWithShardAAndC(
  merchantId: string,
  to: string,
  amount: bigint,
  merchantPassword: string,
  shardC: string  // å•†æˆ·æä¾›å¤‡ä»½åˆ†ç‰‡
): Promise<string> {
  // 1. å‰ç«¯ï¼šå•†æˆ·ä½¿ç”¨åˆ†ç‰‡ A ç­¾å
  const shardA = await this.loadShardA(merchantPassword);
  const partialSigA = await this.signWithShard(shardA, to, amount);
  
  // 2. å‰ç«¯ï¼šå•†æˆ·ä½¿ç”¨åˆ†ç‰‡ C ç­¾å
  const partialSigC = await this.signWithShard(shardC, to, amount);
  
  // 3. ç»„åˆç­¾å
  return this.combineSignatures(partialSigA, partialSigC);
}
```

#### 3.2.2 ç­¾åç»„åˆç®—æ³•

```typescript
// ä½¿ç”¨ ECDSA ç­¾åç»„åˆ
import { Signature } from 'ethers';

class MPCSignatureService {
  /**
   * ç»„åˆä¸¤ä¸ªéƒ¨åˆ†ç­¾å
   */
  combineSignatures(
    partialSigA: string,
    partialSigB: string
  ): string {
    // æ–¹æ³• 1: ä½¿ç”¨ Schnorr ç­¾åï¼ˆå¦‚æœæ”¯æŒï¼‰
    // æ–¹æ³• 2: ä½¿ç”¨ ECDSA ç­¾åç»„åˆï¼ˆéœ€è¦è‡ªå®šä¹‰å®ç°ï¼‰
    // æ–¹æ³• 3: æ¢å¤ç§é’¥åç­¾åï¼ˆä¸æ¨èï¼Œå®‰å…¨é£é™©ï¼‰
    
    // ç®€åŒ–æ–¹æ¡ˆï¼šä½¿ç”¨é˜ˆå€¼ç­¾ååº“
    // æ¨èä½¿ç”¨: tss-lib (Threshold Signature Scheme)
    const tss = require('tss-lib');
    return tss.combineSignatures(partialSigA, partialSigB);
  }
  
  /**
   * ä½¿ç”¨åˆ†ç‰‡ç­¾åï¼ˆéƒ¨åˆ†ç­¾åï¼‰
   */
  async signWithShard(
    shard: string,
    to: string,
    amount: bigint
  ): Promise<string> {
    // 1. æ„å»ºæ¶ˆæ¯å“ˆå¸Œ
    const messageHash = ethers.keccak256(
      ethers.AbiCoder.defaultAbiCoder().encode(
        ['address', 'uint256'],
        [to, amount]
      )
    );
    
    // 2. ä½¿ç”¨åˆ†ç‰‡ç­¾åï¼ˆéƒ¨åˆ†ç­¾åï¼‰
    // æ³¨æ„ï¼šè¿™é‡Œéœ€è¦å®ç°é˜ˆå€¼ç­¾åç®—æ³•
    // å¯ä»¥ä½¿ç”¨ tss-lib æˆ–ç±»ä¼¼åº“
    const tss = require('tss-lib');
    return tss.partialSign(shard, messageHash);
  }
}
```

**é‡è¦**: é˜ˆå€¼ç­¾åï¼ˆThreshold Signatureï¼‰æ˜¯ MPC çš„æ ¸å¿ƒï¼Œéœ€è¦ä¸“é—¨çš„åº“å®ç°ã€‚

### 3.3 é’±åŒ…æ¢å¤

#### 3.3.1 ä½¿ç”¨åˆ†ç‰‡ A + C æ¢å¤

```typescript
// å•†æˆ·å¯ä»¥éšæ—¶ä½¿ç”¨åˆ†ç‰‡ A + C æ¢å¤é’±åŒ…
async recoverWallet(
  shardA: string,
  shardC: string,
  password: string
): Promise<string> {
  // 1. è§£å¯†åˆ†ç‰‡
  const decryptedShardA = this.decryptShard(shardA, password);
  const decryptedShardC = this.decryptShard(shardC, password);
  
  // 2. ä½¿ç”¨ Shamir Secret Sharing æ¢å¤ç§é’¥
  const privateKey = SecretSharing.combine([
    decryptedShardA,
    decryptedShardC
  ]);
  
  // 3. éªŒè¯é’±åŒ…åœ°å€
  const wallet = new ethers.Wallet('0x' + privateKey);
  
  return wallet.address;
}
```

### 3.4 ä½™é¢æŸ¥è¯¢

```typescript
// æŸ¥è¯¢ USDC ä½™é¢
async getBalance(walletAddress: string): Promise<string> {
  const usdcContract = new Contract(
    USDC_ADDRESS,
    ['function balanceOf(address) view returns (uint256)'],
    provider
  );
  
  const balance = await usdcContract.balanceOf(walletAddress);
  return formatUnits(balance, 6); // USDC 6 ä½å°æ•°
}
```

### 3.5 è½¬è´¦åŠŸèƒ½

```typescript
// ä½¿ç”¨ MPC é’±åŒ…è½¬è´¦
async transfer(
  merchantId: string,
  to: string,
  amount: bigint,
  merchantPassword: string
): Promise<string> {
  // 1. è·å–é’±åŒ…åœ°å€
  const walletAddress = await this.getWalletAddress(merchantId);
  
  // 2. æ„å»ºäº¤æ˜“
  const usdcContract = new Contract(
    USDC_ADDRESS,
    ['function transfer(address,uint256)'],
    provider
  );
  
  const txData = usdcContract.interface.encodeFunctionData('transfer', [to, amount]);
  
  // 3. MPC ç­¾åï¼ˆåœºæ™¯ 1: å•†æˆ·ä¸»åŠ¨æ”¯ä»˜ï¼‰
  const signature = await this.signWithShardAAndB(
    merchantId,
    to,
    amount,
    merchantPassword
  );
  
  // 4. å‘é€äº¤æ˜“
  const tx = await provider.sendTransaction({
    from: walletAddress,
    to: USDC_ADDRESS,
    data: txData,
    // ä½¿ç”¨ç­¾åå‘é€
  });
  
  return tx.hash;
}
```

---

## 4. å®‰å…¨è€ƒè™‘

### 4.1 åˆ†ç‰‡å­˜å‚¨å®‰å…¨

#### åˆ†ç‰‡ Aï¼ˆå‰ç«¯ï¼‰
- âœ… ä½¿ç”¨ç”¨æˆ·å¯†ç åŠ å¯†
- âœ… å­˜å‚¨åœ¨ localStorageï¼ˆæµè§ˆå™¨æœ¬åœ°ï¼‰
- âœ… æä¾›åŠ©è®°è¯å¤‡ä»½
- âš ï¸ é£é™©ï¼šå¦‚æœè®¾å¤‡ä¸¢å¤±ï¼Œéœ€è¦åŠ©è®°è¯æ¢å¤

#### åˆ†ç‰‡ Bï¼ˆåç«¯ï¼‰
- âœ… ä½¿ç”¨ AES-256 åŠ å¯†
- âœ… å­˜å‚¨åœ¨æ•°æ®åº“ï¼ˆåŠ å¯†å­—æ®µï¼‰
- âœ… è®¿é—®éœ€è¦å•†æˆ·æˆæƒï¼ˆ2FAï¼‰
- âœ… å®šæœŸå¤‡ä»½åˆ°å†·å­˜å‚¨

#### åˆ†ç‰‡ Cï¼ˆå¤‡ä»½ï¼‰
- âœ… å•†æˆ·è‡ªè¡Œä¿ç®¡ï¼ˆæ¨èï¼‰
- âœ… æˆ–å­˜å‚¨åœ¨ç¡¬ä»¶é’±åŒ…
- âœ… æˆ–å†·å­˜å‚¨å¤‡ä»½

### 4.2 ç­¾åå®‰å…¨

#### é˜ˆå€¼ç­¾åå®ç°

**æ¨èåº“**:
1. **tss-lib** (Threshold Signature Scheme)
   - æ”¯æŒ ECDSA é˜ˆå€¼ç­¾å
   - æˆç†Ÿç¨³å®š
   - æ–‡æ¡£å®Œå–„

2. **fireblocks-sdk** (å¦‚æœåç»­è¿ç§»)
   - ä¼ä¸šçº§ MPC
   - ä½†éœ€è¦ä»˜è´¹

**å®ç°è¦ç‚¹**:
- ä½¿ç”¨æ ‡å‡†çš„é˜ˆå€¼ç­¾åç®—æ³•
- ä¸è¦å°è¯•è‡ªå·±å®ç°ç­¾åç»„åˆï¼ˆå®‰å…¨é£é™©é«˜ï¼‰
- ä½¿ç”¨ç»è¿‡å®¡è®¡çš„åº“

### 4.3 è®¿é—®æ§åˆ¶

```typescript
// åˆ†ç‰‡ B è®¿é—®æ§åˆ¶
@Injectable()
export class MPCWalletService {
  /**
   * è·å–åˆ†ç‰‡ Bï¼ˆéœ€è¦å•†æˆ·æˆæƒï¼‰
   */
  async getShardB(
    merchantId: string,
    authorizationToken: string
  ): Promise<string> {
    // 1. éªŒè¯æˆæƒä»¤ç‰Œ
    const isValid = await this.verifyAuthorization(merchantId, authorizationToken);
    if (!isValid) {
      throw new UnauthorizedException('Invalid authorization');
    }
    
    // 2. è®°å½•è®¿é—®æ—¥å¿—
    await this.logAccess(merchantId, 'shard_b_access');
    
    // 3. è¿”å›åŠ å¯†çš„åˆ†ç‰‡ B
    return await this.getEncryptedShardB(merchantId);
  }
  
  /**
   * è‡ªåŠ¨åˆ†è´¦æˆæƒï¼ˆå•†æˆ·é¢„å…ˆæˆæƒï¼‰
   */
  async authorizeAutoSplit(
    merchantId: string,
    maxAmount: bigint,
    duration: number
  ): Promise<string> {
    // å•†æˆ·æˆæƒ Agentrix åœ¨é™é¢å†…è‡ªåŠ¨ä½¿ç”¨åˆ†ç‰‡ B + C ç­¾å
    // ç”Ÿæˆæˆæƒä»¤ç‰Œ
    const authToken = this.generateAuthToken(merchantId, maxAmount, duration);
    
    // ä¿å­˜æˆæƒè®°å½•
    await this.saveAuthorization(merchantId, authToken, maxAmount, duration);
    
    return authToken;
  }
}
```

---

## 5. å®æ–½è®¡åˆ’

### 5.1 æŠ€æœ¯é€‰å‹

#### é˜ˆå€¼ç­¾ååº“

**æ¨è**: `tss-lib` æˆ– `@fireblocks/tss-lib`

```bash
npm install tss-lib
# æˆ–
npm install @fireblocks/tss-lib
```

**å¤‡é€‰**: å¦‚æœæ‰¾ä¸åˆ°åˆé€‚çš„åº“ï¼Œå¯ä»¥è€ƒè™‘ï¼š
- ä½¿ç”¨ `@noble/secp256k1` + è‡ªå®šä¹‰é˜ˆå€¼ç­¾å
- æˆ–ä½¿ç”¨ `@safe-global/safe-core-sdk`ï¼ˆä½†è¿™æ˜¯å¤šç­¾ï¼Œä¸æ˜¯ MPCï¼‰

#### åŠ å¯†åº“

```bash
npm install crypto-js
npm install @types/crypto-js
```

#### é’±åŒ…åº“

```bash
npm install ethers
```

### 5.2 å¼€å‘æ­¥éª¤

#### é˜¶æ®µ 1: æ ¸å¿ƒåŠŸèƒ½ï¼ˆ2-3å‘¨ï¼‰

1. **ç§é’¥åˆ†ç‰‡ç”Ÿæˆ**
   - å®ç° Shamir Secret Sharing
   - å®ç°åˆ†ç‰‡åŠ å¯†å­˜å‚¨
   - æµ‹è¯•åˆ†ç‰‡æ¢å¤

2. **åŸºç¡€ç­¾å**
   - é›†æˆé˜ˆå€¼ç­¾ååº“
   - å®ç° 2/3 ç­¾åæœºåˆ¶
   - æµ‹è¯•ç­¾åç»„åˆ

3. **é’±åŒ…åˆ›å»º**
   - å‰ç«¯é’±åŒ…åˆ›å»ºç•Œé¢
   - åç«¯é’±åŒ…åˆ›å»º API
   - åˆ†ç‰‡å­˜å‚¨å’Œåˆ†å‘

#### é˜¶æ®µ 2: å®Œæ•´åŠŸèƒ½ï¼ˆ2-3å‘¨ï¼‰

4. **è½¬è´¦åŠŸèƒ½**
   - å®ç° MPC ç­¾åè½¬è´¦
   - é›†æˆ USDC åˆçº¦
   - æµ‹è¯•è½¬è´¦æµç¨‹

5. **ä½™é¢æŸ¥è¯¢**
   - å®ç°ä½™é¢æŸ¥è¯¢ API
   - å‰ç«¯ä½™é¢æ˜¾ç¤º
   - äº¤æ˜“å†å²æŸ¥è¯¢

6. **é’±åŒ…ç®¡ç†**
   - é’±åŒ…ç®¡ç†ç•Œé¢
   - åˆ†ç‰‡å¤‡ä»½å’Œæ¢å¤
   - æˆæƒç®¡ç†

#### é˜¶æ®µ 3: é›†æˆå’Œæµ‹è¯•ï¼ˆ1-2å‘¨ï¼‰

7. **æ™ºèƒ½åˆçº¦é›†æˆ**
   - é›†æˆè‡ªåŠ¨åˆ†è´¦åˆçº¦
   - æµ‹è¯•åˆ†è´¦åˆ° MPC é’±åŒ…

8. **å®‰å…¨æµ‹è¯•**
   - å®‰å…¨å®¡è®¡
   - æ¸—é€æµ‹è¯•
   - æ€§èƒ½æµ‹è¯•

**æ€»è®¡**: 5-8 å‘¨

### 5.3 ä»£ç ç»“æ„

```
backend/src/modules/mpc-wallet/
â”œâ”€â”€ mpc-wallet.module.ts
â”œâ”€â”€ mpc-wallet.service.ts          # æ ¸å¿ƒæœåŠ¡
â”œâ”€â”€ mpc-signature.service.ts       # ç­¾åæœåŠ¡
â”œâ”€â”€ mpc-shard.service.ts          # åˆ†ç‰‡ç®¡ç†
â”œâ”€â”€ dto/
â”‚   â”œâ”€â”€ create-wallet.dto.ts
â”‚   â”œâ”€â”€ sign-transaction.dto.ts
â”‚   â””â”€â”€ recover-wallet.dto.ts
â”œâ”€â”€ entities/
â”‚   â””â”€â”€ mpc-wallet.entity.ts      # æ•°æ®åº“å®ä½“
â””â”€â”€ controllers/
    â””â”€â”€ mpc-wallet.controller.ts

agentrixfrontend/components/mpc-wallet/
â”œâ”€â”€ MPCWalletManager.tsx           # é’±åŒ…ç®¡ç†ç•Œé¢
â”œâ”€â”€ MPCWalletCreate.tsx           # åˆ›å»ºé’±åŒ…
â”œâ”€â”€ MPCWalletRecover.tsx          # æ¢å¤é’±åŒ…
â””â”€â”€ MPCWalletTransfer.tsx         # è½¬è´¦ç•Œé¢
```

---

## 6. ç®€åŒ–ç‰ˆ vs å®Œæ•´ç‰ˆå¯¹æ¯”

### 6.1 åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | ç®€åŒ–ç‰ˆ | å®Œæ•´ç‰ˆ (Fireblocks) |
|------|--------|-------------------|
| **é’±åŒ…åˆ›å»º** | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| **2/3 ç­¾å** | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| **ä½™é¢æŸ¥è¯¢** | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| **è½¬è´¦** | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| **å¤šé“¾æ”¯æŒ** | âŒ ä»… BSC | âœ… æ”¯æŒ |
| **å¤šå¸ç§** | âŒ ä»… USDC | âœ… æ”¯æŒ |
| **æ‰¹é‡äº¤æ˜“** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| **DeFi äº¤äº’** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| **å®‰å…¨å®¡è®¡** | âš ï¸ éœ€è¦è‡ªå·±åš | âœ… å·²æœ‰è®¤è¯ |

### 6.2 æˆæœ¬å¯¹æ¯”

| é¡¹ç›® | ç®€åŒ–ç‰ˆ | Fireblocks |
|------|--------|-----------|
| **å¼€å‘æˆæœ¬** | 5-8 å‘¨ | 2-3 å‘¨é›†æˆ |
| **ç»´æŠ¤æˆæœ¬** | æŒç»­ç»´æŠ¤ | æœåŠ¡å•†ç»´æŠ¤ |
| **ä½¿ç”¨æˆæœ¬** | ä¸€æ¬¡æ€§å¼€å‘ | æŒ‰äº¤æ˜“é‡æ”¶è´¹ |
| **å®‰å…¨æˆæœ¬** | éœ€è¦å®¡è®¡ | å·²æœ‰è®¤è¯ |

### 6.3 æ¨èæ–¹æ¡ˆ

**å¦‚æœäº¤æ˜“é‡ < 1000 ç¬”/å¤©**: æ¨èè‡ªå»ºç®€åŒ–ç‰ˆ  
**å¦‚æœäº¤æ˜“é‡ > 1000 ç¬”/å¤©**: æ¨èä½¿ç”¨ Fireblocks

---

## 7. å…³é”®æŠ€æœ¯éš¾ç‚¹

### 7.1 é˜ˆå€¼ç­¾åå®ç°

**éš¾ç‚¹**: ECDSA é˜ˆå€¼ç­¾åç®—æ³•å¤æ‚

**è§£å†³æ–¹æ¡ˆ**:
1. ä½¿ç”¨æˆç†Ÿçš„åº“ï¼ˆå¦‚ `tss-lib`ï¼‰
2. å¦‚æœæ‰¾ä¸åˆ°åˆé€‚çš„åº“ï¼Œè€ƒè™‘ä½¿ç”¨å¤šç­¾é’±åŒ…ï¼ˆ2/3 å¤šç­¾ï¼‰ä½œä¸ºæ›¿ä»£
3. å¤šç­¾é’±åŒ…æ›´å®¹æ˜“å®ç°ï¼Œä½†éœ€è¦ 3 ä¸ªç‹¬ç«‹åœ°å€

### 7.2 å¤šç­¾é’±åŒ…æ›¿ä»£æ–¹æ¡ˆ

å¦‚æœé˜ˆå€¼ç­¾åå®ç°å›°éš¾ï¼Œå¯ä»¥ä½¿ç”¨ **2/3 å¤šç­¾é’±åŒ…**ï¼š

```solidity
// ä½¿ç”¨ Gnosis Safe æˆ–è‡ªå»ºå¤šç­¾åˆçº¦
contract MerchantMultiSig {
    address public merchant;      // å•†æˆ·åœ°å€
    address public agentrix;       // Agentrix åœ°å€
    address public backup;        // å¤‡ä»½åœ°å€
    
    function executeTransaction(
        address to,
        uint256 amount,
        bytes memory data
    ) external {
        // éœ€è¦ 2/3 ç­¾å
        require(hasApproval(merchant) || hasApproval(agentrix) || hasApproval(backup), "Need 2 approvals");
        // æ‰§è¡Œäº¤æ˜“
    }
}
```

**ä¼˜åŠ¿**:
- âœ… æ›´å®¹æ˜“å®ç°
- âœ… ä½¿ç”¨æ ‡å‡†å¤šç­¾åˆçº¦
- âœ… å®‰å…¨å¯é 

**åŠ£åŠ¿**:
- âš ï¸ éœ€è¦ 3 ä¸ªç‹¬ç«‹åœ°å€ï¼ˆä¸æ˜¯åˆ†ç‰‡ï¼‰
- âš ï¸ ä¸æ˜¯çœŸæ­£çš„ MPCï¼ˆä½†åŠŸèƒ½ç±»ä¼¼ï¼‰

---

## 8. æ€»ç»“

### 8.1 è‡ªå»º MPC é’±åŒ…å¯è¡Œæ€§

âœ… **å¯è¡Œï¼Œæ¨èè‡ªå»ºç®€åŒ–ç‰ˆ**

**ç†ç”±**:
1. åŠŸèƒ½éœ€æ±‚ç®€å•ï¼ˆåªç»™å•†æˆ·ç”¨ï¼‰
2. æŠ€æœ¯å¯è¡Œï¼ˆä½¿ç”¨æˆç†Ÿåº“ï¼‰
3. æˆæœ¬å¯æ§ï¼ˆ5-8 å‘¨å¼€å‘ï¼‰
4. åˆè§„å¯æ§ï¼ˆå®Œå…¨è‡ªä¸»ï¼‰

### 8.2 å®æ–½å»ºè®®

1. **æŠ€æœ¯é€‰å‹**: ä½¿ç”¨ `tss-lib` æˆ–è€ƒè™‘å¤šç­¾é’±åŒ…æ›¿ä»£
2. **åˆ†é˜¶æ®µå®æ–½**: å…ˆå®ç°æ ¸å¿ƒåŠŸèƒ½ï¼Œå†å®Œå–„
3. **å®‰å…¨ä¼˜å…ˆ**: ä½¿ç”¨ç»è¿‡å®¡è®¡çš„åº“ï¼Œä¸è¦è‡ªå·±å®ç°ç­¾åç®—æ³•
4. **æµ‹è¯•å……åˆ†**: å……åˆ†æµ‹è¯•å„ç§åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯æ¢å¤æµç¨‹

### 8.3 é£é™©æç¤º

âš ï¸ **é˜ˆå€¼ç­¾åå®ç°æ˜¯æœ€å¤§éš¾ç‚¹**

å¦‚æœæ‰¾ä¸åˆ°åˆé€‚çš„é˜ˆå€¼ç­¾ååº“ï¼Œå»ºè®®ï¼š
- ä½¿ç”¨å¤šç­¾é’±åŒ…ä½œä¸ºæ›¿ä»£æ–¹æ¡ˆ
- æˆ–è€ƒè™‘ä½¿ç”¨ Fireblocks SDKï¼ˆä»˜è´¹ä½†å¯é ï¼‰

---

**æ–‡æ¡£ç»´æŠ¤**: Agentrix å¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: 2025å¹´1æœˆ

