# PayMind POS Edge AI Agent 产品需求文档（PRD）V1.0

**版本**：V1.0  
**日期**：2025-01-21  
**撰写人**：产品组（POS & Agent）  
**适用范围**：PayMind POS Edge 端侧 AI Agent（基于 Qwen3 0.6B）

---

## 1. 产品概述

### 1.1 产品定位
- 将传统 POS 升级为“AI 驱动的门店助手”，在端侧完成自然语言理解、意图编排与高频交易指令。
- 端侧模型：首发使用 Qwen3 0.6B 量化模型（<300MB），运行在主流 Android/Linux POS SoC + NPU。
- 云侧服务：复用 PayMind 支付、智能路由、Marketplace、风控、Ledger 等能力。

### 1.2 核心价值
| 面向对象 | 价值主张 |
| --- | --- |
| 商户 | 语音/多模态收银、自动退换货、实时经营助手、降低培训成本 |
| 消费者 | 自然语言对话支付、个性化推荐、会员积分可视化 |
| PayMind | 扩展线下节点、沉淀交易数据、驱动 DePIN 激励生态 |

### 1.3 成功指标（KPI）
- 语音指令响应时间 < 500ms（端侧推理）；
- 首批 1,000 台 POS OTA 覆盖，日均活跃指令 ≥ 30/台；
- 交易自动化率（无需人工确认）≥ 40%；
- 离线模式成功完成的收银次数 ≥ 3 次/台/日。

---

## 2. 用户与场景

### 2.1 核心角色
| 角色 | 描述 | 核心诉求 |
| --- | --- | --- |
| 店员（Merchant Copilot 用户） | 一线收银/导购人员 | 快速收银、免培训、语音操作 |
| 店长/老板 | 看板与决策 | 实时经营数据、库存/营销建议 |
| 消费者（ToC Agent） | 前台顾客 | 自然语言购买、优惠提醒、会员积分 |
| PayMind 运营 | 云端管控 | OTA、策略、风控参数下发 |

### 2.2 优先场景（按频次排序）
1. **语音收银**：识别商品 + 调用云端价格/库存 + 推荐支付路径 + 完成支付/小票。  
2. **退换货处理**：定位订单 → 校验规则 → 计算退款 → 提交支付逆向。  
3. **商品语义搜索/推荐**：端侧解析意图，云侧 Marketplace 返回列表 → POS 展示/播报。  
4. **经营快报**：店长语音查询“今天营业额/毛利/热销/缺货”。  
5. **会员互动**：识别会员 → 查询积分 → 触发优惠/兑换。  
6. **弱网/离线兜底**：缓存商品+价格，离线出单，恢复网络后自动对账。

---

## 3. 功能需求

### 3.1 端侧（Edge）必备能力
| 模块 | 功能 | 说明 |
| --- | --- | --- |
| 自然语言理解 | 意图分类、参数抽取、上下文记忆（5 轮） | 基于 Qwen3 0.6B，本地运行，支持中/英/少量方言关键词 |
| 多模态输入 | 语音唤醒、关键词监听、摄像头扫码触发 | 语音热词 “Hey PayMind”，视觉识别调用端侧轻量模型 |
| 流程编排 | 典型指令拆解（收银、退货、查询） | Node-RED 风格编排表，端侧执行，必要时调用云侧 API |
| 安全控制 | 本地权限缓存、额度校验、异常断网防护 | 与云侧 Permission Service 同步，支持离线阈值 |
| OTA & 策略 | 模型/意图表热更新、日志回传 | 预留差分下载通道，10MB 内增量包 |

### 3.2 云侧协同能力
- **Payment & Routing**：调用 `PaymentService.processPayment`、`SmartRouterService`，返回支付建议/状态。  
- **Marketplace & Search**：`/api/search/semantic`、`marketplace.listProducts` 提供商品内容。  
- **Order & Refund**：`/orders`、`/refunds` API，支持状态推送。  
- **Ledger & X402**：实时分账、上链审计。  
- **Guardrails**：规则引擎二次审计（大额、跨境、黑名单）。

### 3.3 功能优先级
- **P0**：语音收银、支付执行、退货、经营快报、OTA、日志。  
- **P1**：商品推荐、会员积分、离线出单、营销配置。  
- **P2**：分期/组合支付、自动营销决策、视觉识别营销屏。

---

## 4. 现状 vs 目标（MVP 对照）

| 模块 | 当前状态（2025Q1） | MVP 目标（2025Q2） | GAP/备注 |
| --- | --- | --- | --- |
| 端侧模型 | 无部署，实验室版本（MiniLM） | Qwen3 0.6B INT4/FP4 量化，<300MB | 需与 POS 厂商完成 NPU 适配 |
| 意图体系 | 云端 Agent 语义识别（全量） | 30 个 POS 高频意图本地化 | 需从现有 `intent_config` 中筛选 & 蒸馏 |
| OTA 管道 | 仅云端应用 OTA | 端侧模型/策略差分 OTA | 依赖 POS OS OTA 通道 + 新增 Agent 层热更新 |
| 支付流程 | 云端 Web 客户端触发 | Edge 调用 `/payments` API + Guardrail 再确认 | 需增加 Edge SDK & 签名机制 |
| 离线处理 | 无 | 离线缓存 200 个 SKU、3 小时离线出单 | 需新增 `offline_order_queue` 与对账脚本 |
| 数据回传 | Web 日志 | Edge 端 1 分钟批量日志 | 需定义 `edge_event` schema |

---

## 5. 技术架构（Fat Edge, Thin Cloud）
```
[用户语音] → [Qwen3 Edge Runtime] → [Intent Graph] →
  ↳ 本地执行（库存缓存 / 价格计算）
  ↳ 云 API (Payment, Marketplace, Ledger, Guardrail)
→ [响应/播报/打印]
```
- **边缘 Runtime**：基于 Android/Linux + NPU，Rust/Go 守护进程 + WASI 插件。
- **通信**：gRPC/WebSocket 双通道；断网自动切 HTTP 队列。
- **安全**：TEE/可信启动、API Key 零知识下发、日志脱敏。

---

## 6. 里程碑
| 阶段 | 时间 | 目标 |
| --- | --- | --- |
| Alpha（实验室） | 2025-02 | 单店试点，语音收银 Demo，手动 OTA |
| Beta（受限商用） | 2025-04 | 100 台 OTA，退换货、经营快报，日志管控 |
| GA（普遍可用） | 2025-07 | 1,000 台部署，离线出单、会员积分、营销插件 |
| GA+（生态） | 2025-10 | DePIN 早期激励、插件市场、定制端侧模型 |

---

## 7. 风险与应对
| 风险 | 说明 | 缓解方案 |
| --- | --- | --- |
| 端侧性能 | 老旧 POS CPU/NPU 不足 | 设定最低硬件清单，提供 Lite 模式（指令集 + 云推理） |
| 数据隐私 | 语音/订单敏感信息 | 本地加密、差分隐私上传、合规审计 |
| 网络波动 | 商户弱网常态 | 离线 SKU 缓存、对账补偿、短信兜底 |
| 语音识别准确率 | 嘈杂环境、多方言 | 定制关键词模型、提供按钮输入备选 |

---

## 8. 后续演进
1. 自研端侧模型（1.3B）接棒 Qwen，支持更多方言与经营洞察。  
2. POS DePIN 节点计费（算力 + 数据贡献激励）。  
3. 与 PayMind Agent Builder 打通，允许第三方上传 Edge 插件。  
4. 可插拔硬件（摄像头/客显屏）统一驱动协议。

---

> 本 PRD 为 POS Edge MVP 指南，后续需求变更请提交至 `POS-Edge-Backlog`。

