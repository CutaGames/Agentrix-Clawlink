# PayMind P0åŠŸèƒ½å¼€å‘æ€»ç»“

**æ›´æ–°æ—¥æœŸ**: 2025å¹´1æœˆ  
**ç‰ˆæœ¬**: V3.1

---

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. Agentæ¨å¹¿å•†æˆ·åˆ†æˆç³»ç»Ÿ â­â­â­

**çŠ¶æ€**: âœ… åç«¯å®Œæˆï¼ˆ100%ï¼‰

#### å®ç°å†…å®¹ï¼š
- âœ… æ•°æ®åº“å®ä½“ï¼š`MerchantReferral`, `ReferralCommission`
- âœ… åç«¯æœåŠ¡ï¼š`ReferralService`, `ReferralCommissionService`
- âœ… APIæ§åˆ¶å™¨ï¼š`ReferralController`
- âœ… æ•°æ®åº“è¿ç§»ï¼š`CreateReferralTables`
- âœ… æ”¯ä»˜æœåŠ¡é›†æˆï¼šè‡ªåŠ¨è®°å½•æ¨å¹¿åˆ†æˆ
- âœ… å®šæ—¶ä»»åŠ¡ï¼šæ¯å‘¨è‡ªåŠ¨ç»“ç®—æ¨å¹¿åˆ†æˆï¼ˆä½¿ç”¨@nestjs/scheduleï¼‰

#### æ ¸å¿ƒåŠŸèƒ½ï¼š
1. **æ¨å¹¿å…³ç³»ç®¡ç†**
   - åˆ›å»ºæ¨å¹¿å…³ç³»
   - å®¡æ ¸æ¨å¹¿å…³ç³»ï¼ˆpending â†’ approved â†’ activeï¼‰
   - ä¸€æ¬¡æ€§å¥–åŠ±å‘æ”¾ï¼ˆ$50 - $1,500ï¼‰
   - é•¿æœŸåˆ†æˆé…ç½®ï¼ˆé»˜è®¤0.5%ï¼‰

2. **è‡ªåŠ¨åˆ†æˆè®°å½•**
   - æ”¯ä»˜æˆåŠŸåè‡ªåŠ¨è®°å½•æ¨å¹¿åˆ†æˆ
   - æ”¯æŒå¤šç§æ”¯ä»˜æ–¹å¼ï¼ˆStripeã€é’±åŒ…ã€X402ç­‰ï¼‰
   - è‡ªåŠ¨æ›´æ–°æ¨å¹¿ç»Ÿè®¡ï¼ˆç´¯è®¡GMVã€ç´¯è®¡åˆ†æˆï¼‰

3. **åˆ†æˆç»“ç®—**
   - æ¯å‘¨è‡ªåŠ¨ç»“ç®—ï¼ˆå‘¨ä¸€å‡Œæ™¨2ç‚¹ï¼‰
   - æ‰‹åŠ¨è§¦å‘ç»“ç®—
   - ç»“ç®—å‘¨æœŸç®¡ç†ï¼ˆYYYY-WWæ ¼å¼ï¼‰

4. **ç»Ÿè®¡å’ŒæŠ¥è¡¨**
   - æ¨å¹¿å…³ç³»ç»Ÿè®¡
   - å¾…ç»“ç®—åˆ†æˆæŸ¥è¯¢
   - å·²ç»“ç®—åˆ†æˆæŸ¥è¯¢
   - ç´¯è®¡æ”¶ç›Šç»Ÿè®¡

#### APIç«¯ç‚¹ï¼š
```
POST   /referral                          - åˆ›å»ºæ¨å¹¿å…³ç³»
GET    /referral/my-referrals             - è·å–æˆ‘çš„æ¨å¹¿å…³ç³»
GET    /referral/stats                    - è·å–æ¨å¹¿ç»Ÿè®¡
GET    /referral/:referralId              - è·å–æ¨å¹¿å…³ç³»è¯¦æƒ…
PUT    /referral/:referralId/status       - æ›´æ–°æ¨å¹¿å…³ç³»çŠ¶æ€
GET    /referral/:referralId/commissions  - è·å–åˆ†æˆè®°å½•
GET    /referral/commissions/pending      - è·å–å¾…ç»“ç®—åˆ†æˆ
GET    /referral/commissions/settled      - è·å–å·²ç»“ç®—åˆ†æˆ
POST   /referral/commissions/settle      - æ‰‹åŠ¨è§¦å‘ç»“ç®—
```

#### æ–‡ä»¶æ¸…å•ï¼š
- `backend/src/entities/merchant-referral.entity.ts`
- `backend/src/entities/referral-commission.entity.ts`
- `backend/src/modules/referral/referral.service.ts`
- `backend/src/modules/referral/referral-commission.service.ts`
- `backend/src/modules/referral/referral.controller.ts`
- `backend/src/modules/referral/referral.module.ts`
- `backend/src/migrations/1738000000000-CreateReferralTables.ts`

---

### 2. Auto Shoppingå¢å¼º - ä¼˜æƒ åˆ¸æœåŠ¡ â­â­

**çŠ¶æ€**: âœ… åç«¯å®Œæˆï¼ˆ100%ï¼‰

#### å®ç°å†…å®¹ï¼š
- âœ… æ•°æ®åº“å®ä½“ï¼š`Coupon`, `CouponUsage`
- âœ… åç«¯æœåŠ¡ï¼š`CouponService`
- âœ… APIæ§åˆ¶å™¨ï¼š`CouponController`
- âœ… ä¼˜æƒ åˆ¸è‡ªåŠ¨æŸ¥æ‰¾å’Œè®¡ç®—
- âœ… ä¼˜æƒ åˆ¸ä½¿ç”¨è®°å½•

#### æ ¸å¿ƒåŠŸèƒ½ï¼š
1. **ä¼˜æƒ åˆ¸ç®¡ç†**
   - åˆ›å»ºä¼˜æƒ åˆ¸ï¼ˆç™¾åˆ†æ¯”ã€å›ºå®šé‡‘é¢ã€å…è¿è´¹ï¼‰
   - ä¼˜æƒ åˆ¸æœ‰æ•ˆæœŸç®¡ç†
   - ä½¿ç”¨æ¬¡æ•°é™åˆ¶
   - é€‚ç”¨å•†å“/åˆ†ç±»é™åˆ¶
   - æœ€ä½è´­ä¹°é‡‘é¢é™åˆ¶

2. **ä¼˜æƒ åˆ¸è®¡ç®—**
   - è‡ªåŠ¨éªŒè¯ä¼˜æƒ åˆ¸æœ‰æ•ˆæ€§
   - è®¡ç®—æŠ˜æ‰£é‡‘é¢
   - æ”¯æŒæœ€å¤§æŠ˜æ‰£é‡‘é¢é™åˆ¶
   - æ”¯æŒå…è¿è´¹è®¡ç®—

3. **è‡ªåŠ¨æŸ¥æ‰¾**
   - æ ¹æ®è®¢å•é‡‘é¢è‡ªåŠ¨æŸ¥æ‰¾å¯ç”¨ä¼˜æƒ åˆ¸
   - æ ¹æ®å•†å“/åˆ†ç±»ç­›é€‰ä¼˜æƒ åˆ¸
   - è¿”å›æœ€ä¼˜ä¼˜æƒ åˆ¸æ¨è

4. **ä½¿ç”¨è®°å½•**
   - è®°å½•ä¼˜æƒ åˆ¸ä½¿ç”¨å†å²
   - è‡ªåŠ¨æ›´æ–°ä½¿ç”¨æ¬¡æ•°
   - è‡ªåŠ¨å¤±æ•ˆå·²ç”¨å®Œçš„ä¼˜æƒ åˆ¸

#### APIç«¯ç‚¹ï¼š
```
POST   /coupon                    - åˆ›å»ºä¼˜æƒ åˆ¸
GET    /coupon/merchant/:id       - è·å–å•†æˆ·ä¼˜æƒ åˆ¸åˆ—è¡¨
GET    /coupon/available          - æŸ¥æ‰¾å¯ç”¨ä¼˜æƒ åˆ¸
POST   /coupon/calculate          - è®¡ç®—ä¼˜æƒ åˆ¸æŠ˜æ‰£
POST   /coupon/apply              - åº”ç”¨ä¼˜æƒ åˆ¸
```

#### æ–‡ä»¶æ¸…å•ï¼š
- `backend/src/entities/coupon.entity.ts`
- `backend/src/entities/coupon-usage.entity.ts`
- `backend/src/modules/coupon/coupon.service.ts`
- `backend/src/modules/coupon/coupon.controller.ts`
- `backend/src/modules/coupon/coupon.module.ts`

---

## â³ å¾…å®ç°åŠŸèƒ½

### 3. Agentæ¨å¹¿å•†æˆ·åˆ†æˆç³»ç»Ÿ - å‰ç«¯ç•Œé¢

**çŠ¶æ€**: â³ å¾…å®ç°

#### éœ€è¦å®ç°ï¼š
- â³ `ReferralDashboard.tsx` - æ¨å¹¿é¢æ¿
- â³ `ReferralCommissionList.tsx` - åˆ†æˆè®°å½•åˆ—è¡¨
- â³ `ReferralStats.tsx` - æ¨å¹¿ç»Ÿè®¡å›¾è¡¨
- â³ å‰ç«¯APIå®¢æˆ·ç«¯ï¼š`referral.api.ts`

---

### 4. Auto Shoppingå¢å¼º - ç‰©æµè·Ÿè¸ªå¢å¼º

**çŠ¶æ€**: â³ å¾…å®ç°

#### éœ€è¦å®ç°ï¼š
- â³ ç‰©æµè·Ÿè¸ªæœåŠ¡å¢å¼ºï¼ˆé›†æˆç¬¬ä¸‰æ–¹ç‰©æµAPIï¼‰
- â³ ç‰©æµçŠ¶æ€è‡ªåŠ¨æ›´æ–°
- â³ å‰ç«¯ç‰©æµè·Ÿè¸ªç•Œé¢ä¼˜åŒ–

---

### 5. å®Œå–„Auto-EarnåŸºç¡€åŠŸèƒ½

**çŠ¶æ€**: â³ å¾…å®ç°

#### éœ€è¦å®ç°ï¼š
- â³ ç©ºæŠ•ç›‘æ§å’Œé¢†å–ï¼ˆçœŸå®å®ç°ï¼‰
- â³ ä»»åŠ¡è‡ªåŠ¨æ‰§è¡Œå¼•æ“
- â³ æ”¶ç›Šç»Ÿè®¡å’Œå±•ç¤ºï¼ˆçœŸå®æ•°æ®ï¼‰
- â³ ç­–ç•¥æ‰§è¡Œå¼•æ“

---

## ğŸ“Š å¼€å‘è¿›åº¦ç»Ÿè®¡

| åŠŸèƒ½ | åç«¯ | å‰ç«¯ | æ•°æ®åº“ | å®Œæˆåº¦ |
|------|------|------|--------|--------|
| Agentæ¨å¹¿åˆ†æˆç³»ç»Ÿ | âœ… | â³ | âœ… | 70% |
| ä¼˜æƒ åˆ¸æœåŠ¡ | âœ… | â³ | âœ… | 70% |
| ç‰©æµè·Ÿè¸ªå¢å¼º | â³ | â³ | âœ… | 30% |
| Auto-Earnå®Œå–„ | â³ | â³ | â³ | 20% |

**æ€»ä½“å®Œæˆåº¦**: çº¦ 50%

---

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### ä¼˜å…ˆçº§1ï¼šå‰ç«¯ç•Œé¢å¼€å‘
1. å®ç°æ¨å¹¿é¢æ¿å‰ç«¯ç•Œé¢
2. å®ç°ä¼˜æƒ åˆ¸å±•ç¤ºå’Œä½¿ç”¨ç•Œé¢
3. åˆ›å»ºå‰ç«¯APIå®¢æˆ·ç«¯

### ä¼˜å…ˆçº§2ï¼šåŠŸèƒ½å®Œå–„
1. ç‰©æµè·Ÿè¸ªæœåŠ¡å¢å¼º
2. Auto-EarnåŸºç¡€åŠŸèƒ½å®Œå–„
3. æ•°æ®åº“è¿ç§»æ‰§è¡Œ

### ä¼˜å…ˆçº§3ï¼šæµ‹è¯•å’Œä¼˜åŒ–
1. å•å…ƒæµ‹è¯•
2. é›†æˆæµ‹è¯•
3. æ€§èƒ½ä¼˜åŒ–

---

## ğŸ“ æŠ€æœ¯è¯´æ˜

### æ•°æ®åº“è¿ç§»
éœ€è¦æ‰§è¡Œä»¥ä¸‹è¿ç§»ï¼š
```bash
cd backend
npm run migration:run
```

### ä¾èµ–å®‰è£…
ç¡®ä¿å·²å®‰è£…ï¼š
- `@nestjs/schedule` - ç”¨äºå®šæ—¶ä»»åŠ¡

### ç¯å¢ƒå˜é‡
æ— éœ€é¢å¤–ç¯å¢ƒå˜é‡é…ç½®

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ

