# V7.0 API æµ‹è¯•ç»“æœæŠ¥å‘Š

**æµ‹è¯•æ—¥æœŸ**: 2025-01-24  
**æµ‹è¯•ç”¨æˆ·**: 50084809@qq.com  
**JWT Token**: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...` (å·²ä½¿ç”¨)

---

## âœ… æµ‹è¯•ç»“æœæ€»è§ˆ

| APIç«¯ç‚¹ | çŠ¶æ€ | HTTPçŠ¶æ€ç  | å“åº”æ—¶é—´ | å¤‡æ³¨ |
|---------|------|-----------|----------|------|
| `GET /api/payment/preflight` | âœ… æˆåŠŸ | 200 | - | è·¯ç”±å†³ç­–æ­£å¸¸ |
| `GET /api/sessions` | âœ… æˆåŠŸ | 200 | - | è¿”å›ç©ºæ•°ç»„ï¼ˆæ­£å¸¸ï¼‰ |
| `GET /api/sessions/active` | âœ… æˆåŠŸ | 200 | - | æ— æ´»è·ƒSessionï¼ˆæ­£å¸¸ï¼‰ |
| `GET /api/relayer/queue/status` | âœ… æˆåŠŸ | 200 | - | é˜Ÿåˆ—ä¸ºç©ºï¼ˆæ­£å¸¸ï¼‰ |

---

## ğŸ“Š è¯¦ç»†æµ‹è¯•ç»“æœ

### 1. Pre-Flight Check API âœ…

**ç«¯ç‚¹**: `GET /api/payment/preflight?amount=10&currency=USDC`

**è¯·æ±‚**:
```bash
curl -X GET "http://localhost:3001/api/payment/preflight?amount=10&currency=USDC" \
  -H "Authorization: Bearer <TOKEN>"
```

**å“åº”** (200 OK):
```json
{
  "recommendedRoute": "crypto-rail",
  "quickPayAvailable": false,
  "requiresKYC": true,
  "estimatedTime": "2-5 minutes"
}
```

**åˆ†æ**:
- âœ… APIæ­£å¸¸å·¥ä½œ
- âœ… è·¯ç”±å†³ç­–é€»è¾‘æ­£ç¡®ï¼š
  - ç”¨æˆ·æ²¡æœ‰æ´»è·ƒSession â†’ `quickPayAvailable: false`
  - æ¨èä½¿ç”¨ `crypto-rail`ï¼ˆæ³•å¸å…¥é‡‘ï¼‰
  - éœ€è¦KYC â†’ `requiresKYC: true`
- âœ… å“åº”æ ¼å¼ç¬¦åˆé¢„æœŸ

**ç»“è®º**: Pre-Flight CheckæœåŠ¡è¿è¡Œæ­£å¸¸ï¼Œèƒ½å¤Ÿæ ¹æ®ç”¨æˆ·çŠ¶æ€æ™ºèƒ½æ¨èæ”¯ä»˜è·¯ç”±ã€‚

---

### 2. è·å–ç”¨æˆ·çš„æ‰€æœ‰Session âœ…

**ç«¯ç‚¹**: `GET /api/sessions`

**è¯·æ±‚**:
```bash
curl -X GET "http://localhost:3001/api/sessions" \
  -H "Authorization: Bearer <TOKEN>"
```

**å“åº”** (200 OK):
```json
[]
```

**åˆ†æ**:
- âœ… APIæ­£å¸¸å·¥ä½œ
- âœ… è¿”å›ç©ºæ•°ç»„ï¼ˆç”¨æˆ·å°šæœªåˆ›å»ºSessionï¼‰
- âœ… ç¬¦åˆé¢„æœŸè¡Œä¸º

**ç»“è®º**: SessionæŸ¥è¯¢åŠŸèƒ½æ­£å¸¸ã€‚

---

### 3. è·å–æ´»è·ƒSession âœ…

**ç«¯ç‚¹**: `GET /api/sessions/active`

**è¯·æ±‚**:
```bash
curl -X GET "http://localhost:3001/api/sessions/active" \
  -H "Authorization: Bearer <TOKEN>"
```

**å“åº”** (200 OK):
```json
null
```

**åˆ†æ**:
- âœ… APIæ­£å¸¸å·¥ä½œ
- âœ… è¿”å› `null`ï¼ˆç”¨æˆ·æ²¡æœ‰æ´»è·ƒSessionï¼‰
- âœ… ç¬¦åˆé¢„æœŸè¡Œä¸º

**ç»“è®º**: æ´»è·ƒSessionæŸ¥è¯¢åŠŸèƒ½æ­£å¸¸ã€‚

---

### 4. Relayeré˜Ÿåˆ—çŠ¶æ€ âœ…

**ç«¯ç‚¹**: `GET /api/relayer/queue/status`

**è¯·æ±‚**:
```bash
curl -X GET "http://localhost:3001/api/relayer/queue/status" \
  -H "Authorization: Bearer <TOKEN>"
```

**å“åº”** (200 OK):
```json
{
  "queueLength": 0,
  "oldestPayment": null,
  "isProcessing": false
}
```

**åˆ†æ**:
- âœ… APIæ­£å¸¸å·¥ä½œ
- âœ… é˜Ÿåˆ—ä¸ºç©ºï¼ˆ`queueLength: 0`ï¼‰
- âœ… å½“å‰æ²¡æœ‰å¤„ç†ä¸­çš„äº¤æ˜“ï¼ˆ`isProcessing: false`ï¼‰
- âœ… ç¬¦åˆé¢„æœŸè¡Œä¸º

**ç»“è®º**: RelayeræœåŠ¡è¿è¡Œæ­£å¸¸ï¼Œé˜Ÿåˆ—ç®¡ç†åŠŸèƒ½æ­£å¸¸ã€‚

---

## ğŸ” åŠŸèƒ½éªŒè¯çŠ¶æ€

### âœ… å·²éªŒè¯åŠŸèƒ½

1. **Pre-Flight CheckæœåŠ¡**
   - âœ… APIç«¯ç‚¹å¯è®¿é—®
   - âœ… è·¯ç”±å†³ç­–é€»è¾‘æ­£ç¡®
   - âœ… èƒ½å¤Ÿè¯†åˆ«ç”¨æˆ·SessionçŠ¶æ€
   - âœ… èƒ½å¤Ÿæ¨èåˆé€‚çš„æ”¯ä»˜è·¯ç”±

2. **Sessionç®¡ç†æœåŠ¡**
   - âœ… æŸ¥è¯¢ç”¨æˆ·Sessionåˆ—è¡¨
   - âœ… æŸ¥è¯¢æ´»è·ƒSession
   - âœ… æ•°æ®åº“æŸ¥è¯¢æ­£å¸¸

3. **RelayeræœåŠ¡**
   - âœ… é˜Ÿåˆ—çŠ¶æ€æŸ¥è¯¢æ­£å¸¸
   - âœ… æœåŠ¡è¿è¡Œæ­£å¸¸

---

## âš ï¸ å¾…æµ‹è¯•åŠŸèƒ½

### 1. åˆ›å»ºSessionï¼ˆéœ€è¦ç”¨æˆ·é’±åŒ…ï¼‰

**ç«¯ç‚¹**: `POST /api/sessions`

**æ‰€éœ€å‚æ•°**:
```json
{
  "signer": "0x...",           // Session Keyåœ°å€
  "singleLimit": 10000000,     // å•ç¬”é™é¢ï¼ˆ10 USDCï¼Œ6 decimalsï¼‰
  "dailyLimit": 100000000,     // æ¯æ—¥é™é¢ï¼ˆ100 USDCï¼Œ6 decimalsï¼‰
  "expiryDays": 30,            // è¿‡æœŸå¤©æ•°
  "signature": "0x...",        // ç”¨æˆ·ç­¾åï¼ˆæˆæƒï¼‰
  "agentId": "optional"        // å¯é€‰
}
```

**é™åˆ¶**:
- éœ€è¦ç”¨æˆ·å·²è¿æ¥é’±åŒ…ï¼ˆ`WalletConnection`è¡¨ä¸­æœ‰è®°å½•ï¼‰
- éœ€è¦ç”¨æˆ·ç­¾åæˆæƒ
- éœ€è¦ç”¨æˆ·é’±åŒ…æœ‰USDCä½™é¢ï¼ˆç”¨äºæˆæƒï¼‰

**å»ºè®®**: åœ¨å‰ç«¯æˆ–Swagger UIä¸­æµ‹è¯•ï¼Œéœ€è¦ç”¨æˆ·é’±åŒ…äº¤äº’ã€‚

---

### 2. Relayer QuickPayï¼ˆéœ€è¦Sessionå’Œç­¾åï¼‰

**ç«¯ç‚¹**: `POST /api/relayer/quickpay`

**æ‰€éœ€å‚æ•°**:
```json
{
  "sessionId": "0x...",        // Session ID
  "paymentId": "payment_123",  // æ”¯ä»˜ID
  "to": "0x...",               // æ”¶æ¬¾åœ°å€
  "amount": "1000000",         // æ”¯ä»˜é‡‘é¢ï¼ˆ1 USDCï¼Œ6 decimalsï¼‰
  "signature": "0x...",        // Session Keyç­¾å
  "nonce": 1234567890         // é˜²é‡æ”¾éšæœºæ•°
}
```

**é™åˆ¶**:
- éœ€è¦å…ˆåˆ›å»ºSession
- éœ€è¦Session Keyç­¾å
- éœ€è¦æœ‰æ•ˆçš„æ”¯ä»˜è¯·æ±‚

**å»ºè®®**: åœ¨å‰ç«¯å®Œæ•´æµç¨‹ä¸­æµ‹è¯•ã€‚

---

### 3. æ’¤é”€Sessionï¼ˆéœ€è¦Session IDï¼‰

**ç«¯ç‚¹**: `DELETE /api/sessions/{sessionId}`

**é™åˆ¶**:
- éœ€è¦å…ˆåˆ›å»ºSession
- éœ€è¦Session ID

**å»ºè®®**: åˆ›å»ºSessionåæµ‹è¯•ã€‚

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

ç”±äºæµ‹è¯•ç¯å¢ƒé™åˆ¶ï¼Œæœªæµ‹é‡ç²¾ç¡®å“åº”æ—¶é—´ï¼Œä½†æ‰€æœ‰APIéƒ½èƒ½æ­£å¸¸å“åº”ã€‚

**é¢„æœŸæ€§èƒ½æŒ‡æ ‡**ï¼ˆæ ¹æ®V7.0è®¾è®¡ï¼‰:
- Pre-Flight Check: < 200ms
- QuickPayç¡®è®¤: < 1ç§’
- SessionæŸ¥è¯¢: < 100ms

**å»ºè®®**: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿›è¡Œæ€§èƒ½æµ‹è¯•ã€‚

---

## ğŸ¯ æµ‹è¯•ç»“è®º

### âœ… æ ¸å¿ƒæœåŠ¡è¿è¡Œæ­£å¸¸

1. **Pre-Flight CheckæœåŠ¡**: âœ… æ­£å¸¸å·¥ä½œï¼Œèƒ½å¤Ÿæ™ºèƒ½æ¨èæ”¯ä»˜è·¯ç”±
2. **Sessionç®¡ç†æœåŠ¡**: âœ… æŸ¥è¯¢åŠŸèƒ½æ­£å¸¸
3. **RelayeræœåŠ¡**: âœ… é˜Ÿåˆ—ç®¡ç†æ­£å¸¸

### âš ï¸ éœ€è¦è¿›ä¸€æ­¥æµ‹è¯•

1. **Sessionåˆ›å»º**: éœ€è¦ç”¨æˆ·é’±åŒ…è¿æ¥å’Œç­¾åï¼ˆå»ºè®®åœ¨å‰ç«¯æµ‹è¯•ï¼‰
2. **QuickPayæ”¯ä»˜**: éœ€è¦å®Œæ•´çš„Sessionå’Œç­¾åæµç¨‹ï¼ˆå»ºè®®ç«¯åˆ°ç«¯æµ‹è¯•ï¼‰
3. **Sessionæ’¤é”€**: éœ€è¦å…ˆåˆ›å»ºSession

### ğŸ’¡ å»ºè®®

1. **å‰ç«¯æµ‹è¯•**: åœ¨Swagger UIæˆ–å‰ç«¯ç•Œé¢ä¸­æµ‹è¯•Sessionåˆ›å»ºå’ŒQuickPayæµç¨‹
2. **ç«¯åˆ°ç«¯æµ‹è¯•**: æŒ‰ç…§æ—¶åºå›¾è¿›è¡Œå®Œæ•´çš„æ”¯ä»˜æµç¨‹æµ‹è¯•
3. **æ€§èƒ½æµ‹è¯•**: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æµ‹é‡å“åº”æ—¶é—´
4. **å‹åŠ›æµ‹è¯•**: æµ‹è¯•å¹¶å‘æ”¯ä»˜åœºæ™¯

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. âœ… **APIç«¯ç‚¹éªŒè¯**: å·²å®ŒæˆåŸºç¡€APIæµ‹è¯•
2. â­ï¸ **Sessionåˆ›å»ºæµ‹è¯•**: éœ€è¦ç”¨æˆ·é’±åŒ…ï¼ˆå»ºè®®åœ¨Swagger UIä¸­æµ‹è¯•ï¼‰
3. â­ï¸ **QuickPayæµç¨‹æµ‹è¯•**: éœ€è¦å®Œæ•´çš„å‰ç«¯æµç¨‹
4. â­ï¸ **ç«¯åˆ°ç«¯æµ‹è¯•**: æŒ‰ç…§æ—¶åºå›¾éªŒè¯å®Œæ•´æµç¨‹

---

**æµ‹è¯•å®Œæˆæ—¶é—´**: 2025-01-24  
**æµ‹è¯•äººå‘˜**: AI Assistant  
**æŠ¥å‘ŠçŠ¶æ€**: âœ… åŸºç¡€APIæµ‹è¯•å®Œæˆ

