# PayMind V7.0 æ”¯ä»˜é‡æ„ - æ‰§è¡Œæ‘˜è¦

**ç‰ˆæœ¬**: V7.0  
**æ—¥æœŸ**: 2025å¹´1æœˆ  
**çŠ¶æ€**: å¾…å®æ–½

---

## ğŸ¯ æ ¸å¿ƒç›®æ ‡

å°† PayMind æ”¯ä»˜ç³»ç»Ÿé‡æ„ä¸ºï¼š
- âœ… **éæ‰˜ç®¡** - èµ„é‡‘åœ¨ç”¨æˆ·é’±åŒ…ï¼Œé€šè¿‡æˆæƒåˆ’æ‰£
- âœ… **ERC-8004** - è½»é‡çº§è´¦æˆ·æŠ½è±¡ï¼Œæ”¯æŒ Session Key
- âœ… **QuickPay** - é“¾ä¸‹ç­¾åéªŒè¯ï¼Œå³æ—¶ç¡®è®¤ï¼Œå¼‚æ­¥ä¸Šé“¾
- âœ… **Crypto-Rail ä¼˜å…ˆ** - æ³•å¸é€šé“ä½œä¸º On-Rampï¼Œåº•å±‚ç»Ÿä¸€ USDC ç»“ç®—
- âœ… **Agent å‹å¥½** - æ”¯æŒè‡ªåŠ¨åŒ–é™é¢æ”¯ä»˜

---

## ğŸ“Š å½“å‰ç³»ç»Ÿ vs PRD V7.0

| ç»„ä»¶ | å½“å‰çŠ¶æ€ | PRD è¦æ±‚ | å·®è· |
|------|---------|---------|------|
| **ERC-8004 åˆçº¦** | âŒ æ—  | âœ… å¿…éœ€ | éœ€è¦å®ç°æ ‡å‡†åˆçº¦ |
| **Relayer æœåŠ¡** | âš ï¸ æ¨¡æ‹Ÿ | âœ… çœŸå®æœåŠ¡ | éœ€è¦çœŸå® Relayer |
| **Session Key** | âŒ æ—  | âœ… å¿…éœ€ | éœ€è¦å‰ç«¯ç”Ÿæˆå’Œç®¡ç† |
| **Pre-Flight Check** | âŒ æ—  | âœ… 200ms å†³ç­– | éœ€è¦æ–°å¢ API |
| **Crypto-Rail** | âŒ æ—  | âœ… Provider èšåˆ | éœ€è¦é›†æˆ MoonPay/Meld |
| **éæ‰˜ç®¡æ¨¡å¼** | âœ… ç¬¦åˆ | âœ… ç¬¦åˆ | æ— éœ€æ”¹åŠ¨ |

---

## ğŸš€ å®æ–½è·¯å¾„ï¼ˆ8å‘¨ï¼‰

### Phase 1: æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼ˆWeek 1-2ï¼‰
- [ ] å®ç° ERC-8004 åˆçº¦ï¼ˆ`createSession`, `executeWithSession`, `revokeSession`ï¼‰
- [ ] æ„å»º PayMind Relayer æœåŠ¡ï¼ˆEOA é’±åŒ…ç®¡ç†ï¼Œé“¾ä¸‹éªŒè¯ï¼Œæ‰¹é‡ä¸Šé“¾ï¼‰
- [ ] å‰ç«¯ Session Key ç”Ÿæˆå™¨ï¼ˆæµè§ˆå™¨æœ¬åœ°ç”Ÿæˆï¼ŒIndexedDB å­˜å‚¨ï¼‰

### Phase 2: æ”¯ä»˜æµç¨‹é‡æ„ï¼ˆWeek 3-4ï¼‰
- [ ] Pre-Flight Check APIï¼ˆ200ms è·¯ç”±å†³ç­–ï¼‰
- [ ] QuickPay å®Œæ•´æµç¨‹ï¼ˆé“¾ä¸‹ç­¾å â†’ å³æ—¶ç¡®è®¤ â†’ å¼‚æ­¥ä¸Šé“¾ï¼‰
- [ ] å‰ç«¯æ”¶é“¶å°é‡æ„ï¼ˆåŠ¨æ€ UIï¼ŒQuickPay æŒ‰é’®ï¼‰

### Phase 3: Crypto-Rail é›†æˆï¼ˆWeek 5-6ï¼‰
- [ ] KYC èšåˆæœåŠ¡ï¼ˆå¯¹æ¥ MoonPay, Meldï¼‰
- [ ] Provider è·¯ç”±é€‰æ‹©ï¼ˆæ±‡ç‡æ¯”è¾ƒï¼Œè´¹ç”¨è®¡ç®—ï¼‰
- [ ] Off-Ramp æ”¯æŒï¼ˆUSDC â†’ æ³•å¸ï¼‰

### Phase 4: æ•°æ®è¿ç§»ï¼ˆWeek 7ï¼‰
- [ ] åˆ›å»º `agent_sessions` è¡¨
- [ ] è¿ç§»æ—§ `AutoPayGrant` æ•°æ®ï¼ˆéœ€è¦ç”¨æˆ·é‡æ–°æˆæƒï¼‰
- [ ] è€ç”¨æˆ·ä½™é¢å¤„ç†ï¼ˆæç°æˆ–è½¬æ¢ä¸º Session é¢åº¦ï¼‰

### Phase 5: æµ‹è¯•ä¸ä¸Šçº¿ï¼ˆWeek 8ï¼‰
- [ ] é›†æˆæµ‹è¯•
- [ ] å‹åŠ›æµ‹è¯•
- [ ] ç°åº¦å‘å¸ƒ

---

## ğŸ”‘ å…³é”®æŠ€æœ¯ç‚¹

### 1. ERC-8004 Session ç®¡ç†

```solidity
// æ ¸å¿ƒå‡½æ•°
function createSession(address signer, uint256 singleLimit, uint256 dailyLimit, uint256 expiry)
function executeWithSession(bytes32 sessionId, address to, uint256 amount, bytes calldata signature)
function revokeSession(bytes32 sessionId)
```

### 2. Relayer æœåŠ¡æµç¨‹

```
Agent è¯·æ±‚ â†’ é“¾ä¸‹éªŒè¯ç­¾åï¼ˆæ¯«ç§’çº§ï¼‰â†’ æ£€æŸ¥é¢åº¦ â†’ å³æ—¶è¿”å›æˆåŠŸ â†’ å¼‚æ­¥ä¸Šé“¾ï¼ˆæ‰¹é‡ï¼‰
```

### 3. QuickPay æ”¯ä»˜æµç¨‹

```
ç”¨æˆ·ç‚¹å‡» â†’ Session Key ç­¾åï¼ˆé“¾ä¸‹ï¼‰â†’ Relayer éªŒè¯ â†’ å³æ—¶ç¡®è®¤ â†’ å•†æˆ·å‘è´§ â†’ å¼‚æ­¥ä¸Šé“¾
```

### 4. Pre-Flight Check

```
UI æ¸²æŸ“å‰ â†’ é“¾ä¸ŠæŸ¥è¯¢ Session çŠ¶æ€ + ä½™é¢ â†’ 200ms è¿”å›è·¯ç”±å»ºè®® â†’ åŠ¨æ€æ¸²æŸ“ UI
```

---

## âš ï¸ å…³é”®é£é™©ä¸ç¼“è§£

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|---------|
| **ERC-8004 æ ‡å‡†æœªæˆç†Ÿ** | é«˜ | å…ˆå®ç°ç®€åŒ–ç‰ˆæœ¬ï¼Œåç»­å‡çº§ |
| **Relayer å•ç‚¹æ•…éšœ** | é«˜ | å¤šèŠ‚ç‚¹ä¸»å¤‡ï¼Œç›‘æ§å‘Šè­¦ |
| **Session Key ç§é’¥æ³„éœ²** | é«˜ | åŠ å¯†å­˜å‚¨ï¼Œé™é¢ä¿æŠ¤ï¼Œç´§æ€¥æ’¤é”€ |
| **é“¾ä¸‹ç¡®è®¤ä¸é“¾ä¸Šä¸ä¸€è‡´** | ä¸­ | å®šæœŸåŒæ­¥ï¼Œäº‰è®®è§£å†³æœºåˆ¶ |

---

## ğŸ“ å…³é”®æ–‡ä»¶æ¸…å•

### æ™ºèƒ½åˆçº¦
- `contracts/ERC8004SessionManager.sol` - ERC-8004 æ ‡å‡†å®ç°
- `scripts/deploy-erc8004.ts` - éƒ¨ç½²è„šæœ¬

### åç«¯æœåŠ¡
- `backend/src/modules/relayer/relayer.service.ts` - Relayer æœåŠ¡
- `backend/src/modules/payment/preflight-check.service.ts` - Pre-Flight Check
- `backend/src/modules/payment/crypto-rail.service.ts` - Crypto-Rail èšåˆ

### å‰ç«¯ç»„ä»¶
- `paymindfrontend/lib/session-key-manager.ts` - Session Key ç”Ÿæˆå™¨
- `paymindfrontend/hooks/useSessionManager.ts` - Session ç®¡ç† Hook
- `paymindfrontend/components/payment/QuickPayButton.tsx` - QuickPay æŒ‰é’®

### æ•°æ®åº“
- `backend/src/migrations/XXXXXX-CreateAgentSessions.ts` - åˆ›å»º agent_sessions è¡¨

---

## ğŸ¯ æˆåŠŸæŒ‡æ ‡

### æŠ€æœ¯æŒ‡æ ‡
- âœ… Pre-Flight Check å“åº”æ—¶é—´ < 200ms
- âœ… QuickPay ç¡®è®¤æ—¶é—´ < 1sï¼ˆé“¾ä¸‹éªŒè¯ï¼‰
- âœ… æ‰¹é‡ä¸Šé“¾ Gas èŠ‚çœ > 30%
- âœ… Relayer å¯ç”¨æ€§ > 99.9%

### ä¸šåŠ¡æŒ‡æ ‡
- âœ… QuickPay ä½¿ç”¨ç‡ > 60%ï¼ˆå°é¢æ”¯ä»˜ï¼‰
- âœ… æ”¯ä»˜æˆåŠŸç‡ > 99%
- âœ… ç”¨æˆ·è¿ç§»ç‡ > 80%ï¼ˆ3ä¸ªæœˆå†…ï¼‰

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

1. **PayMind-V7.0-æ”¯ä»˜é‡æ„åé¦ˆä¸ä¼˜åŒ–æ–¹æ¡ˆ.md** - è¯¦ç»†å·®è·åˆ†æå’Œä¼˜åŒ–å»ºè®®
2. **PayMind-V7.0-æŠ€æœ¯å®æ–½æŒ‡å—.md** - å®Œæ•´ä»£ç å®ç°ç¤ºä¾‹
3. **PayMind ç»Ÿä¸€æ”¯ä»˜åè®® V7.0 PRD** - åŸå§‹éœ€æ±‚æ–‡æ¡£

---

## ğŸš¦ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¼€å§‹ï¼ˆWeek 1ï¼‰
1. âœ… è¯„å®¡ ERC-8004 åˆçº¦è®¾è®¡
2. âœ… æ­å»º Relayer æœåŠ¡æ¡†æ¶
3. âœ… å®ç° Session Key ç”Ÿæˆå™¨åŸå‹

### å¹¶è¡Œè¿›è¡Œ
- åˆçº¦æµ‹è¯•ç¯å¢ƒæ­å»º
- Relayer ç›‘æ§ç³»ç»Ÿè®¾è®¡
- å‰ç«¯ UI åŸå‹è®¾è®¡

---

**æ–‡æ¡£ç‰ˆæœ¬**: V1.0  
**æœ€åæ›´æ–°**: 2025å¹´1æœˆ  
**ç»´æŠ¤è€…**: PayMind å¼€å‘å›¢é˜Ÿ

