# MPC钱包前端测试指南

## 📍 访问入口

**商户后台 → MPC钱包**

1. 登录商户账号
2. 在左侧菜单中找到 **"MPC钱包"**（位于"结算中心"下方）
3. 点击进入MPC钱包管理页面

**直接访问URL**：
```
http://localhost:3000/app/merchant/mpc-wallet
```

---

## 🧪 测试流程

### 测试1：创建MPC钱包

**步骤**：
1. 进入MPC钱包页面
2. 如果还没有钱包，会显示"您还没有MPC钱包"的提示
3. 点击 **"创建MPC钱包"** 按钮
4. 在弹出的模态框中：
   - 输入密码（至少8位字符）
   - 确认密码
   - 点击 **"创建"** 按钮

**预期结果**：
- ✅ 显示"钱包创建成功"
- ✅ 显示钱包地址（可复制）
- ✅ 显示分片C（加密），可以：
  - 显示/隐藏
  - 复制到剪贴板
  - 下载为文件
- ✅ 提示"请妥善保管分片C"
- ✅ 勾选"我已妥善保存分片C"后，点击"完成"按钮

**验证点**：
- [ ] 钱包地址格式正确（0x开头，42字符）
- [ ] 分片C可以复制和下载
- [ ] 分片A已自动保存到localStorage（`mpc_shard_a`）
- [ ] 创建成功后，页面刷新显示钱包信息

---

### 测试2：查看钱包信息

**步骤**：
1. 创建钱包后，或已有钱包时
2. 查看钱包信息卡片

**预期结果**：
- ✅ 显示钱包地址（可复制）
- ✅ 显示链类型（BSC）
- ✅ 显示币种（USDC）
- ✅ 显示状态（激活/未激活）

**验证点**：
- [ ] 所有信息显示正确
- [ ] 钱包地址可以复制
- [ ] 刷新按钮可以重新加载钱包信息

---

### 测试3：授权自动分账

**步骤**：
1. 在钱包信息页面
2. 找到"自动分账授权"卡片
3. 点击 **"授权自动分账"** 按钮
4. 在弹出的模态框中：
   - 输入最大金额（例如：1000.00 USDC）
   - 输入授权时长（例如：30天）
   - 点击 **"确认授权"** 按钮

**预期结果**：
- ✅ 显示"自动分账授权成功"
- ✅ 自动分账授权卡片显示：
  - ✅ 已授权状态（绿色勾选）
  - ✅ 最大金额（例如：1000.00 USDC）
  - ✅ 过期时间（例如：2025-02-27 12:00:00）
- ✅ 显示"撤销授权"按钮

**验证点**：
- [ ] 授权成功
- [ ] 最大金额显示正确（USDC格式）
- [ ] 过期时间计算正确（当前时间 + 授权天数）
- [ ] 可以撤销授权

---

### 测试4：撤销自动分账授权

**步骤**：
1. 在已授权自动分账的状态下
2. 点击 **"撤销授权"** 按钮
3. 确认撤销

**预期结果**：
- ✅ 显示"自动分账授权已撤销"
- ✅ 自动分账授权卡片显示：
  - ✅ 未授权状态
  - ✅ "授权自动分账"按钮重新出现

**验证点**：
- [ ] 撤销成功
- [ ] 状态更新正确

---

### 测试5：恢复钱包

**步骤**：
1. 在钱包信息页面
2. 找到"钱包恢复"卡片
3. 点击 **"恢复钱包"** 按钮
4. 在弹出的模态框中：
   - 粘贴分片A（加密）
   - 粘贴分片C（加密）
   - 输入创建钱包时的密码
   - 点击 **"恢复钱包"** 按钮

**预期结果**：
- ✅ 显示"钱包恢复成功"
- ✅ 验证恢复的钱包地址与原始地址匹配

**验证点**：
- [ ] 使用正确的分片A+C和密码可以恢复
- [ ] 使用错误的分片或密码会显示错误
- [ ] 恢复后钱包信息正确显示

---

## 🔍 测试数据准备

### 创建钱包测试数据

**密码示例**：
- `test123456`（8位，符合要求）
- `MySecurePassword123!`（复杂密码）

**注意**：
- 密码长度至少8位
- 两次输入的密码必须一致

### 授权自动分账测试数据

**最大金额示例**：
- `1000.00` USDC
- `5000.00` USDC
- `10000.00` USDC

**授权时长示例**：
- `30` 天
- `90` 天
- `365` 天

### 恢复钱包测试数据

**分片A和C**：
- 从创建钱包时的结果中获取
- 分片A：存储在localStorage中（`mpc_shard_a`）
- 分片C：创建钱包时显示的分片C

**密码**：
- 使用创建钱包时设置的密码

---

## 🐛 常见问题排查

### 问题1：创建钱包失败

**可能原因**：
- 密码长度不足8位
- 两次输入的密码不一致
- 后端API错误
- 网络连接问题

**排查步骤**：
1. 检查浏览器控制台是否有错误
2. 检查网络请求是否成功（Network标签）
3. 检查后端日志
4. 确认已登录商户账号

### 问题2：无法加载钱包信息

**可能原因**：
- 钱包不存在（404错误，这是正常的）
- 未登录或token过期
- 后端API错误

**排查步骤**：
1. 检查是否已创建钱包
2. 检查localStorage中是否有`access_token`
3. 检查浏览器控制台错误
4. 尝试刷新页面

### 问题3：授权自动分账失败

**可能原因**：
- 最大金额格式错误
- 授权时长无效
- 后端API错误

**排查步骤**：
1. 确认最大金额是数字格式（例如：1000.00）
2. 确认授权时长是正整数
3. 检查浏览器控制台错误
4. 检查后端日志

### 问题4：恢复钱包失败

**可能原因**：
- 分片A或C格式错误
- 密码错误
- 分片不匹配

**排查步骤**：
1. 确认分片A和C是从创建钱包时保存的
2. 确认密码是创建钱包时设置的密码
3. 检查分片格式是否正确（加密字符串）
4. 检查浏览器控制台错误

---

## 📝 测试检查清单

### 功能测试

- [ ] 创建MPC钱包
- [ ] 查看钱包信息
- [ ] 复制钱包地址
- [ ] 授权自动分账
- [ ] 撤销自动分账
- [ ] 恢复钱包
- [ ] 显示/隐藏分片C
- [ ] 复制分片C
- [ ] 下载分片C

### UI/UX测试

- [ ] 页面布局美观
- [ ] 响应式设计（移动端适配）
- [ ] 错误提示清晰
- [ ] 成功提示清晰
- [ ] 加载状态显示
- [ ] 模态框交互流畅

### 安全测试

- [ ] 密码输入框类型为`password`
- [ ] 分片C默认隐藏
- [ ] 分片A存储在localStorage（加密）
- [ ] 敏感信息不暴露在URL中
- [ ] API请求包含认证token

### 边界测试

- [ ] 密码长度不足8位（应显示错误）
- [ ] 两次密码不一致（应显示错误）
- [ ] 最大金额为0或负数（应显示错误）
- [ ] 授权时长为0或负数（应显示错误）
- [ ] 恢复钱包时缺少分片（应显示错误）
- [ ] 恢复钱包时密码错误（应显示错误）

---

## 🎯 测试场景示例

### 场景1：完整流程测试

1. **创建钱包**
   - 密码：`TestPassword123!`
   - 保存分片C到安全位置

2. **查看钱包信息**
   - 验证钱包地址正确
   - 验证状态为"激活"

3. **授权自动分账**
   - 最大金额：`5000.00` USDC
   - 授权时长：`30` 天
   - 验证授权成功

4. **撤销授权**
   - 验证撤销成功
   - 验证状态更新

5. **恢复钱包**
   - 使用保存的分片C
   - 使用localStorage中的分片A
   - 使用创建时的密码
   - 验证恢复成功

### 场景2：错误处理测试

1. **创建钱包错误**
   - 密码太短（7位）→ 应显示错误
   - 密码不一致 → 应显示错误

2. **授权错误**
   - 最大金额为0 → 应显示错误
   - 授权时长为0 → 应显示错误

3. **恢复钱包错误**
   - 分片A错误 → 应显示错误
   - 分片C错误 → 应显示错误
   - 密码错误 → 应显示错误

---

## 📊 测试报告模板

**测试日期**：_________

**测试人员**：_________

**测试环境**：
- 前端URL：`http://localhost:3000`
- 后端URL：`http://localhost:3001`
- 浏览器：_________

**测试结果**：

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 创建钱包 | ⬜ 通过 ⬜ 失败 | |
| 查看钱包信息 | ⬜ 通过 ⬜ 失败 | |
| 授权自动分账 | ⬜ 通过 ⬜ 失败 | |
| 撤销授权 | ⬜ 通过 ⬜ 失败 | |
| 恢复钱包 | ⬜ 通过 ⬜ 失败 | |
| UI/UX | ⬜ 通过 ⬜ 失败 | |
| 错误处理 | ⬜ 通过 ⬜ 失败 | |

**发现的问题**：

1. 
2. 
3. 

**建议**：

1. 
2. 
3. 

---

## 🚀 快速开始

1. **启动后端服务**：
   ```bash
   cd backend
   npm run start:dev
   ```

2. **启动前端服务**：
   ```bash
   cd agentrixfrontend
   npm run dev
   ```

3. **访问页面**：
   - 打开浏览器访问：`http://localhost:3000`
   - 登录商户账号
   - 导航到：商户后台 → MPC钱包

4. **开始测试**：
   - 按照上述测试流程进行测试
   - 记录测试结果
   - 报告发现的问题

---

**祝测试顺利！** 🎉

