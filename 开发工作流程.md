# å¼€å‘å·¥ä½œæµç¨‹è§„èŒƒ

## ğŸ“‹ æ ¸å¿ƒåŸåˆ™

**âœ… æ­£ç¡®æµç¨‹ï¼šæœ¬åœ°å¼€å‘ â†’ Git æäº¤ â†’ æœåŠ¡å™¨ä» Git æ‹‰å–**

**âŒ é”™è¯¯åšæ³•ï¼šç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šä¿®æ”¹ä»£ç **

---

## ğŸ”„ æ ‡å‡†å¼€å‘æµç¨‹

### 1. æœ¬åœ°å¼€å‘
```bash
# åœ¨æœ¬åœ°è¿›è¡Œå¼€å‘
cd backend
# ä¿®æ”¹ä»£ç ...
npm run build  # æœ¬åœ°æµ‹è¯•ç¼–è¯‘
npm run start:dev  # æœ¬åœ°æµ‹è¯•è¿è¡Œ
```

### 2. æäº¤åˆ° Git
```bash
# æ£€æŸ¥å˜æ›´
git status

# æ·»åŠ æ–‡ä»¶
git add .

# æäº¤ï¼ˆä½¿ç”¨æ¸…æ™°çš„æäº¤ä¿¡æ¯ï¼‰
git commit -m "feat: æ·»åŠ æ–°åŠŸèƒ½æè¿°"

# æ¨é€åˆ°è¿œç¨‹ä»“åº“
git push origin main
```

### 3. æœåŠ¡å™¨éƒ¨ç½²ï¼ˆä» Git æ‹‰å–ï¼‰
```bash
# SSH è¿æ¥åˆ°æœåŠ¡å™¨
ssh root@129.226.152.88

# è¿›å…¥åç«¯ç›®å½•
cd /var/www/agentrix-website/backend

# åœæ­¢æœåŠ¡
pm2 stop agentrix-backend

# ä» Git æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# å®‰è£…ä¾èµ–ï¼ˆå¦‚æœæœ‰æ–°ä¾èµ–ï¼‰
npm install

# æ„å»ºé¡¹ç›®
npm run build

# è¿è¡Œæ•°æ®åº“è¿ç§»ï¼ˆå¦‚æœéœ€è¦ï¼‰
npm run migration:run

# é‡å¯æœåŠ¡
pm2 restart agentrix-backend --update-env

# æŸ¥çœ‹æ—¥å¿—
pm2 logs agentrix-backend --lines 50
```

---

## ğŸš« ç¦æ­¢çš„æ“ä½œ

1. **âŒ ç¦æ­¢ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šä¿®æ”¹ä»£ç **
   - æœåŠ¡å™¨ä¸Šçš„ä»£ç åº”è¯¥åªä» Git æ‹‰å–
   - å¦‚æœå¿…é¡»åœ¨æœåŠ¡å™¨ä¸Šä¸´æ—¶ä¿®æ”¹ï¼Œå¿…é¡»ç«‹å³åŒæ­¥å›æœ¬åœ°å¹¶æäº¤åˆ° Git

2. **âŒ ç¦æ­¢ä½¿ç”¨ rsync/scp ç›´æ¥è¦†ç›–æœåŠ¡å™¨ä»£ç **
   - è¿™ä¼šå¯¼è‡´æœåŠ¡å™¨å’Œ Git ä¸åŒæ­¥
   - åº”è¯¥ä½¿ç”¨ Git ä½œä¸ºå”¯ä¸€çš„æ•°æ®æº

3. **âŒ ç¦æ­¢è·³è¿‡ Git ç›´æ¥éƒ¨ç½²**
   - æ‰€æœ‰ä»£ç å˜æ›´å¿…é¡»å…ˆæäº¤åˆ° Git
   - Git æ˜¯å”¯ä¸€çš„ä»£ç æ¥æº

---

## ğŸ“ æ¨èçš„éƒ¨ç½²è„šæœ¬

### æœåŠ¡å™¨ç«¯ Git éƒ¨ç½²è„šæœ¬

åˆ›å»º `deploy-from-git.sh` åœ¨æœåŠ¡å™¨ä¸Šï¼š

```bash
#!/bin/bash
# ä» Git éƒ¨ç½²åˆ°æœåŠ¡å™¨

set -e

cd /var/www/agentrix-website/backend

echo "=== ä» Git éƒ¨ç½² ==="

# åœæ­¢æœåŠ¡
echo "[1/6] åœæ­¢æœåŠ¡..."
pm2 stop agentrix-backend || true

# å¤‡ä»½å½“å‰ä»£ç 
echo "[2/6] å¤‡ä»½å½“å‰ä»£ç ..."
BACKUP_DIR="/var/www/agentrix-website-backup-$(date +%Y%m%d-%H%M%S)"
mkdir -p "$BACKUP_DIR"
cp -r . "$BACKUP_DIR/" 2>/dev/null || true
echo "âœ… å¤‡ä»½å·²ä¿å­˜åˆ°: $BACKUP_DIR"

# æ‹‰å–æœ€æ–°ä»£ç 
echo "[3/6] ä» Git æ‹‰å–æœ€æ–°ä»£ç ..."
git fetch origin
git reset --hard origin/main
echo "âœ… ä»£ç å·²æ›´æ–°"

# å®‰è£…ä¾èµ–
echo "[4/6] å®‰è£…ä¾èµ–..."
npm install

# æ„å»ºé¡¹ç›®
echo "[5/6] æ„å»ºé¡¹ç›®..."
npm run build

# éªŒè¯æ„å»º
if [ ! -f "dist/main.js" ]; then
    echo "âŒ æ„å»ºå¤±è´¥: dist/main.js ä¸å­˜åœ¨"
    exit 1
fi

# è¿è¡Œæ•°æ®åº“è¿ç§»
echo "[6/6] è¿è¡Œæ•°æ®åº“è¿ç§»..."
npm run migration:run || echo "âš ï¸  è¿ç§»å¤±è´¥æˆ–æ— éœ€è¿ç§»"

# é‡å¯æœåŠ¡
echo "é‡å¯æœåŠ¡..."
pm2 restart agentrix-backend --update-env

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
echo ""
echo "=== æœ€è¿‘ 20 è¡Œæ—¥å¿— ==="
pm2 logs agentrix-backend --lines 20 --nostream
```

---

## ğŸ”§ ç´§æ€¥æƒ…å†µå¤„ç†

### å¦‚æœå¿…é¡»åœ¨æœåŠ¡å™¨ä¸Šä¸´æ—¶ä¿®æ”¹

1. **è®°å½•ä¿®æ”¹å†…å®¹**
2. **ç«‹å³åŒæ­¥å›æœ¬åœ°**
   ```bash
   # åœ¨æœåŠ¡å™¨ä¸Š
   git diff > /tmp/server-changes.patch
   
   # åœ¨æœ¬åœ°
   scp root@129.226.152.88:/tmp/server-changes.patch ./
   git apply server-changes.patch
   git add .
   git commit -m "fix: ç´§æ€¥ä¿®å¤ - ä»æœåŠ¡å™¨åŒæ­¥"
   git push origin main
   ```

3. **æˆ–è€…ä½¿ç”¨ Git æäº¤**
   ```bash
   # åœ¨æœåŠ¡å™¨ä¸Š
   cd /var/www/agentrix-website/backend
   git add .
   git commit -m "fix: ç´§æ€¥ä¿®å¤æè¿°"
   git push origin main
   
   # ç„¶ååœ¨æœ¬åœ°æ‹‰å–
   git pull origin main
   ```

---

## ğŸ“Š å·¥ä½œæµç¨‹å¯¹æ¯”

| æ“ä½œ | âŒ é”™è¯¯æ–¹å¼ | âœ… æ­£ç¡®æ–¹å¼ |
|------|------------|------------|
| å¼€å‘ | åœ¨æœåŠ¡å™¨ä¸Šç›´æ¥ä¿®æ”¹ | åœ¨æœ¬åœ°å¼€å‘ |
| ç‰ˆæœ¬æ§åˆ¶ | è·³è¿‡ Git | æäº¤åˆ° Git |
| éƒ¨ç½² | rsync/scp ç›´æ¥è¦†ç›– | ä» Git æ‹‰å– |
| åŒæ­¥ | æœåŠ¡å™¨ â†’ æœ¬åœ° | Git â†’ æœåŠ¡å™¨ â†’ æœ¬åœ° |

---

## ğŸ¯ æœ€ä½³å®è·µ

1. **æ¯æ¬¡å¼€å‘å‰å…ˆæ‹‰å–æœ€æ–°ä»£ç **
   ```bash
   git pull origin main
   ```

2. **é¢‘ç¹æäº¤ï¼Œå°æ­¥å¿«è·‘**
   - å®Œæˆä¸€ä¸ªå°åŠŸèƒ½å°±æäº¤ä¸€æ¬¡
   - ä½¿ç”¨æ¸…æ™°çš„æäº¤ä¿¡æ¯

3. **ä½¿ç”¨åˆ†æ”¯å¼€å‘ï¼ˆå¯é€‰ï¼‰**
   ```bash
   # åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
   git checkout -b feature/new-feature
   
   # å¼€å‘å®Œæˆååˆå¹¶
   git checkout main
   git merge feature/new-feature
   git push origin main
   ```

4. **éƒ¨ç½²å‰åœ¨æœ¬åœ°æµ‹è¯•**
   ```bash
   npm run build
   npm run start:dev
   # æµ‹è¯•é€šè¿‡åå†éƒ¨ç½²
   ```

5. **ä½¿ç”¨ Git æ ‡ç­¾æ ‡è®°ç‰ˆæœ¬**
   ```bash
   git tag -a v1.0.0 -m "ç‰ˆæœ¬ 1.0.0"
   git push origin v1.0.0
   ```

---

## ğŸ“Œ æ€»ç»“

**è®°ä½ï¼šGit æ˜¯å”¯ä¸€çš„ä»£ç æ¥æºï¼**

- âœ… æœ¬åœ°å¼€å‘ â†’ Git æäº¤ â†’ æœåŠ¡å™¨ä» Git æ‹‰å–
- âŒ ä¸è¦åœ¨æœåŠ¡å™¨ä¸Šç›´æ¥ä¿®æ”¹ä»£ç 
- âŒ ä¸è¦è·³è¿‡ Git ç›´æ¥éƒ¨ç½²

è¿™æ ·å¯ä»¥ç¡®ä¿ï¼š
- ä»£ç ç‰ˆæœ¬å¯æ§
- å¯ä»¥å›æ»šåˆ°ä»»æ„ç‰ˆæœ¬
- å›¢é˜Ÿåä½œé¡ºç•…
- é¿å…åŒæ­¥é—®é¢˜

