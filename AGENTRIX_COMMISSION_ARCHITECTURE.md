# Agentrix 佣金架构设计文档

> 版本: 1.0 | 日期: 2026-02-01 | 状态: 生产中

## 一、架构概览

Agentrix 平台采用**双轨佣金架构**，满足不同用户群体的需求：

```
┌─────────────────────────────────────────────────────────────────┐
│                    Agentrix 佣金架构                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────┐       ┌─────────────────────────────┐  │
│  │  V5 Marketplace     │       │    Commerce Skill           │  │
│  │  (商品交易佣金)      │       │    (基础设施使用费)          │  │
│  │                     │       │                             │  │
│  │  面向: 商户/消费者   │       │  面向: 开发者/Agent         │  │
│  │  费率: 3%~10%       │       │  费率: 0%~0.5%              │  │
│  │  按商品类型          │       │  按功能叠加                  │  │
│  │                     │       │                             │  │
│  │  用户心智:          │       │  用户心智:                   │  │
│  │  "交易平台"          │ 调用→ │  "支付基础设施"              │  │
│  └──────────┬──────────┘       └──────────────┬──────────────┘  │
│             │                                 │                 │
│             └────────────────┬────────────────┘                 │
│                              ▼                                  │
│              ┌───────────────────────────────┐                  │
│              │      链上结算合约              │                  │
│              │  CommissionV2 + BudgetPool    │                  │
│              │  (BNB Chain / Base)           │                  │
│              └───────────────────────────────┘                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、V5 Marketplace 佣金（面向商户/消费者）

### 2.1 核心理念
- **平台抽佣模式**：类似淘宝、亚马逊
- **从商品GMV中扣除**：商户承担
- **包含Agent激励**：推广Agent分享激励池

### 2.2 费率表（按商品类型）

| 商品类型 | 平台费 | 激励池 | **总费率** | 结算时间 |
|----------|--------|--------|-----------|----------|
| 实物商品 | 0.5% | 2.5% | **3.0%** | 确认收货 T+7 |
| 服务类 | 1.0% | 4.0% | **5.0%** | 服务完成 T+3 |
| 虚拟资产 | 0.5% | 2.5% | **3.0%** | 即时结算 |
| NFT/RWA | 0.5% | 2.0% | **2.5%** | 链上确认 T+1 |
| 开发工具/技能 | 3.0% | 7.0% | **10.0%** | 即时结算 |
| 订阅服务 | 1.0% | 4.0% | **5.0%** | 周期结算 |

### 2.3 激励池分配规则

```typescript
// V5.0 Agent 分佣规则
EXECUTOR_SHARE_OF_POOL = 0.7  // 执行Agent: 70%
REFERRER_SHARE_OF_POOL = 0.3  // 推荐Agent: 30%

// 示例: 用户购买 ¥100 技能
// 总费率 10% = ¥10
// ├─ 平台费: ¥3 (3%)
// └─ 激励池: ¥7 (7%)
//     ├─ 执行Agent: ¥4.9 (70%)
//     └─ 推荐Agent: ¥2.1 (30%)
```

### 2.4 适用场景
- 商户在 Marketplace 开店卖商品
- 专业用户发布付费技能
- 消费者购买商品/服务
- Agent 推广赚取佣金

---

## 三、Commerce Skill 费用（面向开发者/Agent）

### 3.1 核心理念
- **基础设施使用费**：类似 Stripe API、支付宝开放平台
- **从支付金额中扣除**：调用方承担
- **按功能叠加**：用什么付什么

### 3.2 费率表（按功能叠加）

| 功能 | 费率 | 说明 |
|------|------|------|
| 纯加密支付 | **0%** | 不需要任何转换 |
| + 法币入金(Onramp) | **+0.1%** | 用户用法币购买USDC |
| + 法币出金(Offramp) | **+0.1%** | 商户USDC提现到银行 |
| + 分账(Split) | **+0.3%** | 多方自动分账 |
| **全功能组合** | **0.5%** | 同时使用所有功能 |

### 3.3 费用示例

```typescript
// 场景1: Agent纯加密支付
commerce.pay({ amount: 1000, usdc: true })
// 费用: 0% = $0

// 场景2: 用户法币支付 + 分账
commerce.pay({ 
  amount: 1000, 
  usesOnramp: true,  // +0.1%
  usesSplit: true    // +0.3%
})
// 费用: 0.4% = $4

// 场景3: 全功能（法币入→分账→法币出）
commerce.pay({
  amount: 1000,
  usesOnramp: true,   // +0.1%
  usesOfframp: true,  // +0.1%
  usesSplit: true     // +0.3%
})
// 费用: 0.5% = $5
```

### 3.4 适用场景
- 开发者 Agent 接入支付能力
- SaaS 平台内嵌支付功能
- 外包平台多方分账
- DAO 预算管理

---

## 四、两套机制的本质区别

| 维度 | V5 Marketplace | Commerce Skill |
|------|---------------|----------------|
| **本质** | 平台抽佣（交易税） | 基础设施费（工具费） |
| **费用来源** | 商品GMV | 支付金额 |
| **谁付费** | 商户（卖家） | 调用方（开发者/Agent） |
| **费率决定因素** | 商品类型（固定） | 使用功能（可选叠加） |
| **结算时间** | 按商品类型（T+1~T+37） | 可自定义（即时~里程碑） |
| **Agent角色** | 赚分成（被动） | 自主执行（主动） |
| **分账灵活性** | 固定7:3 | 完全自定义 |
| **用户心智** | "我在开店/购物" | "我在调用API" |

---

## 五、用户画像对比

### V5 Marketplace 用户

| 角色 | 典型用户 | 核心诉求 |
|------|----------|----------|
| 商户 | 淘宝卖家、服务提供商、内容创作者 | "平台帮我找客户" |
| 买家 | 普通消费者 | "我要买商品/服务" |
| Agent | 推广Agent、执行Agent | "帮商户推广赚佣金" |

### Commerce Skill 用户

| 角色 | 典型用户 | 核心诉求 |
|------|----------|----------|
| 开发者 | SaaS开发者、Agent开发者 | "不想自己造支付轮子" |
| Agent | 自主Agent、协作Agent | "需要自动完成支付结算" |
| 企业 | 跨境电商、外包平台、DAO | "需要灵活的多方分账" |

---

## 六、互相关系：Marketplace 底层调用 Commerce Skill

```
用户在 Marketplace 购买商品 (¥100)
           │
           ▼
┌─────────────────────────────────────┐
│  V5 Marketplace 层                  │
│  计算佣金: 10% = ¥10               │
│  ├─ 平台费: ¥3                     │
│  └─ 激励池: ¥7 (执行70%+推荐30%)   │
└──────────────┬──────────────────────┘
               │ 调用
               ▼
┌─────────────────────────────────────┐
│  Commerce Skill 层                  │
│  功能费: 0.3% = ¥0.3 (分账功能)    │
│  执行分账到各方钱包                 │
└──────────────┬──────────────────────┘
               │ 调用
               ▼
┌─────────────────────────────────────┐
│  链上合约层                         │
│  CommissionV2.settleWithSplit()    │
└─────────────────────────────────────┘
```

---

## 七、合约地址（BNB Testnet）

| 合约 | 地址 | 用途 |
|------|------|------|
| CommissionV2 | `0x1de9d3e3EFbF30f0846aBC07b684C7E675138827` | 统一佣金结算 |
| BudgetPool | `0x8C8D25589b700D0F94b5Ad09aFacEB58595481c9` | 预算池管理 |
| Settlement Token | `0xc23453b4842FDc4360A0a3518E2C0f51a2069386` | USDC代币 |

---

## 八、配置文件位置

| 配置 | 文件路径 |
|------|----------|
| V5费率配置 | `backend/src/modules/commission/financial-architecture.config.ts` |
| Commerce费率模板 | `backend/src/modules/commerce/split-plan.service.ts` |
| 合约部署脚本 | `contract/scripts/deploy-CommissionV2.ts` |
| 前端佣金面板 | `frontend/components/agent/workspace/commerce/` |

---

*文档维护者: Agentrix Team | 最后更新: 2026-02-01*
