#!/bin/bash

# é‡Šæ”¾ç«¯å£3001å¹¶é‡å¯åç«¯æœåŠ¡

echo "=========================================="
echo "ğŸ”§ é‡Šæ”¾ç«¯å£3001å¹¶é‡å¯åç«¯æœåŠ¡"
echo "=========================================="
echo ""

# æŸ¥æ‰¾å¹¶æ€æ­»å ç”¨3001ç«¯å£çš„è¿›ç¨‹
echo "[1/3] æŸ¥æ‰¾å ç”¨3001ç«¯å£çš„è¿›ç¨‹..."
PID=$(lsof -ti:3001 2>/dev/null)

if [ -n "$PID" ]; then
    echo "æ‰¾åˆ°è¿›ç¨‹: $PID"
    echo "[2/3] æ€æ­»è¿›ç¨‹..."
    kill -9 $PID 2>/dev/null
    sleep 2
    echo "âœ… è¿›ç¨‹å·²ç»ˆæ­¢"
else
    echo "âœ… ç«¯å£3001æœªè¢«å ç”¨"
fi

# éªŒè¯ç«¯å£çŠ¶æ€
echo "[3/3] éªŒè¯ç«¯å£çŠ¶æ€..."
if lsof -ti:3001 >/dev/null 2>&1; then
    echo "âŒ ç«¯å£ä»è¢«å ç”¨ï¼Œå°è¯•å¼ºåˆ¶æ€æ­»..."
    lsof -ti:3001 | xargs kill -9 2>/dev/null
    sleep 1
else
    echo "âœ… ç«¯å£å·²é‡Šæ”¾"
fi

echo ""
echo "ç°åœ¨å¯ä»¥å¯åŠ¨åç«¯æœåŠ¡äº†:"
echo "  cd backend"
echo "  npm run start:dev"

