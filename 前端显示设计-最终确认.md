# 前端显示设计-最终确认

## 一、基于UserFriendlyPaymentModalV2的显示设计

### 1.1 保持现有功能

✅ **QuickPay选项和授权检查**
- 显示QuickPay授权状态
- 显示授权阈值（每笔0.1U，每天10U）
- 支持授权引导

✅ **商家收款方式配置**
- 只收法币：只显示法币支付选项
- 只收数字货币：只显示数字货币支付选项
- 两种都接受：显示所有支付选项

✅ **智能路由价格对比显示**
- 数字货币直接支付价格（最低）
- Stripe支付价格
- 法币转数字货币最优价格

✅ **KYC流程引导**
- 显示是否需要KYC
- 引导用户完成KYC

✅ **法币转数字货币报价显示**
- 显示最优Provider报价
- 显示汇率信息

### 1.2 更新显示内容（简化）

#### 支付方式选项显示

**每个支付选项显示**：
```
┌─────────────────────────────────────┐
│ [图标] 支付方式名称                  │
│                                     │
│ 描述信息                            │
│                                     │
│ 总手续费：X%                        │
│ 汇率：1 CNY = X USDC（如果涉及）   │
│                                     │
│ [需要KYC] [QuickPay已授权]          │
└─────────────────────────────────────┘
```

#### 支付前汇总显示

**法币支付**：
```
┌─────────────────────────────────────┐
│ 支付金额：100元                      │
├─────────────────────────────────────┤
│ 推荐路由：法币转数字货币（最优）     │
│ 汇率：1 CNY = 0.138 USDC            │
│ 总手续费：4.5%                      │
│                                     │
│ [需要KYC] [QuickPay已授权]          │
│                                     │
│ [确认支付]                          │
└─────────────────────────────────────┘
```

**数字货币支付**：
```
┌─────────────────────────────────────┐
│ 支付金额：100 USDC                  │
├─────────────────────────────────────┤
│ 推荐路由：数字货币直接支付（最低）   │
│ 总手续费：2.3%                      │
│                                     │
│ [QuickPay已授权]                    │
│                                     │
│ [确认支付]                          │
└─────────────────────────────────────┘
```

### 1.3 支付中显示

```
┌─────────────────────────────────────┐
│ 正在处理支付...                     │
├─────────────────────────────────────┤
│ [进度条]                            │
│                                     │
│ 步骤1：通过Provider处理支付 ✓      │
│ 步骤2：转换为USDC... ⏳            │
│ 步骤3：创建合约交易... ⏳           │
└─────────────────────────────────────┘
```

### 1.4 支付后显示

```
┌─────────────────────────────────────┐
│ ✅ 支付成功                          │
├─────────────────────────────────────┤
│ 支付金额：100元                      │
│ 交易哈希：0x...                     │
│                                     │
│ [查看详情] [返回]                   │
└─────────────────────────────────────┘
```

---

## 二、显示逻辑

### 2.1 总手续费计算

**法币转数字货币（无Agent）**：
```
总手续费 = Provider手续费% + Agentrix手续费%
```

**法币转数字货币（有Agent）**：
```
总手续费 = Provider手续费% + Agent手续费% + Agentrix手续费%
```

**数字货币直接支付（无Agent）**：
```
总手续费 = Agentrix手续费%
```

**数字货币直接支付（有Agent）**：
```
总手续费 = Agent手续费% + Agentrix手续费%
```

### 2.2 汇率显示

**显示条件**：
- 涉及法币和数字货币转换时显示
- 格式：1 CNY = 0.138 USDC

**数据来源**：
- Provider实时汇率
- 或智能路由计算的汇率

### 2.3 KYC显示

**显示条件**：
- 法币转数字货币需要KYC时显示
- 显示"[需要KYC]"标签
- 点击后引导用户完成KYC

### 2.4 QuickPay显示

**显示条件**：
- 用户已授权QuickPay时显示
- 显示"[QuickPay已授权]"标签
- 显示授权阈值信息

---

## 三、代码实现要点

### 3.1 前端组件更新

**UserFriendlyPaymentModalV2.tsx**：
- 保持现有功能
- 更新手续费显示：只显示总手续费
- 更新汇率显示：如果涉及转换
- 更新KYC和QuickPay信息显示

### 3.2 后端API更新

**payment.api.ts**：
- 返回总手续费（百分比）
- 返回汇率信息（如果涉及转换）
- 返回KYC要求
- 返回QuickPay授权状态

### 3.3 计算逻辑

**smart-router.service.ts**：
- 计算总手续费（所有手续费的总和）
- 计算汇率（如果涉及转换）
- 返回KYC要求
- 返回QuickPay授权状态

---

## 四、需要确认

1. **总手续费是否包含所有手续费？**
   - Provider + Agent + Agentrix？

2. **是否显示商家到账金额？**
   - 显示：商家到账：XX USDC
   - 不显示：只显示总手续费和汇率

3. **汇率显示格式？**
   - 1 CNY = 0.138 USDC
   - 或其他格式？

4. **KYC和QuickPay信息显示位置？**
   - 在支付选项下方？
   - 在支付前汇总区域？

---

## 五、下一步

1. **等待您提供具体的手续费比例**
2. **确认前端显示内容**
3. **更新代码实现**

