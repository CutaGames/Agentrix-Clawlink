# ARN Protocol (Alliance Rewards Network)

> x402 ç”Ÿæ€çš„è´¨é‡ä¸æ¿€åŠ±åŸºç¡€è®¾æ–½

## æ¦‚è¿°

ARN (Alliance Rewards Network) æ˜¯ x402 æ”¯ä»˜åè®®çš„æ¿€åŠ±å±‚ï¼Œè´Ÿè´£ï¼š
- ğŸ“Š æ”¶å–å’Œåˆ†é…åè®®è´¹ç”¨ (0.3%)
- ğŸ† ç®¡ç† Epoch å‘¨æœŸå¥–åŠ±åˆ†å‘
- âœ… é€šè¿‡ Bond/Challenge æœºåˆ¶ä¿è¯æœåŠ¡è´¨é‡

## æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·æ”¯ä»˜æµç¨‹                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ArnSessionManager                             â”‚
â”‚              (Session Key æ”¯ä»˜å…¥å£)                               â”‚
â”‚  â€¢ éªŒè¯ Session ç­¾å                                              â”‚
â”‚  â€¢ æ£€æŸ¥é¢åº¦é™åˆ¶                                                    â”‚
â”‚  â€¢ è½¬å‘æ”¯ä»˜åˆ° FeeSplitter                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ArnFeeSplitter                               â”‚
â”‚               (æ ¸å¿ƒåˆ†è´¦åˆçº¦)                                       â”‚
â”‚  â€¢ æ‰£é™¤ 0.3% åè®®è´¹ â†’ Treasury                                    â”‚
â”‚  â€¢ è®°å½•æ”¶æ® â†’ ReceiptRegistry                                     â”‚
â”‚  â€¢ è½¬å‘å‰©ä½™ 99.7% â†’ Commission åˆçº¦                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                   â”‚
                    â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ArnTreasury          â”‚  â”‚    Commission Contract    â”‚
â”‚    (åè®®è´¹é‡‘åº“)            â”‚  â”‚     (å•†æˆ·åˆ†è´¦)            â”‚
â”‚  â€¢ 40% Watcher            â”‚  â”‚  â€¢ å•†æˆ·æ”¶å…¥               â”‚
â”‚  â€¢ 30% Operator           â”‚  â”‚  â€¢ Agent ä½£é‡‘             â”‚
â”‚  â€¢ 20% Public Goods       â”‚  â”‚  â€¢ å¹³å°è´¹ç”¨               â”‚
â”‚  â€¢ 10% Security Reserve   â”‚  â”‚  â€¢ Off-ramp è´¹ç”¨          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      EpochManager                                â”‚
â”‚                   (å‘¨æœŸç®¡ç†å™¨)                                    â”‚
â”‚  â€¢ 7å¤©ä¸ºä¸€ä¸ª Epoch                                               â”‚
â”‚  â€¢ ç®¡ç† Epoch ç”Ÿå‘½å‘¨æœŸ                                            â”‚
â”‚  â€¢ è§¦å‘å¥–åŠ±åˆ†é…                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MerkleDistributor                             â”‚
â”‚                   (Merkle åˆ†å‘å™¨)                                 â”‚
â”‚  â€¢ ä½¿ç”¨ Merkle è¯æ˜éªŒè¯é¢†å–èµ„æ ¼                                    â”‚
â”‚  â€¢ æ”¯æŒå¤š Epoch ç´¯ç§¯é¢†å–                                          â”‚
â”‚  â€¢ Gas é«˜æ•ˆçš„æ‰¹é‡åˆ†å‘                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  AttestationRegistry                             â”‚
â”‚                  (è´¨é‡è¯æ˜æ³¨å†Œè¡¨)                                  â”‚
â”‚  â€¢ Agent æäº¤æœåŠ¡è´¨é‡è¯æ˜                                         â”‚
â”‚  â€¢ Bond è´¨æŠ¼æœºåˆ¶                                                  â”‚
â”‚  â€¢ Challenge æŒ‘æˆ˜æœºåˆ¶                                             â”‚
â”‚  â€¢ Arbiter ä»²è£                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## åˆçº¦

| åˆçº¦ | æè¿° | çŠ¶æ€ |
|------|------|------|
| `ArnSessionManager` | Session Key æ”¯ä»˜ç®¡ç†å™¨ | âœ… å®Œæˆ |
| `ArnFeeSplitter` | æ ¸å¿ƒåˆ†è´¦åˆçº¦ (0.3% åè®®è´¹) | âœ… å®Œæˆ |
| `ArnTreasury` | åè®®è´¹é‡‘åº“ (40/30/20/10 åˆ†é…) | âœ… å®Œæˆ |
| `ReceiptRegistry` | é“¾ä¸Šæ”¶æ®æ³¨å†Œè¡¨ | âœ… å®Œæˆ |
| `EpochManager` | Epoch å‘¨æœŸç®¡ç†å™¨ | âœ… å®Œæˆ |
| `MerkleDistributor` | Merkle æ ‘å¥–åŠ±åˆ†å‘å™¨ | âœ… å®Œæˆ |
| `AttestationRegistry` | è´¨é‡è¯æ˜ + Bond/Challenge | âœ… å®Œæˆ |

## å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
cd arn-protocol
npm install
```

### ç¼–è¯‘åˆçº¦

```bash
npm run compile
```

### è¿è¡Œæµ‹è¯•

```bash
npm test
```

### éƒ¨ç½²åˆ° BSC Testnet

```bash
# é…ç½® .env æ–‡ä»¶
cp .env.example .env
# ç¼–è¾‘ .env æ·»åŠ ç§é’¥å’Œ RPC URL

# éƒ¨ç½²æ‰€æœ‰åˆçº¦
npm run deploy:testnet
```

## é…ç½®

### ç¯å¢ƒå˜é‡

```env
# å¿…éœ€
PRIVATE_KEY=0x...                    # éƒ¨ç½²è´¦æˆ·ç§é’¥
BSC_TESTNET_RPC_URL=https://...      # BSC Testnet RPC

# å¯é€‰
COMMISSION_CONTRACT_ADDRESS=0x...    # Commission åˆçº¦åœ°å€
BSC_TESTNET_USDC_ADDRESS=0x...       # USDT/USDC ä»£å¸åœ°å€
BSCSCAN_API_KEY=...                  # ç”¨äºåˆçº¦éªŒè¯
```

## è´¹ç”¨ç»“æ„

### åè®®è´¹ (0.3%)

æ¯ç¬” x402 æ”¯ä»˜æ‰£é™¤ 0.3% åè®®è´¹ï¼Œåˆ†é…å¦‚ä¸‹ï¼š

| è§’è‰² | æ¯”ä¾‹ | ç”¨é€” |
|------|------|------|
| Watcher | 40% | é“¾ä¸Šç›‘æ§å’Œé¢„è­¦ |
| Operator | 30% | èŠ‚ç‚¹è¿è¥å’Œç»´æŠ¤ |
| Public Goods | 20% | ç”Ÿæ€å…¬å…±ç‰©å“å»ºè®¾ |
| Security Reserve | 10% | å®‰å…¨å‚¨å¤‡é‡‘ |

### Epoch å¥–åŠ±

- **å‘¨æœŸ**: 7 å¤©
- **åˆ†å‘æ–¹å¼**: Merkle æ ‘è¯æ˜
- **é¢†å–**: ç”¨æˆ·é€šè¿‡ `claim()` æˆ– `claimMultiple()` é¢†å–

## è´¨é‡æ¿€åŠ± (Bond/Challenge)

### æµç¨‹

1. **æäº¤è¯æ˜**: Agent æäº¤æœåŠ¡è´¨é‡è¯æ˜ + å¯é€‰ Bond
2. **æŒ‘æˆ˜æœŸ**: 7 å¤©å†…å…¶ä»–äººå¯ä»¥ Challenge
3. **ä»²è£**: å¦‚è¢«æŒ‘æˆ˜ï¼ŒArbiter è¿›è¡Œä»²è£
4. **ç»“æœ**:
   - æŒ‘æˆ˜æˆåŠŸ: 50% Bond ç»™æŒ‘æˆ˜è€…
   - æŒ‘æˆ˜å¤±è´¥: Agent ä¿ç•™ Bondï¼Œè·å¾—éªŒè¯æ ‡è®°

### å‚æ•°

- æœ€å° Bond: 10 USDT
- æŒ‘æˆ˜æœŸ: 7 å¤©
- Slash æ¯”ä¾‹: 50%

## æµ‹è¯•è¦†ç›–

```
ARN Protocol
  ArnFeeSplitter
    âœ” Should split native payment correctly with 0.3% fee
    âœ” Should emit PaymentSplit event
  ArnTreasury
    âœ” Should have correct distribution ratios
    âœ” Should receive funds
  ReceiptRegistry
    âœ” Should record receipt correctly
    âœ” Should track epoch stats
  EpochManager
    âœ” Should initialize with epoch 1
    âœ” Should not advance epoch before time
    âœ” Should advance epoch after duration
    âœ” Should finalize epoch with merkle root
  MerkleDistributor
    âœ” Should set merkle root
  AttestationRegistry
    âœ” Should submit attestation without bond
    âœ” Should validate attestation after challenge period

15 passing
```

## è·¯çº¿å›¾

### Phase 1: æ ¸å¿ƒåˆçº¦ âœ…
- [x] ArnSessionManager
- [x] ArnFeeSplitter
- [x] ArnTreasury
- [x] ReceiptRegistry
- [x] EpochManager
- [x] MerkleDistributor
- [x] AttestationRegistry

### Phase 2: åç«¯æœåŠ¡ (è¿›è¡Œä¸­)
- [ ] Epoch ç»“ç®—æœåŠ¡
- [ ] Merkle æ ‘ç”ŸæˆæœåŠ¡
- [ ] å¥–åŠ±è®¡ç®—å¼•æ“
- [ ] é“¾ä¸Šäº‹ä»¶ç´¢å¼•å™¨

### Phase 3: å‰ç«¯é›†æˆ
- [ ] å¥–åŠ±ä»ªè¡¨ç›˜
- [ ] é¢†å–ç•Œé¢
- [ ] Agent è¯æ˜æäº¤
- [ ] æŒ‘æˆ˜/ä»²è£ç•Œé¢

### Phase 4: ç‹¬ç«‹ä»“åº“
- [ ] è¿ç§»åˆ°ç‹¬ç«‹ GitHub ä»“åº“
- [ ] NPM åŒ…å‘å¸ƒ
- [ ] SDK å¼€å‘
- [ ] æ–‡æ¡£ç«™ç‚¹

## è®¸å¯è¯

MIT

## ç›¸å…³é“¾æ¥

- [x402 Protocol](https://x402.org)
- [Agentrix](https://agentrix.top)
- [ERC-8004 Session Keys](https://eips.ethereum.org/EIPS/eip-8004)
