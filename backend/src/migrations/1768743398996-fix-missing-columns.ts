import { MigrationInterface, QueryRunner } from "typeorm";

export class FixMissingColumns1768743398996 implements MigrationInterface {
    name = 'FixMissingColumns1768743398996'

    public async up(queryRunner: QueryRunner): Promise<void> {
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" DROP CONSTRAINT IF EXISTS "FK_workspaces_owner"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" DROP CONSTRAINT IF EXISTS "FK_workspace_members_user"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" DROP CONSTRAINT IF EXISTS "FK_workspace_members_workspace"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "user_installed_skills" DROP CONSTRAINT IF EXISTS "FK_user_installed_skills_skill"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "user_installed_skills" DROP CONSTRAINT IF EXISTS "FK_user_installed_skills_user"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_skill_conversions" DROP CONSTRAINT IF EXISTS "product_skill_conversions_skillId_fkey"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_skill_conversions" DROP CONSTRAINT IF EXISTS "product_skill_conversions_productId_fkey"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_reviews" DROP CONSTRAINT IF EXISTS "FK_a2ffe4b13d499c0e8aa165996c6"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skill_analytics" DROP CONSTRAINT IF EXISTS "skill_analytics_skillId_fkey"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "external_skill_mappings" DROP CONSTRAINT IF EXISTS "external_skill_mappings_agentrixSkillId_fkey"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" DROP CONSTRAINT IF EXISTS "fk_developer_account_user"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_allocations_v4" DROP CONSTRAINT IF EXISTS "FK_commission_allocations_v4_settlement"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP CONSTRAINT IF EXISTS "FK_authorizations_agent"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP CONSTRAINT IF EXISTS "FK_authorizations_user"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "api_keys" DROP CONSTRAINT IF EXISTS "FK_api_keys_user"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_sessions" DROP CONSTRAINT IF EXISTS "FK_40a6b0600d60c067ae0f8659ce0"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" DROP CONSTRAINT IF EXISTS "FK_4fb7acafe990a5abbf321c534a5"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" DROP CONSTRAINT IF EXISTS "FK_48a6cbf3db98bc76347a8ff4615"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_users_appleId"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_users_twitterId"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_users_status"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_users_email"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_workspaces_owner_id"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_workspaces_status"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_workspaces_slug"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_workspace_members_workspace_user"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_workspace_members_user_id"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_webhook_configs_merchantId"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_SKILLS_STATUS"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_SKILLS_CATEGORY"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_SKILLS_AUTHOR"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."idx_skills_layer"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."idx_skills_source"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."idx_skills_resource_type"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_66fd180e7e0ee1ac31f003bcba"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_ecommerce_connections_merchant_platform"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_product_sync_mappings_connection_external_unique"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_product_sync_mappings_product_id"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_product_reviews_product_status"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_product_reviews_merchant_status"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_policies_userId"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_policies_workspaceId"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_pay_intents_idempotencyKey"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."idx_skill_analytics_skill_time"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."idx_skill_analytics_caller_time"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."idx_skill_analytics_platform_time"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_kyc_records_user_id"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_kyc_records_status"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_kyc_records_level"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_kyc_records_expires_at"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_fund_paths_payment_id"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_fund_paths_transaction_hash"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_fund_paths_created_at"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_fund_paths_path_type"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_fund_paths_is_x402"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."idx_developer_accounts_status"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."idx_developer_accounts_tier"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."idx_developer_accounts_user_id"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."idx_developer_accounts_developer_unique_id"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_authorizations_user_agent"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_authorizations_user_status"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_9bdba9200942bb473313764db9"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_9caabe7c3a8dabd16e206879b0"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_api_keys_key_hash"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_api_keys_user_id"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_25a2aa754bee06261e91bfc051"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_726c4e7569d4ccb1af4a35ac12"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_agent_accounts_unique_id"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_agent_accounts_owner_id"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_agent_accounts_status"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_agent_accounts_type"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_accounts_owner"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_accounts_wallet_address"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_accounts_status"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_accounts_is_default"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_e7bf8ade89ec9a566493f3f5e8"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_48a6cbf3db98bc76347a8ff461"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_316e4c34c7b75742e11c083f89"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_827af7fe090efe8ee13c98c384"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_128772fbda0ab3bf2605f2955d"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_10ae0181853fe5ddf3372bccba"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_cef5ce7c595db3ef0126a9ad65"`);
        await queryRunner.query(`DO $$ BEGIN IF NOT EXISTS (SELECT 1 FROM pg_type WHERE typname = 'risk_assessments_decision_enum') THEN CREATE TYPE "public"."risk_assessments_decision_enum" AS ENUM('approve', 'review', 'reject'); END IF; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "user_installed_skills" DROP CONSTRAINT IF EXISTS "UQ_user_skill"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "external_skill_mappings" DROP CONSTRAINT IF EXISTS "external_skill_mappings_externalPlatform_externalId_key"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."webhook_events_status_enum" AS ENUM('pending', 'delivered', 'failed')`);
        await queryRunner.query(`CREATE TABLE "webhook_events" ("id" uuid NOT NULL DEFAULT uuid_generate_v4(), "configId" character varying NOT NULL, "eventType" character varying NOT NULL, "payload" jsonb NOT NULL, "status" "public"."webhook_events_status_enum" NOT NULL DEFAULT 'pending', "attempts" integer NOT NULL DEFAULT '0', "lastAttemptAt" TIMESTAMP, "deliveredAt" TIMESTAMP, "error" text, "createdAt" TIMESTAMP NOT NULL DEFAULT now(), "updatedAt" TIMESTAMP NOT NULL DEFAULT now(), CONSTRAINT "PK_4cba37e6a0acb5e1fc49c34ebfd" PRIMARY KEY ("id"))`);
        await queryRunner.query(`CREATE INDEX "IDX_45c756af6533ee6e9f80ce7efe" ON "webhook_events" ("configId") `);
        await queryRunner.query(`CREATE TYPE "public"."agent_registry_risktier_enum" AS ENUM('low', 'medium', 'high')`);
        await queryRunner.query(`CREATE TABLE "agent_registry" ("id" uuid NOT NULL DEFAULT uuid_generate_v4(), "agentId" character varying NOT NULL, "name" character varying NOT NULL, "description" text, "owner_id" uuid NOT NULL, "publicKey" character varying, "clientSecret" character varying, "riskTier" "public"."agent_registry_risktier_enum" NOT NULL DEFAULT 'medium', "easAttestationUid" character varying, "capabilities" jsonb, "callbacks" jsonb, "createdAt" TIMESTAMP NOT NULL DEFAULT now(), "updatedAt" TIMESTAMP NOT NULL DEFAULT now(), CONSTRAINT "UQ_aeacc3841a82b3665d07baef452" UNIQUE ("agentId"), CONSTRAINT "PK_2fa83fbd316bd264716d0db1a6e" PRIMARY KEY ("id"))`);
        await queryRunner.query(`CREATE TABLE "audit_proofs" ("id" uuid NOT NULL DEFAULT uuid_generate_v4(), "payIntentId" character varying NOT NULL, "authorizationId" character varying, "agentId" character varying, "decisionLog" jsonb NOT NULL, "signature" text, "proofHash" character varying(64), "previousProofHash" character varying(64), "createdAt" TIMESTAMP NOT NULL DEFAULT now(), CONSTRAINT "PK_2a43c911a632217c1b69809a11f" PRIMARY KEY ("id"))`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "users" DROP COLUMN IF EXISTS "status_updated_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "users" DROP COLUMN IF EXISTS "last_active_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "users" DROP COLUMN IF EXISTS "default_account_id"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "users" DROP COLUMN IF EXISTS "status_reason"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" DROP COLUMN IF EXISTS "max_members"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" DROP COLUMN IF EXISTS "max_agents"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" DROP COLUMN IF EXISTS "max_storage_mb"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" DROP COLUMN IF EXISTS "used_storage_mb"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" DROP COLUMN IF EXISTS "plan_expires_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" DROP COLUMN IF EXISTS "created_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" DROP COLUMN IF EXISTS "updated_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" DROP COLUMN IF EXISTS "icon_url"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" DROP COLUMN IF EXISTS "invited_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" DROP COLUMN IF EXISTS "accepted_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" DROP COLUMN IF EXISTS "invited_by"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" DROP COLUMN IF EXISTS "last_active_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" DROP COLUMN IF EXISTS "joined_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" DROP COLUMN IF EXISTS "updated_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" DROP COLUMN IF EXISTS "display_name"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "webhook_configs" DROP COLUMN IF EXISTS "merchantId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "webhook_configs" DROP COLUMN IF EXISTS "timeout"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "webhook_configs" DROP COLUMN IF EXISTS "enabled"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" DROP COLUMN IF EXISTS "ratingCount"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" DROP COLUMN IF EXISTS "transactionId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" DROP COLUMN IF EXISTS "agentId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "products" DROP COLUMN IF EXISTS "reviewedAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "products" DROP COLUMN IF EXISTS "lastSyncAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "products" DROP COLUMN IF EXISTS "reviewedBy"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "products" DROP COLUMN IF EXISTS "reviewNote"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_reviews" DROP COLUMN IF EXISTS "product_snapshot"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_reviews" DROP COLUMN IF EXISTS "revision_fields"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_reviews" DROP COLUMN IF EXISTS "auto_review_result"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_reviews" DROP COLUMN IF EXISTS "review_comment"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_reviews" DROP COLUMN IF EXISTS "rejection_reason"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" DROP COLUMN IF EXISTS "lastTriggered"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" DROP COLUMN IF EXISTS "createdAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" DROP COLUMN IF EXISTS "updatedAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "document_type"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."document_type_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "date_of_birth"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "company_info"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "reviewed_by"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "reviewed_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "review_history"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "approved_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "expires_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "last_reminder_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "provider_response"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "aml_risk_score"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "sanction_check_result"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "created_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "updated_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "full_name"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "document_number"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "country_code"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "selfie_url"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "company_name"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "company_registration_number"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "company_type"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "rejection_reason"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "review_notes"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "provider_name"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "provider_verification_id"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" DROP COLUMN IF EXISTS "contact_email"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" DROP COLUMN IF EXISTS "status_reason"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" DROP COLUMN IF EXISTS "unlock_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" DROP COLUMN IF EXISTS "trigger_type"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" DROP COLUMN IF EXISTS "merchant_id"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "authorization_type"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."authorization_type_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "is_auto_pay"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "single_tx_limit"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "daily_limit"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "monthly_limit"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "used_today"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "used_this_month"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "total_used"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "last_daily_reset_date"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "last_monthly_reset_date"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "expires_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "created_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "updated_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "userId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "balance"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "usdValue"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "lastSyncedAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "tokenAddress"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "tokenSymbol"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "api_keys" DROP COLUMN IF EXISTS "allowed_origins"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "parent_agent_id"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "agent_type"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."agent_type_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "default_account_id"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "mpc_wallet_id"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "credit_score"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "risk_level"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."agent_risk_level_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "credit_score_updated_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "spending_limits"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "used_today_amount"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "used_month_amount"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "limit_reset_date"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "activated_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "last_active_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "total_transactions"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "total_transaction_amount"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "successful_transactions"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "failed_transactions"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "created_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "updated_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP CONSTRAINT IF EXISTS "UQ_7bcc7100cafd8838a8200bb70e4"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "agent_unique_id"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "avatar_url"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "public_key"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "api_secret_hash"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "api_key_prefix"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "external_wallet_address"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "eas_attestation_uid"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "onchain_registration_tx_hash"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "registration_chain"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "status_reason"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "owner_type"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."account_owner_type_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "wallet_type"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."account_wallet_type_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "chain_type"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."account_chain_type_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "mpc_wallet_id"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "available_balance"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "frozen_balance"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "pending_balance"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "balance_updated_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "multi_currency_balances"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "is_default"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "single_tx_limit"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "daily_limit"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "monthly_limit"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "total_deposit"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "total_withdraw"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "transaction_count"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "created_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "updated_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP CONSTRAINT IF EXISTS "UQ_abcd260aa34b3ad2c0ff663dc20"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "account_id"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "owner_id"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "chain_id"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "wallet_address"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "status_reason"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" DROP COLUMN IF EXISTS "paymentId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" DROP COLUMN IF EXISTS "decision"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        try {
            await queryRunner.query(`DROP TYPE IF EXISTS "public"."risk_assessments_decision_enum"`);
        } catch (e) {
            console.log('⚠️ Could not drop risk_assessments_decision_enum (not owner)');
        }
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" DROP COLUMN IF EXISTS "metadata"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "assetType"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        try {
            await queryRunner.query(`DROP TYPE IF EXISTS "public"."asset_aggregations_assettype_enum"`);
        } catch (e) {
            console.log('⚠️ Could not drop asset_aggregations_assettype_enum (not owner)');
        }
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "sourceType"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        try {
            await queryRunner.query(`DROP TYPE IF EXISTS "public"."asset_aggregations_sourcetype_enum"`);
        } catch (e) {
            console.log('⚠️ Could not drop asset_aggregations_sourcetype_enum (not owner)');
        }
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "metadata"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "price"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "commissionRate"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "incomeMode"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        try {
            await queryRunner.query(`DROP TYPE IF EXISTS "public"."asset_aggregations_incomemode_enum"`);
        } catch (e) {
            console.log('⚠️ Could not drop asset_aggregations_incomemode_enum (not owner)');
        }
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "assetId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "sourcePlatform"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "contractAddress"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "tokenId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "currency"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ADD IF NOT EXISTS "iconUrl" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ADD IF NOT EXISTS "maxMembers" integer NOT NULL DEFAULT '1'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ADD IF NOT EXISTS "maxAgents" integer NOT NULL DEFAULT '3'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ADD IF NOT EXISTS "maxStorageMB" integer NOT NULL DEFAULT '100'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ADD IF NOT EXISTS "usedStorageMB" numeric(10,2) NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ADD IF NOT EXISTS "planExpiresAt" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ADD IF NOT EXISTS "createdAt" TIMESTAMP NOT NULL DEFAULT now(); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ADD IF NOT EXISTS "updatedAt" TIMESTAMP NOT NULL DEFAULT now(); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" ADD "displayName" character varying(50); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" ADD "invitedAt" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" ADD "acceptedAt" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" ADD "invitedBy" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" ADD "lastActiveAt" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" ADD "joinedAt" TIMESTAMP NOT NULL DEFAULT now(); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" ADD "updatedAt" TIMESTAMP NOT NULL DEFAULT now(); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "webhook_configs" ADD "user_id" uuid NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "webhook_configs" ADD "active" boolean NOT NULL DEFAULT true; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" ADD "paymentId" uuid; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" ADD "decision" "public"."risk_assessments_decision_enum" DEFAULT 'review'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" ADD "metadata" jsonb; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "pay_intents" ADD "attribution" jsonb; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "fullName" character varying(100); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."kyc_records_documenttype_enum" AS ENUM('id_card', 'passport', 'driver_license', 'business_license', 'bank_statement', 'utility_bill', 'other')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "documentType" "public"."kyc_records_documenttype_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "documentNumber" character varying(100); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "dateOfBirth" date; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "countryCode" character varying(10); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "selfieUrl" character varying(500); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "companyName" character varying(200); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "companyRegistrationNumber" character varying(100); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "companyType" character varying(50); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "companyInfo" jsonb; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "reviewedBy" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "reviewedAt" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "rejectionReason" text; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "reviewNotes" text; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "reviewHistory" jsonb; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "approvedAt" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "expiresAt" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "lastReminderAt" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "providerName" character varying(50); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "providerVerificationId" character varying(100); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "providerResponse" jsonb; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "amlRiskScore" numeric(5,2); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "sanctionCheckResult" jsonb; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "createdAt" TIMESTAMP NOT NULL DEFAULT now(); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "updatedAt" TIMESTAMP NOT NULL DEFAULT now(); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "mpc_wallets" ADD "workspaceId" uuid; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "mpc_wallets" ADD "userId" uuid; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."mpc_wallets_purpose_enum" AS ENUM('execution', 'settlement', 'dev', 'test')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "mpc_wallets" ADD "purpose" "public"."mpc_wallets_purpose_enum" NOT NULL DEFAULT 'execution'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ADD "contactEmail" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" ADD "payee_id" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."commission_settlements_v4_payee_type_enum" AS ENUM('agent', 'merchant', 'paymind')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" ADD "payee_type" "public"."commission_settlements_v4_payee_type_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" ADD "amount" numeric(15,6); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" ADD "currency" character varying(10) NOT NULL DEFAULT 'USDT'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" ADD "settlement_date" date; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" ADD "transaction_hash" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."authorizations_authorizationtype_enum" AS ENUM('manual', 'auto_pay')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "authorizationType" "public"."authorizations_authorizationtype_enum" NOT NULL DEFAULT 'manual'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "isAutoPay" boolean NOT NULL DEFAULT false; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "merchantScope" text; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "categoryScope" text; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "singleTxLimit" numeric(15,2); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "dailyLimit" numeric(15,2); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "monthlyLimit" numeric(15,2); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "usedToday" numeric(15,2) NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "usedThisMonth" numeric(15,2) NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "totalUsed" numeric(15,2) NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "lastDailyResetDate" date; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "lastMonthlyResetDate" date; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "expiresAt" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "createdAt" TIMESTAMP NOT NULL DEFAULT now(); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "updatedAt" TIMESTAMP NOT NULL DEFAULT now(); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "assetId" character varying(255) NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "assetType" "public"."asset_aggregations_assettype_enum" NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "sourcePlatform" character varying(100) NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "sourceType" "public"."asset_aggregations_sourcetype_enum" NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "contractAddress" character varying(255); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "tokenId" character varying(255); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "metadata" jsonb; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "price" numeric(18,2); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "currency" character varying(3); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "commissionRate" numeric(5,4); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "incomeMode" "public"."asset_aggregations_incomemode_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."api_keys_mode_enum" AS ENUM('sandbox', 'production')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "api_keys" ADD "mode" "public"."api_keys_mode_enum" NOT NULL DEFAULT 'production'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "api_keys" ADD "allowedOrigins" text; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "api_keys" ADD "rate_limit" integer NOT NULL DEFAULT '60'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "api_keys" ADD "metadata" jsonb; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "agentUniqueId" character varying(50) NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD CONSTRAINT "UQ_9e2cf40168fd6b81f3497fe7dc4" UNIQUE ("agentUniqueId"); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "avatarUrl" character varying(500); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "parentAgentId" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."agent_accounts_agenttype_enum" AS ENUM('personal', 'merchant', 'platform', 'third_party')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "agentType" "public"."agent_accounts_agenttype_enum" NOT NULL DEFAULT 'personal'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "publicKey" character varying(255); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "apiSecretHash" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "apiKeyPrefix" character varying(20); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "defaultAccountId" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "mpcWalletId" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "externalWalletAddress" character varying(100); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "creditScore" numeric(7,2) NOT NULL DEFAULT '500'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."agent_accounts_risklevel_enum" AS ENUM('low', 'medium', 'high', 'critical')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "riskLevel" "public"."agent_accounts_risklevel_enum" NOT NULL DEFAULT 'medium'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "creditScoreUpdatedAt" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "spendingLimits" jsonb; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "usedTodayAmount" numeric(18,2) NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "usedMonthAmount" numeric(18,2) NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "limitResetDate" date; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "easAttestationUid" character varying(100); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "onchainRegistrationTxHash" character varying(100); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "registrationChain" character varying(20); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "activatedAt" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "lastActiveAt" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "totalTransactions" integer NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "totalTransactionAmount" numeric(18,2) NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "successfulTransactions" integer NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "failedTransactions" integer NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "createdAt" TIMESTAMP NOT NULL DEFAULT now(); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "updatedAt" TIMESTAMP NOT NULL DEFAULT now(); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "accountId" character varying(50) NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD CONSTRAINT "UQ_03220d8b0ebb79b008b6ec15b3e" UNIQUE ("accountId"); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "ownerId" character varying NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."accounts_ownertype_enum" AS ENUM('user', 'agent', 'merchant', 'platform')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "ownerType" "public"."accounts_ownertype_enum" NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."accounts_wallettype_enum" AS ENUM('custodial', 'non_custodial', 'virtual')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "walletType" "public"."accounts_wallettype_enum" NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."accounts_chaintype_enum" AS ENUM('evm', 'solana', 'bitcoin', 'multi')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "chainType" "public"."accounts_chaintype_enum" NOT NULL DEFAULT 'evm'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "chainId" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "walletAddress" character varying(100); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "mpcWalletId" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "availableBalance" numeric(18,6) NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "frozenBalance" numeric(18,6) NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "pendingBalance" numeric(18,6) NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "balanceUpdatedAt" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "multiCurrencyBalances" jsonb; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "isDefault" boolean NOT NULL DEFAULT false; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "singleTxLimit" numeric(18,2); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "dailyLimit" numeric(18,2); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "monthlyLimit" numeric(18,2); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "totalDeposit" numeric(18,2) NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "totalWithdraw" numeric(18,2) NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "transactionCount" integer NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "createdAt" TIMESTAMP NOT NULL DEFAULT now(); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "updatedAt" TIMESTAMP NOT NULL DEFAULT now(); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" ADD "transactionId" uuid; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" ADD "agentId" character varying(255); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "userId" uuid NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "tokenAddress" character varying(255) NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "tokenSymbol" character varying(50) NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "balance" numeric(18,6) NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "usdValue" numeric(18,2); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "lastSyncedAt" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "users" DROP COLUMN IF EXISTS "roles"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."users_roles_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "users" ADD "roles" text array NOT NULL DEFAULT '{user}'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`ALTER TYPE "public"."user_status_enum" RENAME TO "user_status_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."users_status_enum" AS ENUM('active', 'pending', 'suspended', 'frozen', 'closed', 'banned')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "users" ALTER COLUMN "status" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "users" ALTER COLUMN "status" TYPE "public"."users_status_enum" USING "status"::"text"::"public"."users_status_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "users" ALTER COLUMN "status" SET DEFAULT 'active'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."user_status_enum_old"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "users" ADD CONSTRAINT "UQ_60cea0d80c39eedaaaf5e21f175" UNIQUE ("appleId"); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "users" ADD CONSTRAINT "UQ_eda3fd04bdb78a1c678fdb6ecc9" UNIQUE ("twitterId"); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "users" DROP COLUMN IF EXISTS "defaultAccountId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "users" ADD "defaultAccountId" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`ALTER TYPE "public"."workspace_type_enum" RENAME TO "workspace_type_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."workspaces_type_enum" AS ENUM('personal', 'team', 'organization', 'enterprise')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ALTER COLUMN "type" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ALTER COLUMN "type" TYPE "public"."workspaces_type_enum" USING "type"::"text"::"public"."workspaces_type_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ALTER COLUMN "type" SET DEFAULT 'personal'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."workspace_type_enum_old"`);
        await queryRunner.query(`ALTER TYPE "public"."workspace_plan_enum" RENAME TO "workspace_plan_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."workspaces_plan_enum" AS ENUM('free', 'pro', 'business', 'enterprise')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ALTER COLUMN "plan" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ALTER COLUMN "plan" TYPE "public"."workspaces_plan_enum" USING "plan"::"text"::"public"."workspaces_plan_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ALTER COLUMN "plan" SET DEFAULT 'free'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."workspace_plan_enum_old"`);
        await queryRunner.query(`ALTER TYPE "public"."workspace_status_enum" RENAME TO "workspace_status_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."workspaces_status_enum" AS ENUM('active', 'suspended', 'archived', 'deleted')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ALTER COLUMN "status" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ALTER COLUMN "status" TYPE "public"."workspaces_status_enum" USING "status"::"text"::"public"."workspaces_status_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ALTER COLUMN "status" SET DEFAULT 'active'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."workspace_status_enum_old"`);
        await queryRunner.query(`ALTER TYPE "public"."workspace_member_role_enum" RENAME TO "workspace_member_role_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."workspace_members_role_enum" AS ENUM('owner', 'admin', 'member', 'viewer', 'guest')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" ALTER COLUMN "role" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" ALTER COLUMN "role" TYPE "public"."workspace_members_role_enum" USING "role"::"text"::"public"."workspace_members_role_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" ALTER COLUMN "role" SET DEFAULT 'member'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."workspace_member_role_enum_old"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "webhook_configs" DROP COLUMN IF EXISTS "url"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "webhook_configs" ADD "url" character varying NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "webhook_configs" DROP COLUMN IF EXISTS "events"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "webhook_configs" ADD "events" text NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "webhook_configs" DROP COLUMN IF EXISTS "secret"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "webhook_configs" ADD "secret" character varying NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`ALTER TYPE "public"."skill_layer_enum" RENAME TO "skill_layer_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."skills_layer_enum" AS ENUM('infra', 'resource', 'logic', 'composite')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "layer" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "layer" TYPE "public"."skills_layer_enum" USING "layer"::"text"::"public"."skills_layer_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "layer" SET DEFAULT 'logic'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."skill_layer_enum_old"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "layer" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`ALTER TYPE "public"."skill_value_type_enum" RENAME TO "skill_value_type_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."skills_valuetype_enum" AS ENUM('action', 'deliverable', 'decision', 'data')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "valueType" TYPE "public"."skills_valuetype_enum" USING "valueType"::"text"::"public"."skills_valuetype_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."skill_value_type_enum_old"`);
        await queryRunner.query(`ALTER TYPE "public"."skill_resource_type_enum" RENAME TO "skill_resource_type_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."skills_resourcetype_enum" AS ENUM('physical', 'service', 'digital', 'data', 'logic')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "resourceType" TYPE "public"."skills_resourcetype_enum" USING "resourceType"::"text"::"public"."skills_resourcetype_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."skill_resource_type_enum_old"`);
        await queryRunner.query(`ALTER TYPE "public"."skill_source_enum" RENAME TO "skill_source_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."skills_source_enum" AS ENUM('native', 'imported', 'converted')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "source" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "source" TYPE "public"."skills_source_enum" USING "source"::"text"::"public"."skills_source_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "source" SET DEFAULT 'native'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."skill_source_enum_old"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "source" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`ALTER TYPE "public"."skill_original_platform_enum" RENAME TO "skill_original_platform_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."skills_originalplatform_enum" AS ENUM('claude', 'openai', 'gemini', 'grok', 'third_party')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "originalPlatform" TYPE "public"."skills_originalplatform_enum" USING "originalPlatform"::"text"::"public"."skills_originalplatform_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."skill_original_platform_enum_old"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "humanAccessible" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "compatibleAgents" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "permissions" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" DROP COLUMN IF EXISTS "imageUrl"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ADD "imageUrl" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" DROP COLUMN IF EXISTS "thumbnailUrl"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ADD "thumbnailUrl" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" DROP COLUMN IF EXISTS "ucpCheckoutEndpoint"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ADD "ucpCheckoutEndpoint" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" DROP COLUMN IF EXISTS "x402ServiceEndpoint"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ADD "x402ServiceEndpoint" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "createdAt" SET DEFAULT now(); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "updatedAt" SET DEFAULT now(); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "user_installed_skills" ALTER COLUMN "installedAt" SET DEFAULT now(); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "user_installed_skills" ALTER COLUMN "updatedAt" SET DEFAULT now(); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "admin_roles" DROP COLUMN IF EXISTS "permissions"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "admin_roles" ADD "permissions" text array; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "payments" DROP CONSTRAINT IF EXISTS "FK_d35cb3c13a18e1ea1705b2817b1"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "payments" ALTER COLUMN "userId" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`ALTER TYPE "public"."payments_paymentmethod_enum" RENAME TO "payments_paymentmethod_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."payments_paymentmethod_enum" AS ENUM('stripe', 'wallet', 'passkey', 'x402', 'multisig', 'transak')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "payments" ALTER COLUMN "paymentMethod" TYPE "public"."payments_paymentmethod_enum" USING "paymentMethod"::"text"::"public"."payments_paymentmethod_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."payments_paymentmethod_enum_old"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "ecommerce_connections" DROP COLUMN IF EXISTS "store_name"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "ecommerce_connections" ADD "store_name" character varying NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "ecommerce_connections" DROP COLUMN IF EXISTS "store_url"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "ecommerce_connections" ADD "store_url" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "ecommerce_connections" ALTER COLUMN "created_at" SET DEFAULT now(); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "ecommerce_connections" ALTER COLUMN "updated_at" SET DEFAULT now(); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "products" DROP COLUMN IF EXISTS "status"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "products" ADD "status" "public"."products_status_enum" NOT NULL DEFAULT 'active'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "products" DROP COLUMN IF EXISTS "syncSource"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "products" ADD "syncSource" character varying(50); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "products" DROP COLUMN IF EXISTS "externalId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "products" ADD "externalId" character varying(255); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_sync_mappings" DROP COLUMN IF EXISTS "external_product_id"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_sync_mappings" ADD "external_product_id" character varying NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_sync_mappings" DROP COLUMN IF EXISTS "sync_direction"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_sync_mappings" ADD "sync_direction" character varying NOT NULL DEFAULT 'import'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_sync_mappings" ALTER COLUMN "created_at" SET DEFAULT now(); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_skill_conversions" DROP CONSTRAINT IF EXISTS "product_skill_conversions_productId_key"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`ALTER TYPE "public"."conversion_status_enum" RENAME TO "conversion_status_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."product_skill_conversions_status_enum" AS ENUM('pending', 'completed', 'failed', 'outdated')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_skill_conversions" ALTER COLUMN "status" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_skill_conversions" ALTER COLUMN "status" TYPE "public"."product_skill_conversions_status_enum" USING "status"::"text"::"public"."product_skill_conversions_status_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_skill_conversions" ALTER COLUMN "status" SET DEFAULT 'pending'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."conversion_status_enum_old"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_skill_conversions" ALTER COLUMN "status" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_skill_conversions" ALTER COLUMN "conversionConfig" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_skill_conversions" ALTER COLUMN "createdAt" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_skill_conversions" ALTER COLUMN "updatedAt" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_reviews" ALTER COLUMN "submitted_at" SET DEFAULT now(); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_reviews" ALTER COLUMN "updated_at" SET DEFAULT now(); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" DROP COLUMN IF EXISTS "userId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" ADD "userId" uuid; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" DROP COLUMN IF EXISTS "workspaceId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" ADD "workspaceId" uuid; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" DROP COLUMN IF EXISTS "type"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."policies_type_enum" AS ENUM('daily_limit', 'single_limit', 'protocol_whitelist', 'action_whitelist', 'auto_claim_airdrop')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" ADD "type" "public"."policies_type_enum" NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" DROP COLUMN IF EXISTS "name"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" ADD "name" character varying(150) NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" DROP COLUMN IF EXISTS "created_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" ADD "created_at" TIMESTAMP NOT NULL DEFAULT now(); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" DROP COLUMN IF EXISTS "updated_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" ADD "updated_at" TIMESTAMP NOT NULL DEFAULT now(); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "pay_intents" DROP CONSTRAINT IF EXISTS "FK_18f1583a8acf3b2bb8ce87a6579"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "pay_intents" ALTER COLUMN "userId" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`ALTER TYPE "public"."pay_intents_status_enum" RENAME TO "pay_intents_status_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."pay_intents_status_enum" AS ENUM('requires_payment_method', 'processing', 'succeeded', 'failed', 'canceled', 'expired', 'created', 'authorized', 'executing', 'completed', 'cancelled')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "pay_intents" ALTER COLUMN "status" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "pay_intents" ALTER COLUMN "status" TYPE "public"."pay_intents_status_enum" USING "status"::"text"::"public"."pay_intents_status_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "pay_intents" ALTER COLUMN "status" SET DEFAULT 'created'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."pay_intents_status_enum_old"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "pay_intents" ALTER COLUMN "mode" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "pay_intents" ADD CONSTRAINT "UQ_5c959590bac593f8a395ed3b087" UNIQUE ("idempotencyKey"); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "orders" DROP CONSTRAINT IF EXISTS "FK_151b79a83ba240b0cb31b2302d1"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "orders" DROP CONSTRAINT IF EXISTS "FK_8624dad595ae567818ad9983b33"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "orders" ALTER COLUMN "userId" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "orders" ALTER COLUMN "productId" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`ALTER TYPE "public"."orders_status_enum" RENAME TO "orders_status_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."orders_status_enum" AS ENUM('created', 'paid', 'fulfilled', 'cancelled', 'refunded', 'pending', 'processing', 'pending_shipment', 'shipped', 'delivered', 'settled', 'frozen', 'disputed', 'completed')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "orders" ALTER COLUMN "status" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "orders" ALTER COLUMN "status" TYPE "public"."orders_status_enum" USING "status"::"text"::"public"."orders_status_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "orders" ALTER COLUMN "status" SET DEFAULT 'pending'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."orders_status_enum_old"`);
        await queryRunner.query(`ALTER TYPE "public"."orders_assettype_enum" RENAME TO "orders_assettype_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."orders_assettype_enum" AS ENUM('physical', 'service', 'virtual', 'nft_rwa', 'dev_tool', 'subscription', 'other', 'aggregated_web2', 'aggregated_web3')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "orders" ALTER COLUMN "assetType" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "orders" ALTER COLUMN "assetType" TYPE "public"."orders_assettype_enum" USING "assetType"::"text"::"public"."orders_assettype_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "orders" ALTER COLUMN "assetType" SET DEFAULT 'physical'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."orders_assettype_enum_old"`);
        await queryRunner.query(`ALTER TYPE "public"."caller_type_enum" RENAME TO "caller_type_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."skill_analytics_callertype_enum" AS ENUM('agent', 'human', 'system')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skill_analytics" ALTER COLUMN "callerType" TYPE "public"."skill_analytics_callertype_enum" USING "callerType"::"text"::"public"."skill_analytics_callertype_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."caller_type_enum_old"`);
        await queryRunner.query(`ALTER TYPE "public"."call_platform_enum" RENAME TO "call_platform_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."skill_analytics_platform_enum" AS ENUM('agentrix_web', 'agentrix_api', 'claude_mcp', 'openai_gpt', 'gemini', 'grok', 'sdk', 'other')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skill_analytics" ALTER COLUMN "platform" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skill_analytics" ALTER COLUMN "platform" TYPE "public"."skill_analytics_platform_enum" USING "platform"::"text"::"public"."skill_analytics_platform_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skill_analytics" ALTER COLUMN "platform" SET DEFAULT 'agentrix_api'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."call_platform_enum_old"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skill_analytics" ALTER COLUMN "platform" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skill_analytics" ALTER COLUMN "success" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skill_analytics" ALTER COLUMN "revenueGenerated" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skill_analytics" ALTER COLUMN "commissionAmount" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skill_analytics" ALTER COLUMN "createdAt" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "merchant_referrals" ALTER COLUMN "commissionRate" SET DEFAULT '0.005'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`ALTER TYPE "public"."kyc_record_level_enum" RENAME TO "kyc_record_level_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."kyc_records_level_enum" AS ENUM('basic', 'standard', 'advanced', 'enterprise')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ALTER COLUMN "level" TYPE "public"."kyc_records_level_enum" USING "level"::"text"::"public"."kyc_records_level_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."kyc_record_level_enum_old"`);
        await queryRunner.query(`ALTER TYPE "public"."kyc_record_status_enum" RENAME TO "kyc_record_status_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."kyc_records_status_enum" AS ENUM('not_started', 'pending', 'in_review', 'approved', 'rejected', 'expired', 'resubmit')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ALTER COLUMN "status" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ALTER COLUMN "status" TYPE "public"."kyc_records_status_enum" USING "status"::"text"::"public"."kyc_records_status_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ALTER COLUMN "status" SET DEFAULT 'not_started'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."kyc_record_status_enum_old"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "mpc_wallets" ALTER COLUMN "merchantId" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`ALTER TYPE "public"."fund_path_type_enum" RENAME TO "fund_path_type_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."fund_paths_path_type_enum" AS ENUM('merchant_net', 'platform_fee', 'channel_fee', 'promoter_share', 'executor_share', 'referrer_share', 'platform_fund', 'tax', 'gas_fee')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "fund_paths" ALTER COLUMN "path_type" TYPE "public"."fund_paths_path_type_enum" USING "path_type"::"text"::"public"."fund_paths_path_type_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."fund_path_type_enum_old"`);
        await queryRunner.query(`ALTER TYPE "public"."external_platform_enum" RENAME TO "external_platform_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."external_skill_mappings_externalplatform_enum" AS ENUM('claude_mcp', 'openai_gpt', 'gemini', 'grok', 'zapier', 'plugin_lab', 'other')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "external_skill_mappings" ALTER COLUMN "externalPlatform" TYPE "public"."external_skill_mappings_externalplatform_enum" USING "externalPlatform"::"text"::"public"."external_skill_mappings_externalplatform_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."external_platform_enum_old"`);
        await queryRunner.query(`ALTER TYPE "public"."sync_status_enum" RENAME TO "sync_status_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."external_skill_mappings_syncstatus_enum" AS ENUM('active', 'paused', 'error', 'deprecated')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "external_skill_mappings" ALTER COLUMN "syncStatus" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "external_skill_mappings" ALTER COLUMN "syncStatus" TYPE "public"."external_skill_mappings_syncstatus_enum" USING "syncStatus"::"text"::"public"."external_skill_mappings_syncstatus_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "external_skill_mappings" ALTER COLUMN "syncStatus" SET DEFAULT 'active'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."sync_status_enum_old"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "external_skill_mappings" ALTER COLUMN "syncStatus" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "external_skill_mappings" ALTER COLUMN "callCount" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "external_skill_mappings" ALTER COLUMN "passthroughPricing" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "external_skill_mappings" ALTER COLUMN "agentrixMarkup" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "external_skill_mappings" ALTER COLUMN "createdAt" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "external_skill_mappings" ALTER COLUMN "updatedAt" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" DROP CONSTRAINT IF EXISTS "developer_accounts_user_id_key"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`ALTER TYPE "public"."developer_type_enum" RENAME TO "developer_type_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."developer_accounts_type_enum" AS ENUM('individual', 'team', 'company', 'agency')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ALTER COLUMN "type" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ALTER COLUMN "type" TYPE "public"."developer_accounts_type_enum" USING "type"::"text"::"public"."developer_accounts_type_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ALTER COLUMN "type" SET DEFAULT 'individual'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."developer_type_enum_old"`);
        await queryRunner.query(`ALTER TYPE "public"."developer_tier_enum" RENAME TO "developer_tier_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."developer_accounts_tier_enum" AS ENUM('starter', 'professional', 'enterprise', 'partner')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ALTER COLUMN "tier" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ALTER COLUMN "tier" TYPE "public"."developer_accounts_tier_enum" USING "tier"::"text"::"public"."developer_accounts_tier_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ALTER COLUMN "tier" SET DEFAULT 'starter'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."developer_tier_enum_old"`);
        await queryRunner.query(`ALTER TYPE "public"."developer_account_status_enum" RENAME TO "developer_account_status_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."developer_accounts_status_enum" AS ENUM('pending', 'active', 'suspended', 'revoked', 'banned')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ALTER COLUMN "status" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ALTER COLUMN "status" TYPE "public"."developer_accounts_status_enum" USING "status"::"text"::"public"."developer_accounts_status_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ALTER COLUMN "status" SET DEFAULT 'pending'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."developer_account_status_enum_old"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" DROP COLUMN IF EXISTS "default_account_id"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ADD "default_account_id" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" DROP COLUMN IF EXISTS "kyc_record_id"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ADD "kyc_record_id" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" DROP COLUMN IF EXISTS "approved_by"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ADD "approved_by" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`ALTER TYPE "public"."commissions_payeetype_enum" RENAME TO "commissions_payeetype_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."commissions_payeetype_enum" AS ENUM('agent', 'merchant', 'paymind')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commissions" ALTER COLUMN "payeeType" TYPE "public"."commissions_payeetype_enum" USING "payeeType"::"text"::"public"."commissions_payeetype_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."commissions_payeetype_enum_old"`);
        await queryRunner.query(`ALTER TYPE "public"."commissions_assettype_enum" RENAME TO "commissions_assettype_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."commissions_assettype_enum" AS ENUM('physical', 'service', 'virtual', 'nft_rwa', 'dev_tool', 'subscription', 'other', 'aggregated_web2', 'aggregated_web3')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commissions" ALTER COLUMN "assetType" TYPE "public"."commissions_assettype_enum" USING "assetType"::"text"::"public"."commissions_assettype_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."commissions_assettype_enum_old"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_allocations_v4" ALTER COLUMN "settlement_id" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_allocations_v4" DROP COLUMN IF EXISTS "agent_wallet"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_allocations_v4" ADD "agent_wallet" character varying NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_allocations_v4" DROP COLUMN IF EXISTS "role"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_allocations_v4" ADD "role" character varying NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_allocations_v4" DROP COLUMN IF EXISTS "status"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_allocations_v4" ADD "status" character varying NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" ALTER COLUMN "order_id" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" ALTER COLUMN "total_amount" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" ALTER COLUMN "merchant_amount" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" ALTER COLUMN "platform_fee" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" ALTER COLUMN "channel_fee" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" DROP COLUMN IF EXISTS "status"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."commission_settlements_v4_status_enum" AS ENUM('pending', 'processing', 'completed', 'failed')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" ADD "status" "public"."commission_settlements_v4_status_enum" NOT NULL DEFAULT 'pending'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ALTER COLUMN "agent_id" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`ALTER TYPE "public"."authorization_status_enum" RENAME TO "authorization_status_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."authorizations_status_enum" AS ENUM('active', 'revoked', 'expired', 'suspended')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ALTER COLUMN "status" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ALTER COLUMN "status" TYPE "public"."authorizations_status_enum" USING "status"::"text"::"public"."authorizations_status_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ALTER COLUMN "status" SET DEFAULT 'active'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."authorization_status_enum_old"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "api_keys" DROP COLUMN IF EXISTS "key_hash"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "api_keys" ADD "key_hash" character varying NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`ALTER TYPE "public"."agent_account_status_enum" RENAME TO "agent_account_status_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."agent_accounts_status_enum" AS ENUM('draft', 'active', 'suspended', 'revoked')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ALTER COLUMN "status" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ALTER COLUMN "status" TYPE "public"."agent_accounts_status_enum" USING "status"::"text"::"public"."agent_accounts_status_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ALTER COLUMN "status" SET DEFAULT 'draft'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."agent_account_status_enum_old"`);
        await queryRunner.query(`ALTER TYPE "public"."account_status_enum" RENAME TO "account_status_enum_old"`);
        await queryRunner.query(`CREATE TYPE "public"."accounts_status_enum" AS ENUM('active', 'frozen', 'closed')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ALTER COLUMN "status" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ALTER COLUMN "status" TYPE "public"."accounts_status_enum" USING "status"::"text"::"public"."accounts_status_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ALTER COLUMN "status" SET DEFAULT 'active'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."account_status_enum_old"`);
        await queryRunner.query(`COMMENT ON COLUMN "risk_assessments"."riskScore" IS '风险评分 0-100'`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" ALTER COLUMN "riskFactors" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE INDEX "IDX_97672ac88f789774dd47f7c8be" ON "users" ("email") `);
        await queryRunner.query(`CREATE INDEX "IDX_3676155292d72c67cd4e090514" ON "users" ("status") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "IDX_b8e9fe62e93d60089dfc4f175f" ON "workspaces" ("slug") `);
        await queryRunner.query(`CREATE INDEX "IDX_047bb7ff6e4f9decf845460fa3" ON "workspaces" ("status") `);
        await queryRunner.query(`CREATE INDEX "IDX_3bc45ecdd8fdc2108bb92516dd" ON "workspaces" ("owner_id") `);
        await queryRunner.query(`CREATE INDEX "IDX_4e83431119fa585fc7aa8b817d" ON "workspace_members" ("user_id") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "IDX_4896b609c71ca5ad20ad662077" ON "workspace_members" ("workspace_id", "user_id") `);
        await queryRunner.query(`CREATE INDEX "IDX_ffe3a9d1abc346a2f87c99b4da" ON "webhook_configs" ("user_id") `);
        await queryRunner.query(`CREATE INDEX "IDX_e7bf8ade89ec9a566493f3f5e8" ON "risk_assessments" ("createdAt") `);
        await queryRunner.query(`CREATE INDEX "IDX_48a6cbf3db98bc76347a8ff461" ON "risk_assessments" ("paymentId") `);
        await queryRunner.query(`CREATE INDEX "IDX_4cb9b00e587d37247b0ede91b6" ON "ecommerce_connections" ("merchant_id", "platform") `);
        await queryRunner.query(`CREATE INDEX "IDX_a20cec9b80e97a87d2259da5d2" ON "product_sync_mappings" ("product_id") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "IDX_f0361b2c9c65f76e59b7fd3d7b" ON "product_sync_mappings" ("connection_id", "external_product_id") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "IDX_5497d0bf58e88ac26c4475dcbd" ON "product_skill_conversions" ("productId") `);
        await queryRunner.query(`CREATE INDEX "IDX_ca680c529b18e7b957df5121c8" ON "product_reviews" ("merchant_id", "status") `);
        await queryRunner.query(`CREATE INDEX "IDX_e0c7f32fe3dea54c9818e5dd96" ON "product_reviews" ("product_id", "status") `);
        await queryRunner.query(`CREATE INDEX "IDX_38257ef457c16308306252c1cf" ON "policies" ("workspaceId") `);
        await queryRunner.query(`CREATE INDEX "IDX_68d47698bc19079fdd433fb35d" ON "policies" ("userId") `);
        await queryRunner.query(`CREATE INDEX "IDX_ad6f8f152983481f7cd2566880" ON "skill_analytics" ("platform", "createdAt") `);
        await queryRunner.query(`CREATE INDEX "IDX_7dce24e094014264e49c797506" ON "skill_analytics" ("callerId", "createdAt") `);
        await queryRunner.query(`CREATE INDEX "IDX_dcb7fd279d04ad6807ef74949e" ON "skill_analytics" ("skillId", "createdAt") `);
        await queryRunner.query(`CREATE INDEX "IDX_a678fb77bdfdc6102104bf84bf" ON "kyc_records" ("expiresAt") `);
        await queryRunner.query(`CREATE INDEX "IDX_4fc48d5a36206f5d6ef427bad9" ON "kyc_records" ("level") `);
        await queryRunner.query(`CREATE INDEX "IDX_18445b880f4d1f3ea7a3f89ef3" ON "kyc_records" ("status") `);
        await queryRunner.query(`CREATE INDEX "IDX_d20b5a5f164a27f1a823596d19" ON "kyc_records" ("user_id") `);
        await queryRunner.query(`CREATE INDEX "IDX_4738f2a7f4da8a01147aeb3ce1" ON "mpc_wallets" ("userId") `);
        await queryRunner.query(`CREATE INDEX "IDX_cb3a395ca5ae514337353a920b" ON "mpc_wallets" ("workspaceId") `);
        await queryRunner.query(`CREATE INDEX "IDX_beba816fe439e7f1c378a53e97" ON "fund_paths" ("created_at") `);
        await queryRunner.query(`CREATE INDEX "IDX_99633d3bb9b283e162b07caee5" ON "fund_paths" ("transaction_hash") `);
        await queryRunner.query(`CREATE INDEX "IDX_5f6cbe9f9bcfeb8cf626779e62" ON "fund_paths" ("payment_id") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "IDX_148b408ffa6d52092fba4282a9" ON "external_skill_mappings" ("externalPlatform", "externalId") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "IDX_742dcedf19dd7b9dfe71905309" ON "developer_accounts" ("developer_unique_id") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "IDX_9b16f8de98f0aaecd292b7589d" ON "developer_accounts" ("user_id") `);
        await queryRunner.query(`CREATE INDEX "IDX_ae1140ccefeb9cbd5d689943ee" ON "developer_accounts" ("tier") `);
        await queryRunner.query(`CREATE INDEX "IDX_0dd3cbc597f14e84d3338b4ddb" ON "developer_accounts" ("status") `);
        await queryRunner.query(`CREATE INDEX "IDX_ae697c43785428b569d1ba18c6" ON "authorizations" ("user_id", "status") `);
        await queryRunner.query(`CREATE INDEX "IDX_7e7abfa6343c0280ece899c7bb" ON "authorizations" ("user_id", "agent_id") `);
        await queryRunner.query(`CREATE INDEX "IDX_316e4c34c7b75742e11c083f89" ON "asset_aggregations" ("sourceType") `);
        await queryRunner.query(`CREATE INDEX "IDX_827af7fe090efe8ee13c98c384" ON "asset_aggregations" ("sourcePlatform") `);
        await queryRunner.query(`CREATE INDEX "IDX_128772fbda0ab3bf2605f2955d" ON "asset_aggregations" ("assetType") `);
        await queryRunner.query(`CREATE INDEX "IDX_10ae0181853fe5ddf3372bccba" ON "asset_aggregations" ("assetId") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "IDX_cef5ce7c595db3ef0126a9ad65" ON "asset_aggregations" ("assetId", "sourcePlatform", "chain") `);
        await queryRunner.query(`CREATE INDEX "IDX_57384430aa1959f4578046c9b8" ON "api_keys" ("key_hash") `);
        await queryRunner.query(`CREATE INDEX "IDX_cd1a671c7e6c5f7c8dd83887ed" ON "agent_sessions" ("session_id") `);
        await queryRunner.query(`CREATE INDEX "IDX_032b2532a5a2f79f79f6ac18e8" ON "agent_sessions" ("user_id", "status") `);
        await queryRunner.query(`CREATE INDEX "IDX_936b9031eade82ddb4f967a3a9" ON "agent_accounts" ("agentType") `);
        await queryRunner.query(`CREATE INDEX "IDX_6356abee0a1f3598bdaa3c43a8" ON "agent_accounts" ("status") `);
        await queryRunner.query(`CREATE INDEX "IDX_520155605623354677a0e2457c" ON "agent_accounts" ("owner_id") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "IDX_9e2cf40168fd6b81f3497fe7dc" ON "agent_accounts" ("agentUniqueId") `);
        await queryRunner.query(`CREATE INDEX "IDX_b54dff1e7acc1d7bc841068194" ON "accounts" ("isDefault") `);
        await queryRunner.query(`CREATE INDEX "IDX_ecd806309a44545de35344424e" ON "accounts" ("status") `);
        await queryRunner.query(`CREATE INDEX "IDX_406305df749949ee26aa34da71" ON "accounts" ("walletAddress") `);
        await queryRunner.query(`CREATE INDEX "IDX_ce4e5b0e259f11bcc7c90b9911" ON "accounts" ("ownerId", "ownerType") `);
        await queryRunner.query(`CREATE INDEX "IDX_66fd180e7e0ee1ac31f003bcba" ON "risk_assessments" ("transactionId") `);
        await queryRunner.query(`CREATE INDEX "IDX_9bdba9200942bb473313764db9" ON "asset_aggregations" ("chain", "tokenAddress") `);
        await queryRunner.query(`CREATE INDEX "IDX_9caabe7c3a8dabd16e206879b0" ON "asset_aggregations" ("userId") `);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "user_installed_skills" ADD CONSTRAINT "UQ_553a823c7c1c09a11cdfe604e5d" UNIQUE ("userId", "skillId"); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ADD CONSTRAINT "FK_3bc45ecdd8fdc2108bb92516dde" FOREIGN KEY ("owner_id") REFERENCES "users"("id") ON DELETE NO ACTION ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" ADD CONSTRAINT "FK_4a7c584ddfe855379598b5e20fd" FOREIGN KEY ("workspace_id") REFERENCES "workspaces"("id") ON DELETE CASCADE ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" ADD CONSTRAINT "FK_4e83431119fa585fc7aa8b817db" FOREIGN KEY ("user_id") REFERENCES "users"("id") ON DELETE NO ACTION ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "webhook_configs" ADD CONSTRAINT "FK_ffe3a9d1abc346a2f87c99b4daa" FOREIGN KEY ("user_id") REFERENCES "users"("id") ON DELETE NO ACTION ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ADD CONSTRAINT "FK_f02611dff877c36f7fb4b34b1e2" FOREIGN KEY ("authorId") REFERENCES "users"("id") ON DELETE NO ACTION ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "user_installed_skills" ADD CONSTRAINT "FK_4c7091ab25aa7e1f78e94151600" FOREIGN KEY ("userId") REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "user_installed_skills" ADD CONSTRAINT "FK_ff7285dfa514787529498a65ab4" FOREIGN KEY ("skillId") REFERENCES "skills"("id") ON DELETE CASCADE ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "payments" ADD CONSTRAINT "FK_d35cb3c13a18e1ea1705b2817b1" FOREIGN KEY ("userId") REFERENCES "users"("id") ON DELETE NO ACTION ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" ADD CONSTRAINT "FK_48a6cbf3db98bc76347a8ff4615" FOREIGN KEY ("paymentId") REFERENCES "payments"("id") ON DELETE NO ACTION ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" ADD CONSTRAINT "FK_4fb7acafe990a5abbf321c534a5" FOREIGN KEY ("userId") REFERENCES "users"("id") ON DELETE NO ACTION ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_skill_conversions" ADD CONSTRAINT "FK_5497d0bf58e88ac26c4475dcbdb" FOREIGN KEY ("productId") REFERENCES "products"("id") ON DELETE CASCADE ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_skill_conversions" ADD CONSTRAINT "FK_22e2223dd0e6e8b53603c0c81a0" FOREIGN KEY ("skillId") REFERENCES "skills"("id") ON DELETE SET NULL ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_reviews" ADD CONSTRAINT "FK_a2ffe4b13d499c0e8aa165996c6" FOREIGN KEY ("reviewer_id") REFERENCES "users"("id") ON DELETE NO ACTION ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "pay_intents" ADD CONSTRAINT "FK_18f1583a8acf3b2bb8ce87a6579" FOREIGN KEY ("userId") REFERENCES "users"("id") ON DELETE NO ACTION ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "orders" ADD CONSTRAINT "FK_151b79a83ba240b0cb31b2302d1" FOREIGN KEY ("userId") REFERENCES "users"("id") ON DELETE NO ACTION ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "orders" ADD CONSTRAINT "FK_8624dad595ae567818ad9983b33" FOREIGN KEY ("productId") REFERENCES "products"("id") ON DELETE NO ACTION ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skill_analytics" ADD CONSTRAINT "FK_a651c0d07ee40a88284aeac0a1f" FOREIGN KEY ("skillId") REFERENCES "skills"("id") ON DELETE CASCADE ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD CONSTRAINT "FK_d20b5a5f164a27f1a823596d192" FOREIGN KEY ("user_id") REFERENCES "users"("id") ON DELETE NO ACTION ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "external_skill_mappings" ADD CONSTRAINT "FK_ad08043283626da722aae26455a" FOREIGN KEY ("agentrixSkillId") REFERENCES "skills"("id") ON DELETE SET NULL ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ADD CONSTRAINT "FK_9b16f8de98f0aaecd292b7589d0" FOREIGN KEY ("user_id") REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_allocations_v4" ADD CONSTRAINT "FK_aea95cfbac3d460a3a3e1a43a44" FOREIGN KEY ("settlement_id") REFERENCES "commission_settlements_v4"("id") ON DELETE NO ACTION ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_registry" ADD CONSTRAINT "FK_144da264822e2b6844ae46afddc" FOREIGN KEY ("owner_id") REFERENCES "users"("id") ON DELETE NO ACTION ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD CONSTRAINT "FK_f4b4d267563cdddee85181202a4" FOREIGN KEY ("user_id") REFERENCES "users"("id") ON DELETE NO ACTION ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD CONSTRAINT "FK_90441a7bbac6b13fbb1ce7e5838" FOREIGN KEY ("agent_id") REFERENCES "agent_registry"("id") ON DELETE NO ACTION ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "api_keys" ADD CONSTRAINT "FK_a3baee01d8408cd3c0f89a9a973" FOREIGN KEY ("user_id") REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_sessions" ADD CONSTRAINT "FK_90ac0c3af00655374304aa7b925" FOREIGN KEY ("user_id") REFERENCES "users"("id") ON DELETE NO ACTION ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD CONSTRAINT "FK_520155605623354677a0e2457c4" FOREIGN KEY ("owner_id") REFERENCES "users"("id") ON DELETE NO ACTION ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD CONSTRAINT "FK_3000dad1da61b29953f07476324" FOREIGN KEY ("user_id") REFERENCES "users"("id") ON DELETE NO ACTION ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
    }

    public async down(queryRunner: QueryRunner): Promise<void> {
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP CONSTRAINT IF EXISTS "FK_3000dad1da61b29953f07476324"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP CONSTRAINT IF EXISTS "FK_520155605623354677a0e2457c4"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_sessions" DROP CONSTRAINT IF EXISTS "FK_90ac0c3af00655374304aa7b925"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "api_keys" DROP CONSTRAINT IF EXISTS "FK_a3baee01d8408cd3c0f89a9a973"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP CONSTRAINT IF EXISTS "FK_90441a7bbac6b13fbb1ce7e5838"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP CONSTRAINT IF EXISTS "FK_f4b4d267563cdddee85181202a4"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_registry" DROP CONSTRAINT IF EXISTS "FK_144da264822e2b6844ae46afddc"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_allocations_v4" DROP CONSTRAINT IF EXISTS "FK_aea95cfbac3d460a3a3e1a43a44"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" DROP CONSTRAINT IF EXISTS "FK_9b16f8de98f0aaecd292b7589d0"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "external_skill_mappings" DROP CONSTRAINT IF EXISTS "FK_ad08043283626da722aae26455a"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP CONSTRAINT IF EXISTS "FK_d20b5a5f164a27f1a823596d192"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skill_analytics" DROP CONSTRAINT IF EXISTS "FK_a651c0d07ee40a88284aeac0a1f"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "orders" DROP CONSTRAINT IF EXISTS "FK_8624dad595ae567818ad9983b33"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "orders" DROP CONSTRAINT IF EXISTS "FK_151b79a83ba240b0cb31b2302d1"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "pay_intents" DROP CONSTRAINT IF EXISTS "FK_18f1583a8acf3b2bb8ce87a6579"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_reviews" DROP CONSTRAINT IF EXISTS "FK_a2ffe4b13d499c0e8aa165996c6"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_skill_conversions" DROP CONSTRAINT IF EXISTS "FK_22e2223dd0e6e8b53603c0c81a0"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_skill_conversions" DROP CONSTRAINT IF EXISTS "FK_5497d0bf58e88ac26c4475dcbdb"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" DROP CONSTRAINT IF EXISTS "FK_4fb7acafe990a5abbf321c534a5"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" DROP CONSTRAINT IF EXISTS "FK_48a6cbf3db98bc76347a8ff4615"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "payments" DROP CONSTRAINT IF EXISTS "FK_d35cb3c13a18e1ea1705b2817b1"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "user_installed_skills" DROP CONSTRAINT IF EXISTS "FK_ff7285dfa514787529498a65ab4"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "user_installed_skills" DROP CONSTRAINT IF EXISTS "FK_4c7091ab25aa7e1f78e94151600"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" DROP CONSTRAINT IF EXISTS "FK_f02611dff877c36f7fb4b34b1e2"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "webhook_configs" DROP CONSTRAINT IF EXISTS "FK_ffe3a9d1abc346a2f87c99b4daa"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" DROP CONSTRAINT IF EXISTS "FK_4e83431119fa585fc7aa8b817db"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" DROP CONSTRAINT IF EXISTS "FK_4a7c584ddfe855379598b5e20fd"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" DROP CONSTRAINT IF EXISTS "FK_3bc45ecdd8fdc2108bb92516dde"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "user_installed_skills" DROP CONSTRAINT IF EXISTS "UQ_553a823c7c1c09a11cdfe604e5d"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_9caabe7c3a8dabd16e206879b0"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_9bdba9200942bb473313764db9"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_66fd180e7e0ee1ac31f003bcba"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_ce4e5b0e259f11bcc7c90b9911"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_406305df749949ee26aa34da71"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_ecd806309a44545de35344424e"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_b54dff1e7acc1d7bc841068194"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_9e2cf40168fd6b81f3497fe7dc"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_520155605623354677a0e2457c"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_6356abee0a1f3598bdaa3c43a8"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_936b9031eade82ddb4f967a3a9"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_032b2532a5a2f79f79f6ac18e8"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_cd1a671c7e6c5f7c8dd83887ed"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_57384430aa1959f4578046c9b8"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_cef5ce7c595db3ef0126a9ad65"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_10ae0181853fe5ddf3372bccba"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_128772fbda0ab3bf2605f2955d"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_827af7fe090efe8ee13c98c384"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_316e4c34c7b75742e11c083f89"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_7e7abfa6343c0280ece899c7bb"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_ae697c43785428b569d1ba18c6"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_0dd3cbc597f14e84d3338b4ddb"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_ae1140ccefeb9cbd5d689943ee"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_9b16f8de98f0aaecd292b7589d"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_742dcedf19dd7b9dfe71905309"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_148b408ffa6d52092fba4282a9"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_5f6cbe9f9bcfeb8cf626779e62"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_99633d3bb9b283e162b07caee5"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_beba816fe439e7f1c378a53e97"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_cb3a395ca5ae514337353a920b"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_4738f2a7f4da8a01147aeb3ce1"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_d20b5a5f164a27f1a823596d19"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_18445b880f4d1f3ea7a3f89ef3"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_4fc48d5a36206f5d6ef427bad9"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_a678fb77bdfdc6102104bf84bf"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_dcb7fd279d04ad6807ef74949e"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_7dce24e094014264e49c797506"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_ad6f8f152983481f7cd2566880"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_68d47698bc19079fdd433fb35d"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_38257ef457c16308306252c1cf"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_e0c7f32fe3dea54c9818e5dd96"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_ca680c529b18e7b957df5121c8"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_5497d0bf58e88ac26c4475dcbd"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_f0361b2c9c65f76e59b7fd3d7b"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_a20cec9b80e97a87d2259da5d2"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_4cb9b00e587d37247b0ede91b6"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_48a6cbf3db98bc76347a8ff461"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_e7bf8ade89ec9a566493f3f5e8"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_ffe3a9d1abc346a2f87c99b4da"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_4896b609c71ca5ad20ad662077"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_4e83431119fa585fc7aa8b817d"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_3bc45ecdd8fdc2108bb92516dd"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_047bb7ff6e4f9decf845460fa3"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_b8e9fe62e93d60089dfc4f175f"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_3676155292d72c67cd4e090514"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_97672ac88f789774dd47f7c8be"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" ALTER COLUMN "riskFactors" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`COMMENT ON COLUMN "risk_assessments"."riskScore" IS NULL`);
        await queryRunner.query(`CREATE TYPE "public"."account_status_enum_old" AS ENUM('active', 'frozen', 'closed')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ALTER COLUMN "status" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ALTER COLUMN "status" TYPE "public"."account_status_enum_old" USING "status"::"text"::"public"."account_status_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ALTER COLUMN "status" SET DEFAULT 'active'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."accounts_status_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."account_status_enum_old" RENAME TO "account_status_enum"`);
        await queryRunner.query(`CREATE TYPE "public"."agent_account_status_enum_old" AS ENUM('draft', 'active', 'suspended', 'revoked')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ALTER COLUMN "status" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ALTER COLUMN "status" TYPE "public"."agent_account_status_enum_old" USING "status"::"text"::"public"."agent_account_status_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ALTER COLUMN "status" SET DEFAULT 'draft'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."agent_accounts_status_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."agent_account_status_enum_old" RENAME TO "agent_account_status_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "api_keys" DROP COLUMN IF EXISTS "key_hash"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "api_keys" ADD "key_hash" character varying(64) NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."authorization_status_enum_old" AS ENUM('active', 'revoked', 'expired')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ALTER COLUMN "status" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ALTER COLUMN "status" TYPE "public"."authorization_status_enum_old" USING "status"::"text"::"public"."authorization_status_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ALTER COLUMN "status" SET DEFAULT 'active'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."authorizations_status_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."authorization_status_enum_old" RENAME TO "authorization_status_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ALTER COLUMN "agent_id" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" DROP COLUMN IF EXISTS "status"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."commission_settlements_v4_status_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" ADD "status" character varying(20) NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" ALTER COLUMN "channel_fee" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" ALTER COLUMN "platform_fee" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" ALTER COLUMN "merchant_amount" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" ALTER COLUMN "total_amount" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" ALTER COLUMN "order_id" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_allocations_v4" DROP COLUMN IF EXISTS "status"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_allocations_v4" ADD "status" character varying(20) NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_allocations_v4" DROP COLUMN IF EXISTS "role"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_allocations_v4" ADD "role" character varying(20) NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_allocations_v4" DROP COLUMN IF EXISTS "agent_wallet"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_allocations_v4" ADD "agent_wallet" character varying(42) NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_allocations_v4" ALTER COLUMN "settlement_id" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."commissions_assettype_enum_old" AS ENUM('physical', 'service', 'virtual', 'nft_rwa', 'dev_tool', 'aggregated_web2', 'aggregated_web3')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commissions" ALTER COLUMN "assetType" TYPE "public"."commissions_assettype_enum_old" USING "assetType"::"text"::"public"."commissions_assettype_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."commissions_assettype_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."commissions_assettype_enum_old" RENAME TO "commissions_assettype_enum"`);
        await queryRunner.query(`CREATE TYPE "public"."commissions_payeetype_enum_old" AS ENUM('agent', 'merchant', 'agentrix')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commissions" ALTER COLUMN "payeeType" TYPE "public"."commissions_payeetype_enum_old" USING "payeeType"::"text"::"public"."commissions_payeetype_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."commissions_payeetype_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."commissions_payeetype_enum_old" RENAME TO "commissions_payeetype_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" DROP COLUMN IF EXISTS "approved_by"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ADD "approved_by" uuid; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" DROP COLUMN IF EXISTS "kyc_record_id"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ADD "kyc_record_id" uuid; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" DROP COLUMN IF EXISTS "default_account_id"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ADD "default_account_id" uuid; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."developer_account_status_enum_old" AS ENUM('pending', 'active', 'suspended', 'revoked', 'banned')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ALTER COLUMN "status" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ALTER COLUMN "status" TYPE "public"."developer_account_status_enum_old" USING "status"::"text"::"public"."developer_account_status_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ALTER COLUMN "status" SET DEFAULT 'pending'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."developer_accounts_status_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."developer_account_status_enum_old" RENAME TO "developer_account_status_enum"`);
        await queryRunner.query(`CREATE TYPE "public"."developer_tier_enum_old" AS ENUM('starter', 'professional', 'enterprise', 'partner')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ALTER COLUMN "tier" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ALTER COLUMN "tier" TYPE "public"."developer_tier_enum_old" USING "tier"::"text"::"public"."developer_tier_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ALTER COLUMN "tier" SET DEFAULT 'starter'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."developer_accounts_tier_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."developer_tier_enum_old" RENAME TO "developer_tier_enum"`);
        await queryRunner.query(`CREATE TYPE "public"."developer_type_enum_old" AS ENUM('individual', 'team', 'company', 'agency')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ALTER COLUMN "type" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ALTER COLUMN "type" TYPE "public"."developer_type_enum_old" USING "type"::"text"::"public"."developer_type_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ALTER COLUMN "type" SET DEFAULT 'individual'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."developer_accounts_type_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."developer_type_enum_old" RENAME TO "developer_type_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ADD CONSTRAINT "developer_accounts_user_id_key" UNIQUE ("user_id"); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "external_skill_mappings" ALTER COLUMN "updatedAt" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "external_skill_mappings" ALTER COLUMN "createdAt" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "external_skill_mappings" ALTER COLUMN "agentrixMarkup" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "external_skill_mappings" ALTER COLUMN "passthroughPricing" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "external_skill_mappings" ALTER COLUMN "callCount" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "external_skill_mappings" ALTER COLUMN "syncStatus" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."sync_status_enum_old" AS ENUM('active', 'paused', 'error', 'deprecated')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "external_skill_mappings" ALTER COLUMN "syncStatus" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "external_skill_mappings" ALTER COLUMN "syncStatus" TYPE "public"."sync_status_enum_old" USING "syncStatus"::"text"::"public"."sync_status_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "external_skill_mappings" ALTER COLUMN "syncStatus" SET DEFAULT 'active'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."external_skill_mappings_syncstatus_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."sync_status_enum_old" RENAME TO "sync_status_enum"`);
        await queryRunner.query(`CREATE TYPE "public"."external_platform_enum_old" AS ENUM('claude_mcp', 'openai_gpt', 'gemini', 'grok', 'zapier', 'plugin_lab', 'other')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "external_skill_mappings" ALTER COLUMN "externalPlatform" TYPE "public"."external_platform_enum_old" USING "externalPlatform"::"text"::"public"."external_platform_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."external_skill_mappings_externalplatform_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."external_platform_enum_old" RENAME TO "external_platform_enum"`);
        await queryRunner.query(`CREATE TYPE "public"."fund_path_type_enum_old" AS ENUM('merchant_net', 'platform_fee', 'channel_fee', 'promoter_share', 'executor_share', 'referrer_share', 'platform_fund', 'tax', 'gas_fee')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "fund_paths" ALTER COLUMN "path_type" TYPE "public"."fund_path_type_enum_old" USING "path_type"::"text"::"public"."fund_path_type_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."fund_paths_path_type_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."fund_path_type_enum_old" RENAME TO "fund_path_type_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "mpc_wallets" ALTER COLUMN "merchantId" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."kyc_record_status_enum_old" AS ENUM('not_started', 'pending', 'in_review', 'approved', 'rejected', 'expired', 'resubmit')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ALTER COLUMN "status" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ALTER COLUMN "status" TYPE "public"."kyc_record_status_enum_old" USING "status"::"text"::"public"."kyc_record_status_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ALTER COLUMN "status" SET DEFAULT 'not_started'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."kyc_records_status_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."kyc_record_status_enum_old" RENAME TO "kyc_record_status_enum"`);
        await queryRunner.query(`CREATE TYPE "public"."kyc_record_level_enum_old" AS ENUM('basic', 'standard', 'advanced', 'enterprise')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ALTER COLUMN "level" TYPE "public"."kyc_record_level_enum_old" USING "level"::"text"::"public"."kyc_record_level_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."kyc_records_level_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."kyc_record_level_enum_old" RENAME TO "kyc_record_level_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "merchant_referrals" ALTER COLUMN "commissionRate" SET DEFAULT 0.005; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skill_analytics" ALTER COLUMN "createdAt" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skill_analytics" ALTER COLUMN "commissionAmount" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skill_analytics" ALTER COLUMN "revenueGenerated" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skill_analytics" ALTER COLUMN "success" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skill_analytics" ALTER COLUMN "platform" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."call_platform_enum_old" AS ENUM('agentrix_web', 'agentrix_api', 'claude_mcp', 'openai_gpt', 'gemini', 'grok', 'sdk', 'other')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skill_analytics" ALTER COLUMN "platform" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skill_analytics" ALTER COLUMN "platform" TYPE "public"."call_platform_enum_old" USING "platform"::"text"::"public"."call_platform_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skill_analytics" ALTER COLUMN "platform" SET DEFAULT 'agentrix_api'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."skill_analytics_platform_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."call_platform_enum_old" RENAME TO "call_platform_enum"`);
        await queryRunner.query(`CREATE TYPE "public"."caller_type_enum_old" AS ENUM('agent', 'human', 'system')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skill_analytics" ALTER COLUMN "callerType" TYPE "public"."caller_type_enum_old" USING "callerType"::"text"::"public"."caller_type_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."skill_analytics_callertype_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."caller_type_enum_old" RENAME TO "caller_type_enum"`);
        await queryRunner.query(`CREATE TYPE "public"."orders_assettype_enum_old" AS ENUM('physical', 'service', 'virtual', 'nft_rwa', 'dev_tool', 'aggregated_web2', 'aggregated_web3')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "orders" ALTER COLUMN "assetType" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "orders" ALTER COLUMN "assetType" TYPE "public"."orders_assettype_enum_old" USING "assetType"::"text"::"public"."orders_assettype_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "orders" ALTER COLUMN "assetType" SET DEFAULT 'physical'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."orders_assettype_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."orders_assettype_enum_old" RENAME TO "orders_assettype_enum"`);
        await queryRunner.query(`CREATE TYPE "public"."orders_status_enum_old" AS ENUM('pending', 'paid', 'processing', 'pending_shipment', 'shipped', 'delivered', 'settled', 'frozen', 'refunded', 'cancelled', 'disputed', 'completed')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "orders" ALTER COLUMN "status" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "orders" ALTER COLUMN "status" TYPE "public"."orders_status_enum_old" USING "status"::"text"::"public"."orders_status_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "orders" ALTER COLUMN "status" SET DEFAULT 'pending'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."orders_status_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."orders_status_enum_old" RENAME TO "orders_status_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "orders" ALTER COLUMN "productId" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "orders" ALTER COLUMN "userId" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "orders" ADD CONSTRAINT "FK_8624dad595ae567818ad9983b33" FOREIGN KEY ("productId") REFERENCES "products"("id") ON DELETE NO ACTION ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "orders" ADD CONSTRAINT "FK_151b79a83ba240b0cb31b2302d1" FOREIGN KEY ("userId") REFERENCES "users"("id") ON DELETE NO ACTION ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "pay_intents" DROP CONSTRAINT IF EXISTS "UQ_5c959590bac593f8a395ed3b087"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "pay_intents" ALTER COLUMN "mode" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."pay_intents_status_enum_old" AS ENUM('created', 'authorized', 'executing', 'completed', 'failed', 'cancelled', 'expired')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "pay_intents" ALTER COLUMN "status" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "pay_intents" ALTER COLUMN "status" TYPE "public"."pay_intents_status_enum_old" USING "status"::"text"::"public"."pay_intents_status_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "pay_intents" ALTER COLUMN "status" SET DEFAULT 'created'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."pay_intents_status_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."pay_intents_status_enum_old" RENAME TO "pay_intents_status_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "pay_intents" ALTER COLUMN "userId" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "pay_intents" ADD CONSTRAINT "FK_18f1583a8acf3b2bb8ce87a6579" FOREIGN KEY ("userId") REFERENCES "users"("id") ON DELETE NO ACTION ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" DROP COLUMN IF EXISTS "updated_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" ADD "updated_at" TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" DROP COLUMN IF EXISTS "created_at"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" ADD "created_at" TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" DROP COLUMN IF EXISTS "name"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" ADD "name" character varying NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" DROP COLUMN IF EXISTS "type"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."policies_type_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" ADD "type" character varying NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" DROP COLUMN IF EXISTS "workspaceId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" ADD "workspaceId" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" DROP COLUMN IF EXISTS "userId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" ADD "userId" character varying NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_reviews" ALTER COLUMN "updated_at" SET DEFAULT CURRENT_TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_reviews" ALTER COLUMN "submitted_at" SET DEFAULT CURRENT_TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_skill_conversions" ALTER COLUMN "updatedAt" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_skill_conversions" ALTER COLUMN "createdAt" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_skill_conversions" ALTER COLUMN "conversionConfig" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_skill_conversions" ALTER COLUMN "status" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."conversion_status_enum_old" AS ENUM('pending', 'completed', 'failed', 'outdated')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_skill_conversions" ALTER COLUMN "status" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_skill_conversions" ALTER COLUMN "status" TYPE "public"."conversion_status_enum_old" USING "status"::"text"::"public"."conversion_status_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_skill_conversions" ALTER COLUMN "status" SET DEFAULT 'pending'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."product_skill_conversions_status_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."conversion_status_enum_old" RENAME TO "conversion_status_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_skill_conversions" ADD CONSTRAINT "product_skill_conversions_productId_key" UNIQUE ("productId"); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_sync_mappings" ALTER COLUMN "created_at" SET DEFAULT CURRENT_TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_sync_mappings" DROP COLUMN IF EXISTS "sync_direction"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_sync_mappings" ADD "sync_direction" character varying(20) NOT NULL DEFAULT 'import'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_sync_mappings" DROP COLUMN IF EXISTS "external_product_id"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_sync_mappings" ADD "external_product_id" character varying(255) NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "products" DROP COLUMN IF EXISTS "externalId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "products" ADD "externalId" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "products" DROP COLUMN IF EXISTS "syncSource"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "products" ADD "syncSource" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "products" DROP COLUMN IF EXISTS "status"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "products" ADD "status" character varying NOT NULL DEFAULT 'active'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "ecommerce_connections" ALTER COLUMN "updated_at" SET DEFAULT CURRENT_TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "ecommerce_connections" ALTER COLUMN "created_at" SET DEFAULT CURRENT_TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "ecommerce_connections" DROP COLUMN IF EXISTS "store_url"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "ecommerce_connections" ADD "store_url" character varying(500); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "ecommerce_connections" DROP COLUMN IF EXISTS "store_name"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "ecommerce_connections" ADD "store_name" character varying(255) NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."payments_paymentmethod_enum_old" AS ENUM('stripe', 'wallet', 'passkey', 'x402', 'multisig', 'epay')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "payments" ALTER COLUMN "paymentMethod" TYPE "public"."payments_paymentmethod_enum_old" USING "paymentMethod"::"text"::"public"."payments_paymentmethod_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."payments_paymentmethod_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."payments_paymentmethod_enum_old" RENAME TO "payments_paymentmethod_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "payments" ALTER COLUMN "userId" SET NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "payments" ADD CONSTRAINT "FK_d35cb3c13a18e1ea1705b2817b1" FOREIGN KEY ("userId") REFERENCES "users"("id") ON DELETE NO ACTION ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "admin_roles" DROP COLUMN IF EXISTS "permissions"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "admin_roles" ADD "permissions" text; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "user_installed_skills" ALTER COLUMN "updatedAt" SET DEFAULT CURRENT_TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "user_installed_skills" ALTER COLUMN "installedAt" SET DEFAULT CURRENT_TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "updatedAt" SET DEFAULT CURRENT_TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "createdAt" SET DEFAULT CURRENT_TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" DROP COLUMN IF EXISTS "x402ServiceEndpoint"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ADD "x402ServiceEndpoint" character varying(500); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" DROP COLUMN IF EXISTS "ucpCheckoutEndpoint"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ADD "ucpCheckoutEndpoint" character varying(500); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" DROP COLUMN IF EXISTS "thumbnailUrl"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ADD "thumbnailUrl" character varying(500); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" DROP COLUMN IF EXISTS "imageUrl"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ADD "imageUrl" character varying(500); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "permissions" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "compatibleAgents" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "humanAccessible" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."skill_original_platform_enum_old" AS ENUM('claude', 'openai', 'gemini', 'grok', 'third_party')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "originalPlatform" TYPE "public"."skill_original_platform_enum_old" USING "originalPlatform"::"text"::"public"."skill_original_platform_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."skills_originalplatform_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."skill_original_platform_enum_old" RENAME TO "skill_original_platform_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "source" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."skill_source_enum_old" AS ENUM('native', 'imported', 'converted')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "source" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "source" TYPE "public"."skill_source_enum_old" USING "source"::"text"::"public"."skill_source_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "source" SET DEFAULT 'native'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."skills_source_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."skill_source_enum_old" RENAME TO "skill_source_enum"`);
        await queryRunner.query(`CREATE TYPE "public"."skill_resource_type_enum_old" AS ENUM('physical', 'service', 'digital', 'data', 'logic')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "resourceType" TYPE "public"."skill_resource_type_enum_old" USING "resourceType"::"text"::"public"."skill_resource_type_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."skills_resourcetype_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."skill_resource_type_enum_old" RENAME TO "skill_resource_type_enum"`);
        await queryRunner.query(`CREATE TYPE "public"."skill_value_type_enum_old" AS ENUM('action', 'deliverable', 'decision', 'data')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "valueType" TYPE "public"."skill_value_type_enum_old" USING "valueType"::"text"::"public"."skill_value_type_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."skills_valuetype_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."skill_value_type_enum_old" RENAME TO "skill_value_type_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "layer" DROP NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."skill_layer_enum_old" AS ENUM('infra', 'resource', 'logic', 'composite')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "layer" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "layer" TYPE "public"."skill_layer_enum_old" USING "layer"::"text"::"public"."skill_layer_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ALTER COLUMN "layer" SET DEFAULT 'logic'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."skills_layer_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."skill_layer_enum_old" RENAME TO "skill_layer_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "webhook_configs" DROP COLUMN IF EXISTS "secret"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "webhook_configs" ADD "secret" character varying(100); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "webhook_configs" DROP COLUMN IF EXISTS "events"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "webhook_configs" ADD "events" jsonb NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "webhook_configs" DROP COLUMN IF EXISTS "url"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "webhook_configs" ADD "url" character varying(500) NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."workspace_member_role_enum_old" AS ENUM('owner', 'admin', 'member', 'viewer', 'guest')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" ALTER COLUMN "role" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" ALTER COLUMN "role" TYPE "public"."workspace_member_role_enum_old" USING "role"::"text"::"public"."workspace_member_role_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" ALTER COLUMN "role" SET DEFAULT 'member'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."workspace_members_role_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."workspace_member_role_enum_old" RENAME TO "workspace_member_role_enum"`);
        await queryRunner.query(`CREATE TYPE "public"."workspace_status_enum_old" AS ENUM('active', 'suspended', 'archived', 'deleted')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ALTER COLUMN "status" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ALTER COLUMN "status" TYPE "public"."workspace_status_enum_old" USING "status"::"text"::"public"."workspace_status_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ALTER COLUMN "status" SET DEFAULT 'active'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."workspaces_status_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."workspace_status_enum_old" RENAME TO "workspace_status_enum"`);
        await queryRunner.query(`CREATE TYPE "public"."workspace_plan_enum_old" AS ENUM('free', 'pro', 'business', 'enterprise')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ALTER COLUMN "plan" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ALTER COLUMN "plan" TYPE "public"."workspace_plan_enum_old" USING "plan"::"text"::"public"."workspace_plan_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ALTER COLUMN "plan" SET DEFAULT 'free'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."workspaces_plan_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."workspace_plan_enum_old" RENAME TO "workspace_plan_enum"`);
        await queryRunner.query(`CREATE TYPE "public"."workspace_type_enum_old" AS ENUM('personal', 'team', 'organization', 'enterprise')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ALTER COLUMN "type" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ALTER COLUMN "type" TYPE "public"."workspace_type_enum_old" USING "type"::"text"::"public"."workspace_type_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ALTER COLUMN "type" SET DEFAULT 'personal'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."workspaces_type_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."workspace_type_enum_old" RENAME TO "workspace_type_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "users" DROP COLUMN IF EXISTS "defaultAccountId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "users" ADD "defaultAccountId" uuid; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "users" DROP CONSTRAINT IF EXISTS "UQ_eda3fd04bdb78a1c678fdb6ecc9"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "users" DROP CONSTRAINT IF EXISTS "UQ_60cea0d80c39eedaaaf5e21f175"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."user_status_enum_old" AS ENUM('active', 'pending', 'suspended', 'frozen', 'closed', 'banned')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "users" ALTER COLUMN "status" DROP DEFAULT; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "users" ALTER COLUMN "status" TYPE "public"."user_status_enum_old" USING "status"::"text"::"public"."user_status_enum_old"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "users" ALTER COLUMN "status" SET DEFAULT 'active'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."users_status_enum"`);
        await queryRunner.query(`ALTER TYPE "public"."user_status_enum_old" RENAME TO "user_status_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "users" DROP COLUMN IF EXISTS "roles"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."users_roles_enum" AS ENUM('user', 'agent', 'merchant', 'developer')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "users" ADD "roles" "public"."users_roles_enum" array NOT NULL DEFAULT '{user}'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "lastSyncedAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "usdValue"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "balance"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "tokenSymbol"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "tokenAddress"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "userId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" DROP COLUMN IF EXISTS "agentId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" DROP COLUMN IF EXISTS "transactionId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "updatedAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "createdAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "transactionCount"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "totalWithdraw"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "totalDeposit"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "monthlyLimit"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "dailyLimit"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "singleTxLimit"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "isDefault"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "multiCurrencyBalances"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "balanceUpdatedAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "pendingBalance"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "frozenBalance"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "availableBalance"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "mpcWalletId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "walletAddress"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "chainId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "chainType"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."accounts_chaintype_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "walletType"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."accounts_wallettype_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "ownerType"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."accounts_ownertype_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "ownerId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP CONSTRAINT IF EXISTS "UQ_03220d8b0ebb79b008b6ec15b3e"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" DROP COLUMN IF EXISTS "accountId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "updatedAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "createdAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "failedTransactions"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "successfulTransactions"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "totalTransactionAmount"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "totalTransactions"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "lastActiveAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "activatedAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "registrationChain"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "onchainRegistrationTxHash"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "easAttestationUid"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "limitResetDate"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "usedMonthAmount"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "usedTodayAmount"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "spendingLimits"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "creditScoreUpdatedAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "riskLevel"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."agent_accounts_risklevel_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "creditScore"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "externalWalletAddress"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "mpcWalletId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "defaultAccountId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "apiKeyPrefix"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "apiSecretHash"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "publicKey"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "agentType"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."agent_accounts_agenttype_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "parentAgentId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "avatarUrl"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP CONSTRAINT IF EXISTS "UQ_9e2cf40168fd6b81f3497fe7dc4"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" DROP COLUMN IF EXISTS "agentUniqueId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "api_keys" DROP COLUMN IF EXISTS "metadata"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "api_keys" DROP COLUMN IF EXISTS "rate_limit"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "api_keys" DROP COLUMN IF EXISTS "allowedOrigins"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "api_keys" DROP COLUMN IF EXISTS "mode"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."api_keys_mode_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "incomeMode"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "commissionRate"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "currency"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "price"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "metadata"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "tokenId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "contractAddress"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "sourceType"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "sourcePlatform"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "assetType"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" DROP COLUMN IF EXISTS "assetId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "updatedAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "createdAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "expiresAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "lastMonthlyResetDate"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "lastDailyResetDate"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "totalUsed"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "usedThisMonth"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "usedToday"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "monthlyLimit"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "dailyLimit"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "singleTxLimit"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "categoryScope"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "merchantScope"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "isAutoPay"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" DROP COLUMN IF EXISTS "authorizationType"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."authorizations_authorizationtype_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" DROP COLUMN IF EXISTS "transaction_hash"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" DROP COLUMN IF EXISTS "settlement_date"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" DROP COLUMN IF EXISTS "currency"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" DROP COLUMN IF EXISTS "amount"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" DROP COLUMN IF EXISTS "payee_type"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."commission_settlements_v4_payee_type_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" DROP COLUMN IF EXISTS "payee_id"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" DROP COLUMN IF EXISTS "contactEmail"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "mpc_wallets" DROP COLUMN IF EXISTS "purpose"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."mpc_wallets_purpose_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "mpc_wallets" DROP COLUMN IF EXISTS "userId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "mpc_wallets" DROP COLUMN IF EXISTS "workspaceId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "updatedAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "createdAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "sanctionCheckResult"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "amlRiskScore"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "providerResponse"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "providerVerificationId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "providerName"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "lastReminderAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "expiresAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "approvedAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "reviewHistory"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "reviewNotes"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "rejectionReason"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "reviewedAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "reviewedBy"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "companyInfo"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "companyType"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "companyRegistrationNumber"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "companyName"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "selfieUrl"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "countryCode"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "dateOfBirth"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "documentNumber"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "documentType"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."kyc_records_documenttype_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" DROP COLUMN IF EXISTS "fullName"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "pay_intents" DROP COLUMN IF EXISTS "attribution"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" DROP COLUMN IF EXISTS "metadata"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" DROP COLUMN IF EXISTS "decision"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" DROP COLUMN IF EXISTS "paymentId"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "webhook_configs" DROP COLUMN IF EXISTS "active"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "webhook_configs" DROP COLUMN IF EXISTS "user_id"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" DROP COLUMN IF EXISTS "updatedAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" DROP COLUMN IF EXISTS "joinedAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" DROP COLUMN IF EXISTS "lastActiveAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" DROP COLUMN IF EXISTS "invitedBy"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" DROP COLUMN IF EXISTS "acceptedAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" DROP COLUMN IF EXISTS "invitedAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" DROP COLUMN IF EXISTS "displayName"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" DROP COLUMN IF EXISTS "updatedAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" DROP COLUMN IF EXISTS "createdAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" DROP COLUMN IF EXISTS "planExpiresAt"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" DROP COLUMN IF EXISTS "usedStorageMB"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" DROP COLUMN IF EXISTS "maxStorageMB"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" DROP COLUMN IF EXISTS "maxAgents"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" DROP COLUMN IF EXISTS "maxMembers"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" DROP COLUMN IF EXISTS "iconUrl"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "currency" character varying(3); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "tokenId" character varying(255); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "contractAddress" character varying(255); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "sourcePlatform" character varying(100) NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "assetId" character varying(255) NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."asset_aggregations_incomemode_enum" AS ENUM('platform_commission', 'user_paid')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "incomeMode" "public"."asset_aggregations_incomemode_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "commissionRate" numeric(5,4); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "price" numeric(18,2); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "metadata" jsonb; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."asset_aggregations_sourcetype_enum" AS ENUM('platform_aggregated', 'user_generated')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "sourceType" "public"."asset_aggregations_sourcetype_enum" NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."asset_aggregations_assettype_enum" AS ENUM('nft', 'ft', 'game_asset', 'rwa')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "assetType" "public"."asset_aggregations_assettype_enum" NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" ADD "metadata" jsonb; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."risk_assessments_decision_enum" AS ENUM('approve', 'review', 'reject')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" ADD "decision" "public"."risk_assessments_decision_enum" DEFAULT 'review'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" ADD "paymentId" uuid; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "status_reason" character varying(500); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "wallet_address" character varying(100); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "chain_id" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "owner_id" character varying NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "account_id" character varying(50) NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD CONSTRAINT "UQ_abcd260aa34b3ad2c0ff663dc20" UNIQUE ("account_id"); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "updated_at" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "created_at" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "transaction_count" integer NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "total_withdraw" numeric(18,2) NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "total_deposit" numeric(18,2) NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "monthly_limit" numeric(18,2); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "daily_limit" numeric(18,2); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "single_tx_limit" numeric(18,2); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "is_default" boolean NOT NULL DEFAULT false; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "multi_currency_balances" jsonb; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "balance_updated_at" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "pending_balance" numeric(18,6) NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "frozen_balance" numeric(18,6) NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "available_balance" numeric(18,6) NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "mpc_wallet_id" uuid; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."account_chain_type_enum" AS ENUM('evm', 'solana', 'bitcoin', 'multi')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "chain_type" "public"."account_chain_type_enum" NOT NULL DEFAULT 'evm'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."account_wallet_type_enum" AS ENUM('custodial', 'non_custodial', 'virtual')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "wallet_type" "public"."account_wallet_type_enum" NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."account_owner_type_enum" AS ENUM('user', 'agent', 'merchant', 'platform')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "accounts" ADD "owner_type" "public"."account_owner_type_enum" NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "status_reason" character varying(500); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "registration_chain" character varying(20); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "onchain_registration_tx_hash" character varying(100); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "eas_attestation_uid" character varying(100); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "external_wallet_address" character varying(100); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "api_key_prefix" character varying(20); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "api_secret_hash" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "public_key" character varying(255); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "avatar_url" character varying(500); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "agent_unique_id" character varying(50) NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD CONSTRAINT "UQ_7bcc7100cafd8838a8200bb70e4" UNIQUE ("agent_unique_id"); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "updated_at" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "created_at" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "failed_transactions" integer NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "successful_transactions" integer NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "total_transaction_amount" numeric(18,2) NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "total_transactions" integer NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "last_active_at" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "activated_at" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "limit_reset_date" date; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "used_month_amount" numeric(18,2) NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "used_today_amount" numeric(18,2) NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "spending_limits" jsonb; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "credit_score_updated_at" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."agent_risk_level_enum" AS ENUM('low', 'medium', 'high', 'critical')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "risk_level" "public"."agent_risk_level_enum" NOT NULL DEFAULT 'medium'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "credit_score" numeric(7,2) NOT NULL DEFAULT '500'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "mpc_wallet_id" uuid; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "default_account_id" uuid; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."agent_type_enum" AS ENUM('personal', 'merchant', 'platform', 'third_party')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "agent_type" "public"."agent_type_enum" NOT NULL DEFAULT 'personal'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_accounts" ADD "parent_agent_id" uuid; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "api_keys" ADD "allowed_origins" text; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "tokenSymbol" character varying(50) NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "tokenAddress" character varying(255) NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "lastSyncedAt" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "usdValue" numeric(18,2); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "balance" numeric(18,6) NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "asset_aggregations" ADD "userId" uuid NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "updated_at" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "created_at" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "expires_at" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "last_monthly_reset_date" date; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "last_daily_reset_date" date; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "total_used" numeric(15,2) NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "used_this_month" numeric(15,2) NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "used_today" numeric(15,2) NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "monthly_limit" numeric(15,2); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "daily_limit" numeric(15,2); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "single_tx_limit" numeric(15,2); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "is_auto_pay" boolean NOT NULL DEFAULT false; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."authorization_type_enum" AS ENUM('manual', 'auto_pay')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD "authorization_type" "public"."authorization_type_enum" NOT NULL DEFAULT 'manual'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" ADD "merchant_id" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" ADD "trigger_type" character varying(20); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_settlements_v4" ADD "unlock_at" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ADD "status_reason" character varying(500); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ADD "contact_email" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "provider_verification_id" character varying(100); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "provider_name" character varying(50); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "review_notes" text; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "rejection_reason" text; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "company_type" character varying(50); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "company_registration_number" character varying(100); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "company_name" character varying(200); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "selfie_url" character varying(500); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "country_code" character varying(10); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "document_number" character varying(100); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "full_name" character varying(100); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "updated_at" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "created_at" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "sanction_check_result" jsonb; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "aml_risk_score" numeric(5,2); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "provider_response" jsonb; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "last_reminder_at" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "expires_at" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "approved_at" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "review_history" jsonb; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "reviewed_at" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "reviewed_by" uuid; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "company_info" jsonb; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "date_of_birth" date; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE TYPE "public"."document_type_enum" AS ENUM('id_card', 'passport', 'driver_license', 'business_license', 'bank_statement', 'utility_bill', 'other')`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "kyc_records" ADD "document_type" "public"."document_type_enum"; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" ADD "updatedAt" TIMESTAMP NOT NULL DEFAULT now(); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" ADD "createdAt" TIMESTAMP NOT NULL DEFAULT now(); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "policies" ADD "lastTriggered" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_reviews" ADD "rejection_reason" text; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_reviews" ADD "review_comment" text; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_reviews" ADD "auto_review_result" jsonb; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_reviews" ADD "revision_fields" jsonb; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_reviews" ADD "product_snapshot" jsonb; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "products" ADD "reviewNote" text; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "products" ADD "reviewedBy" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "products" ADD "lastSyncAt" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "products" ADD "reviewedAt" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" ADD "agentId" character varying(255); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" ADD "transactionId" uuid; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skills" ADD "ratingCount" integer NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "webhook_configs" ADD "enabled" boolean NOT NULL DEFAULT true; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "webhook_configs" ADD "timeout" integer NOT NULL DEFAULT '5000'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "webhook_configs" ADD "merchantId" uuid NOT NULL; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" ADD "display_name" character varying(50); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" ADD "updated_at" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" ADD "joined_at" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" ADD "last_active_at" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" ADD "invited_by" uuid; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" ADD "accepted_at" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" ADD "invited_at" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ADD "icon_url" character varying; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ADD "updated_at" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ADD "created_at" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ADD "plan_expires_at" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ADD "used_storage_mb" numeric(10,2) NOT NULL DEFAULT '0'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ADD "max_storage_mb" integer NOT NULL DEFAULT '100'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ADD "max_agents" integer NOT NULL DEFAULT '3'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ADD "max_members" integer NOT NULL DEFAULT '1'; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "users" ADD "status_reason" character varying(500); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "users" ADD "default_account_id" uuid; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "users" ADD "last_active_at" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "users" ADD "status_updated_at" TIMESTAMP; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DROP TABLE "audit_proofs"`);
        await queryRunner.query(`DROP TABLE "agent_registry"`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."agent_registry_risktier_enum"`);
        await queryRunner.query(`DROP INDEX IF EXISTS "public"."IDX_45c756af6533ee6e9f80ce7efe"`);
        await queryRunner.query(`DROP TABLE "webhook_events"`);
        await queryRunner.query(`DROP TYPE IF EXISTS "public"."webhook_events_status_enum"`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "external_skill_mappings" ADD CONSTRAINT "external_skill_mappings_externalPlatform_externalId_key" UNIQUE ("externalPlatform", "externalId"); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "user_installed_skills" ADD CONSTRAINT "UQ_user_skill" UNIQUE ("userId", "skillId"); EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`CREATE UNIQUE INDEX "IDX_cef5ce7c595db3ef0126a9ad65" ON "asset_aggregations" ("chain", "assetId", "sourcePlatform") `);
        await queryRunner.query(`CREATE INDEX "IDX_10ae0181853fe5ddf3372bccba" ON "asset_aggregations" ("assetId") `);
        await queryRunner.query(`CREATE INDEX "IDX_128772fbda0ab3bf2605f2955d" ON "asset_aggregations" ("assetType") `);
        await queryRunner.query(`CREATE INDEX "IDX_827af7fe090efe8ee13c98c384" ON "asset_aggregations" ("sourcePlatform") `);
        await queryRunner.query(`CREATE INDEX "IDX_316e4c34c7b75742e11c083f89" ON "asset_aggregations" ("sourceType") `);
        await queryRunner.query(`CREATE INDEX "IDX_48a6cbf3db98bc76347a8ff461" ON "risk_assessments" ("paymentId") `);
        await queryRunner.query(`CREATE INDEX "IDX_e7bf8ade89ec9a566493f3f5e8" ON "risk_assessments" ("createdAt") `);
        await queryRunner.query(`CREATE INDEX "IDX_accounts_is_default" ON "accounts" ("is_default") `);
        await queryRunner.query(`CREATE INDEX "IDX_accounts_status" ON "accounts" ("status") `);
        await queryRunner.query(`CREATE INDEX "IDX_accounts_wallet_address" ON "accounts" ("wallet_address") `);
        await queryRunner.query(`CREATE INDEX "IDX_accounts_owner" ON "accounts" ("owner_id", "owner_type") `);
        await queryRunner.query(`CREATE INDEX "IDX_agent_accounts_type" ON "agent_accounts" ("agent_type") `);
        await queryRunner.query(`CREATE INDEX "IDX_agent_accounts_status" ON "agent_accounts" ("status") `);
        await queryRunner.query(`CREATE INDEX "IDX_agent_accounts_owner_id" ON "agent_accounts" ("owner_id") `);
        await queryRunner.query(`CREATE INDEX "IDX_agent_accounts_unique_id" ON "agent_accounts" ("agent_unique_id") `);
        await queryRunner.query(`CREATE INDEX "IDX_726c4e7569d4ccb1af4a35ac12" ON "agent_sessions" ("status", "user_id") `);
        await queryRunner.query(`CREATE INDEX "IDX_25a2aa754bee06261e91bfc051" ON "agent_sessions" ("session_id") `);
        await queryRunner.query(`CREATE INDEX "IDX_api_keys_user_id" ON "api_keys" ("user_id") `);
        await queryRunner.query(`CREATE INDEX "IDX_api_keys_key_hash" ON "api_keys" ("key_hash") `);
        await queryRunner.query(`CREATE INDEX "IDX_9caabe7c3a8dabd16e206879b0" ON "asset_aggregations" ("userId") `);
        await queryRunner.query(`CREATE INDEX "IDX_9bdba9200942bb473313764db9" ON "asset_aggregations" ("chain", "tokenAddress") `);
        await queryRunner.query(`CREATE INDEX "IDX_authorizations_user_status" ON "authorizations" ("user_id", "status") `);
        await queryRunner.query(`CREATE INDEX "IDX_authorizations_user_agent" ON "authorizations" ("user_id", "agent_id") `);
        await queryRunner.query(`CREATE INDEX "idx_developer_accounts_developer_unique_id" ON "developer_accounts" ("developer_unique_id") `);
        await queryRunner.query(`CREATE INDEX "idx_developer_accounts_user_id" ON "developer_accounts" ("user_id") `);
        await queryRunner.query(`CREATE INDEX "idx_developer_accounts_tier" ON "developer_accounts" ("tier") `);
        await queryRunner.query(`CREATE INDEX "idx_developer_accounts_status" ON "developer_accounts" ("status") `);
        await queryRunner.query(`CREATE INDEX "IDX_fund_paths_is_x402" ON "fund_paths" ("is_x402") `);
        await queryRunner.query(`CREATE INDEX "IDX_fund_paths_path_type" ON "fund_paths" ("path_type") `);
        await queryRunner.query(`CREATE INDEX "IDX_fund_paths_created_at" ON "fund_paths" ("created_at") `);
        await queryRunner.query(`CREATE INDEX "IDX_fund_paths_transaction_hash" ON "fund_paths" ("transaction_hash") `);
        await queryRunner.query(`CREATE INDEX "IDX_fund_paths_payment_id" ON "fund_paths" ("payment_id") `);
        await queryRunner.query(`CREATE INDEX "IDX_kyc_records_expires_at" ON "kyc_records" ("expires_at") `);
        await queryRunner.query(`CREATE INDEX "IDX_kyc_records_level" ON "kyc_records" ("level") `);
        await queryRunner.query(`CREATE INDEX "IDX_kyc_records_status" ON "kyc_records" ("status") `);
        await queryRunner.query(`CREATE INDEX "IDX_kyc_records_user_id" ON "kyc_records" ("user_id") `);
        await queryRunner.query(`CREATE INDEX "idx_skill_analytics_platform_time" ON "skill_analytics" ("platform", "createdAt") `);
        await queryRunner.query(`CREATE INDEX "idx_skill_analytics_caller_time" ON "skill_analytics" ("callerId", "createdAt") `);
        await queryRunner.query(`CREATE INDEX "idx_skill_analytics_skill_time" ON "skill_analytics" ("skillId", "createdAt") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "IDX_pay_intents_idempotencyKey" ON "pay_intents" ("idempotencyKey") WHERE ("idempotencyKey" IS NOT NULL)`);
        await queryRunner.query(`CREATE INDEX "IDX_policies_workspaceId" ON "policies" ("workspaceId") `);
        await queryRunner.query(`CREATE INDEX "IDX_policies_userId" ON "policies" ("userId") `);
        await queryRunner.query(`CREATE INDEX "IDX_product_reviews_merchant_status" ON "product_reviews" ("merchant_id", "status") `);
        await queryRunner.query(`CREATE INDEX "IDX_product_reviews_product_status" ON "product_reviews" ("product_id", "status") `);
        await queryRunner.query(`CREATE INDEX "IDX_product_sync_mappings_product_id" ON "product_sync_mappings" ("product_id") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "IDX_product_sync_mappings_connection_external_unique" ON "product_sync_mappings" ("connection_id", "external_product_id") `);
        await queryRunner.query(`CREATE INDEX "IDX_ecommerce_connections_merchant_platform" ON "ecommerce_connections" ("merchant_id", "platform") `);
        await queryRunner.query(`CREATE INDEX "IDX_66fd180e7e0ee1ac31f003bcba" ON "risk_assessments" ("transactionId") `);
        await queryRunner.query(`CREATE INDEX "idx_skills_resource_type" ON "skills" ("resourceType") `);
        await queryRunner.query(`CREATE INDEX "idx_skills_source" ON "skills" ("source") `);
        await queryRunner.query(`CREATE INDEX "idx_skills_layer" ON "skills" ("layer") `);
        await queryRunner.query(`CREATE INDEX "IDX_SKILLS_AUTHOR" ON "skills" ("authorId") `);
        await queryRunner.query(`CREATE INDEX "IDX_SKILLS_CATEGORY" ON "skills" ("category") `);
        await queryRunner.query(`CREATE INDEX "IDX_SKILLS_STATUS" ON "skills" ("status") `);
        await queryRunner.query(`CREATE INDEX "IDX_webhook_configs_merchantId" ON "webhook_configs" ("merchantId") `);
        await queryRunner.query(`CREATE INDEX "IDX_workspace_members_user_id" ON "workspace_members" ("user_id") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "IDX_workspace_members_workspace_user" ON "workspace_members" ("workspace_id", "user_id") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "IDX_workspaces_slug" ON "workspaces" ("slug") `);
        await queryRunner.query(`CREATE INDEX "IDX_workspaces_status" ON "workspaces" ("status") `);
        await queryRunner.query(`CREATE INDEX "IDX_workspaces_owner_id" ON "workspaces" ("owner_id") `);
        await queryRunner.query(`CREATE INDEX "IDX_users_email" ON "users" ("email") `);
        await queryRunner.query(`CREATE INDEX "IDX_users_status" ON "users" ("status") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "IDX_users_twitterId" ON "users" ("twitterId") WHERE ("twitterId" IS NOT NULL)`);
        await queryRunner.query(`CREATE UNIQUE INDEX "IDX_users_appleId" ON "users" ("appleId") WHERE ("appleId" IS NOT NULL)`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" ADD CONSTRAINT "FK_48a6cbf3db98bc76347a8ff4615" FOREIGN KEY ("paymentId") REFERENCES "payments"("id") ON DELETE NO ACTION ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "risk_assessments" ADD CONSTRAINT "FK_4fb7acafe990a5abbf321c534a5" FOREIGN KEY ("userId") REFERENCES "users"("id") ON DELETE NO ACTION ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "agent_sessions" ADD CONSTRAINT "FK_40a6b0600d60c067ae0f8659ce0" FOREIGN KEY ("user_id") REFERENCES "users"("id") ON DELETE NO ACTION ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "api_keys" ADD CONSTRAINT "FK_api_keys_user" FOREIGN KEY ("user_id") REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD CONSTRAINT "FK_authorizations_user" FOREIGN KEY ("user_id") REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "authorizations" ADD CONSTRAINT "FK_authorizations_agent" FOREIGN KEY ("agent_id") REFERENCES "accounts"("id") ON DELETE CASCADE ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "commission_allocations_v4" ADD CONSTRAINT "FK_commission_allocations_v4_settlement" FOREIGN KEY ("settlement_id") REFERENCES "commission_settlements_v4"("id") ON DELETE NO ACTION ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "developer_accounts" ADD CONSTRAINT "fk_developer_account_user" FOREIGN KEY ("user_id") REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "external_skill_mappings" ADD CONSTRAINT "external_skill_mappings_agentrixSkillId_fkey" FOREIGN KEY ("agentrixSkillId") REFERENCES "skills"("id") ON DELETE SET NULL ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "skill_analytics" ADD CONSTRAINT "skill_analytics_skillId_fkey" FOREIGN KEY ("skillId") REFERENCES "skills"("id") ON DELETE CASCADE ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_reviews" ADD CONSTRAINT "FK_a2ffe4b13d499c0e8aa165996c6" FOREIGN KEY ("reviewer_id") REFERENCES "users"("id") ON DELETE SET NULL ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_skill_conversions" ADD CONSTRAINT "product_skill_conversions_productId_fkey" FOREIGN KEY ("productId") REFERENCES "products"("id") ON DELETE CASCADE ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "product_skill_conversions" ADD CONSTRAINT "product_skill_conversions_skillId_fkey" FOREIGN KEY ("skillId") REFERENCES "skills"("id") ON DELETE SET NULL ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "user_installed_skills" ADD CONSTRAINT "FK_user_installed_skills_user" FOREIGN KEY ("userId") REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "user_installed_skills" ADD CONSTRAINT "FK_user_installed_skills_skill" FOREIGN KEY ("skillId") REFERENCES "skills"("id") ON DELETE CASCADE ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" ADD CONSTRAINT "FK_workspace_members_workspace" FOREIGN KEY ("workspace_id") REFERENCES "workspaces"("id") ON DELETE CASCADE ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspace_members" ADD CONSTRAINT "FK_workspace_members_user" FOREIGN KEY ("user_id") REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
        await queryRunner.query(`DO $$ BEGIN ALTER TABLE "workspaces" ADD CONSTRAINT "FK_workspaces_owner" FOREIGN KEY ("owner_id") REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE NO ACTION; EXCEPTION WHEN undefined_table THEN NULL; END $$;`);
    }

}
