{
  "openapi": "3.1.0",
  "info": {
    "title": "Agentrix Commerce & Marketplace API",
    "version": "2.0.0",
    "description": "Agentrix unified commerce API for GPTs. Supports marketplace search, skill execution, revenue split plans, budget pools, milestone-based payouts, fee calculation, and UCP checkout. Platform fee: 0.3% on splits, pure crypto payments are free."
  },
  "servers": [
    {
      "url": "https://api.agentrix.top/api",
      "description": "Agentrix API Server"
    }
  ],
  "components": {
    "securitySchemes": {
      "ApiKeyAuth": {
        "type": "apiKey",
        "in": "header",
        "name": "X-API-Key",
        "description": "API Key for identifying the GPT user session."
      }
    },
    "schemas": {
      "ToolResponse": {
        "type": "object",
        "properties": {
          "content": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "type": { "type": "string", "description": "Content type, usually 'text'" },
                "text": { "type": "string", "description": "Response content in JSON string format" }
              },
              "required": ["type", "text"]
            },
            "description": "Response content array"
          },
          "isError": { "type": "boolean", "description": "Whether the operation resulted in an error" }
        },
        "required": ["content"]
      },
      "SearchResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean" },
          "message": { "type": "string" },
          "data": {
            "type": "object",
            "properties": {
              "items": {
                "type": "array",
                "items": { "$ref": "#/components/schemas/Product" }
              },
              "total": { "type": "integer" },
              "query": { "type": "string" }
            },
            "required": ["items"]
          }
        },
        "required": ["success", "data"]
      },
      "ProductResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean" },
          "message": { "type": "string" },
          "data": { "$ref": "#/components/schemas/Product" }
        },
        "required": ["success", "data"]
      },
      "Product": {
        "type": "object",
        "properties": {
          "id": { "type": "string", "description": "Product ID" },
          "title": { "type": "string", "description": "Product title" },
          "description": { "type": "string" },
          "price": { "type": "number" },
          "currency": { "type": "string", "default": "CNY" },
          "priceDisplay": { "type": "string" },
          "image": { "type": "string", "format": "uri" },
          "images": {
            "type": "array",
            "items": { "type": "string", "format": "uri" }
          },
          "category": { "type": "string" },
          "productType": {
            "type": "string",
            "enum": ["physical", "service", "crypto", "nft"]
          },
          "stock": { "type": "integer" },
          "inStock": { "type": "boolean" }
        },
        "required": ["id", "title", "price"]
      },
      "ShippingAddress": {
        "type": "object",
        "properties": {
          "name": { "type": "string" },
          "phone": { "type": "string" },
          "addressLine": { "type": "string" },
          "city": { "type": "string" },
          "postalCode": { "type": "string" },
          "country": { "type": "string" }
        },
        "required": ["name", "phone", "addressLine"]
      },
      "CreateOrderInput": {
        "type": "object",
        "properties": {
          "productId": { "type": "string" },
          "quantity": { "type": "integer", "default": 1, "minimum": 1 },
          "shippingAddress": { "$ref": "#/components/schemas/ShippingAddress" },
          "appointmentTime": {
            "type": "string",
            "format": "date-time",
            "description": "For service-type products."
          },
          "contactInfo": { "type": "string" },
          "walletAddress": { "type": "string" },
          "chain": {
            "type": "string",
            "enum": ["ethereum", "polygon", "solana", "bsc"]
          }
        },
        "required": ["productId"]
      },
      "OrderResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean" },
          "message": { "type": "string" },
          "data": { "$ref": "#/components/schemas/Order" }
        },
        "required": ["success", "data"]
      },
      "Order": {
        "type": "object",
        "properties": {
          "orderId": { "type": "string" },
          "status": {
            "type": "string",
            "enum": ["pending", "paid", "processing", "shipped", "delivered", "cancelled"]
          },
          "amount": { "type": "number" },
          "currency": { "type": "string" },
          "productId": { "type": "string" },
          "quantity": { "type": "integer" },
          "createdAt": { "type": "string", "format": "date-time" }
        },
        "required": ["orderId", "status", "amount", "currency"]
      },
      "PaymentInput": {
        "type": "object",
        "properties": {
          "orderId": { "type": "string" },
          "method": {
            "type": "string",
            "enum": ["crypto", "fiat", "usdc"]
          }
        },
        "required": ["orderId"]
      },
      "PaymentResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean" },
          "message": { "type": "string" },
          "data": { "$ref": "#/components/schemas/Payment" }
        },
        "required": ["success", "data"]
      },
      "Payment": {
        "type": "object",
        "properties": {
          "paymentId": { "type": "string" },
          "paymentUrl": { "type": "string", "format": "uri" },
          "status": {
            "type": "string",
            "enum": ["pending", "processing", "completed", "failed"]
          },
          "orderId": { "type": "string" }
        },
        "required": ["paymentId", "status"]
      },
      "Error": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean" },
          "error": { "type": "string" },
          "message": { "type": "string" }
        },
        "required": ["success"]
      }
    }
  },
  "security": [{ "ApiKeyAuth": [] }],
  "paths": {
    "/marketplace/search": {
      "get": {
        "summary": "Search products",
        "operationId": "searchProducts",
        "tags": ["Marketplace"],
        "parameters": [
          { "name": "query", "in": "query", "required": true, "schema": { "type": "string" } },
          { "name": "category", "in": "query", "schema": { "type": "string" } },
          { "name": "priceMin", "in": "query", "schema": { "type": "number" } },
          { "name": "priceMax", "in": "query", "schema": { "type": "number" } },
          { "name": "currency", "in": "query", "schema": { "type": "string", "default": "CNY" } },
          { "name": "inStock", "in": "query", "schema": { "type": "boolean" } },
          { "name": "limit", "in": "query", "schema": { "type": "integer", "default": 10, "minimum": 1, "maximum": 100 } }
        ],
        "responses": {
          "200": {
            "description": "Search results",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/SearchResponse" }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    },
    "/marketplace/products/{id}": {
      "get": {
        "summary": "Get product details",
        "operationId": "getProduct",
        "tags": ["Marketplace"],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "string" } }
        ],
        "responses": {
          "200": {
            "description": "Product details",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ProductResponse" }
              }
            }
          },
          "404": {
            "description": "Product not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    },
    "/marketplace/orders": {
      "post": {
        "summary": "Create an order",
        "operationId": "createOrder",
        "tags": ["Orders"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/CreateOrderInput" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Order created",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/OrderResponse" }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    },
    "/marketplace/payments": {
      "post": {
        "summary": "Initiate a payment",
        "operationId": "initiatePayment",
        "tags": ["Payments"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/PaymentInput" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Payment created",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/PaymentResponse" }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" }
              }
            }
          }
        }
      }
    },
    "/mcp/tool/search_marketplace": {
      "post": {
        "summary": "Search Agentrix Marketplace for skills, products, services, and tasks. Supports natural language queries with filtering and sorting.",
        "operationId": "searchMarketplace",
        "tags": ["Commerce"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "query": { "type": "string", "description": "Search query (natural language supported). Example: 'AI writing assistant' or 'payment integration'" },
                  "type": { "type": "string", "enum": ["all", "skill", "product", "service", "task"], "description": "Filter by type. Default: all" },
                  "category": { "type": "string", "enum": ["payment", "commerce", "data", "utility", "integration", "ai", "defi", "nft", "social"] },
                  "priceMin": { "type": "number", "description": "Minimum price in USD" },
                  "priceMax": { "type": "number", "description": "Maximum price in USD" },
                  "sortBy": { "type": "string", "enum": ["relevance", "popular", "newest", "price_low", "price_high", "rating"] },
                  "page": { "type": "number", "description": "Page number for pagination" },
                  "limit": { "type": "number", "description": "Results per page. Max 50, default 10" }
                },
                "required": ["query"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Search results with skills, products, and services",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ToolResponse" }
              }
            }
          }
        }
      }
    },
    "/mcp/tool/execute_skill": {
      "post": {
        "summary": "Execute a skill from Agentrix Marketplace by ID. Free skills execute immediately. Paid skills require payment via wallet (free, user pays gas), balance, or X402 auto payment.",
        "operationId": "executeSkill",
        "tags": ["Commerce"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "skillId": { "type": "string", "description": "Skill ID from search results" },
                  "params": { "type": "object", "description": "Skill-specific input parameters" },
                  "paymentMethod": { "type": "string", "enum": ["wallet", "balance", "x402_auto"], "description": "Payment method. Default: balance" },
                  "maxPrice": { "type": "number", "description": "Max price safety limit in USD" }
                },
                "required": ["skillId"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Skill execution result",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ToolResponse" }
              }
            }
          }
        }
      }
    },
    "/mcp/tool/publish_to_marketplace": {
      "post": {
        "summary": "Publish a skill, product, service, or task to Agentrix Marketplace. Supports automatic split plan creation and budget pool setup. Platform fee: 0.3% on transactions.",
        "operationId": "publishToMarketplace",
        "tags": ["Commerce"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "type": { "type": "string", "enum": ["skill", "product", "service", "task"], "description": "Type of item to publish" },
                  "name": { "type": "string", "description": "Name of the item (3-100 chars)" },
                  "description": { "type": "string", "description": "Detailed description (10-5000 chars)" },
                  "category": { "type": "string", "enum": ["payment", "commerce", "data", "utility", "integration", "ai", "defi", "nft", "social", "other"], "description": "Category" },
                  "pricing": {
                    "type": "object",
                    "properties": {
                      "model": { "type": "string", "enum": ["free", "per_call", "subscription", "one_time", "revenue_share"] },
                      "price": { "type": "number" },
                      "currency": { "type": "string" }
                    },
                    "required": ["model"]
                  },
                  "tags": { "type": "array", "items": { "type": "string" }, "description": "Tags for discoverability" },
                  "visibility": { "type": "string", "enum": ["public", "private", "unlisted"] }
                },
                "required": ["type", "name", "description"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Publish result with marketplace listing details",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ToolResponse" }
              }
            }
          }
        }
      }
    },
    "/mcp/tool/commerce": {
      "post": {
        "summary": "Unified commerce operations: manage split plans, budget pools, milestones, and settlements. Supports multi-party revenue sharing and on-chain settlements.",
        "operationId": "commerceAction",
        "tags": ["Commerce"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "action": {
                    "type": "string",
                    "description": "The commerce action to perform",
                    "enum": [
                      "create_split_plan", "get_split_plan", "update_split_plan",
                      "activate_split_plan", "archive_split_plan", "list_split_plans", "preview_allocation",
                      "create_budget_pool", "get_budget_pool", "fund_budget_pool",
                      "activate_budget_pool", "cancel_budget_pool", "list_budget_pools",
                      "create_milestone", "get_milestone", "start_milestone",
                      "submit_milestone", "approve_milestone", "reject_milestone", "release_milestone_funds",
                      "calculate_fees", "get_fee_structure"
                    ]
                  },
                  "mode": { "type": "string", "enum": ["PAY_ONLY", "SPLIT_ONLY", "PAY_AND_SPLIT"], "description": "Commerce operation mode" },
                  "params": { "type": "object", "description": "Action-specific parameters (varies by action)" }
                },
                "required": ["action"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Commerce action result",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ToolResponse" }
              }
            }
          }
        }
      }
    },
    "/mcp/tool/split_plan": {
      "post": {
        "summary": "Create and manage revenue split plans for multi-party transactions. Define how payments are distributed among participants (merchants, agents, referrers). Example: 70% to merchant, 20% to agent, 10% to platform.",
        "operationId": "splitPlan",
        "tags": ["Commerce"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "action": { "type": "string", "enum": ["create", "get", "update", "activate", "archive", "list", "preview"] },
                  "planId": { "type": "string", "description": "Split plan ID (for get/update/activate/archive)" },
                  "name": { "type": "string", "description": "Plan name (for create)" },
                  "productType": { "type": "string", "description": "Product type: skill, subscription, marketplace, custom" },
                  "rules": {
                    "type": "array",
                    "description": "Split rules defining recipient shares",
                    "items": {
                      "type": "object",
                      "properties": {
                        "recipient": { "type": "string", "description": "Wallet address or user ID" },
                        "shareBps": { "type": "number", "description": "Share in basis points (10000 = 100%)" },
                        "role": { "type": "string", "enum": ["platform", "merchant", "agent", "referrer", "custom"] }
                      }
                    }
                  },
                  "amount": { "type": "string", "description": "Amount for allocation preview (in micro units)" },
                  "paymentType": { "type": "string", "enum": ["CRYPTO_DIRECT", "ONRAMP", "OFFRAMP", "MIXED"] }
                },
                "required": ["action"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Split plan operation result",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ToolResponse" }
              }
            }
          }
        }
      }
    },
    "/mcp/tool/budget_pool": {
      "post": {
        "summary": "Create and manage budget pools for multi-agent collaboration tasks. Supports milestone-based payouts with quality gates. Example: Create a $1000 pool for a development task with 3 milestones.",
        "operationId": "budgetPool",
        "tags": ["Commerce"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "action": { "type": "string", "enum": ["create", "get", "fund", "activate", "cancel", "list"] },
                  "poolId": { "type": "string", "description": "Budget pool ID" },
                  "name": { "type": "string", "description": "Pool name" },
                  "totalBudget": { "type": "string", "description": "Total budget in micro units" },
                  "deadline": { "type": "string", "description": "Deadline ISO date string" },
                  "qualityGate": {
                    "type": "object",
                    "properties": {
                      "minQualityScore": { "type": "number", "description": "Min quality score 0-100" },
                      "requiresApproval": { "type": "boolean", "description": "Requires manual approval" },
                      "autoReleaseDelay": { "type": "number", "description": "Auto-release delay in seconds" }
                    }
                  },
                  "amount": { "type": "string", "description": "Amount to fund" },
                  "source": { "type": "string", "enum": ["wallet", "transak", "external"], "description": "Funding source" }
                },
                "required": ["action"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Budget pool operation result",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ToolResponse" }
              }
            }
          }
        }
      }
    },
    "/mcp/tool/milestone": {
      "post": {
        "summary": "Manage milestones within budget pools. Create, start, submit deliverables, approve/reject with quality scores, and release funds for completed work.",
        "operationId": "milestone",
        "tags": ["Commerce"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "action": { "type": "string", "enum": ["create", "get", "start", "submit", "approve", "reject", "release"] },
                  "milestoneId": { "type": "string", "description": "Milestone ID" },
                  "poolId": { "type": "string", "description": "Parent budget pool ID (for create)" },
                  "title": { "type": "string", "description": "Milestone title" },
                  "percentOfPool": { "type": "number", "description": "Percentage of pool budget (basis points, 10000 = 100%)" },
                  "deliverableHash": { "type": "string", "description": "Hash of deliverable for verification" },
                  "artifacts": { "type": "array", "items": { "type": "string" }, "description": "Artifact URLs or IPFS hashes" },
                  "qualityScore": { "type": "number", "description": "Quality score 0-100 (for approve)" },
                  "feedback": { "type": "string", "description": "Approval feedback" },
                  "reason": { "type": "string", "description": "Rejection reason" }
                },
                "required": ["action"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Milestone operation result",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ToolResponse" }
              }
            }
          }
        }
      }
    },
    "/mcp/tool/calculate_commerce_fees": {
      "post": {
        "summary": "Calculate platform fees for a given amount and payment type. Pure crypto: 0% (free). On-ramp: +0.1%. Off-ramp: +0.1%. Split commission: 0.3% (min 0.1 USDC).",
        "operationId": "calculateCommerceFees",
        "tags": ["Commerce"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "amount": { "type": "number", "description": "Amount in micro units (1 USDC = 1000000)" },
                  "paymentType": { "type": "string", "enum": ["CRYPTO_DIRECT", "ONRAMP", "OFFRAMP", "MIXED"], "description": "Payment type" }
                },
                "required": ["amount", "paymentType"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Fee calculation result",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ToolResponse" }
              }
            }
          }
        }
      }
    }
  }
}
