# 数据库配置说明

## 配置文件位置

项目中有两个数据库配置文件，用于不同的场景：

### 1. `backend/src/config/database.config.ts`
**用途**：NestJS 应用运行时连接数据库

**使用场景**：
- 后端服务启动时
- API 请求处理时
- 通过 `DatabaseConfig` 类注入到 NestJS 模块

**默认配置**：
```typescript
username: 'paymind'
password: 'paymind_password'
database: 'paymind_db'
```

### 2. `backend/src/config/data-source.ts`
**用途**：TypeORM CLI 和独立脚本连接数据库

**使用场景**：
- 运行数据库迁移：`npm run migration:run`
- 运行种子脚本：`npm run seed`
- 其他独立的数据库脚本

**默认配置**（已统一）：
```typescript
username: 'paymind'
password: 'paymind_password'
database: 'paymind_db'
```

## 统一配置

✅ **已统一两个配置文件的默认值**，确保：
- 相同的默认用户名：`paymind`
- 相同的默认密码：`paymind_password`
- 相同的默认数据库：`paymind_db`

## 环境变量配置

两个配置文件都支持通过环境变量覆盖默认值：

```bash
# 在 backend/.env 文件中设置
DB_HOST=localhost
DB_PORT=5432
DB_USERNAME=paymind
DB_PASSWORD=你的实际密码
DB_DATABASE=paymind_db
```

## 为什么需要两个配置？

1. **NestJS 应用运行时**：使用 `DatabaseConfig`，通过依赖注入管理连接
2. **CLI 工具和脚本**：使用 `AppDataSource`，直接初始化 DataSource 实例

这种设计是 TypeORM + NestJS 的标准做法。

## 常见问题

### Q: 为什么迁移脚本连接失败？
A: 确保 `data-source.ts` 中的配置与你的实际数据库配置一致，或设置正确的环境变量。

### Q: 为什么应用启动时连接失败？
A: 确保 `database.config.ts` 中的配置与你的实际数据库配置一致，或设置正确的环境变量。

### Q: 如何查看当前使用的配置？
A: 检查 `backend/.env` 文件，或查看两个配置文件中的默认值。

