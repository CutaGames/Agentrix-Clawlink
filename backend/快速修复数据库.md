# å¿«é€Ÿä¿®å¤æ•°æ®åº“é—®é¢˜

## é—®é¢˜
åç«¯æœåŠ¡æ— æ³•å¯åŠ¨ï¼Œå› ä¸º `agent_sessions` è¡¨çš„ `userId` åˆ—åŒ…å« NULL å€¼ï¼Œæ— æ³•è®¾ç½®ä¸º NOT NULLã€‚

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ³• 1ï¼šç›´æ¥æ‰§è¡Œ SQLï¼ˆæœ€å¿«ï¼‰

è¿æ¥åˆ° PostgreSQL æ•°æ®åº“ï¼Œæ‰§è¡Œä»¥ä¸‹ SQLï¼š

```sql
-- 1. åˆ é™¤æ‰€æœ‰ userId ä¸º NULL çš„è®°å½•
DELETE FROM agent_sessions WHERE "userId" IS NULL;

-- 2. åˆ é™¤å¤–é”®çº¦æŸï¼ˆå¦‚æœå­˜åœ¨ï¼‰
ALTER TABLE agent_sessions DROP CONSTRAINT IF EXISTS "FK_40a6b0600d60c067ae0f8659ce0";

-- 3. å°† userId è®¾ç½®ä¸º NOT NULL
ALTER TABLE agent_sessions ALTER COLUMN "userId" SET NOT NULL;
```

### æ–¹æ³• 2ï¼šä½¿ç”¨ psql å‘½ä»¤è¡Œ

```bash
# è¿æ¥åˆ°æ•°æ®åº“
psql -U paymind -d paymind_db

# æ‰§è¡Œä¿®å¤è„šæœ¬
\i backend/scripts/fix-db-quick.sql
```

### æ–¹æ³• 3ï¼šè¿è¡Œè¿ç§»

```bash
cd backend
npm run migration:run
```

## ä¿®å¤å

1. **é‡æ–°å¯åŠ¨åç«¯æœåŠ¡**ï¼š
   ```bash
   cd backend
   npm run start:dev
   ```

2. **éªŒè¯æœåŠ¡å¯åŠ¨**ï¼š
   - åº”è¯¥çœ‹åˆ°ï¼š`ğŸš€ PayMind Backend is running on: http://0.0.0.0:3001`
   - åº”è¯¥çœ‹åˆ°ï¼š`ğŸ“š API Documentation: http://0.0.0.0:3001/api/docs`

3. **è®¿é—® Swagger æ–‡æ¡£**ï¼š
   - æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:3001/api/docs

## æ³¨æ„äº‹é¡¹

- å·²ä¸´æ—¶ç¦ç”¨ `synchronize`ï¼Œæ”¹ä¸ºä½¿ç”¨è¿ç§»ç®¡ç†æ•°æ®åº“ç»“æ„
- å¦‚æœä»¥åéœ€è¦å¯ç”¨ `synchronize`ï¼Œç¡®ä¿æ•°æ®åº“ä¸­æ²¡æœ‰ NULL å€¼é—®é¢˜
- å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å§‹ç»ˆä½¿ç”¨è¿ç§»ï¼Œè€Œä¸æ˜¯ `synchronize`

