# ç»Ÿä¸€æ”¯ä»˜æœ¬åœ°æµè§ˆå™¨è°ƒè¯•æ’æŸ¥æ­¥éª¤

## ğŸš€ å¿«é€Ÿè¯Šæ–­å·¥å…·

åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œå¿«é€Ÿè¯Šæ–­ï¼š

```javascript
// å®Œæ•´è¯Šæ–­ï¼ˆæ¨èï¼‰
PaymentDebug.fullDiagnosis()

// å•ç‹¬æ£€æŸ¥
PaymentDebug.checkApiConfig()           // æ£€æŸ¥APIé…ç½®
PaymentDebug.checkAuth()                // æ£€æŸ¥è®¤è¯çŠ¶æ€
PaymentDebug.testBackendConnection()    // æµ‹è¯•åç«¯è¿æ¥
PaymentDebug.testPaymentRouting(100, 'CNY')  // æµ‹è¯•æ”¯ä»˜è·¯ç”±
PaymentDebug.checkPaymentContext()      // æ£€æŸ¥æ”¯ä»˜ä¸Šä¸‹æ–‡
```

## ğŸ“‹ æ’æŸ¥æµç¨‹æ€»è§ˆ

```
æ­¥éª¤1: ç¯å¢ƒæ£€æŸ¥
  â†“
æ­¥éª¤2: ç½‘ç»œè¿æ¥æ£€æŸ¥
  â†“
æ­¥éª¤3: APIé…ç½®æ£€æŸ¥
  â†“
æ­¥éª¤4: è®¤è¯æ£€æŸ¥
  â†“
æ­¥éª¤5: å‰ç«¯ä»£ç æ£€æŸ¥
  â†“
æ­¥éª¤6: åç«¯APIæ£€æŸ¥
  â†“
æ­¥éª¤7: æµè§ˆå™¨æ§åˆ¶å°æ£€æŸ¥
  â†“
æ­¥éª¤8: ç½‘ç»œè¯·æ±‚æ£€æŸ¥
```

---

## ğŸ” æ­¥éª¤1: ç¯å¢ƒæ£€æŸ¥

### 1.1 æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨

**æ£€æŸ¥æ–¹æ³•**ï¼š
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
cd backend
npm run start:dev

# æˆ–è€…æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -ano | findstr :3001  # Windows
lsof -i :3001                 # Mac/Linux
```

**é¢„æœŸç»“æœ**ï¼š
- åç«¯æœåŠ¡åº”è¯¥åœ¨ `http://localhost:3001` è¿è¡Œ
- æ§åˆ¶å°åº”è¯¥æ˜¾ç¤º "Nest application successfully started"

**å¦‚æœå¤±è´¥**ï¼š
- æ£€æŸ¥åç«¯ä¾èµ–æ˜¯å¦å®‰è£…ï¼š`cd backend && npm install`
- æ£€æŸ¥æ•°æ®åº“è¿æ¥é…ç½®
- æ£€æŸ¥ç¯å¢ƒå˜é‡æ–‡ä»¶ `.env`

### 1.2 æ£€æŸ¥å‰ç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨

**æ£€æŸ¥æ–¹æ³•**ï¼š
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
cd paymindfrontend
npm run dev

# æˆ–è€…æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -ano | findstr :3000  # Windows
lsof -i :3000                 # Mac/Linux
```

**é¢„æœŸç»“æœ**ï¼š
- å‰ç«¯æœåŠ¡åº”è¯¥åœ¨ `http://localhost:3000` è¿è¡Œ
- æµè§ˆå™¨å¯ä»¥è®¿é—®é¦–é¡µ

---

## ğŸŒ æ­¥éª¤2: ç½‘ç»œè¿æ¥æ£€æŸ¥

### 2.1 æ£€æŸ¥APIåŸºç¡€URLé…ç½®

**æ£€æŸ¥ä½ç½®**ï¼š
- æ–‡ä»¶ï¼š`paymindfrontend/lib/api/client.ts`
- å…³é”®ä»£ç ï¼š
```typescript
const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3001/api';
```

**æ£€æŸ¥æ–¹æ³•**ï¼š
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. åœ¨Consoleä¸­è¾“å…¥ï¼š
```javascript
// æ£€æŸ¥ç¯å¢ƒå˜é‡
console.log('API URL:', process.env.NEXT_PUBLIC_API_URL)

// æ£€æŸ¥å®é™…ä½¿ç”¨çš„URL
// éœ€è¦æŸ¥çœ‹ network è¯·æ±‚ä¸­çš„å®é™…URL
```

**é¢„æœŸç»“æœ**ï¼š
- API_BASE_URL åº”è¯¥æ˜¯ `http://localhost:3001/api`
- å¦‚æœä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œç¡®ä¿ `.env.local` æ–‡ä»¶å­˜åœ¨ä¸”é…ç½®æ­£ç¡®

**å¦‚æœå¤±è´¥**ï¼š
- åˆ›å»º/æ£€æŸ¥ `paymindfrontend/.env.local` æ–‡ä»¶ï¼š
```bash
NEXT_PUBLIC_API_URL=http://localhost:3001/api
```
- é‡å¯å‰ç«¯æœåŠ¡

### 2.2 æµ‹è¯•åç«¯APIè¿é€šæ€§

**æ£€æŸ¥æ–¹æ³•**ï¼š
åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è®¿é—®ï¼š
```
http://localhost:3001/api/health
```

æˆ–è€…ä½¿ç”¨curlï¼š
```bash
curl http://localhost:3001/api/health
```

**é¢„æœŸç»“æœ**ï¼š
- è¿”å›JSONå“åº”ï¼ŒåŒ…å«æœåŠ¡çŠ¶æ€ä¿¡æ¯

**å¦‚æœå¤±è´¥**ï¼š
- æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦çœŸçš„åœ¨è¿è¡Œ
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
- æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å…¶ä»–ç¨‹åºå ç”¨

---

## ğŸ” æ­¥éª¤3: è®¤è¯æ£€æŸ¥

### 3.1 æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€

**æ£€æŸ¥ä½ç½®**ï¼š
- æ–‡ä»¶ï¼š`paymindfrontend/contexts/UserContext.tsx`
- æµè§ˆå™¨æ§åˆ¶å°æ£€æŸ¥ï¼š
```javascript
// åœ¨æµè§ˆå™¨Consoleä¸­æ‰§è¡Œ
const token = localStorage.getItem('access_token')
console.log('Tokenå­˜åœ¨:', !!token)
console.log('Tokenå€¼:', token ? token.substring(0, 20) + '...' : 'null')
```

**é¢„æœŸç»“æœ**ï¼š
- å¦‚æœå·²ç™»å½•ï¼Œåº”è¯¥æœ‰token
- Tokenåº”è¯¥æ˜¯æœ‰æ•ˆçš„JWTæ ¼å¼

**å¦‚æœå¤±è´¥**ï¼š
- å…ˆç™»å½•ç³»ç»Ÿ
- æ£€æŸ¥ç™»å½•APIæ˜¯å¦æ­£å¸¸å·¥ä½œ
- æ£€æŸ¥tokenæ˜¯å¦è¿‡æœŸ

### 3.2 æ£€æŸ¥APIè¯·æ±‚ä¸­çš„è®¤è¯å¤´

**æ£€æŸ¥æ–¹æ³•**ï¼š
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. åˆ‡æ¢åˆ° Network æ ‡ç­¾
3. è§¦å‘ä¸€æ¬¡æ”¯ä»˜æ“ä½œ
4. æŸ¥çœ‹è¯·æ±‚å¤´ä¸­çš„ `Authorization` å­—æ®µ

**é¢„æœŸç»“æœ**ï¼š
```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**å¦‚æœå¤±è´¥**ï¼š
- æ£€æŸ¥ `paymindfrontend/lib/api/client.ts` ä¸­çš„tokenè®¾ç½®é€»è¾‘
- æ£€æŸ¥tokenæ˜¯å¦è¢«æ­£ç¡®ä¿å­˜åˆ°localStorage

---

## ğŸ’» æ­¥éª¤4: å‰ç«¯ä»£ç æ£€æŸ¥

### 4.1 æ£€æŸ¥PaymentContextæ˜¯å¦æ­£ç¡®åˆå§‹åŒ–

**æ£€æŸ¥ä½ç½®**ï¼š
- æ–‡ä»¶ï¼š`paymindfrontend/pages/_app.tsx`
- ç¡®ä¿ `PaymentProvider` åŒ…è£¹äº†åº”ç”¨

**æ£€æŸ¥æ–¹æ³•**ï¼š
æŸ¥çœ‹ `_app.tsx` æ–‡ä»¶ï¼Œç¡®è®¤ï¼š
```tsx
<PaymentProvider>
  <Component {...pageProps} />
</PaymentProvider>
```

### 4.2 æ£€æŸ¥æ”¯ä»˜é¡µé¢æ˜¯å¦æ­£ç¡®ä½¿ç”¨PaymentContext

**æ£€æŸ¥ä½ç½®**ï¼š
- æ–‡ä»¶ï¼š`paymindfrontend/pages/pay/unified.tsx`
- æˆ–å…¶ä»–æ”¯ä»˜ç›¸å…³é¡µé¢

**æ£€æŸ¥æ–¹æ³•**ï¼š
ç¡®è®¤é¡µé¢ä¸­ä½¿ç”¨äº†ï¼š
```tsx
const { startPayment, processPayment } = usePayment()
```

**å¦‚æœå¤±è´¥**ï¼š
- ç¡®ä¿åœ¨ `PaymentProvider` å†…éƒ¨ä½¿ç”¨ `usePayment()`
- æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯è¾¹ç•Œé˜»æ­¢äº†ç»„ä»¶æ¸²æŸ“

### 4.3 æ£€æŸ¥æ”¯ä»˜APIè°ƒç”¨

**æ£€æŸ¥ä½ç½®**ï¼š
- æ–‡ä»¶ï¼š`paymindfrontend/contexts/PaymentContext.tsx`
- æ–¹æ³•ï¼š`processPayment()`

**æ£€æŸ¥æ–¹æ³•**ï¼š
1. åœ¨ `processPayment` æ–¹æ³•ä¸­æ·»åŠ console.log
2. æ£€æŸ¥è°ƒç”¨çš„APIè·¯å¾„æ˜¯å¦æ­£ç¡®

**å…³é”®æ£€æŸ¥ç‚¹**ï¼š
```typescript
// æ£€æŸ¥APIè°ƒç”¨
const result = await paymentApi.process(paymentData)
```

---

## ğŸ”§ æ­¥éª¤5: åç«¯APIæ£€æŸ¥

### 5.1 æ£€æŸ¥æ”¯ä»˜APIè·¯ç”±æ˜¯å¦å­˜åœ¨

**æ£€æŸ¥ä½ç½®**ï¼š
- æ–‡ä»¶ï¼š`backend/src/modules/payment/payment.controller.ts`
- è·¯ç”±ï¼š`POST /payments/process`

**æ£€æŸ¥æ–¹æ³•**ï¼š
1. æŸ¥çœ‹åç«¯æ—¥å¿—ï¼Œç¡®è®¤è·¯ç”±å·²æ³¨å†Œ
2. ä½¿ç”¨Postmanæˆ–curlæµ‹è¯•ï¼š
```bash
curl -X POST http://localhost:3001/api/payments/process \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "amount": 100,
    "currency": "CNY",
    "paymentMethod": "stripe"
  }'
```

**é¢„æœŸç»“æœ**ï¼š
- è¿”å›æ”¯ä»˜å¤„ç†ç»“æœæˆ–é”™è¯¯ä¿¡æ¯

### 5.2 æ£€æŸ¥æ”¯ä»˜æœåŠ¡ä¾èµ–

**æ£€æŸ¥ä½ç½®**ï¼š
- æ–‡ä»¶ï¼š`backend/src/modules/payment/payment.service.ts`
- æ£€æŸ¥æ‰€æœ‰ä¾èµ–æœåŠ¡æ˜¯å¦æ­£å¸¸åˆå§‹åŒ–

**æ£€æŸ¥æ–¹æ³•**ï¼š
æŸ¥çœ‹åç«¯å¯åŠ¨æ—¥å¿—ï¼Œç¡®è®¤æ²¡æœ‰ä¾èµ–æ³¨å…¥é”™è¯¯

---

## ğŸ–¥ï¸ æ­¥éª¤6: æµè§ˆå™¨æ§åˆ¶å°æ£€æŸ¥

### 6.1 æ£€æŸ¥JavaScripté”™è¯¯

**æ£€æŸ¥æ–¹æ³•**ï¼š
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. åˆ‡æ¢åˆ° Console æ ‡ç­¾
3. æŸ¥çœ‹æ˜¯å¦æœ‰çº¢è‰²é”™è¯¯ä¿¡æ¯

**å¸¸è§é”™è¯¯**ï¼š
- `NetworkError`: æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨
- `401 Unauthorized`: è®¤è¯å¤±è´¥
- `CORS error`: è·¨åŸŸé—®é¢˜
- `TypeError`: ä»£ç é”™è¯¯

### 6.2 æ£€æŸ¥APIè¯·æ±‚æ—¥å¿—

**æ£€æŸ¥ä½ç½®**ï¼š
- æ–‡ä»¶ï¼š`paymindfrontend/lib/api/client.ts`
- ä»£ç ä¸­å·²æœ‰å¼€å‘ç¯å¢ƒæ—¥å¿—

**æ£€æŸ¥æ–¹æ³•**ï¼š
åœ¨Consoleä¸­æŸ¥çœ‹ï¼š
- ğŸ”µ APIè¯·æ±‚æ—¥å¿—
- ğŸŸ¢ APIå“åº”æ—¥å¿—
- ğŸ”´ APIé”™è¯¯æ—¥å¿—

---

## ğŸ“¡ æ­¥éª¤7: ç½‘ç»œè¯·æ±‚æ£€æŸ¥

### 7.1 æ£€æŸ¥Networkè¯·æ±‚è¯¦æƒ…

**æ£€æŸ¥æ–¹æ³•**ï¼š
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. åˆ‡æ¢åˆ° Network æ ‡ç­¾
3. è§¦å‘æ”¯ä»˜æ“ä½œ
4. æŸ¥çœ‹è¯·æ±‚è¯¦æƒ…

**å…³é”®æ£€æŸ¥ç‚¹**ï¼š

#### è¯·æ±‚URL
- æ˜¯å¦æ­£ç¡®ï¼š`http://localhost:3001/api/payments/process`
- å¦‚æœæ˜¾ç¤ºå…¶ä»–URLï¼Œæ£€æŸ¥API_BASE_URLé…ç½®

#### è¯·æ±‚æ–¹æ³•
- åº”è¯¥æ˜¯ `POST`

#### è¯·æ±‚å¤´
- `Content-Type: application/json`
- `Authorization: Bearer ...`ï¼ˆå¦‚æœå·²ç™»å½•ï¼‰

#### è¯·æ±‚ä½“
- æ£€æŸ¥å‘é€çš„æ•°æ®æ ¼å¼æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥å¿…éœ€å­—æ®µæ˜¯å¦å­˜åœ¨

#### å“åº”çŠ¶æ€
- `200 OK`: æˆåŠŸ
- `401 Unauthorized`: è®¤è¯å¤±è´¥
- `400 Bad Request`: è¯·æ±‚å‚æ•°é”™è¯¯
- `500 Internal Server Error`: æœåŠ¡å™¨é”™è¯¯
- `Network Error`: æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨

#### å“åº”å†…å®¹
- æŸ¥çœ‹å“åº”ä½“çš„JSONå†…å®¹
- æ£€æŸ¥é”™è¯¯ä¿¡æ¯

### 7.2 æ£€æŸ¥CORSé—®é¢˜

**ç—‡çŠ¶**ï¼š
- æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤ºCORSé”™è¯¯
- Networkè¯·æ±‚æ˜¾ç¤º `CORS policy` é”™è¯¯

**è§£å†³æ–¹æ³•**ï¼š
æ£€æŸ¥åç«¯CORSé…ç½®ï¼š
- æ–‡ä»¶ï¼š`backend/src/main.ts`
- ç¡®ä¿å…è®¸ `http://localhost:3000` çš„è¯·æ±‚

---

## ğŸ› æ­¥éª¤8: å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1: "æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨"

**å¯èƒ½åŸå› **ï¼š
1. åç«¯æœåŠ¡æœªå¯åŠ¨
2. ç«¯å£é…ç½®é”™è¯¯
3. é˜²ç«å¢™é˜»æ­¢

**è§£å†³æ–¹æ³•**ï¼š
1. ç¡®è®¤åç«¯æœåŠ¡åœ¨ `http://localhost:3001` è¿è¡Œ
2. æ£€æŸ¥ `NEXT_PUBLIC_API_URL` ç¯å¢ƒå˜é‡
3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### é—®é¢˜2: "401 Unauthorized"

**å¯èƒ½åŸå› **ï¼š
1. ç”¨æˆ·æœªç™»å½•
2. Tokenè¿‡æœŸ
3. Tokenæ ¼å¼é”™è¯¯

**è§£å†³æ–¹æ³•**ï¼š
1. å…ˆç™»å½•ç³»ç»Ÿ
2. æ£€æŸ¥tokenæ˜¯å¦æœ‰æ•ˆ
3. æ£€æŸ¥tokenæ˜¯å¦æ­£ç¡®æ·»åŠ åˆ°è¯·æ±‚å¤´

### é—®é¢˜3: "400 Bad Request"

**å¯èƒ½åŸå› **ï¼š
1. è¯·æ±‚å‚æ•°æ ¼å¼é”™è¯¯
2. ç¼ºå°‘å¿…éœ€å­—æ®µ
3. æ•°æ®ç±»å‹ä¸åŒ¹é…

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥è¯·æ±‚ä½“æ ¼å¼
2. æŸ¥çœ‹åç«¯é”™è¯¯ä¿¡æ¯
3. å¯¹æ¯”APIæ–‡æ¡£ç¡®è®¤å‚æ•°è¦æ±‚

### é—®é¢˜4: "500 Internal Server Error"

**å¯èƒ½åŸå› **ï¼š
1. åç«¯ä»£ç é”™è¯¯
2. æ•°æ®åº“è¿æ¥é—®é¢˜
3. ä¾èµ–æœåŠ¡æœªå¯åŠ¨

**è§£å†³æ–¹æ³•**ï¼š
1. æŸ¥çœ‹åç«¯æ—¥å¿—
2. æ£€æŸ¥æ•°æ®åº“è¿æ¥
3. æ£€æŸ¥æ‰€æœ‰ä¾èµ–æœåŠ¡

### é—®é¢˜5: æ”¯ä»˜æŒ‰é’®ç‚¹å‡»æ— ååº”

**å¯èƒ½åŸå› **ï¼š
1. JavaScripté”™è¯¯é˜»æ­¢æ‰§è¡Œ
2. äº‹ä»¶å¤„ç†å‡½æ•°æœªç»‘å®š
3. ç»„ä»¶æœªæ­£ç¡®æ¸²æŸ“

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
2. æ£€æŸ¥ç»„ä»¶æ˜¯å¦æ­£ç¡®æ¸²æŸ“
3. æ£€æŸ¥äº‹ä»¶å¤„ç†å‡½æ•°

---

## ğŸ”§ è°ƒè¯•å·¥å…·å’ŒæŠ€å·§

### 1. æµè§ˆå™¨å¼€å‘è€…å·¥å…·

**å¿«æ·é”®**ï¼š
- `F12`: æ‰“å¼€/å…³é—­å¼€å‘è€…å·¥å…·
- `Ctrl+Shift+I` (Windows) / `Cmd+Option+I` (Mac)

**å…³é”®æ ‡ç­¾**ï¼š
- **Console**: æŸ¥çœ‹æ—¥å¿—å’Œé”™è¯¯
- **Network**: æŸ¥çœ‹ç½‘ç»œè¯·æ±‚
- **Application**: æŸ¥çœ‹localStorageã€sessionStorage
- **Sources**: è°ƒè¯•ä»£ç 

### 2. æ·»åŠ è°ƒè¯•æ—¥å¿—

**åœ¨å‰ç«¯ä»£ç ä¸­æ·»åŠ **ï¼š
```typescript
console.log('ğŸ”µ æ”¯ä»˜è¯·æ±‚:', paymentData)
console.log('ğŸŸ¢ æ”¯ä»˜å“åº”:', result)
console.error('ğŸ”´ æ”¯ä»˜é”™è¯¯:', error)
```

**åœ¨åç«¯ä»£ç ä¸­æ·»åŠ **ï¼š
```typescript
this.logger.log('æ”¯ä»˜è¯·æ±‚:', dto)
this.logger.error('æ”¯ä»˜é”™è¯¯:', error)
```

### 3. ä½¿ç”¨Postmanæµ‹è¯•API

**åˆ›å»ºæµ‹è¯•è¯·æ±‚**ï¼š
1. æ–¹æ³•ï¼šPOST
2. URLï¼š`http://localhost:3001/api/payments/process`
3. Headersï¼š
   - `Content-Type: application/json`
   - `Authorization: Bearer YOUR_TOKEN`
4. Bodyï¼š
```json
{
  "amount": 100,
  "currency": "CNY",
  "paymentMethod": "stripe"
}
```

### 4. æ£€æŸ¥ç¯å¢ƒå˜é‡

**å‰ç«¯ç¯å¢ƒå˜é‡**ï¼š
- æ–‡ä»¶ï¼š`paymindfrontend/.env.local`
- å†…å®¹ï¼š
```bash
NEXT_PUBLIC_API_URL=http://localhost:3001/api
```

**åç«¯ç¯å¢ƒå˜é‡**ï¼š
- æ–‡ä»¶ï¼š`backend/.env`
- æ£€æŸ¥æ•°æ®åº“ã€Stripeç­‰é…ç½®

---

## ğŸ“ æ’æŸ¥æ¸…å•

ä½¿ç”¨ä»¥ä¸‹æ¸…å•é€æ­¥æ’æŸ¥ï¼š

- [ ] åç«¯æœåŠ¡å·²å¯åŠ¨ï¼ˆç«¯å£3001ï¼‰
- [ ] å‰ç«¯æœåŠ¡å·²å¯åŠ¨ï¼ˆç«¯å£3000ï¼‰
- [ ] API_BASE_URLé…ç½®æ­£ç¡®
- [ ] åç«¯APIå¥åº·æ£€æŸ¥é€šè¿‡
- [ ] ç”¨æˆ·å·²ç™»å½•ï¼ˆæœ‰æœ‰æ•ˆtokenï¼‰
- [ ] PaymentProviderå·²æ­£ç¡®åˆå§‹åŒ–
- [ ] æ”¯ä»˜é¡µé¢æ­£ç¡®ä½¿ç”¨usePayment
- [ ] æµè§ˆå™¨æ§åˆ¶å°æ— JavaScripté”™è¯¯
- [ ] Networkè¯·æ±‚æ˜¾ç¤ºæ­£ç¡®çš„URL
- [ ] Networkè¯·æ±‚åŒ…å«æ­£ç¡®çš„è®¤è¯å¤´
- [ ] Networkè¯·æ±‚ä½“æ ¼å¼æ­£ç¡®
- [ ] åç«¯APIè·¯ç”±å­˜åœ¨ä¸”å¯è®¿é—®
- [ ] åç«¯æ—¥å¿—æ˜¾ç¤ºè¯·æ±‚å·²æ¥æ”¶
- [ ] æ— CORSé”™è¯¯
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] æ‰€æœ‰ä¾èµ–æœåŠ¡æ­£å¸¸

---

## ğŸ¯ å¿«é€Ÿè¯Šæ–­å‘½ä»¤

åœ¨æµè§ˆå™¨Consoleä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œå¿«é€Ÿè¯Šæ–­ï¼š

```javascript
// 1. æ£€æŸ¥APIé…ç½®
console.log('API URL:', process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3001/api')

// 2. æ£€æŸ¥è®¤è¯token
const token = localStorage.getItem('access_token')
console.log('Tokenå­˜åœ¨:', !!token)
console.log('Tokené•¿åº¦:', token?.length || 0)

// 3. æµ‹è¯•APIè¿é€šæ€§
fetch('http://localhost:3001/api/health')
  .then(r => r.json())
  .then(data => console.log('âœ… åç«¯è¿æ¥æ­£å¸¸:', data))
  .catch(err => console.error('âŒ åç«¯è¿æ¥å¤±è´¥:', err))

// 4. æµ‹è¯•æ”¯ä»˜APIï¼ˆéœ€è¦å…ˆç™»å½•ï¼‰
fetch('http://localhost:3001/api/payments/routing?amount=100&currency=CNY', {
  headers: {
    'Authorization': `Bearer ${localStorage.getItem('access_token')}`
  }
})
  .then(r => r.json())
  .then(data => console.log('âœ… æ”¯ä»˜è·¯ç”±APIæ­£å¸¸:', data))
  .catch(err => console.error('âŒ æ”¯ä»˜è·¯ç”±APIå¤±è´¥:', err))
```

---

## ğŸ“ å¦‚æœä»¥ä¸Šæ­¥éª¤éƒ½æ— æ³•è§£å†³é—®é¢˜

1. **æ”¶é›†é”™è¯¯ä¿¡æ¯**ï¼š
   - æµè§ˆå™¨æ§åˆ¶å°çš„å®Œæ•´é”™è¯¯ä¿¡æ¯
   - Networkè¯·æ±‚çš„å®Œæ•´è¯¦æƒ…ï¼ˆåŒ…æ‹¬è¯·æ±‚å’Œå“åº”ï¼‰
   - åç«¯æ—¥å¿—çš„å®Œæ•´è¾“å‡º

2. **æ£€æŸ¥ä»£ç ç‰ˆæœ¬**ï¼š
   - ç¡®è®¤ä»£ç æ˜¯æœ€æ–°ç‰ˆæœ¬
   - æ£€æŸ¥æ˜¯å¦æœ‰æœªæäº¤çš„ä¿®æ”¹

3. **å°è¯•æœ€å°åŒ–å¤ç°**ï¼š
   - åˆ›å»ºä¸€ä¸ªæœ€ç®€å•çš„æ”¯ä»˜æµ‹è¯•é¡µé¢
   - é€æ­¥æ·»åŠ åŠŸèƒ½ï¼Œå®šä½é—®é¢˜

4. **æ£€æŸ¥ä¾èµ–ç‰ˆæœ¬**ï¼š
   - ç¡®è®¤æ‰€æœ‰npmåŒ…ç‰ˆæœ¬å…¼å®¹
   - æ£€æŸ¥æ˜¯å¦æœ‰ç‰ˆæœ¬å†²çª

---

## ğŸ“š ç›¸å…³æ–‡ä»¶æ¸…å•

### å‰ç«¯å…³é”®æ–‡ä»¶
- `paymindfrontend/lib/api/client.ts` - APIå®¢æˆ·ç«¯
- `paymindfrontend/lib/api/payment.api.ts` - æ”¯ä»˜API
- `paymindfrontend/contexts/PaymentContext.tsx` - æ”¯ä»˜ä¸Šä¸‹æ–‡
- `paymindfrontend/pages/_app.tsx` - åº”ç”¨å…¥å£
- `paymindfrontend/pages/pay/unified.tsx` - ç»Ÿä¸€æ”¯ä»˜é¡µé¢

### åç«¯å…³é”®æ–‡ä»¶
- `backend/src/modules/payment/payment.controller.ts` - æ”¯ä»˜æ§åˆ¶å™¨
- `backend/src/modules/payment/payment.service.ts` - æ”¯ä»˜æœåŠ¡
- `backend/src/main.ts` - åº”ç”¨å…¥å£ï¼ˆCORSé…ç½®ï¼‰

### é…ç½®æ–‡ä»¶
- `paymindfrontend/.env.local` - å‰ç«¯ç¯å¢ƒå˜é‡
- `backend/.env` - åç«¯ç¯å¢ƒå˜é‡

