# PayMind æ™ºèƒ½è·¯ç”±æµç¨‹ä¼˜åŒ– V5.0
## ç”¨æˆ·å‹å¥½çš„å¿«é€Ÿé€šé“ä¸å¼•å¯¼æµç¨‹è®¾è®¡

**ç‰ˆæœ¬**: 5.0  
**æ—¥æœŸ**: 2025å¹´1æœˆ  
**è®¾è®¡ç†å¿µ**: ç”¨æˆ·ä¼˜å…ˆã€æµç¨‹ç®€åŒ–ã€æ™ºèƒ½å¼•å¯¼ã€å¿«é€Ÿé€šé“ä¼˜å…ˆ

---

## ğŸ“‹ ç›®å½•

1. [æ™ºèƒ½è·¯ç”±æµç¨‹æ€»è§ˆ](#1-æ™ºèƒ½è·¯ç”±æµç¨‹æ€»è§ˆ)
2. [ç”¨æˆ·çŠ¶æ€æ£€æŸ¥æµç¨‹](#2-ç”¨æˆ·çŠ¶æ€æ£€æŸ¥æµç¨‹)
3. [QuickPayå¿«é€Ÿé€šé“æ£€æŸ¥](#3-quickpayå¿«é€Ÿé€šé“æ£€æŸ¥)
4. [KYCå¼•å¯¼æµç¨‹](#4-kycå¼•å¯¼æµç¨‹)
5. [æ”¯ä»˜æ–¹å¼æ¨èé€»è¾‘](#5-æ”¯ä»˜æ–¹å¼æ¨èé€»è¾‘)
6. [ç”¨æˆ·äº¤äº’æµç¨‹ä¼˜åŒ–](#6-ç”¨æˆ·äº¤äº’æµç¨‹ä¼˜åŒ–)
7. [æ ¸å¿ƒè®¾è®¡ä¿ç•™](#7-æ ¸å¿ƒè®¾è®¡ä¿ç•™)
8. [å®ç°æ–¹æ¡ˆ](#8-å®ç°æ–¹æ¡ˆ)

---

## 1. æ™ºèƒ½è·¯ç”±æµç¨‹æ€»è§ˆ

### 1.1 å®Œæ•´æµç¨‹ï¼ˆä¼˜åŒ–åï¼‰

```
ç”¨æˆ·å‘èµ·æ”¯ä»˜
    â†“
[é˜¶æ®µ0: ç”¨æˆ·çŠ¶æ€æ£€æŸ¥]
  â”œâ”€â†’ æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€
  â”œâ”€â†’ è·å–PayMind ID
  â”œâ”€â†’ æ£€æŸ¥QuickPayæˆæƒçŠ¶æ€
  â”œâ”€â†’ æ£€æŸ¥KYCçŠ¶æ€
  â”œâ”€â†’ æ£€æŸ¥Agentè®¾ç½®
  â””â”€â†’ æ£€æŸ¥é’±åŒ…è¿æ¥çŠ¶æ€
    â†“
[é˜¶æ®µ1: å¿«é€Ÿé€šé“åˆ¤æ–­]
  â”œâ”€â†’ æ£€æŸ¥æ˜¯å¦æ»¡è¶³QuickPayæ¡ä»¶
  â”‚   â”œâ”€â†’ å·²æˆæƒ âœ“
  â”‚   â”œâ”€â†’ é‡‘é¢åœ¨é™é¢å†… âœ“
  â”‚   â”œâ”€â†’ é€šé“å¯ç”¨ âœ“
  â”‚   â””â”€â†’ ç›´æ¥è¿›å…¥QuickPayæµç¨‹
    â†“
[é˜¶æ®µ2: æ™ºèƒ½è·¯ç”±åˆ†æ]
  â”œâ”€â†’ è·å–å•†æˆ·ä»·æ ¼è®¾ç½®
  â”œâ”€â†’ è·å–å¯ç”¨é€šé“åˆ—è¡¨
  â”œâ”€â†’ è®¡ç®—å„é€šé“ä»·æ ¼
  â”œâ”€â†’ è¯„ä¼°é€šé“æˆåŠŸç‡
  â””â”€â†’ ç”Ÿæˆæ¨èåˆ—è¡¨
    â†“
[é˜¶æ®µ3: ç”¨æˆ·å¼•å¯¼]
  â”œâ”€â†’ æœªæˆæƒQuickPay â†’ å¼•å¯¼æˆæƒ
  â”œâ”€â†’ æœªå®ŒæˆKYC â†’ å¼•å¯¼KYC
  â”œâ”€â†’ æœªè¿æ¥é’±åŒ… â†’ å¼•å¯¼è¿æ¥
  â””â”€â†’ æ˜¾ç¤ºæ¨èæ”¯ä»˜æ–¹å¼
    â†“
[é˜¶æ®µ4: æ”¯ä»˜æ‰§è¡Œ]
  â””â”€â†’ æ‰§è¡Œæ”¯ä»˜æµç¨‹
```

### 1.2 æ ¸å¿ƒä¼˜åŒ–ç‚¹

1. **ç”¨æˆ·çŠ¶æ€ä¼˜å…ˆæ£€æŸ¥**ï¼šåœ¨è·¯ç”±åˆ†æå‰å…ˆæ£€æŸ¥ç”¨æˆ·çŠ¶æ€
2. **å¿«é€Ÿé€šé“ä¼˜å…ˆ**ï¼šæ»¡è¶³æ¡ä»¶ç›´æ¥èµ°QuickPayï¼Œæ— éœ€é€‰æ‹©
3. **æ™ºèƒ½å¼•å¯¼**ï¼šæ ¹æ®ç”¨æˆ·çŠ¶æ€æ™ºèƒ½å¼•å¯¼ï¼Œè€Œéå¼ºåˆ¶è¦æ±‚
4. **æµç¨‹ç®€åŒ–**ï¼šå‡å°‘ç”¨æˆ·å†³ç­–ç‚¹ï¼Œè‡ªåŠ¨é€‰æ‹©æœ€ä¼˜æ–¹æ¡ˆ

---

## 2. ç”¨æˆ·çŠ¶æ€æ£€æŸ¥æµç¨‹

### 2.1 æ£€æŸ¥é¡¹æ¸…å•

#### 2.1.1 å¿…æ£€é¡¹

| æ£€æŸ¥é¡¹ | æ£€æŸ¥å†…å®¹ | å½±å“ |
|-------|---------|------|
| **ç”¨æˆ·ç™»å½•çŠ¶æ€** | æ˜¯å¦å·²ç™»å½• | æœªç™»å½•éœ€è¦å…ˆç™»å½• |
| **PayMind ID** | æ˜¯å¦å·²åˆ›å»ºPayMind ID | æœªåˆ›å»ºéœ€è¦åˆ›å»º |
| **QuickPayæˆæƒ** | æ˜¯å¦å·²æˆæƒQuickPay | å½±å“å¿«é€Ÿé€šé“å¯ç”¨æ€§ |
| **KYCçŠ¶æ€** | KYCå®ŒæˆçŠ¶æ€ | å½±å“æ³•å¸è½¬æ•°å­—è´§å¸é€šé“ |
| **é’±åŒ…è¿æ¥** | æ˜¯å¦å·²è¿æ¥é’±åŒ… | å½±å“æ•°å­—è´§å¸æ”¯ä»˜ |

#### 2.1.2 å¯é€‰æ£€æŸ¥é¡¹

| æ£€æŸ¥é¡¹ | æ£€æŸ¥å†…å®¹ | å½±å“ |
|-------|---------|------|
| **Agentè®¾ç½®** | æ˜¯å¦è®¾ç½®äº†é»˜è®¤Agent | å½±å“Agentä»£ä»˜ |
| **æ”¯ä»˜åå¥½** | å†å²æ”¯ä»˜åå¥½ | å½±å“æ¨èä¼˜å…ˆçº§ |
| **é£é™©ç­‰çº§** | ç”¨æˆ·é£é™©ç­‰çº§ | å½±å“é€šé“é€‰æ‹© |

### 2.2 ç”¨æˆ·çŠ¶æ€æ£€æŸ¥æœåŠ¡

```typescript
@Injectable()
export class UserStatusService {
  /**
   * æ£€æŸ¥ç”¨æˆ·çŠ¶æ€ï¼ˆæ”¯ä»˜å‰ï¼‰
   */
  async checkUserStatus(
    userId: string,
    paymentAmount: number,
    currency: string,
  ): Promise<UserStatus> {
    // 1. æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€
    const user = await this.userRepository.findOne({
      where: { id: userId },
    });
    
    if (!user) {
      return {
        isLoggedIn: false,
        needsLogin: true,
      };
    }
    
    // 2. æ£€æŸ¥PayMind ID
    const paymindId = user.paymindId;
    if (!paymindId) {
      return {
        isLoggedIn: true,
        hasPayMindId: false,
        needsPayMindId: true,
      };
    }
    
    // 3. æ£€æŸ¥QuickPayæˆæƒ
    const quickPayGrants = await this.quickPayGrantRepository.find({
      where: { userId, status: 'active' },
    });
    const hasQuickPayAuth = quickPayGrants.length > 0;
    const quickPayLimit = this.calculateQuickPayLimit(quickPayGrants);
    
    // 4. æ£€æŸ¥KYCçŠ¶æ€
    const kycStatus = user.kycStatus || 'not_started';
    const kycLevel = user.kycLevel || 0;
    
    // 5. æ£€æŸ¥é’±åŒ…è¿æ¥
    const walletConnections = await this.walletConnectionRepository.find({
      where: { userId, isActive: true },
    });
    const hasWallet = walletConnections.length > 0;
    
    // 6. æ£€æŸ¥Agentè®¾ç½®
    const agentSettings = await this.agentSettingRepository.findOne({
      where: { userId },
    });
    const hasAgentSettings = !!agentSettings;
    
    return {
      isLoggedIn: true,
      hasPayMindId: true,
      paymindId,
      quickPay: {
        authorized: hasQuickPayAuth,
        limit: quickPayLimit,
        canUse: hasQuickPayAuth && paymentAmount <= quickPayLimit.singleLimit,
      },
      kyc: {
        status: kycStatus,
        level: kycLevel,
        needsKYC: kycStatus !== 'verified' && this.needsKYCForPayment(currency),
      },
      wallet: {
        connected: hasWallet,
        connections: walletConnections,
      },
      agent: {
        configured: hasAgentSettings,
        settings: agentSettings,
      },
    };
  }
  
  /**
   * åˆ¤æ–­æ˜¯å¦éœ€è¦KYC
   */
  private needsKYCForPayment(currency: string): boolean {
    // æ³•å¸è½¬æ•°å­—è´§å¸éœ€è¦KYC
    const fiatCurrencies = ['USD', 'EUR', 'GBP', 'CNY', 'JPY'];
    return fiatCurrencies.includes(currency);
  }
}
```

---

## 3. QuickPayå¿«é€Ÿé€šé“æ£€æŸ¥

### 3.1 QuickPayæ¡ä»¶æ£€æŸ¥

#### 3.1.1 æ£€æŸ¥æ¡ä»¶

**å¿…è¦æ¡ä»¶**ï¼š
1. âœ… ç”¨æˆ·å·²ç™»å½•
2. âœ… å·²åˆ›å»ºPayMind ID
3. âœ… å·²æˆæƒQuickPay
4. âœ… æ”¯ä»˜é‡‘é¢ â‰¤ å•ç¬”é™é¢
5. âœ… ä»Šæ—¥ç´¯è®¡é‡‘é¢ â‰¤ æ¯æ—¥é™é¢
6. âœ… é€šé“å¯ç”¨ï¼ˆX402æˆ–Agent Payï¼‰

**å¯é€‰æ¡ä»¶**ï¼š
- å•†æˆ·æ”¯æŒQuickPay
- è®¢å•ç±»å‹æ”¯æŒQuickPay
- ç”¨æˆ·é£é™©ç­‰çº§ç¬¦åˆè¦æ±‚

#### 3.1.2 QuickPayæ£€æŸ¥é€»è¾‘

```typescript
@Injectable()
export class QuickPayService {
  /**
   * æ£€æŸ¥æ˜¯å¦å¯ä»¥ä½¿ç”¨QuickPay
   */
  async canUseQuickPay(
    userId: string,
    paymentAmount: number,
    currency: string,
    merchantId: string,
  ): Promise<QuickPayCheckResult> {
    // 1. æ£€æŸ¥ç”¨æˆ·çŠ¶æ€
    const userStatus = await this.userStatusService.checkUserStatus(
      userId,
      paymentAmount,
      currency,
    );
    
    if (!userStatus.isLoggedIn || !userStatus.hasPayMindId) {
      return {
        canUse: false,
        reason: 'user_not_logged_in',
        needsLogin: true,
      };
    }
    
    // 2. æ£€æŸ¥QuickPayæˆæƒ
    if (!userStatus.quickPay.authorized) {
      return {
        canUse: false,
        reason: 'quickpay_not_authorized',
        needsAuthorization: true,
        canAuthorize: true,
      };
    }
    
    // 3. æ£€æŸ¥é‡‘é¢é™åˆ¶
    const limit = userStatus.quickPay.limit;
    if (paymentAmount > limit.singleLimit) {
      return {
        canUse: false,
        reason: 'amount_exceeds_limit',
        singleLimit: limit.singleLimit,
        currentAmount: paymentAmount,
        needsIncreaseLimit: true,
      };
    }
    
    // 4. æ£€æŸ¥æ¯æ—¥é™é¢
    const todayUsage = await this.getTodayUsage(userId);
    if (todayUsage + paymentAmount > limit.dailyLimit) {
      return {
        canUse: false,
        reason: 'daily_limit_exceeded',
        dailyLimit: limit.dailyLimit,
        todayUsage,
        remainingLimit: limit.dailyLimit - todayUsage,
      };
    }
    
    // 5. æ£€æŸ¥é€šé“å¯ç”¨æ€§
    const channelAvailable = await this.checkChannelAvailability(
      currency,
      merchantId,
    );
    
    if (!channelAvailable) {
      return {
        canUse: false,
        reason: 'channel_not_available',
      };
    }
    
    // 6. æ‰€æœ‰æ¡ä»¶æ»¡è¶³
    return {
      canUse: true,
      recommendedChannel: 'x402', // æˆ– 'agent_pay'
      estimatedTime: '1-3ç§’',
    };
  }
}
```

### 3.2 QuickPayæˆæƒå¼•å¯¼

#### 3.2.1 å¼•å¯¼æ—¶æœº

**è§¦å‘æ¡ä»¶**ï¼š
- ç”¨æˆ·æœªæˆæƒQuickPay
- æ”¯ä»˜é‡‘é¢åœ¨QuickPayæ¨èèŒƒå›´å†…ï¼ˆ< $100ï¼‰
- ç”¨æˆ·æœ‰å†å²æ”¯ä»˜è®°å½•ï¼ˆä¿¡ä»»åº¦è¾ƒé«˜ï¼‰

**å¼•å¯¼ç­–ç•¥**ï¼š
- **é¦–æ¬¡æ”¯ä»˜**ï¼šæ˜¾ç¤ºå¼•å¯¼å¼¹çª—ï¼Œè¯´æ˜QuickPayä¼˜åŠ¿
- **å°é¢æ”¯ä»˜**ï¼šè‡ªåŠ¨æ¨èQuickPayï¼Œå¼•å¯¼æˆæƒ
- **å¤§é¢æ”¯ä»˜**ï¼šä¸å¼ºåˆ¶å¼•å¯¼ï¼Œæä¾›é€‰é¡¹

#### 3.2.2 å¼•å¯¼ç•Œé¢è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš¡ å¯ç”¨QuickPayå¿«é€Ÿæ”¯ä»˜                                  â”‚
â”‚                                                           â”‚
â”‚  QuickPayå¯ä»¥è®©æ‚¨ï¼š                                      â”‚
â”‚  â€¢ ä¸€é”®å®Œæˆæ”¯ä»˜ï¼Œæ— éœ€é‡å¤è¾“å…¥                             â”‚
â”‚  â€¢ è‡ªåŠ¨ä½¿ç”¨æœ€ä¼˜æ”¯ä»˜æ–¹å¼ï¼ˆX402ã€Agentä»£ä»˜ï¼‰                â”‚
â”‚  â€¢ æ”¯ä»˜é€Ÿåº¦æå‡10å€ï¼ˆ1-3ç§’å®Œæˆï¼‰                         â”‚
â”‚  â€¢ æ”¯æŒå°é¢å…å¯†æ”¯ä»˜                                       â”‚
â”‚                                                           â”‚
â”‚  æˆæƒè®¾ç½®ï¼š                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ’° å•ç¬”é™é¢ï¼š[$100.00] [USD â–¼]                  â”‚   â”‚
â”‚  â”‚  ğŸ“… æ¯æ—¥é™é¢ï¼š[$1,000.00] [USD â–¼]                â”‚   â”‚
â”‚  â”‚  â° æœ‰æ•ˆæœŸï¼š30å¤©                                  â”‚   â”‚
â”‚  â”‚                                                   â”‚   â”‚
â”‚  â”‚  ğŸ’¡ æ‚¨å¯ä»¥åœ¨è®¾ç½®ä¸­éšæ—¶è°ƒæ•´è¿™äº›é™é¢                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                           â”‚
â”‚  [ç¨åå†è¯´]                          [åŒæ„å¹¶å¯ç”¨]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. KYCå¼•å¯¼æµç¨‹

### 4.1 KYCæ£€æŸ¥é€»è¾‘

#### 4.1.1 ä½•æ—¶éœ€è¦KYC

**å¿…é¡»KYCçš„åœºæ™¯**ï¼š
- ä½¿ç”¨æ³•å¸è½¬æ•°å­—è´§å¸é€šé“ï¼ˆMoonPayã€Alchemy Payç­‰ï¼‰
- å¤§é¢æ”¯ä»˜ï¼ˆ> $10,000ï¼‰
- è·¨å¢ƒæ”¯ä»˜ï¼ˆæŸäº›å›½å®¶è¦æ±‚ï¼‰

**å¯é€‰KYCçš„åœºæ™¯**ï¼š
- ä½¿ç”¨Stripeæ”¯ä»˜ï¼ˆæ— éœ€KYCï¼Œä½†ä»·æ ¼è¾ƒé«˜ï¼‰
- å°é¢æ•°å­—è´§å¸æ”¯ä»˜ï¼ˆæ— éœ€KYCï¼‰

#### 4.1.2 KYCå¼•å¯¼ç­–ç•¥

**ç­–ç•¥1ï¼šä»·æ ¼ä¼˜åŠ¿å¼•å¯¼**
- æ˜¾ç¤ºä¸¤ç§ä»·æ ¼å¯¹æ¯”ï¼š
  - æ³•å¸è½¬æ•°å­—è´§å¸ï¼ˆéœ€è¦KYCï¼‰ï¼š$1,000.00
  - Stripeæ”¯ä»˜ï¼ˆæ— éœ€KYCï¼‰ï¼š$1,029.00
- å¼•å¯¼ç”¨æˆ·å®ŒæˆKYCä»¥èŠ‚çœ$29

**ç­–ç•¥2ï¼šæ¸è¿›å¼å¼•å¯¼**
- é¦–æ¬¡æ”¯ä»˜ï¼šæç¤ºKYCä¼˜åŠ¿ï¼Œä½†ä¸å¼ºåˆ¶
- å¤šæ¬¡æ”¯ä»˜åï¼šæ¨èå®ŒæˆKYCä»¥èŠ‚çœæˆæœ¬
- å¤§é¢æ”¯ä»˜ï¼šå¿…é¡»å®ŒæˆKYC

### 4.2 KYCå¼•å¯¼ç•Œé¢è®¾è®¡

#### 4.2.1 ä»·æ ¼å¯¹æ¯”å¼•å¯¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’° å®ŒæˆKYCå¯èŠ‚çœ $29                                    â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  æ”¯ä»˜æ–¹å¼å¯¹æ¯”                                     â”‚   â”‚
â”‚  â”‚                                                   â”‚   â”‚
â”‚  â”‚  âš¡ æ³•å¸è½¬æ•°å­—è´§å¸ï¼ˆæ¨èï¼‰                        â”‚   â”‚
â”‚  â”‚  ğŸ’µ æ”¯ä»˜é‡‘é¢ï¼š$1,000.00                          â”‚   â”‚
â”‚  â”‚  â±ï¸ å¤„ç†æ—¶é—´ï¼š1-3ç§’                               â”‚   â”‚
â”‚  â”‚  âœ… éœ€è¦å®ŒæˆKYCï¼ˆçº¦2åˆ†é’Ÿï¼‰                        â”‚   â”‚
â”‚  â”‚                                                   â”‚   â”‚
â”‚  â”‚  ğŸ’³ Stripeæ”¯ä»˜                                    â”‚   â”‚
â”‚  â”‚  ğŸ’µ æ”¯ä»˜é‡‘é¢ï¼š$1,029.00                          â”‚   â”‚
â”‚  â”‚  â±ï¸ å¤„ç†æ—¶é—´ï¼š2-5ç§’                               â”‚   â”‚
â”‚  â”‚  âŒ æ— éœ€KYC                                       â”‚   â”‚
â”‚  â”‚                                                   â”‚   â”‚
â”‚  â”‚  ğŸ’¡ å®ŒæˆKYCåï¼Œæ¯æ¬¡æ”¯ä»˜å¯èŠ‚çœçº¦2.9%çš„è´¹ç”¨        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                           â”‚
â”‚  [ä½¿ç”¨Stripeæ”¯ä»˜]              [å®ŒæˆKYCå¹¶æ”¯ä»˜]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.2.2 KYCæµç¨‹å¼•å¯¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“‹ å®ŒæˆKYCéªŒè¯ï¼ˆçº¦2åˆ†é’Ÿï¼‰                               â”‚
â”‚                                                           â”‚
â”‚  æ­¥éª¤1/3ï¼šèº«ä»½éªŒè¯                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ“¸ ä¸Šä¼ èº«ä»½è¯                                      â”‚   â”‚
â”‚  â”‚                                                   â”‚   â”‚
â”‚  â”‚  [ç‚¹å‡»ä¸Šä¼ ]                                        â”‚   â”‚
â”‚  â”‚                                                   â”‚   â”‚
â”‚  â”‚  ğŸ’¡ æ”¯æŒJPGã€PNGæ ¼å¼ï¼Œå¤§å°ä¸è¶…è¿‡5MB               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                           â”‚
â”‚  [ä¸Šä¸€æ­¥]                                    [ä¸‹ä¸€æ­¥ â†’]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. æ”¯ä»˜æ–¹å¼æ¨èé€»è¾‘

### 5.1 æ¨èä¼˜å…ˆçº§

#### 5.1.1 ä¼˜å…ˆçº§è§„åˆ™

**ä¼˜å…ˆçº§1ï¼šQuickPayï¼ˆå¦‚æœå¯ç”¨ï¼‰**
- æ¡ä»¶ï¼šå·²æˆæƒ + é‡‘é¢åœ¨é™é¢å†… + é€šé“å¯ç”¨
- ä¼˜åŠ¿ï¼šé€Ÿåº¦æœ€å¿«ã€ä½“éªŒæœ€å¥½
- æ¨èç†ç”±ï¼š"âš¡ æœ€å¿«æ”¯ä»˜æ–¹å¼ï¼Œ1-3ç§’å®Œæˆ"

**ä¼˜å…ˆçº§2ï¼šæ•°å­—è´§å¸ç›´æ¥æ”¯ä»˜**
- æ¡ä»¶ï¼šå•†æˆ·æ¥å—æ•°å­—è´§å¸ + ç”¨æˆ·å·²è¿æ¥é’±åŒ…
- ä¼˜åŠ¿ï¼šæˆæœ¬æœ€ä½ã€é€Ÿåº¦è¾ƒå¿«
- æ¨èç†ç”±ï¼š"ğŸ’° ä»·æ ¼æœ€ä½ï¼Œé€Ÿåº¦è¾ƒå¿«"

**ä¼˜å…ˆçº§3ï¼šæ³•å¸è½¬æ•°å­—è´§å¸**
- æ¡ä»¶ï¼šå•†æˆ·æ¥å—æ•°å­—è´§å¸ + ç”¨æˆ·å·²å®ŒæˆKYC
- ä¼˜åŠ¿ï¼šä»·æ ¼è¾ƒä½ã€æ”¯æŒæ³•å¸
- æ¨èç†ç”±ï¼š"ğŸ’µ ä»·æ ¼è¾ƒä½ï¼Œæ”¯æŒæ³•å¸æ”¯ä»˜"

**ä¼˜å…ˆçº§4ï¼šStripeæ”¯ä»˜**
- æ¡ä»¶ï¼šå•†æˆ·æ¥å—æ³•å¸
- ä¼˜åŠ¿ï¼šæ— éœ€KYCã€æ”¯æŒå¤šç§æ”¯ä»˜æ–¹å¼
- æ¨èç†ç”±ï¼š"ğŸ’³ æ— éœ€KYCï¼Œæ”¯æŒä¿¡ç”¨å¡/Apple Pay"

### 5.2 æ¨èç®—æ³•

```typescript
@Injectable()
export class PaymentRecommendationService {
  /**
   * ç”Ÿæˆæ”¯ä»˜æ–¹å¼æ¨è
   */
  async generateRecommendations(
    userId: string,
    productId: string,
    countryCode: string,
    currency: string,
    amount: number,
  ): Promise<PaymentRecommendation[]> {
    // 1. æ£€æŸ¥ç”¨æˆ·çŠ¶æ€
    const userStatus = await this.userStatusService.checkUserStatus(
      userId,
      amount,
      currency,
    );
    
    // 2. æ£€æŸ¥QuickPay
    const quickPayCheck = await this.quickPayService.canUseQuickPay(
      userId,
      amount,
      currency,
      productId,
    );
    
    if (quickPayCheck.canUse) {
      return [{
        method: 'quickpay',
        priority: 1,
        price: amount,
        estimatedTime: '1-3ç§’',
        reason: 'âš¡ æœ€å¿«æ”¯ä»˜æ–¹å¼ï¼Œ1-3ç§’å®Œæˆ',
        recommended: true,
      }];
    }
    
    // 3. è·å–å•†æˆ·ä»·æ ¼è®¾ç½®
    const pricing = await this.pricingService.getProductPrice(
      productId,
      countryCode,
    );
    
    // 4. è·å–å¯ç”¨é€šé“
    const availableChannels = await this.smartRouter.getAvailableChannels(
      countryCode,
      currency,
      userStatus,
    );
    
    // 5. ç”Ÿæˆæ¨èåˆ—è¡¨
    const recommendations: PaymentRecommendation[] = [];
    
    // æ•°å­—è´§å¸ç›´æ¥æ”¯ä»˜
    if (availableChannels.includes('x402') && userStatus.wallet.connected) {
      recommendations.push({
        method: 'x402',
        priority: 2,
        price: pricing.cryptoPrice,
        estimatedTime: '1-3ç§’',
        reason: 'ğŸ’° ä»·æ ¼æœ€ä½ï¼Œé€Ÿåº¦è¾ƒå¿«',
        recommended: !quickPayCheck.canUse,
      });
    }
    
    // æ³•å¸è½¬æ•°å­—è´§å¸
    if (availableChannels.includes('fiat_to_crypto')) {
      if (userStatus.kyc.status === 'verified') {
        recommendations.push({
          method: 'fiat_to_crypto',
          priority: 3,
          price: pricing.fiatToCryptoPrice,
          estimatedTime: '2-5ç§’',
          reason: 'ğŸ’µ ä»·æ ¼è¾ƒä½ï¼Œæ”¯æŒæ³•å¸æ”¯ä»˜',
          recommended: false,
        });
      } else {
        recommendations.push({
          method: 'fiat_to_crypto',
          priority: 3,
          price: pricing.fiatToCryptoPrice,
          estimatedTime: '2-5ç§’',
          reason: 'ğŸ’µ ä»·æ ¼è¾ƒä½ï¼Œå®ŒæˆKYCå¯èŠ‚çœè´¹ç”¨',
          needsKYC: true,
          recommended: false,
        });
      }
    }
    
    // Stripeæ”¯ä»˜
    if (availableChannels.includes('stripe')) {
      recommendations.push({
        method: 'stripe',
        priority: 4,
        price: pricing.stripePrice,
        estimatedTime: '2-5ç§’',
        reason: 'ğŸ’³ æ— éœ€KYCï¼Œæ”¯æŒä¿¡ç”¨å¡/Apple Pay',
        recommended: false,
      });
    }
    
    // 6. æŒ‰ä¼˜å…ˆçº§æ’åº
    recommendations.sort((a, b) => a.priority - b.priority);
    
    return recommendations;
  }
}
```

---

## 6. ç”¨æˆ·äº¤äº’æµç¨‹ä¼˜åŒ–

### 6.1 ç®€åŒ–æµç¨‹è®¾è®¡

#### 6.1.1 ç†æƒ³æµç¨‹ï¼ˆæœ€å°‘æ­¥éª¤ï¼‰

**åœºæ™¯Aï¼šå·²æˆæƒQuickPay**
```
ç”¨æˆ·ç‚¹å‡»æ”¯ä»˜
  â†“
æ˜¾ç¤ºè®¢å•ä¿¡æ¯ï¼ˆ1ç§’ï¼‰
  â†“
è‡ªåŠ¨ä½¿ç”¨QuickPayæ”¯ä»˜ï¼ˆ1-3ç§’ï¼‰
  â†“
æ”¯ä»˜å®Œæˆ
```

**æ€»æ­¥éª¤**ï¼š2æ­¥ï¼ˆæ˜¾ç¤ºè®¢å• â†’ æ”¯ä»˜å®Œæˆï¼‰

**åœºæ™¯Bï¼šæœªæˆæƒQuickPayï¼Œä½†æ»¡è¶³æ¡ä»¶**
```
ç”¨æˆ·ç‚¹å‡»æ”¯ä»˜
  â†“
æ˜¾ç¤ºè®¢å•ä¿¡æ¯ + QuickPayå¼•å¯¼ï¼ˆ2ç§’ï¼‰
  â†“
ç”¨æˆ·ç‚¹å‡»"å¯ç”¨QuickPay"ï¼ˆ1ç§’ï¼‰
  â†“
æˆæƒå®Œæˆï¼Œè‡ªåŠ¨æ”¯ä»˜ï¼ˆ1-3ç§’ï¼‰
  â†“
æ”¯ä»˜å®Œæˆ
```

**æ€»æ­¥éª¤**ï¼š3æ­¥ï¼ˆæ˜¾ç¤ºè®¢å• â†’ æˆæƒ â†’ æ”¯ä»˜å®Œæˆï¼‰

**åœºæ™¯Cï¼šéœ€è¦KYC**
```
ç”¨æˆ·ç‚¹å‡»æ”¯ä»˜
  â†“
æ˜¾ç¤ºè®¢å•ä¿¡æ¯ + ä»·æ ¼å¯¹æ¯”ï¼ˆ2ç§’ï¼‰
  â†“
ç”¨æˆ·ç‚¹å‡»"å®ŒæˆKYC"ï¼ˆ1ç§’ï¼‰
  â†“
KYCæµç¨‹ï¼ˆ2-5åˆ†é’Ÿï¼‰
  â†“
æ”¯ä»˜å®Œæˆï¼ˆ1-3ç§’ï¼‰
  â†“
æ”¯ä»˜å®Œæˆ
```

**æ€»æ­¥éª¤**ï¼š4æ­¥ï¼ˆæ˜¾ç¤ºè®¢å• â†’ KYC â†’ æ”¯ä»˜å®Œæˆï¼‰

### 6.2 äº¤äº’ä¼˜åŒ–åŸåˆ™

#### 6.2.1 å‡å°‘å†³ç­–ç‚¹

**åŸåˆ™**ï¼š
- è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜æ–¹æ¡ˆï¼Œå‡å°‘ç”¨æˆ·é€‰æ‹©
- åªåœ¨å¿…è¦æ—¶è®©ç”¨æˆ·å†³ç­–
- æä¾›é»˜è®¤é€‰é¡¹ï¼Œå‡å°‘æ€è€ƒè´Ÿæ‹…

**å®ç°**ï¼š
- QuickPayå¯ç”¨æ—¶ï¼Œè‡ªåŠ¨ä½¿ç”¨ï¼Œæ— éœ€é€‰æ‹©
- å¤šä¸ªé€‰é¡¹æ—¶ï¼Œæ¨èç¬¬ä¸€ä¸ªï¼Œå…¶ä»–æŠ˜å 
- å¼•å¯¼æµç¨‹ä¸­ï¼Œæä¾›"ç¨åå†è¯´"é€‰é¡¹

#### 6.2.2 æ¸è¿›å¼æŠ«éœ²

**åŸåˆ™**ï¼š
- å…ˆæ˜¾ç¤ºæ ¸å¿ƒä¿¡æ¯ï¼Œå†æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
- é¿å…ä¿¡æ¯è¿‡è½½
- æŒ‰éœ€å±•å¼€è¯¦ç»†ä¿¡æ¯

**å®ç°**ï¼š
- é»˜è®¤åªæ˜¾ç¤ºæ¨èæ”¯ä»˜æ–¹å¼
- ç‚¹å‡»"æŸ¥çœ‹å…¶ä»–æ–¹å¼"å±•å¼€æ‰€æœ‰é€‰é¡¹
- ä»·æ ¼æ˜ç»†é»˜è®¤æŠ˜å ï¼Œç‚¹å‡»å±•å¼€

#### 6.2.3 æ™ºèƒ½å¼•å¯¼

**åŸåˆ™**ï¼š
- æ ¹æ®ç”¨æˆ·çŠ¶æ€æ™ºèƒ½å¼•å¯¼
- ä¸å¼ºåˆ¶ç”¨æˆ·å®Œæˆæ‰€æœ‰æ­¥éª¤
- æä¾›è·³è¿‡é€‰é¡¹

**å®ç°**ï¼š
- QuickPayå¼•å¯¼ï¼šæä¾›"ç¨åå†è¯´"
- KYCå¼•å¯¼ï¼šæä¾›"ä½¿ç”¨Stripeæ”¯ä»˜"é€‰é¡¹
- é’±åŒ…è¿æ¥ï¼šæä¾›"ç¨åè¿æ¥"é€‰é¡¹

---

## 7. å®ç°æ–¹æ¡ˆ

### 7.1 å‰ç«¯å®ç°

#### 7.1.1 æ”¯ä»˜æµç¨‹ç»„ä»¶

```typescript
export function PaymentFlow() {
  const [userStatus, setUserStatus] = useState<UserStatus | null>(null);
  const [quickPayCheck, setQuickPayCheck] = useState<QuickPayCheckResult | null>(null);
  const [recommendations, setRecommendations] = useState<PaymentRecommendation[]>([]);
  const [currentStep, setCurrentStep] = useState<'checking' | 'recommending' | 'paying'>('checking');
  
  // 1. æ£€æŸ¥ç”¨æˆ·çŠ¶æ€
  useEffect(() => {
    async function checkStatus() {
      const status = await userStatusApi.check(userId, amount, currency);
      setUserStatus(status);
      
      // 2. æ£€æŸ¥QuickPay
      if (status.quickPay.authorized) {
        const quickPay = await quickPayApi.canUse(userId, amount, currency, merchantId);
        setQuickPayCheck(quickPay);
        
        // 3. å¦‚æœå¯ç”¨ï¼Œç›´æ¥ä½¿ç”¨
        if (quickPay.canUse) {
          setCurrentStep('paying');
          await processQuickPay();
          return;
        }
      }
      
      // 4. ç”Ÿæˆæ¨è
      const recs = await recommendationApi.generate(userId, productId, countryCode, currency, amount);
      setRecommendations(recs);
      setCurrentStep('recommending');
    }
    
    checkStatus();
  }, []);
  
  // æ¸²æŸ“
  if (currentStep === 'checking') {
    return <LoadingScreen />;
  }
  
  if (currentStep === 'paying' && quickPayCheck?.canUse) {
    return <QuickPayProcessing />;
  }
  
  if (currentStep === 'recommending') {
    return <PaymentRecommendations 
      recommendations={recommendations}
      userStatus={userStatus}
      onQuickPayAuth={() => handleQuickPayAuth()}
      onKYC={() => handleKYC()}
    />;
  }
}
```

### 7.2 åç«¯å®ç°

#### 7.2.1 è·¯ç”±å†³ç­–æœåŠ¡ï¼ˆä¼˜åŒ–åï¼‰

```typescript
@Injectable()
export class SmartRouterService {
  /**
   * æ™ºèƒ½è·¯ç”±å†³ç­–ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
   */
  async routePayment(
    userId: string,
    productId: string,
    countryCode: string,
    currency: string,
    amount: number,
  ): Promise<RoutingDecision> {
    // 1. æ£€æŸ¥ç”¨æˆ·çŠ¶æ€
    const userStatus = await this.userStatusService.checkUserStatus(
      userId,
      amount,
      currency,
    );
    
    // 2. æ£€æŸ¥QuickPayï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
    if (userStatus.quickPay.authorized) {
      const quickPayCheck = await this.quickPayService.canUseQuickPay(
        userId,
        amount,
        currency,
        productId,
      );
      
      if (quickPayCheck.canUse) {
        return {
          recommendedMethod: 'quickpay',
          channels: [{
            method: 'quickpay',
            price: amount,
            estimatedTime: '1-3ç§’',
            reason: 'âš¡ æœ€å¿«æ”¯ä»˜æ–¹å¼',
          }],
          quickPay: {
            available: true,
            channel: quickPayCheck.recommendedChannel,
          },
        };
      }
    }
    
    // 3. è·å–å•†æˆ·ä»·æ ¼è®¾ç½®
    const pricing = await this.pricingService.getProductPrice(
      productId,
      countryCode,
    );
    
    // 4. è·å–å¯ç”¨é€šé“
    const availableChannels = await this.getAvailableChannels(
      countryCode,
      currency,
      userStatus,
    );
    
    // 5. ç”Ÿæˆæ¨è
    const recommendations = await this.generateRecommendations(
      userId,
      productId,
      countryCode,
      currency,
      amount,
      userStatus,
      pricing,
      availableChannels,
    );
    
    return {
      recommendedMethod: recommendations[0].method,
      channels: recommendations,
      quickPay: {
        available: userStatus.quickPay.authorized,
        needsAuthorization: !userStatus.quickPay.authorized,
      },
      kyc: {
        status: userStatus.kyc.status,
        needsKYC: userStatus.kyc.needsKYC,
      },
    };
  }
}
```

---

## 7. æ ¸å¿ƒè®¾è®¡ä¿ç•™

### 7.1 ERC 8004å’Œå¤šé“¾å…¼å®¹

#### 7.1.1 è®¾è®¡ä¿ç•™

**æ ¸å¿ƒè®¾è®¡**ï¼š
- âœ… **ERC 8004åè®®æ”¯æŒ**ï¼šæ”¯æŒEthereumé“¾ä¸Šçš„ERC 8004 Agentèº«ä»½æ ‡å‡†
- âœ… **å¤šé“¾å…¼å®¹**ï¼šæ”¯æŒEthereumã€Solanaã€BSCã€Polygonã€Baseç­‰å¤šæ¡é“¾
- âœ… **W3C DIDæ”¯æŒ**ï¼šæ”¯æŒW3C DIDæ ‡å‡†ï¼Œæ ¼å¼ï¼š`did:paymind:agent:{agentId}`
- âœ… **è·¨é“¾ç»Ÿä¸€ID**ï¼šPayMind Agent IDä½œä¸ºè·¨é“¾ç»Ÿä¸€æ ‡è¯†

#### 7.1.2 åœ¨æ™ºèƒ½è·¯ç”±ä¸­çš„åº”ç”¨

**Agent IDè§£æ**ï¼š
```typescript
@Injectable()
export class SmartRouterService {
  /**
   * æ™ºèƒ½è·¯ç”±å†³ç­–ï¼ˆæ”¯æŒå¤šé“¾Agent IDï¼‰
   */
  async routePayment(
    userId: string,
    productId: string,
    countryCode: string,
    currency: string,
    amount: number,
    agentId?: string,  // æ”¯æŒå¤šé“¾Agent ID
  ): Promise<RoutingDecision> {
    // 1. è§£æAgent IDï¼ˆå¤šé“¾æ”¯æŒï¼‰
    let agentIdentity: AgentIdentity | null = null;
    if (agentId) {
      agentIdentity = await this.agentIdentityService.resolveAgentId(agentId);
      // æ”¯æŒERC 8004ã€DIDã€Solanaç­‰å¤šç§åè®®
    }
    
    // 2. æ£€æŸ¥ç”¨æˆ·çŠ¶æ€
    const userStatus = await this.userStatusService.checkUserStatus(
      userId,
      amount,
      currency,
    );
    
    // 3. å¦‚æœAgent IDæœ‰æ•ˆï¼Œä½¿ç”¨Agentä»£ä»˜
    if (agentIdentity && agentIdentity.verified) {
      const agentPayCheck = await this.checkAgentPayAvailability(
        agentIdentity,
        amount,
        currency,
      );
      
      if (agentPayCheck.available) {
        return {
          recommendedMethod: 'agent_pay',
          agentId: agentIdentity.paymindAgentId,
          chain: agentIdentity.primaryChain,
          protocol: agentIdentity.protocol, // ERC 8004, DID, etc.
        };
      }
    }
    
    // 4. ç»§ç»­å…¶ä»–è·¯ç”±é€»è¾‘...
  }
}
```

#### 7.1.3 åè®®é€‚é…å™¨

**æ”¯æŒçš„åè®®**ï¼š
| åè®®/æ ‡å‡† | é“¾ | çŠ¶æ€ | è¯´æ˜ |
|---------|----|----|------|
| **ERC 8004** | Ethereum | âœ… | AIä»£ç†èº«ä»½æ ‡å‡† |
| **ERC 725** | Ethereum | âœ… | èº«ä»½ç®¡ç†æ ‡å‡† |
| **W3C DID** | æ‰€æœ‰é“¾ | âœ… | å»ä¸­å¿ƒåŒ–èº«ä»½æ ‡å‡† |
| **Solana Agent Registry** | Solana | âœ… | Solanaé“¾ä¸Šæ³¨å†Œ |
| **BSC Agent Registry** | BSC | âœ… | BSCé“¾ä¸Šæ³¨å†Œ |
| **Polygon Agent Registry** | Polygon | âœ… | Polygoné“¾ä¸Šæ³¨å†Œ |
| **Base Agent Registry** | Base | âœ… | Baseé“¾ä¸Šæ³¨å†Œ |

### 7.2 SLAæ²»ç†æœºåˆ¶

#### 7.2.1 è®¾è®¡ä¿ç•™

**æ ¸å¿ƒè®¾è®¡**ï¼š
- âœ… **SLAæŒ‡æ ‡è®°å½•**ï¼šè®°å½•æ”¯ä»˜æˆåŠŸç‡ã€å“åº”æ—¶é—´ã€å¯ç”¨æ€§ç­‰æŒ‡æ ‡
- âœ… **SLAåˆè§„æ£€æŸ¥**ï¼šæ£€æŸ¥SLAæ˜¯å¦è¾¾æ ‡
- âœ… **SLAè¿çº¦å¤„ç†**ï¼šè§¦å‘SLAè¿çº¦æ—¶çš„è¡¥å¿æœºåˆ¶
- âœ… **ä¸‰å±‚IDè¿½è´£**ï¼šåŸºäºUser IDã€Agent IDã€Session IDçš„è¿½è´£ä½“ç³»

#### 7.2.2 åœ¨æ™ºèƒ½è·¯ç”±ä¸­çš„åº”ç”¨

**SLAè®°å½•æ—¶æœº**ï¼š
```typescript
@Injectable()
export class SmartRouterService {
  /**
   * æ™ºèƒ½è·¯ç”±å†³ç­–ï¼ˆè®°å½•SLAï¼‰
   */
  async routePayment(
    userId: string,
    productId: string,
    countryCode: string,
    currency: string,
    amount: number,
  ): Promise<RoutingDecision> {
    const sessionId = uuidv4(); // åˆ›å»ºSession ID
    
    const startTime = Date.now();
    
    // 1. æ‰§è¡Œè·¯ç”±å†³ç­–
    const decision = await this.executeRouting(
      userId,
      productId,
      countryCode,
      currency,
      amount,
    );
    
    const responseTime = Date.now() - startTime;
    
    // 2. è®°å½•SLAæŒ‡æ ‡
    await this.slaService.recordPaymentSLA({
      sessionId,
      userId,
      agentId: decision.agentId,
      merchantId: productId,
      metrics: {
        responseTime,
        paymentSuccess: false, // å¾…æ”¯ä»˜å®Œæˆåæ›´æ–°
        availability: 1.0,
      },
    });
    
    return {
      ...decision,
      sessionId, // è¿”å›Session IDç”¨äºåç»­è¿½è¸ª
    };
  }
}
```

**SLAæŒ‡æ ‡**ï¼š
- **å“åº”æ—¶é—´**ï¼šè·¯ç”±å†³ç­–å“åº”æ—¶é—´ï¼ˆç›®æ ‡ï¼š< 500msï¼‰
- **æ”¯ä»˜æˆåŠŸç‡**ï¼šæ”¯ä»˜æˆåŠŸæ¯”ä¾‹ï¼ˆç›®æ ‡ï¼š> 99%ï¼‰
- **å¯ç”¨æ€§**ï¼šæœåŠ¡å¯ç”¨æ—¶é—´æ¯”ä¾‹ï¼ˆç›®æ ‡ï¼š> 99.9%ï¼‰
- **ç»“ç®—å»¶è¿Ÿ**ï¼šèµ„é‡‘ç»“ç®—å»¶è¿Ÿï¼ˆç›®æ ‡ï¼šT+1ï¼‰

### 7.3 ç»Ÿä¸€æ”¯ä»˜æµç¨‹ï¼ˆ7é˜¶æ®µï¼‰

#### 7.3.1 è®¾è®¡ä¿ç•™

**æ ¸å¿ƒè®¾è®¡**ï¼š
- âœ… **7é˜¶æ®µç»Ÿä¸€æµç¨‹**ï¼šé€‚é…æ‰€æœ‰æ”¯ä»˜åœºæ™¯çš„ç»Ÿä¸€æµç¨‹
- âœ… **ä¸‰å±‚IDä½“ç³»**ï¼šUser IDã€Agent IDã€Session ID
- âœ… **é˜¶æ®µæ¸…æ™°**ï¼šæ¯ä¸ªé˜¶æ®µèŒè´£æ˜ç¡®ï¼Œå¯è¿½è¸ªå¯å®¡è®¡

#### 7.3.2 7é˜¶æ®µæµç¨‹ï¼ˆä¼˜åŒ–åï¼‰

```
é˜¶æ®µ0: ç”¨æˆ·çŠ¶æ€æ£€æŸ¥ï¼ˆæ–°å¢ï¼‰
  â”œâ”€â†’ æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€
  â”œâ”€â†’ è·å–PayMind ID
  â”œâ”€â†’ æ£€æŸ¥QuickPayæˆæƒçŠ¶æ€
  â”œâ”€â†’ æ£€æŸ¥KYCçŠ¶æ€
  â”œâ”€â†’ æ£€æŸ¥Agentè®¾ç½®
  â””â”€â†’ åˆ›å»ºSession IDï¼ˆä¸‰å±‚IDä¹‹ä¸€ï¼‰
    â†“
é˜¶æ®µ1: æ”¯ä»˜è¯·æ±‚
  â”œâ”€â†’ åˆ›å»ºæ”¯ä»˜è®°å½•
  â”œâ”€â†’ éªŒè¯æ”¯ä»˜å‚æ•°
  â”œâ”€â†’ è·å–User IDï¼ˆä¸‰å±‚IDä¹‹ä¸€ï¼‰
  â”œâ”€â†’ è·å–Agent IDï¼ˆä¸‰å±‚IDä¹‹ä¸€ï¼Œå¯é€‰ï¼‰
  â””â”€â†’ å…³è”Session ID
    â†“
é˜¶æ®µ2: æ™ºèƒ½è·¯ç”±é€‰æ‹©ï¼ˆå«ä»·æ ¼è·å–ï¼‰
  â”œâ”€â†’ è·å–å•†æˆ·ä»·æ ¼è®¾ç½®
  â”œâ”€â†’ è·å–å¯ç”¨é€šé“åˆ—è¡¨
  â”œâ”€â†’ è®¡ç®—å„é€šé“ä»·æ ¼
  â”œâ”€â†’ é€‰æ‹©æœ€ä¼˜é€šé“
  â””â”€â†’ è®°å½•è·¯ç”±å†³ç­–ï¼ˆSLAæŒ‡æ ‡ï¼‰
    â†“
é˜¶æ®µ3: æ”¯ä»˜æ‰§è¡Œ
  â”œâ”€â†’ æ‰§è¡Œå®é™…æ”¯ä»˜
  â”œâ”€â†’ æ›´æ–°æ”¯ä»˜çŠ¶æ€
  â””â”€â†’ è®°å½•æ”¯ä»˜ç»“æœï¼ˆSLAæŒ‡æ ‡ï¼‰
    â†“
é˜¶æ®µ4: é€šé“è´¹ç”¨æ‰£é™¤ï¼ˆå•†æˆ·æ‰¿æ‹…ï¼‰
  â”œâ”€â†’ è®¡ç®—é€šé“è´¹ç”¨
  â”œâ”€â†’ ä»å•†æˆ·æ”¶å…¥ä¸­æ‰£é™¤
  â””â”€â†’ è®°å½•è´¹ç”¨æ˜ç»†
    â†“
é˜¶æ®µ5: å›ºå®šä½£é‡‘è®¡ç®—ï¼ˆåŸºäºå•†æˆ·ç¨å‰ä»·æ ¼ï¼‰
  â”œâ”€â†’ åŸºäºå•†æˆ·ç¨å‰ä»·æ ¼è®¡ç®—
  â”œâ”€â†’ ä½¿ç”¨å›ºå®šä½£é‡‘æ¯”ä¾‹
  â”œâ”€â†’ è®¡ç®—Agentä½£é‡‘ï¼ˆå…³è”Agent IDï¼‰
  â”œâ”€â†’ è®¡ç®—PayMindå¹³å°è´¹
  â””â”€â†’ è®°å½•åˆ†ä½£æ˜ç»†
    â†“
é˜¶æ®µ6: èµ„é‡‘æ‰˜ç®¡ï¼ˆå¯é€‰ï¼‰
  â”œâ”€â†’ æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰˜ç®¡
  â”œâ”€â†’ åˆ›å»ºæ‰˜ç®¡è®°å½•
  â””â”€â†’ å…³è”Session ID
    â†“
é˜¶æ®µ7: ç»“ç®—åˆ†æ´¾
  â”œâ”€â†’ ç»“ç®—èµ„é‡‘
  â”œâ”€â†’ åˆ†æ´¾åˆ°å„æ–¹è´¦æˆ·
  â”œâ”€â†’ è®°å½•SLAæŒ‡æ ‡ï¼ˆæœ€ç»ˆï¼‰
  â”œâ”€â†’ å…³è”ä¸‰å±‚IDï¼ˆUser IDã€Agent IDã€Session IDï¼‰
  â””â”€â†’ å®Œæˆæ”¯ä»˜
```

#### 7.3.3 ä¸‰å±‚IDä½“ç³»

**User IDï¼ˆç”¨æˆ·IDï¼‰**ï¼š
- PayMind IDï¼ˆç³»ç»Ÿç”Ÿæˆï¼Œè·¨é“¾ï¼‰
- é’±åŒ…åœ°å€ï¼ˆå¤šé“¾ï¼šEthereumã€Solanaã€BSCã€Polygonç­‰ï¼‰
- é‚®ç®±/æ‰‹æœºå·ï¼ˆWeb2ï¼‰

**Agent IDï¼ˆä»£ç†IDï¼Œå¤šé“¾å…¼å®¹ï¼‰**ï¼š
- ERC 8004 (Ethereum)
- Solana Agent Registry
- BSC Agent Registry
- Polygon Agent Registry
- PayMind Agent IDï¼ˆè·¨é“¾ç»Ÿä¸€IDï¼‰
- W3C DIDï¼š`did:paymind:agent:{agentId}`

**Session IDï¼ˆä¼šè¯IDï¼‰**ï¼š
- ç³»ç»Ÿç”Ÿæˆï¼Œå…³è”User IDå’ŒAgent ID
- ç”¨äºè¿½è¸ªå•æ¬¡æ”¯ä»˜æµç¨‹
- ç”¨äºSLAè®°å½•å’Œè¿½è´£

#### 7.3.4 ä¸‰å±‚IDåœ¨æ”¯ä»˜æµç¨‹ä¸­çš„åº”ç”¨

```typescript
interface PaymentRecord {
  // ä¸‰å±‚ID
  userId: string;        // User ID
  agentId?: string;     // Agent IDï¼ˆå¯é€‰ï¼‰
  sessionId: string;    // Session IDï¼ˆå¿…å¡«ï¼‰
  
  // æ”¯ä»˜ä¿¡æ¯
  productId: string;
  amount: number;
  currency: string;
  
  // SLAè®°å½•
  slaMetrics: {
    responseTime: number;
    paymentSuccess: boolean;
    availability: number;
  };
  
  // è¿½è´£ä¿¡æ¯
  liability: {
    userLiability?: string;
    agentLiability?: string;
    platformLiability?: string;
  };
}
```

### 7.4 è®¾è®¡å…¼å®¹æ€§ç¡®è®¤

#### 7.4.1 å…¼å®¹æ€§æ£€æŸ¥

**ERC 8004å’Œå¤šé“¾å…¼å®¹**ï¼š
- âœ… åœ¨Agent IDè§£æä¸­æ”¯æŒ
- âœ… åœ¨åˆ†ä½£è®¡ç®—ä¸­å…³è”
- âœ… åœ¨è·¯ç”±å†³ç­–ä¸­è€ƒè™‘

**SLAæ²»ç†æœºåˆ¶**ï¼š
- âœ… åœ¨è·¯ç”±å†³ç­–ä¸­è®°å½•
- âœ… åœ¨æ”¯ä»˜æµç¨‹ä¸­è¿½è¸ª
- âœ… åœ¨ç»“ç®—åˆ†æ´¾ä¸­å®Œæˆ

**ç»Ÿä¸€æ”¯ä»˜æµç¨‹ï¼ˆ7é˜¶æ®µï¼‰**ï¼š
- âœ… ä¿æŒ7é˜¶æ®µæµç¨‹ä¸å˜
- âœ… æ–°å¢é˜¶æ®µ0ï¼ˆç”¨æˆ·çŠ¶æ€æ£€æŸ¥ï¼‰
- âœ… é›†æˆä¸‰å±‚IDä½“ç³»

#### 7.4.2 è®¾è®¡æ•´åˆ

**æ•´åˆç‚¹1ï¼šç”¨æˆ·çŠ¶æ€æ£€æŸ¥ â†’ ä¸‰å±‚ID**
- åœ¨é˜¶æ®µ0ä¸­åˆ›å»ºSession ID
- è·å–User IDå’ŒAgent ID
- ä¸ºåç»­é˜¶æ®µæä¾›IDæ”¯æŒ

**æ•´åˆç‚¹2ï¼šæ™ºèƒ½è·¯ç”± â†’ ERC 8004**
- åœ¨è·¯ç”±å†³ç­–ä¸­è§£æAgent ID
- æ”¯æŒå¤šé“¾Agent IDéªŒè¯
- æ”¯æŒERC 8004åè®®

**æ•´åˆç‚¹3ï¼šæ”¯ä»˜æµç¨‹ â†’ SLA**
- åœ¨æ”¯ä»˜æµç¨‹ä¸­è®°å½•SLAæŒ‡æ ‡
- å…³è”ä¸‰å±‚IDè¿›è¡Œè¿½è´£
- åœ¨ç»“ç®—åˆ†æ´¾ä¸­å®ŒæˆSLAè®°å½•

---

## 8. æ€»ç»“

### 8.1 æ ¸å¿ƒä¼˜åŒ–

1. **ç”¨æˆ·çŠ¶æ€ä¼˜å…ˆæ£€æŸ¥**ï¼šåœ¨è·¯ç”±åˆ†æå‰å…ˆæ£€æŸ¥ç”¨æˆ·çŠ¶æ€
2. **QuickPayå¿«é€Ÿé€šé“**ï¼šæ»¡è¶³æ¡ä»¶ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€é€‰æ‹©
3. **æ™ºèƒ½å¼•å¯¼**ï¼šæ ¹æ®ç”¨æˆ·çŠ¶æ€æ™ºèƒ½å¼•å¯¼ï¼Œè€Œéå¼ºåˆ¶è¦æ±‚
4. **æµç¨‹ç®€åŒ–**ï¼šå‡å°‘ç”¨æˆ·å†³ç­–ç‚¹ï¼Œè‡ªåŠ¨é€‰æ‹©æœ€ä¼˜æ–¹æ¡ˆ

### 8.2 ç”¨æˆ·ä½“éªŒæå‡

- **æœ€å¿«æµç¨‹**ï¼š2æ­¥å®Œæˆæ”¯ä»˜ï¼ˆæ˜¾ç¤ºè®¢å• â†’ æ”¯ä»˜å®Œæˆï¼‰
- **æ™ºèƒ½æ¨è**ï¼šè‡ªåŠ¨é€‰æ‹©æœ€ä¼˜æ”¯ä»˜æ–¹å¼
- **æ¸è¿›å¼å¼•å¯¼**ï¼šä¸å¼ºåˆ¶ç”¨æˆ·å®Œæˆæ‰€æœ‰æ­¥éª¤
- **é€æ˜æ¸…æ™°**ï¼šæ¸…æ¥šæ˜¾ç¤ºä»·æ ¼ã€æ—¶é—´ã€åŸå› 

---

**æ­¤ä¼˜åŒ–ç¡®ä¿äº†PayMindæ”¯ä»˜æµç¨‹çš„ç”¨æˆ·å‹å¥½æ€§å’Œæ•ˆç‡ï¼ŒåŒæ—¶ä¿æŒäº†æ™ºèƒ½è·¯ç”±çš„å‡†ç¡®æ€§å’Œçµæ´»æ€§ã€‚**

