# PayMind V3.0 测试执行清单

## 🎯 测试目标

验证V3.0支付流程优化功能是否正常工作，包括：
1. 手续费计算逻辑
2. 总手续费和汇率显示
3. 支付流程完整性

---

## ✅ 测试前准备

### 1. 服务启动检查

- [ ] 后端服务运行正常 (http://localhost:3001/api/health)
- [ ] 前端服务运行正常 (http://localhost:3000)
- [ ] 数据库连接正常
- [ ] 无编译错误

### 2. 测试数据准备

- [ ] 创建测试用户
- [ ] 创建测试商品（实体商品、服务、数字资产）
- [ ] 配置商家收款方式

---

## 🧪 测试场景

### 场景1：法币支付 → 数字货币结算（实体商品，无Agent）

**测试步骤**：
1. 访问 `http://localhost:3000/payment-demo`
2. 点击"体验统一支付流程"
3. 创建支付请求：
   - 金额：100元
   - 订单类型：product（实体商品）
   - 无Agent
4. 查看支付选项

**预期结果**：
- ✅ 总手续费显示：3.5%
- ✅ 汇率显示：1 CNY = 0.142 USDC
- ✅ 显示KYC要求（如果需要）
- ✅ 显示QuickPay授权状态（如果已授权）
- ✅ 支付选项描述正确

**验证点**：
- [ ] 总手续费计算正确（Provider 3% + PayMind 0.5% = 3.5%）
- [ ] 汇率显示正确
- [ ] 前端显示格式正确

---

### 场景2：法币支付 → 数字货币结算（服务/数字资产，有Agent）

**测试步骤**：
1. 访问 `http://localhost:3000/payment-demo`
2. 点击"体验统一支付流程"
3. 创建支付请求：
   - 金额：100元
   - 订单类型：service（服务）
   - 有Agent（传递agentId）
4. 查看支付选项

**预期结果**：
- ✅ 总手续费显示：7%
- ✅ 汇率显示：1 CNY = 0.142 USDC
- ✅ 显示KYC要求（如果需要）

**验证点**：
- [ ] 总手续费计算正确（Provider 3% + Agent 3% + PayMind 1% = 7%）
- [ ] 汇率显示正确
- [ ] Agent手续费正确计算

---

### 场景3：数字货币直接支付（实体商品，无Agent）

**测试步骤**：
1. 访问 `http://localhost:3000/payment-demo`
2. 点击"体验统一支付流程"
3. 创建支付请求：
   - 金额：100 USDC
   - 订单类型：product（实体商品）
   - 无Agent
4. 查看支付选项

**预期结果**：
- ✅ 总手续费显示：0.5%
- ✅ 无汇率显示（不涉及转换）

**验证点**：
- [ ] 总手续费计算正确（PayMind 0.5%）
- [ ] 无汇率显示（正确）

---

### 场景4：数字货币直接支付（服务/数字资产，有Agent）

**测试步骤**：
1. 访问 `http://localhost:3000/payment-demo`
2. 点击"体验统一支付流程"
3. 创建支付请求：
   - 金额：100 USDC
   - 订单类型：service（服务）
   - 有Agent（传递agentId）
4. 查看支付选项

**预期结果**：
- ✅ 总手续费显示：4%
- ✅ 无汇率显示（不涉及转换）

**验证点**：
- [ ] 总手续费计算正确（Agent 3% + PayMind 1% = 4%）
- [ ] 无汇率显示（正确）

---

## 🔍 API测试

### 测试1：获取支付路由（实体商品，无Agent）

**请求**：
```bash
GET http://localhost:3001/api/payments/routing?amount=100&currency=CNY&orderType=product
```

**预期响应**：
```json
{
  "totalFeeRate": 0.035,
  "exchangeRate": {
    "from": "CNY",
    "to": "USDC",
    "rate": 0.142
  },
  "requiresKYC": true,
  ...
}
```

**验证点**：
- [ ] `totalFeeRate` = 0.035 (3.5%)
- [ ] `exchangeRate` 存在且正确
- [ ] `requiresKYC` 正确

---

### 测试2：获取支付路由（服务/数字资产，有Agent）

**请求**：
```bash
GET http://localhost:3001/api/payments/routing?amount=100&currency=CNY&orderType=service&agentId=test-agent-id
```

**预期响应**：
```json
{
  "totalFeeRate": 0.07,
  "exchangeRate": {
    "from": "CNY",
    "to": "USDC",
    "rate": 0.142
  },
  ...
}
```

**验证点**：
- [ ] `totalFeeRate` = 0.07 (7%)
- [ ] `exchangeRate` 存在且正确

---

### 测试3：获取支付路由（数字货币直接支付）

**请求**：
```bash
GET http://localhost:3001/api/payments/routing?amount=100&currency=USDC&orderType=product
```

**预期响应**：
```json
{
  "totalFeeRate": 0.005,
  "exchangeRate": undefined,
  ...
}
```

**验证点**：
- [ ] `totalFeeRate` = 0.005 (0.5%)
- [ ] `exchangeRate` 不存在（正确）

---

## 📊 测试结果记录

### 测试日期：___________

### 场景1：法币支付（实体商品，无Agent）
- [ ] 通过
- [ ] 失败
- 问题：___________

### 场景2：法币支付（服务/数字资产，有Agent）
- [ ] 通过
- [ ] 失败
- 问题：___________

### 场景3：数字货币直接支付（实体商品，无Agent）
- [ ] 通过
- [ ] 失败
- 问题：___________

### 场景4：数字货币直接支付（服务/数字资产，有Agent）
- [ ] 通过
- [ ] 失败
- 问题：___________

### API测试
- [ ] 通过
- [ ] 失败
- 问题：___________

---

## 🐛 问题记录

### 问题1：___________
**描述**：___________
**解决方案**：___________

### 问题2：___________
**描述**：___________
**解决方案**：___________

---

## ✅ 测试完成确认

- [ ] 所有测试场景通过
- [ ] 所有API测试通过
- [ ] 无编译错误
- [ ] 无运行时错误
- [ ] 前端显示正确
- [ ] 后端逻辑正确

**测试人员签名**：___________
**测试完成日期**：___________

