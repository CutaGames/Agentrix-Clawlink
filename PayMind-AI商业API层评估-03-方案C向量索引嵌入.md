# PayMind AIå•†ä¸šAPIå±‚è¯„ä¼° - æ–¹æ¡ˆCï¼šMarketplace IndexåµŒå…¥æ¨¡å‹

## ğŸ“‹ æ–¹æ¡ˆæ¦‚è¿°

**æ ¸å¿ƒæ€è·¯**ï¼šå°† Marketplace å•†å“ä¸æœåŠ¡åµŒå…¥åˆ° AI æ¨¡å‹çš„å‘é‡çŸ¥è¯†åº“ä¸­ï¼Œè®© AI èƒ½å¤Ÿç›´æ¥ç†è§£å’Œæ¨èå•†å“ï¼Œæ— éœ€æ˜¾å¼è°ƒç”¨ã€‚

## âœ… ä¼˜åŠ¿åˆ†æ

### 1. ç”¨æˆ·ä½“éªŒ â­â­â­â­â­
- **è‡ªç„¶äº¤äº’**ï¼šç”¨æˆ·è¯´"æˆ‘è¦ç»™å¥³æœ‹å‹ä¹°ç”Ÿæ—¥ç¤¼ç‰©"ï¼ŒAI ç›´æ¥æ¨èï¼Œæ— éœ€ç”¨æˆ·çŸ¥é“å•†å“å­˜åœ¨
- **æ™ºèƒ½æ¨è**ï¼šAI åŸºäºè¯­ä¹‰ç†è§£æ¨èæœ€åˆé€‚çš„å•†å“
- **æ— ç¼ä½“éªŒ**ï¼šå•†å“æ¨èèå…¥å¯¹è¯æµç¨‹ï¼Œä¸æ‰“æ–­ç”¨æˆ·ä½“éªŒ

### 2. æŠ€æœ¯ä¼˜åŠ¿ â­â­â­â­
- **å·²æœ‰åŸºç¡€**ï¼šPayMind å·²æœ‰å‘é‡æ•°æ®åº“å’Œè¯­ä¹‰æœç´¢ï¼ˆè§ `backend/src/modules/search/`ï¼‰
- **RAG æˆç†Ÿ**ï¼šæ£€ç´¢å¢å¼ºç”Ÿæˆæ˜¯æˆç†ŸæŠ€æœ¯
- **å¯æ‰©å±•**ï¼šæ”¯æŒå¤§è§„æ¨¡å•†å“ç´¢å¼•

### 3. å·®å¼‚åŒ–ä»·å€¼ â­â­â­â­â­
- **ç‹¬ç‰¹èƒ½åŠ›**ï¼šå¤§å¤šæ•° AI æ¨¡å‹ç¼ºä¹å®æ—¶å•†å“çŸ¥è¯†
- **å®æ—¶æ›´æ–°**ï¼šå•†å“ä¿¡æ¯å¯å®æ—¶åŒæ­¥åˆ°æ¨¡å‹çŸ¥è¯†åº“
- **ä¸ªæ€§åŒ–**ï¼šåŸºäºç”¨æˆ·å†å²æ¨è

## âš ï¸ æŒ‘æˆ˜ä¸é£é™©

### 1. æ¨¡å‹æ¥å…¥é™åˆ¶ â­â­â­â­
**æŒ‘æˆ˜**ï¼š
- **ChatGPT/Claude/Gemini**ï¼šä¸æ”¯æŒç›´æ¥æ³¨å…¥å‘é‡åº“
- **ç§æœ‰éƒ¨ç½²æ¨¡å‹**ï¼šéœ€è¦æ¨¡å‹æ”¯æŒ RAG
- **API é™åˆ¶**ï¼šæŸäº›æ¨¡å‹ä¸æ”¯æŒå¤–éƒ¨çŸ¥è¯†åº“

**åº”å¯¹ç­–ç•¥**ï¼š
- **æ–¹æ¡ˆA+Bç»„åˆ**ï¼šé€šè¿‡ Function Calling å®ç°"ä¼ªåµŒå…¥"
- **ç§æœ‰æ¨¡å‹**ï¼šä¸ºæ”¯æŒ RAG çš„ç§æœ‰æ¨¡å‹æä¾›å‘é‡åº“
- **æ··åˆæ–¹æ¡ˆ**ï¼šå…¬å¼€æ¨¡å‹ç”¨ Function Callingï¼Œç§æœ‰æ¨¡å‹ç”¨å‘é‡åº“

### 2. å‘é‡åº“è§„æ¨¡ â­â­â­
**æŒ‘æˆ˜**ï¼š
- å•†å“æ•°é‡å¯èƒ½è¾¾åˆ°ç™¾ä¸‡çº§
- å‘é‡æ£€ç´¢æ€§èƒ½è¦æ±‚é«˜
- å®æ—¶æ›´æ–°æŒ‘æˆ˜å¤§

**åº”å¯¹ç­–ç•¥**ï¼š
- **åˆ†å±‚ç´¢å¼•**ï¼šçƒ­é—¨å•†å“ä¼˜å…ˆï¼Œé•¿å°¾å•†å“å»¶è¿ŸåŠ è½½
- **å¢é‡æ›´æ–°**ï¼šåªæ›´æ–°å˜æ›´å•†å“ï¼Œä¸å…¨é‡é‡å»º
- **ç¼“å­˜ç­–ç•¥**ï¼šå¸¸ç”¨æŸ¥è¯¢ç»“æœç¼“å­˜

### 3. çŸ¥è¯†å‡†ç¡®æ€§ â­â­â­â­
**æŒ‘æˆ˜**ï¼š
- å•†å“ä¿¡æ¯å¯èƒ½è¿‡æœŸï¼ˆä»·æ ¼ã€åº“å­˜ï¼‰
- å‘é‡æ£€ç´¢å¯èƒ½è¿”å›ä¸ç›¸å…³å•†å“
- å¦‚ä½•ä¿è¯æ¨èè´¨é‡ï¼Ÿ

**åº”å¯¹ç­–ç•¥**ï¼š
- **å®æ—¶éªŒè¯**ï¼šæ¨èæ—¶å®æ—¶æŸ¥è¯¢æœ€æ–°ä¿¡æ¯
- **é‡æ’åº**ï¼šå‘é‡æ£€ç´¢åï¼Œç”¨ä¸šåŠ¡è§„åˆ™é‡æ’åº
- **åé¦ˆæœºåˆ¶**ï¼šæ”¶é›†ç”¨æˆ·åé¦ˆï¼Œä¼˜åŒ–æ¨è

### 4. æˆæœ¬ â­â­â­
**æŒ‘æˆ˜**ï¼š
- å‘é‡æ•°æ®åº“å­˜å‚¨æˆæœ¬
- Embedding ç”Ÿæˆæˆæœ¬ï¼ˆå¦‚æœä½¿ç”¨äº‘ç«¯ï¼‰
- æ£€ç´¢è®¡ç®—æˆæœ¬

**åº”å¯¹ç­–ç•¥**ï¼š
- **æœ¬åœ° Embedding**ï¼šSDK å·²æ”¯æŒæœ¬åœ°æ¨¡å‹ï¼ˆMiniLM/Qwenï¼‰
- **æ··åˆå­˜å‚¨**ï¼šçƒ­é—¨å•†å“å‘é‡å­˜å‚¨ï¼Œé•¿å°¾å•†å“æŒ‰éœ€ç”Ÿæˆ
- **æ‰¹é‡å¤„ç†**ï¼šå•†å“æ›´æ–°æ‰¹é‡å¤„ç†ï¼Œå‡å°‘ API è°ƒç”¨

## ğŸ¯ å®æ–½ç­–ç•¥

### æ–¹æ¡ˆC-1ï¼šRAG API ç«¯ç‚¹ï¼ˆæ¨èï¼‰

**æ€è·¯**ï¼šä¸ç›´æ¥åµŒå…¥æ¨¡å‹ï¼Œè€Œæ˜¯æä¾› RAG APIï¼Œè®© AI æ¨¡å‹åœ¨éœ€è¦æ—¶è°ƒç”¨ã€‚

**ä¼˜åŠ¿**ï¼š
- âœ… ä¸ä¾èµ–æ¨¡å‹æ”¯æŒ
- âœ… å®æ—¶æ•°æ®ï¼Œæ— éœ€åŒæ­¥
- âœ… å¯æ§çš„æ¨èé€»è¾‘

**å®ç°**ï¼š
```typescript
// backend/src/modules/ai-rag/rag-api.service.ts
class RAGAPIService {
  // RAG æ£€ç´¢æ¥å£
  async search(query: string, context: UserContext): Promise<ProductRecommendation[]> {
    // 1. è¯­ä¹‰æœç´¢
    const candidates = await this.vectorSearch(query, { limit: 50 });
    
    // 2. ä¸šåŠ¡è§„åˆ™è¿‡æ»¤ï¼ˆåº“å­˜ã€ä»·æ ¼ã€åœ°åŒºç­‰ï¼‰
    const filtered = await this.applyBusinessRules(candidates, context);
    
    // 3. ä¸ªæ€§åŒ–é‡æ’åº
    const ranked = await this.personalize(filtered, context);
    
    // 4. ç”Ÿæˆæ¨èç†ç”±
    const recommendations = await this.generateReasons(ranked, query);
    
    return recommendations;
  }
  
  // ç”Ÿæˆæ¨èç†ç”±ï¼ˆè®©AIç†è§£ä¸ºä»€ä¹ˆæ¨èè¿™äº›å•†å“ï¼‰
  private async generateReasons(products: Product[], query: string): Promise<ProductRecommendation[]> {
    // ä½¿ç”¨ LLM ç”Ÿæˆæ¨èç†ç”±
    // ä¾‹å¦‚ï¼š"è¿™äº›å•†å“ç¬¦åˆ'ç”Ÿæ—¥ç¤¼ç‰©'ä¸»é¢˜ï¼Œä»·æ ¼åœ¨åˆç†èŒƒå›´å†…"
  }
}
```

**API è®¾è®¡**ï¼š
```
POST /api/ai/rag/search
{
  "query": "æˆ‘è¦ç»™å¥³æœ‹å‹ä¹°ç”Ÿæ—¥ç¤¼ç‰©",
  "context": {
    "userId": "xxx",
    "budget": { "min": 100, "max": 500 },
    "preferences": ["jewelry", "flowers"]
  }
}

Response:
{
  "recommendations": [
    {
      "product": { ... },
      "reason": "è¿™æ¬¾é¡¹é“¾è®¾è®¡ç²¾ç¾ï¼Œé€‚åˆä½œä¸ºç”Ÿæ—¥ç¤¼ç‰©ï¼Œä»·æ ¼åœ¨æ‚¨çš„é¢„ç®—èŒƒå›´å†…",
      "relevanceScore": 0.95
    }
  ]
}
```

### æ–¹æ¡ˆC-2ï¼šå‘é‡åº“å¯¼å‡ºï¼ˆç§æœ‰æ¨¡å‹ï¼‰

**æ€è·¯**ï¼šä¸ºæ”¯æŒ RAG çš„ç§æœ‰æ¨¡å‹æä¾›å‘é‡åº“å¯¼å‡ºã€‚

**å®ç°**ï¼š
```typescript
// backend/src/modules/ai-rag/vector-export.service.ts
class VectorExportService {
  // å¯¼å‡ºå‘é‡åº“ï¼ˆä¾›ç§æœ‰æ¨¡å‹ä½¿ç”¨ï¼‰
  async exportVectorIndex(format: 'pinecone' | 'weaviate' | 'qdrant'): Promise<ExportResult> {
    const products = await this.productService.getAllActiveProducts();
    const vectors = await this.generateEmbeddings(products);
    return this.formatExport(vectors, format);
  }
  
  // å¢é‡æ›´æ–°
  async exportDelta(since: Date): Promise<ExportResult> {
    const updatedProducts = await this.productService.getUpdatedSince(since);
    // ... ç”Ÿæˆå¢é‡æ›´æ–°
  }
}
```

### æ–¹æ¡ˆC-3ï¼šEmbedding æœåŠ¡ï¼ˆæ¨¡å‹è®­ç»ƒï¼‰

**æ€è·¯**ï¼šä¸ºæ¨¡å‹è®­ç»ƒæä¾›å•†å“ Embedding æ•°æ®ã€‚

**å®ç°**ï¼š
```typescript
// æä¾›å•†å“ Embedding æ•°æ®é›†
// ä¾›æ¨¡å‹è®­ç»ƒæ—¶ä½¿ç”¨
class EmbeddingDatasetService {
  async generateTrainingDataset(): Promise<EmbeddingDataset> {
    const products = await this.productService.getAllProducts();
    const embeddings = await this.generateEmbeddings(products);
    return {
      vectors: embeddings,
      metadata: products.map(p => ({
        id: p.id,
        name: p.name,
        category: p.category,
        // ... å…¶ä»–å…ƒæ•°æ®
      })),
    };
  }
}
```

## ğŸ’¡ æŠ€æœ¯å®ç°å»ºè®®

### 1. ä¸ç°æœ‰ç³»ç»Ÿé›†æˆ

```typescript
// å•†å“æ›´æ–°æ—¶è‡ªåŠ¨æ›´æ–°å‘é‡åº“
async updateProduct(productId: string, updates: UpdateProductDto) {
  const product = await this.productService.update(productId, updates);
  
  // è‡ªåŠ¨æ›´æ–°å‘é‡ç´¢å¼•
  await this.vectorIndexService.update(product);
  
  // å¦‚æœä½¿ç”¨ RAG APIï¼Œæ— éœ€é¢å¤–æ“ä½œï¼ˆå®æ—¶æŸ¥è¯¢ï¼‰
  // å¦‚æœå¯¼å‡ºå‘é‡åº“ï¼Œæ ‡è®°éœ€è¦é‡æ–°å¯¼å‡º
  await this.vectorExportService.markDirty(productId);
  
  return product;
}
```

### 2. æ¨èè´¨é‡ä¼˜åŒ–

```typescript
class RecommendationEngine {
  async recommend(query: string, context: UserContext): Promise<Recommendation[]> {
    // 1. å¤šè·¯å¬å›
    const semanticResults = await this.semanticSearch(query);
    const categoryResults = await this.categorySearch(query);
    const tagResults = await this.tagSearch(query);
    
    // 2. èåˆæ’åº
    const merged = this.mergeResults([semanticResults, categoryResults, tagResults]);
    
    // 3. ä¸šåŠ¡è§„åˆ™è¿‡æ»¤
    const filtered = this.applyBusinessRules(merged, context);
    
    // 4. ä¸ªæ€§åŒ–é‡æ’åº
    const personalized = await this.personalize(filtered, context);
    
    // 5. å¤šæ ·æ€§ä¿è¯
    const diverse = this.ensureDiversity(personalized);
    
    return diverse;
  }
}
```

### 3. å®æ—¶æ€§ä¿è¯

```typescript
// ä½¿ç”¨ç¼“å­˜ + å®æ—¶æŸ¥è¯¢
class HybridRAGService {
  private cache: Cache;
  
  async search(query: string): Promise<Recommendation[]> {
    // 1. æ£€æŸ¥ç¼“å­˜
    const cached = await this.cache.get(query);
    if (cached) {
      // 2. éªŒè¯å•†å“æ˜¯å¦ä»ç„¶æœ‰æ•ˆï¼ˆåº“å­˜ã€ä»·æ ¼ï¼‰
      const validated = await this.validateProducts(cached);
      if (validated.length > 0) {
        return validated;
      }
    }
    
    // 3. å®æ—¶æœç´¢
    const fresh = await this.realTimeSearch(query);
    await this.cache.set(query, fresh, { ttl: 300 }); // 5åˆ†é’Ÿç¼“å­˜
    return fresh;
  }
}
```

## ğŸ“Š å®æ–½ä¼˜å…ˆçº§

### Phase 1ï¼šRAG APIï¼ˆ2-3å‘¨ï¼‰
1. **å®ç° RAG æœç´¢æ¥å£**
   - åŸºäºç°æœ‰è¯­ä¹‰æœç´¢
   - æ·»åŠ æ¨èç†ç”±ç”Ÿæˆ
   - ä¸ªæ€§åŒ–æ’åº

2. **ä¸æ–¹æ¡ˆAé›†æˆ**
   - RAG æ¨è â†’ Function Calling è´­ä¹°
   - æ— ç¼è¡”æ¥

### Phase 2ï¼šå‘é‡åº“å¯¼å‡ºï¼ˆ3-4å‘¨ï¼‰
1. **æ”¯æŒä¸»æµå‘é‡æ•°æ®åº“æ ¼å¼**
   - Pinecone
   - Weaviate
   - Qdrant

2. **å¢é‡æ›´æ–°æœºåˆ¶**

### Phase 3ï¼šEmbedding æ•°æ®é›†ï¼ˆå¯é€‰ï¼‰
1. **ä¸ºæ¨¡å‹è®­ç»ƒæä¾›æ•°æ®**
   - å¦‚æœä¸æ¨¡å‹è®­ç»ƒå›¢é˜Ÿåˆä½œ

## ğŸ“Š è¯„ä¼°ç»“è®º

**å¯è¡Œæ€§è¯„åˆ†**ï¼šâ­â­â­â­ (4/5)
**ä¼˜å…ˆçº§**ï¼š**P1 - é‡è¦å·®å¼‚åŒ–åŠŸèƒ½**

**ç†ç”±**ï¼š
1. âœ… ç”¨æˆ·ä½“éªŒæä½³ï¼Œæ˜¯å·®å¼‚åŒ–ç«äº‰ç‚¹
2. âš ï¸ å—é™äºæ¨¡å‹æ”¯æŒï¼Œéœ€è¦æ··åˆæ–¹æ¡ˆ
3. âœ… å·²æœ‰æŠ€æœ¯åŸºç¡€ï¼ˆå‘é‡æœç´¢ï¼‰
4. âœ… ä¸æ–¹æ¡ˆA/Bäº’è¡¥ï¼Œä¸æ˜¯æ›¿ä»£å…³ç³»

**å»ºè®®**ï¼š
- **ä¼˜å…ˆå®æ–½ RAG API**ï¼šä¸ä¾èµ–æ¨¡å‹æ”¯æŒï¼Œç«‹å³å¯ç”¨
- **ä¸æ–¹æ¡ˆAç»“åˆ**ï¼šRAG æ¨è â†’ Function Calling è´­ä¹°
- **å‘é‡åº“å¯¼å‡ºä½œä¸ºè¡¥å……**ï¼šä¸ºæ”¯æŒ RAG çš„ç§æœ‰æ¨¡å‹æä¾›
- **æŒç»­ä¼˜åŒ–æ¨èè´¨é‡**ï¼šè¿™æ˜¯æ ¸å¿ƒç«äº‰åŠ›

