# Agentrix æ™ºèƒ½è·¯ç”±ç³»ç»Ÿæ–‡æ¡£ V5.0

**ç‰ˆæœ¬**: 5.0  
**æ›´æ–°æ—¥æœŸ**: 2025å¹´12æœˆ11æ—¥  
**åˆ†æ”¯**: feat/smartcheckout-layout

---

## ğŸ“‹ ç›®å½•

1. [æ™ºèƒ½è·¯ç”±æ¦‚è¿°](#1-æ™ºèƒ½è·¯ç”±æ¦‚è¿°)
2. [è·¯ç”±å†³ç­–é€»è¾‘](#2-è·¯ç”±å†³ç­–é€»è¾‘)
3. [æ”¯ä»˜é€šé“å¯¹æ¯”](#3-æ”¯ä»˜é€šé“å¯¹æ¯”)
4. [Pre-Flight Check æœºåˆ¶](#4-pre-flight-check-æœºåˆ¶)
5. [è·¯ç”±ä¼˜å…ˆçº§è§„åˆ™](#5-è·¯ç”±ä¼˜å…ˆçº§è§„åˆ™)
6. [å•†æˆ·ä»·å€¼åˆ†æ](#6-å•†æˆ·ä»·å€¼åˆ†æ)
7. [æŠ€æœ¯å®ç°](#7-æŠ€æœ¯å®ç°)
8. [å¸¸è§é—®é¢˜](#8-å¸¸è§é—®é¢˜)

---

## 1. æ™ºèƒ½è·¯ç”±æ¦‚è¿°

### 1.1 ä»€ä¹ˆæ˜¯æ™ºèƒ½è·¯ç”±

æ™ºèƒ½è·¯ç”±æ˜¯ Agentrix æ”¯ä»˜ç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œæ ¹æ®ç”¨æˆ·çŠ¶æ€ã€è®¢å•é‡‘é¢ã€å¯ç”¨é€šé“ç­‰å› ç´ ï¼Œ**è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜æ”¯ä»˜æ–¹å¼**ã€‚

### 1.2 è®¾è®¡ç›®æ ‡

| ç›®æ ‡ | æè¿° | ä¼˜å…ˆçº§ |
|------|------|--------|
| **æˆæœ¬æœ€ä¼˜** | é€‰æ‹©è´¹ç‡æœ€ä½çš„é€šé“ | â­â­â­ |
| **æˆåŠŸç‡æœ€é«˜** | ä¼˜å…ˆé€‰æ‹©æˆåŠŸç‡é«˜çš„é€šé“ | â­â­â­ |
| **ç”¨æˆ·ä½“éªŒ** | å‡å°‘ç”¨æˆ·æ“ä½œæ­¥éª¤ | â­â­ |
| **å…¨çƒè¦†ç›–** | æ”¯æŒå¤šåœ°åŒºã€å¤šè´§å¸ | â­â­ |

### 1.3 æ”¯æŒçš„è·¯ç”±ç±»å‹

```typescript
type RouteType = 'quickpay' | 'wallet' | 'provider' | 'local-rail' | 'crypto-rail';
```

| è·¯ç”±ç±»å‹ | æè¿° | é€šé“ |
|---------|------|------|
| `quickpay` | ä¸€é”®å… Gas æ”¯ä»˜ | Session + Relayer |
| `wallet` | é’±åŒ…ç›´æ¥è½¬è´¦ | ERC20 Transfer |
| `provider` | ç¬¬ä¸‰æ–¹æ”¯ä»˜æœåŠ¡å•† | Transak / Stripe |
| `local-rail` | æœ¬åœ°æ”¯ä»˜é€šé“ | æ”¯ä»˜å® / å¾®ä¿¡ (è®¡åˆ’ä¸­) |
| `crypto-rail` | è·¨é“¾åŠ å¯†æ”¯ä»˜ | DEX èšåˆ (è®¡åˆ’ä¸­) |

---

## 2. è·¯ç”±å†³ç­–é€»è¾‘

### 2.1 å†³ç­–æµç¨‹å›¾

```
ç”¨æˆ·å‘èµ·æ”¯ä»˜
    â†“
Pre-Flight Check (é¢„æ£€æŸ¥)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          æ£€æŸ¥ QuickPay å¯ç”¨æ€§            â”‚
â”‚                                          â”‚
â”‚  âœ“ æœ‰æ´»è·ƒ Session?                       â”‚
â”‚  âœ“ é‡‘é¢ â‰¤ å•ç¬”é™é¢?                      â”‚
â”‚  âœ“ é‡‘é¢ â‰¤ æ—¥å‰©ä½™é™é¢?                    â”‚
â”‚                                          â”‚
â”‚  å…¨éƒ¨æ»¡è¶³ â†’ æ¨è QuickPay               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ (ä¸æ»¡è¶³)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          æ£€æŸ¥ Wallet Pay å¯ç”¨æ€§          â”‚
â”‚                                          â”‚
â”‚  âœ“ é’±åŒ…å·²è¿æ¥?                          â”‚
â”‚  âœ“ ä½™é¢å……è¶³?                            â”‚
â”‚                                          â”‚
â”‚  å…¨éƒ¨æ»¡è¶³ â†’ æ¨è Wallet Pay             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ (ä¸æ»¡è¶³)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          é™çº§åˆ° Fiat Provider            â”‚
â”‚                                          â”‚
â”‚  â†’ æ¨è Transak (æ³•å¸æ”¯ä»˜)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ä»£ç å®ç°

```typescript
// SmartCheckout åˆå§‹åŒ–æ—¶çš„è·¯ç”±å†³ç­–
const initializePayment = async () => {
  // 1. æ‰§è¡Œé¢„æ£€æŸ¥
  const result = await paymentApi.preflightCheck({
    amount: order.amount.toString(),
    currency: order.currency,
  });
  
  // 2. è·å–ç”¨æˆ·çŠ¶æ€
  const finalSession = session || activeSession || currentSession;
  const hasWallet = isConnected && defaultWallet;
  const hasQuickPaySession = Boolean(finalSession);
  
  // 3. åˆ¤æ–­ QuickPay æ˜¯å¦å¯ç”¨
  const quickPayEligible = hasQuickPaySession && result.quickPayAvailable;
  
  // 4. è®¾ç½®æ¨èè·¯ç”±
  if (quickPayEligible) {
    setRouteType('quickpay');
  } else if (hasWallet) {
    setRouteType('wallet');
  } else {
    setRouteType('provider');
  }
};
```

---

## 3. æ”¯ä»˜é€šé“å¯¹æ¯”

### 3.1 è´¹ç‡å¯¹æ¯”

| é€šé“ | è´¹ç‡ | Gas è´¹ | KYC | åˆ°è´¦æ—¶é—´ |
|------|------|--------|-----|---------|
| **QuickPay** | 0% | æ—  (Gasless) | å¦ | å³æ—¶ |
| **Wallet Pay** | 0% | ~0.1 USDT | å¦ | ~15ç§’ |
| **Transak** | 1-5% | æ—  | æ˜¯ | 2-5åˆ†é’Ÿ |
| **Stripe** | 2.9% + $0.30 | æ—  | å¦ | å³æ—¶ |

### 3.2 æˆæœ¬ç¤ºä¾‹

**è®¢å•é‡‘é¢**: $100 USD

| é€šé“ | è´¹ç”¨è®¡ç®— | å•†æˆ·å®æ”¶ |
|------|---------|---------|
| QuickPay | $0 | **$100** |
| Wallet Pay | ~$0.10 (Gas) | **$99.90** |
| Transak (3%) | $3 | **$97** |
| Stripe | $2.9 + $0.30 = $3.20 | **$96.80** |

### 3.3 é€‚ç”¨åœºæ™¯

| é€šé“ | é€‚ç”¨åœºæ™¯ | ä¸é€‚ç”¨åœºæ™¯ |
|------|---------|-----------|
| **QuickPay** | å°é¢é«˜é¢‘ã€å·²æˆæƒç”¨æˆ· | é¦–æ¬¡ç”¨æˆ·ã€å¤§é¢è®¢å• |
| **Wallet Pay** | å·²æœ‰é’±åŒ…ç”¨æˆ·ã€å³æ—¶æ”¯ä»˜ | æ— å¸ç”¨æˆ· |
| **Transak** | æ— å¸ç”¨æˆ·ã€å¤§é¢è®¢å• | å°é¢è®¢å• (< $30) |

---

## 4. Pre-Flight Check æœºåˆ¶

### 4.1 é¢„æ£€æŸ¥æ¥å£

**ç«¯ç‚¹**: `GET /api/payment/preflight`

**è¯·æ±‚å‚æ•°**:
```typescript
{
  amount: string;     // è®¢å•é‡‘é¢
  currency: string;   // è´§å¸ä»£ç  (USD/CNY/USDT)
}
```

**å“åº”ç¤ºä¾‹**:
```typescript
{
  recommendedRoute: 'quickpay',
  quickPayAvailable: true,
  sessionLimit: {
    singleLimit: '100',
    dailyLimit: '1000',
    dailyRemaining: '850'
  },
  walletBalance: '50.5',
  requiresKYC: false,
  fees: {
    gasFee: '0.1',
    providerFee: '0',
    total: '0.1'
  },
  providerOptions: [
    {
      id: 'transak',
      name: 'Transak',
      price: 100,
      fee: 3,
      minAmount: 30,
      available: true
    }
  ]
}
```

### 4.2 é¢„æ£€æŸ¥é€»è¾‘

```typescript
// backend: preflight-check.service.ts
async preflightCheck(userId: string, dto: PreflightCheckDto) {
  // 1. æ£€æŸ¥ç”¨æˆ· Session
  const session = await this.sessionService.getActiveSession(userId);
  
  // 2. æ£€æŸ¥é’±åŒ…ä½™é¢
  const balance = await this.walletService.getBalance(userId);
  
  // 3. æ£€æŸ¥ KYC çŠ¶æ€
  const kycStatus = await this.kycService.getStatus(userId);
  
  // 4. è®¡ç®—æ¨èè·¯ç”±
  const recommendedRoute = this.calculateRecommendedRoute({
    session, balance, kycStatus, amount: dto.amount
  });
  
  return {
    recommendedRoute,
    quickPayAvailable: Boolean(session),
    sessionLimit: session?.limit,
    walletBalance: balance?.toString(),
    requiresKYC: !kycStatus?.verified,
  };
}
```

---

## 5. è·¯ç”±ä¼˜å…ˆçº§è§„åˆ™

### 5.1 ä¼˜å…ˆçº§é¡ºåº

1. **QuickPay** (æœ€é«˜ä¼˜å…ˆçº§)
   - æ¡ä»¶: æœ‰ Session + é‡‘é¢åœ¨é™é¢å†…
   - ä¼˜åŠ¿: é›¶è´¹ç”¨ã€å³æ—¶åˆ°è´¦ã€æ— éœ€ç­¾å

2. **Wallet Pay** (æ¬¡ä¼˜å…ˆçº§)
   - æ¡ä»¶: é’±åŒ…å·²è¿æ¥ + ä½™é¢å……è¶³
   - ä¼˜åŠ¿: å³æ—¶ã€æ— éœ€ KYC

3. **Provider** (æœ€ä½ä¼˜å…ˆçº§)
   - æ¡ä»¶: å…¶ä»–æ–¹å¼ä¸å¯ç”¨
   - ä¼˜åŠ¿: æ”¯æŒæ³•å¸ã€æ— éœ€æŒå¸

### 5.2 é™é¢æ£€æŸ¥è§„åˆ™ (V5.0 æ›´æ–°)

```typescript
// ä» Session æ ¹çº§åˆ«è¯»å–é™é¢ (å·²ä¿®å¤)
const singleLimit = session?.singleLimit ? parseFloat(String(session.singleLimit)) : 0;
const dailyLimit = session?.dailyLimit ? parseFloat(String(session.dailyLimit)) : 0;
const usedToday = session?.usedToday ? parseFloat(String(session.usedToday)) : 0;
const dailyRemaining = dailyLimit - usedToday;

// æœ‰æ•ˆé™é¢æ£€æŸ¥
const hasValidLimits = singleLimit > 0 && dailyLimit > 0;

// è¶…é™åˆ¤æ–­
const exceedsLimit = hasValidLimits && cryptoAmount && (
  cryptoAmount > singleLimit ||      // è¶…è¿‡å•ç¬”é™é¢
  cryptoAmount > dailyRemaining      // è¶…è¿‡æ—¥å‰©ä½™é™é¢
);

// QuickPay ç¦ç”¨æ¡ä»¶
const isQuickPayDisabled = !session || (hasValidLimits && exceedsLimit);
```

---

## 6. å•†æˆ·ä»·å€¼åˆ†æ

### 6.1 æˆæœ¬èŠ‚çœ

**åœºæ™¯**: æœˆ GMV $100,000ï¼Œå‡è®¾ 60% ç”¨æˆ·æœ‰ Session

| æ”¯ä»˜æ–¹å¼ | æ¯”ä¾‹ | é‡‘é¢ | è´¹ç”¨ | è´¹ç‡ |
|---------|------|------|------|------|
| QuickPay | 60% | $60,000 | $0 | 0% |
| Wallet Pay | 20% | $20,000 | $20 | 0.1% |
| Transak | 20% | $20,000 | $600 | 3% |
| **æ€»è®¡** | 100% | $100,000 | **$620** | **0.62%** |

**å¯¹æ¯”çº¯ Stripe**: $100,000 Ã— 2.9% = $2,900  
**èŠ‚çœ**: $2,900 - $620 = **$2,280/æœˆ (78%)**

### 6.2 è½¬åŒ–ç‡æå‡

| æŒ‡æ ‡ | ä¼ ç»Ÿæ”¯ä»˜ | æ™ºèƒ½è·¯ç”± | æå‡ |
|------|---------|---------|------|
| æ”¯ä»˜æ­¥éª¤ | 5-8 æ­¥ | 1-3 æ­¥ | -60% |
| æ”¯ä»˜è€—æ—¶ | 30-60ç§’ | 5-15ç§’ | -70% |
| æ”¾å¼ƒç‡ | 15-20% | 5-8% | -60% |
| æˆåŠŸç‡ | 95% | 99.5% | +4.5% |

---

## 7. æŠ€æœ¯å®ç°

### 7.1 å‰ç«¯ç»„ä»¶

**æ–‡ä»¶**: `frontend/components/payment/SmartCheckout.tsx`

```typescript
// è·¯ç”±é€‰æ‹© UI
const CryptoSection = () => {
  const session = currentSession || activeSession;
  
  // é™é¢æ£€æŸ¥ (V5.0 ä¿®å¤)
  const singleLimit = session?.singleLimit ? parseFloat(String(session.singleLimit)) : 0;
  const dailyRemaining = dailyLimit - usedToday;
  
  const hasValidLimits = singleLimit > 0;
  const exceedsLimit = hasValidLimits && cryptoAmount > singleLimit;
  const isQuickPayDisabled = !session || exceedsLimit;
  
  return (
    <div>
      {/* QuickPay å¡ç‰‡ */}
      <QuickPayCard 
        disabled={isQuickPayDisabled}
        reason={exceedsLimit ? 'Exceeds session limit' : 'Enable for instant payment'}
      />
      
      {/* Wallet Pay å¡ç‰‡ */}
      <WalletPayCard />
    </div>
  );
};
```

### 7.2 åç«¯æœåŠ¡

**æ–‡ä»¶**: `backend/src/modules/payment/preflight-check.service.ts`

```typescript
@Injectable()
export class PreflightCheckService {
  async preflightCheck(userId: string, dto: PreflightCheckDto) {
    const session = await this.sessionService.getActiveSession(userId);
    const amount = parseFloat(dto.amount);
    
    // æ£€æŸ¥ QuickPay å¯ç”¨æ€§
    let quickPayAvailable = false;
    if (session) {
      const singleLimit = session.singleLimit || 0;
      const dailyRemaining = (session.dailyLimit || 0) - (session.usedToday || 0);
      quickPayAvailable = amount <= singleLimit && amount <= dailyRemaining;
    }
    
    return {
      recommendedRoute: quickPayAvailable ? 'quickpay' : 'wallet',
      quickPayAvailable,
      sessionLimit: {
        singleLimit: session?.singleLimit?.toString() || '0',
        dailyLimit: session?.dailyLimit?.toString() || '0',
        dailyRemaining: dailyRemaining?.toString() || '0',
      }
    };
  }
}
```

---

## 8. è·¯ç”±é€‰æ‹©æ—¶åºå›¾

### 8.1 æ™ºèƒ½è·¯ç”±å†³ç­–æµç¨‹

```mermaid
sequenceDiagram
    autonumber
    participant U as ç”¨æˆ·
    participant FE as å‰ç«¯
    participant BE as PreflightCheckService
    participant SS as SessionService
    participant WS as WalletService

    U->>FE: 1. è¿›å…¥æ”¯ä»˜é¡µé¢
    FE->>BE: 2. GET /api/payment/preflight?amount=X
    
    rect rgb(230, 230, 250)
        Note over BE: è·¯ç”±å†³ç­–é€»è¾‘
        BE->>SS: 3. getActiveSession(userId)
        SS-->>BE: 4. Session ä¿¡æ¯
        BE->>WS: 5. getBalance(userId)
        WS-->>BE: 6. é’±åŒ…ä½™é¢
        BE->>BE: 7. calculateRecommendedRoute()
    end
    
    BE-->>FE: 8. {recommendedRoute, quickPayAvailable, sessionLimit}
    
    alt QuickPay å¯ç”¨
        FE->>FE: 9a. è®¾ç½® routeType = 'quickpay'
    else æœ‰é’±åŒ…ä½™é¢
        FE->>FE: 9b. è®¾ç½® routeType = 'wallet'
    else æ— é’±åŒ…
        FE->>FE: 9c. è®¾ç½® routeType = 'provider'
    end
    
    FE-->>U: 10. æ˜¾ç¤ºæ¨èæ”¯ä»˜æ–¹å¼
```

### 8.2 è·¯ç”±ä¼˜å…ˆçº§å†³ç­–æ ‘

```mermaid
flowchart TD
    A[å¼€å§‹æ”¯ä»˜] --> B{æœ‰ QuickPay Session?}
    B -->|æ˜¯| C{é‡‘é¢ â‰¤ å•ç¬”é™é¢?}
    B -->|å¦| G{é’±åŒ…å·²è¿æ¥?}
    
    C -->|æ˜¯| D{é‡‘é¢ â‰¤ æ—¥å‰©ä½™é™é¢?}
    C -->|å¦| G
    
    D -->|æ˜¯| E[âœ… ä½¿ç”¨ QuickPay]
    D -->|å¦| G
    
    G -->|æ˜¯| H{ä½™é¢å……è¶³?}
    G -->|å¦| K[ä½¿ç”¨ Provider]
    
    H -->|æ˜¯| I[âœ… ä½¿ç”¨ Wallet Pay]
    H -->|å¦| J{éœ€è¦ KYC?}
    
    J -->|å¦| K[âœ… ä½¿ç”¨ Provider]
    J -->|æ˜¯| L[æç¤ºå®Œæˆ KYC]
    
    style E fill:#90EE90
    style I fill:#90EE90
    style K fill:#90EE90
```

### 8.3 å®Œæ•´æ”¯ä»˜è·¯ç”±æµç¨‹

```mermaid
sequenceDiagram
    autonumber
    participant U as ç”¨æˆ·
    participant FE as SmartCheckout
    participant BE as PaymentService
    participant QP as QuickPay Handler
    participant WP as Wallet Handler
    participant PP as Provider Handler
    participant CC as Commission åˆçº¦

    U->>FE: 1. ç¡®è®¤æ”¯ä»˜
    FE->>BE: 2. processPayment({route, amount})
    
    alt route = 'quickpay'
        BE->>QP: 3a. handleQuickPay()
        QP->>CC: 4a. executePayment via Relayer
        CC-->>QP: 5a. txHash
        QP-->>BE: 6a. æ”¯ä»˜å®Œæˆ
    else route = 'wallet'
        BE->>WP: 3b. handleWalletPay()
        WP->>CC: 4b. éªŒè¯ txHash
        CC-->>WP: 5b. äº¤æ˜“ç¡®è®¤
        WP-->>BE: 6b. æ”¯ä»˜å®Œæˆ
    else route = 'provider'
        BE->>PP: 3c. handleProviderPay()
        PP->>PP: 4c. ç­‰å¾… Webhook
        PP-->>BE: 5c. æ”¯ä»˜å®Œæˆ
    end
    
    BE->>BE: 7. è®¡ç®—åˆ†ä½£
    BE->>CC: 8. è§¦å‘åˆ†è´¦
    CC-->>BE: 9. PaymentAutoSplit äº‹ä»¶
    BE-->>FE: 10. {success: true}
    FE-->>U: 11. æ˜¾ç¤ºæ”¯ä»˜æˆåŠŸ
```

---

## 9. å¸¸è§é—®é¢˜

### 9.1 QuickPay æ€»æ˜¯æ˜¾ç¤º "Exceeds session limit"

**åŸå› **: Session é™é¢å­—æ®µè¯»å–è·¯å¾„é”™è¯¯

**è§£å†³**: V5.0 å·²ä¿®å¤ï¼Œä» `session.singleLimit` è€Œé `session.limit.singleLimit` è¯»å–

### 9.2 æ³•å¸è®¢å•æ— æ³•ä½¿ç”¨ QuickPay

**åŸå› **: QuickPay æœªå¤„ç†æ³•å¸â†’USDT è½¬æ¢

**è§£å†³**: V5.0 å·²ä¿®å¤ï¼Œè‡ªåŠ¨å°†æ³•å¸é‡‘é¢è½¬æ¢ä¸º USDT åæ‰§è¡Œ QuickPay

### 9.3 Transak é‡‘é¢æ— æ³•é”å®š

**åŸå› **: 
- Create Session API è¢« Cloudflare é˜»æ­¢
- Staging ç¯å¢ƒä¸æ”¯æŒ URL å‚æ•°é”å®š

**è§£å†³**: éƒ¨ç½²åç«¯åˆ°æµ·å¤–æœåŠ¡å™¨

---

## ğŸ“Š ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | æ›´æ–°å†…å®¹ |
|------|------|---------|
| V5.1 | 2025-01-17 | æ·»åŠ è·¯ç”±æ—¶åºå›¾ã€å†³ç­–æ ‘ã€X402 V2 æ”¯æŒã€0.3% é€šé“è´¹ä»å¹³å°è´¹æ‰£é™¤ã€èµ„é‡‘è·¯å¾„è·Ÿè¸ª |
| V5.0 | 2025-12-11 | ä¿®å¤ Session é™é¢æ£€æŸ¥ã€æ³•å¸è®¢å•æ”¯æŒ |
| V4.0 | 2025-01 | å…¨çƒé€šé“æ”¯æŒã€å•†æˆ·ä»·å€¼ä¼˜åŒ– |
| V3.0 | 2024-12 | Pre-Flight Check æœºåˆ¶ |

---

## 9. X402 V2 åè®®æ”¯æŒ

### 9.1 X402 V2 æ¦‚è¿°

X402 V2 æ˜¯ Agentrix æ”¯ä»˜ç³»ç»Ÿå¯¹ ARN/X402 åè®®çš„å‡çº§æ”¯æŒã€‚ä¸»è¦å˜åŒ–ï¼š

- **é€šé“è´¹é€»è¾‘**: 0.3% é€šé“è´¹ä»å¹³å°è´¹ä¸­æ‰£é™¤ï¼ˆè€Œéé¢å¤–æ”¶å–ï¼‰
- **èµ„é‡‘è·¯å¾„è¿½è¸ª**: è¯¦ç»†è®°å½•æ¯ç¬”äº¤æ˜“çš„èµ„é‡‘æµå‘
- **å‘åå…¼å®¹**: é X402 æ”¯ä»˜ä»ä½¿ç”¨åŸæœ‰è´¹ç‡ç»“æ„

### 9.2 è´¹ç‡ç»“æ„ (V4.0)

| äº§å“ç±»å‹ | æ¿€åŠ±æ±  | å¹³å°è´¹ | X402é€šé“è´¹ | å•†æˆ·å®æ”¶ |
|---------|--------|--------|-----------|---------|
| å®ä½“å•†å“ | 2.2% | 0.5% | 0.3%* | 97% |
| æœåŠ¡ç±» | 3.7% | 1.0% | 0.3%* | 95% |
| è™šæ‹Ÿèµ„äº§ | 2.2% | 0.5% | 0.3%* | 97% |
| NFT | 1.7% | 0.5% | 0.3%* | 97.5% |

> *æ³¨ï¼šX402 é€šé“è´¹ä»å¹³å°è´¹ä¸­æ‰£é™¤ï¼Œå•†æˆ·å®æ”¶ä¸å˜

### 9.3 èµ„é‡‘è·¯å¾„ç¤ºä¾‹

**100 USDT å®ä½“å•†å“è®¢å• (X402 V2)**ï¼š

```
å®¢æˆ·æ”¯ä»˜: 100 USDT
    â”œâ”€â†’ å•†æˆ·å®æ”¶: 97.00 USDT (97%)
    â”œâ”€â†’ æ¿€åŠ±æ± : 2.20 USDT (2.2%)
    â”‚     â”œâ”€â†’ æ‰§è¡ŒAgent: 1.54 USDT (70%)
    â”‚     â””â”€â†’ æ¨èAgent: 0.66 USDT (30%)
    â””â”€â†’ å¹³å°æ”¶å…¥: 0.80 USDT (0.8%)
          â”œâ”€â†’ X402é€šé“è´¹: 0.30 USDT (0.3%)
          â”œâ”€â†’ æ¨å¹¿Agent: 0.10 USDT (20%)
          â””â”€â†’ Paymind: 0.40 USDT
```

### 9.4 ç®¡ç†å‘˜èµ„é‡‘è·¯å¾„æŸ¥çœ‹

èµ„é‡‘è·¯å¾„åŠŸèƒ½å·²é›†æˆåˆ°ç®¡ç†åå°ï¼š

- **è·¯å¾„**: `/admin/fund-paths`
- **åŠŸèƒ½**: 
  - æŸ¥çœ‹æ‰€æœ‰äº¤æ˜“çš„èµ„é‡‘åˆ†é…è¯¦æƒ…
  - æŒ‰æ”¯ä»˜IDæˆ–äº¤æ˜“å“ˆå¸Œæœç´¢
  - è¿‡æ»¤ X402 æ”¯ä»˜
  - å¯¼å‡ºèµ„é‡‘æµæŠ¥è¡¨

---

**æ–‡æ¡£ç»´æŠ¤**: Agentrix Team  
**æœ€åæ›´æ–°**: 2025-01-17
