# 直接更新数据库商品价格

## 方法1：使用psql命令行（推荐）

在WSL或Linux终端中执行：

```bash
# 方式1：使用环境变量
psql -h localhost -U agentrix -d agentrix_db -f backend/scripts/update-prices-direct.sql

# 方式2：直接指定参数
psql -h localhost -p 5432 -U agentrix -d agentrix_db -f backend/scripts/update-prices-direct.sql
```

如果设置了密码，会提示输入密码。

## 方法2：使用psql交互式执行

```bash
psql -h localhost -U agentrix -d agentrix_db
```

然后在psql中执行：

```sql
-- 更新USDT商品价格为0.01
UPDATE products 
SET price = 0.01,
    "updatedAt" = NOW()
WHERE (metadata->>'currency' = 'USDT' OR (metadata->>'currency' IS NULL AND price > 1))
  AND price > 0.01;

-- 更新USD商品价格为0.1
UPDATE products 
SET price = 0.1,
    "updatedAt" = NOW()
WHERE metadata->>'currency' = 'USD' 
  AND price > 0.1;

-- 更新CNY商品价格为1
UPDATE products 
SET price = 1,
    "updatedAt" = NOW()
WHERE metadata->>'currency' = 'CNY' 
  AND price > 1;

-- 查看更新结果
SELECT id, name, price, metadata->>'currency' as currency 
FROM products 
ORDER BY "createdAt" DESC;
```

## 方法3：使用数据库管理工具

如果使用pgAdmin、DBeaver等工具：

1. 连接到数据库
2. 打开SQL编辑器
3. 复制以下SQL并执行：

```sql
-- 更新USDT商品价格为0.01
UPDATE products 
SET price = 0.01,
    "updatedAt" = NOW()
WHERE (metadata->>'currency' = 'USDT' OR (metadata->>'currency' IS NULL AND price > 1))
  AND price > 0.01;

-- 更新USD商品价格为0.1
UPDATE products 
SET price = 0.1,
    "updatedAt" = NOW()
WHERE metadata->>'currency' = 'USD' 
  AND price > 0.1;

-- 更新CNY商品价格为1
UPDATE products 
SET price = 1,
    "updatedAt" = NOW()
WHERE metadata->>'currency' = 'CNY' 
  AND price > 1;
```

## 方法4：使用Node.js脚本（如果psql不可用）

在WSL中运行：

```bash
cd backend
npx ts-node scripts/update-product-prices.ts
```

## 验证更新

更新后，执行以下SQL查看结果：

```sql
SELECT 
    id,
    name,
    price,
    COALESCE(metadata->>'currency', 'CNY') as currency,
    stock
FROM products
ORDER BY "createdAt" DESC;
```

## 更新规则

| 货币类型 | 新价格 | 说明 |
|---------|--------|------|
| USDT | 0.01 | 适合BSC测试网USDT测试 |
| USD | 0.1 | 适合法币支付测试 |
| CNY | 1 | 适合人民币支付测试 |

## 注意事项

1. ⚠️ 更新前建议备份数据库
2. ⚠️ 确保在测试环境中执行
3. ✅ 更新后刷新浏览器页面即可看到新价格

