# PayMind ç”Ÿæ€åˆ†æˆæœºåˆ¶è¯¦ç»†è®¾è®¡ V3.1
## åˆ‡å®è½åœ°å¹¶äº§ç”Ÿé£è½®æ•ˆåº”çš„åˆ†æˆæœºåˆ¶

**ç‰ˆæœ¬**: 3.1  
**æ—¥æœŸ**: 2025å¹´1æœˆ

---

## ğŸ“‹ ç›®å½•

1. [åˆ†æˆæœºåˆ¶æ€»è§ˆ](#1-åˆ†æˆæœºåˆ¶æ€»è§ˆ)
2. [äº¤æ˜“åˆ†æˆæœºåˆ¶](#2-äº¤æ˜“åˆ†æˆæœºåˆ¶)
3. [æ¨å¹¿åˆ†æˆæœºåˆ¶](#3-æ¨å¹¿åˆ†æˆæœºåˆ¶)
4. [Agent åä½œåˆ†æˆæœºåˆ¶](#4-agent-åä½œåˆ†æˆæœºåˆ¶)
5. [åˆ†æˆç»“ç®—æœºåˆ¶](#5-åˆ†æˆç»“ç®—æœºåˆ¶)
6. [é£è½®æ•ˆåº”è®¾è®¡](#6-é£è½®æ•ˆåº”è®¾è®¡)

---

## 1. åˆ†æˆæœºåˆ¶æ€»è§ˆ

### 1.1 æ ¸å¿ƒåŸåˆ™

1. **é€æ˜å…¬å¹³**ï¼šæ‰€æœ‰åˆ†æˆè§„åˆ™å…¬å¼€é€æ˜
2. **é•¿æœŸæ¿€åŠ±**ï¼šæ¨å¹¿ Agent è·å¾—é•¿æœŸæ”¶ç›Š
3. **å¤šèµ¢è®¾è®¡**ï¼šæ‰€æœ‰å‚ä¸è€…éƒ½èƒ½è·å¾—æ”¶ç›Š
4. **é£è½®é©±åŠ¨**ï¼šåˆ†æˆæœºåˆ¶é©±åŠ¨ç”Ÿæ€å¢é•¿

### 1.2 åˆ†æˆç±»å‹

| åˆ†æˆç±»å‹ | åˆ†æˆå¯¹è±¡ | åˆ†æˆæ¯”ä¾‹ | ç»“ç®—å‘¨æœŸ |
|---------|---------|---------|---------|
| **äº¤æ˜“åˆ†æˆ** | æ‰§è¡Œ Agent | 2-3% | T+1 |
| **å•†å“æ¨èåˆ†æˆ** | æ¨è Agent | å•†å“ä½£é‡‘ç‡ Ã— 30% | T+1 |
| **å•†æˆ·æ¨å¹¿åˆ†æˆ** | æ¨å¹¿ Agent | 0.5%ï¼ˆæ°¸ä¹…ï¼‰ | T+7 |
| **å¹³å°æ‰‹ç»­è´¹** | PayMind | 0.5%-1% | T+1 |

---

## 2. äº¤æ˜“åˆ†æˆæœºåˆ¶

### 2.1 åŸºç¡€äº¤æ˜“åˆ†æˆ

#### 2.1.1 åˆ†æˆæ¯”ä¾‹ï¼ˆæŒ‰è®¢å•ç±»å‹ï¼‰

| è®¢å•ç±»å‹ | å•†æˆ·æ”¶å…¥ | æ‰§è¡Œ Agent | PayMind | Provider | è¯´æ˜ |
|---------|---------|-----------|---------|----------|------|
| **å®ç‰©å•†å“** | 97.5% | 2% | 0.5% | 0% | æ—  Provider |
| **å®ç‰©å•†å“ï¼ˆæ³•å¸è½¬æ•°å­—è´§å¸ï¼‰** | 94.5% | 2% | 0.5% | 3% | æœ‰ Provider |
| **æœåŠ¡/æ•°å­—èµ„äº§** | 96% | 3% | 1% | 0% | æ—  Provider |
| **æœåŠ¡/æ•°å­—èµ„äº§ï¼ˆæ³•å¸è½¬æ•°å­—è´§å¸ï¼‰** | 93% | 3% | 1% | 3% | æœ‰ Provider |
| **NFT/è™šæ‹Ÿèµ„äº§** | 96% | 3% | 1% | 0% | æ—  Provider |
| **NFT/è™šæ‹Ÿèµ„äº§ï¼ˆæ³•å¸è½¬æ•°å­—è´§å¸ï¼‰** | 93% | 3% | 1% | 3% | æœ‰ Provider |

#### 2.1.2 è®¡ç®—ç¤ºä¾‹

**ç¤ºä¾‹ 1ï¼šå®ç‰©å•†å“ï¼ˆæ—  Providerï¼‰**
- äº¤æ˜“é‡‘é¢ï¼š$1000
- æ‰§è¡Œ Agent åˆ†æˆï¼š$1000 Ã— 2% = **$20**
- PayMind åˆ†æˆï¼š$1000 Ã— 0.5% = **$5**
- å•†æˆ·æ”¶å…¥ï¼š$1000 - $20 - $5 = **$975**

**ç¤ºä¾‹ 2ï¼šæœåŠ¡/æ•°å­—èµ„äº§ï¼ˆæœ‰ Providerï¼‰**
- äº¤æ˜“é‡‘é¢ï¼š$1000
- Provider æ‰‹ç»­è´¹ï¼š$1000 Ã— 3% = **$30**
- æ‰§è¡Œ Agent åˆ†æˆï¼š$1000 Ã— 3% = **$30**
- PayMind åˆ†æˆï¼š$1000 Ã— 1% = **$10**
- å•†æˆ·æ”¶å…¥ï¼š$1000 - $30 - $30 - $10 = **$930**

---

### 2.2 å•†å“æ¨èåˆ†æˆï¼ˆå¤š Agent åä½œï¼‰

#### 2.2.1 åˆ†æˆè§„åˆ™

å½“å¤šä¸ª Agent å‚ä¸äº¤æ˜“æ—¶ï¼š

**åœºæ™¯ Aï¼šæ¨è Agent + æ‰§è¡Œ Agent**
- æ¨è Agentï¼ˆæ¨èå•†å“ï¼‰ï¼šå•†å“ä½£é‡‘ç‡ Ã— 30%
- æ‰§è¡Œ Agentï¼ˆæ‰§è¡Œäº¤æ˜“ï¼‰ï¼šå•†å“ä½£é‡‘ç‡ Ã— 70%
- PayMindï¼šå¹³å°æ‰‹ç»­è´¹ï¼ˆ0.5% æˆ– 1%ï¼‰

**åœºæ™¯ Bï¼šåªæœ‰æ‰§è¡Œ Agent**
- æ‰§è¡Œ Agentï¼šAgent åˆ†æˆï¼ˆ2% æˆ– 3%ï¼‰
- PayMindï¼šå¹³å°æ‰‹ç»­è´¹ï¼ˆ0.5% æˆ– 1%ï¼‰

#### 2.2.2 è®¡ç®—ç¤ºä¾‹

**ç¤ºä¾‹ï¼šæ¨è Agent + æ‰§è¡Œ Agent**
- äº¤æ˜“é‡‘é¢ï¼š$1000
- å•†å“ä½£é‡‘ç‡ï¼š10%ï¼ˆå•†æˆ·è®¾ç½®ï¼‰
- æ¨è Agent åˆ†æˆï¼š$1000 Ã— 10% Ã— 30% = **$30**
- æ‰§è¡Œ Agent åˆ†æˆï¼š$1000 Ã— 10% Ã— 70% = **$70**
- PayMind åˆ†æˆï¼š$1000 Ã— 1% = **$10**
- å•†æˆ·æ”¶å…¥ï¼š$1000 - $100 - $10 = **$890**

**è¯´æ˜**ï¼š
- å¦‚æœå•†å“ä½£é‡‘ç‡ > Agent åŸºç¡€åˆ†æˆï¼Œä½¿ç”¨å•†å“ä½£é‡‘ç‡
- å¦‚æœå•†å“ä½£é‡‘ç‡ < Agent åŸºç¡€åˆ†æˆï¼Œä½¿ç”¨ Agent åŸºç¡€åˆ†æˆ

---

## 3. æ¨å¹¿åˆ†æˆæœºåˆ¶ï¼ˆå…³é”®åˆ›æ–°ï¼‰

### 3.1 å•†æˆ·æ¨å¹¿å¥–åŠ±

#### 3.1.1 ä¸€æ¬¡æ€§å¥–åŠ±

| å•†æˆ·ç±»å‹ | å…¥é©»å¥–åŠ± | é¦–æ¬¡äº¤æ˜“å¥–åŠ± | æ€»è®¡ |
|---------|---------|------------|------|
| **å°å‹å•†æˆ·**ï¼ˆæœˆGMV < $10Kï¼‰ | $50 | $100 | **$150** |
| **ä¸­å‹å•†æˆ·**ï¼ˆæœˆGMV $10K - $100Kï¼‰ | $200 | $500 | **$700** |
| **å¤§å‹å•†æˆ·**ï¼ˆæœˆGMV > $100Kï¼‰ | $500 | $1000 | **$1,500** |

**å¥–åŠ±æ¡ä»¶**ï¼š
1. æ¨è Agent å¼•å¯¼å•†æˆ·å®Œæˆæ³¨å†Œå’Œå…¥é©»
2. å•†æˆ·å®Œæˆé¦–æ¬¡äº¤æ˜“ï¼ˆé‡‘é¢ â‰¥ $100ï¼‰

#### 3.1.2 é•¿æœŸåˆ†æˆï¼ˆæ°¸ä¹…ï¼‰

**åˆ†æˆè§„åˆ™**ï¼š
- åˆ†æˆæ¯”ä¾‹ï¼šå•†æˆ·æ‰€æœ‰äº¤æ˜“é¢çš„ **0.5%**
- åˆ†æˆå¯¹è±¡ï¼šæ¨è Agent
- åˆ†æˆæœŸé™ï¼š**æ°¸ä¹…**ï¼ˆåªè¦å•†æˆ·åœ¨å¹³å°ï¼‰
- ç»“ç®—å‘¨æœŸï¼šT+7ï¼ˆæ¯å‘¨ç»“ç®—ä¸€æ¬¡ï¼‰

**è®¡ç®—ç¤ºä¾‹**ï¼š
- Agent A æ¨èä¸­å‹å•†æˆ· B
- å•†æˆ· B æœˆ GMVï¼š$50,000
- Agent A ä¸€æ¬¡æ€§å¥–åŠ±ï¼š$700
- Agent A æœˆé•¿æœŸåˆ†æˆï¼š$50,000 Ã— 0.5% = **$250/æœˆ**
- Agent A å¹´é•¿æœŸåˆ†æˆï¼š$250 Ã— 12 = **$3,000/å¹´**
- Agent A æ€»æ”¶ç›Šï¼ˆç¬¬ä¸€å¹´ï¼‰ï¼š$700 + $3,000 = **$3,700**

**é•¿æœŸä»·å€¼**ï¼š
- å¦‚æœå•†æˆ· B æŒç»­è¿è¥ 5 å¹´ï¼ŒAgent A ç´¯è®¡è·å¾—ï¼š$700 + $3,000 Ã— 5 = **$15,700**

---

### 3.2 æ¨å¹¿ Agent èµ„æ ¼

#### 3.2.1 è°å¯ä»¥æˆä¸ºæ¨å¹¿ Agentï¼Ÿ

- âœ… ä»»ä½•æ¥å…¥ PayMind SDK çš„ Agent
- âœ… ä»»ä½•åœ¨ Marketplace ä¸Šæ¶çš„ Agent
- âœ… ä»»ä½• PayMind ç”¨æˆ·ï¼ˆé€šè¿‡å¿«é€Ÿç”Ÿæˆ Agent åŠŸèƒ½ï¼‰

#### 3.2.2 æ¨å¹¿æµç¨‹

1. **è¯†åˆ«æ½œåœ¨å•†æˆ·**
   - Agent é€šè¿‡å¯¹è¯è¯†åˆ«ç”¨æˆ·æœ‰å•†æˆ·éœ€æ±‚
   - Agent ä¸»åŠ¨æ¨è PayMind å•†æˆ·æœåŠ¡

2. **å¼•å¯¼å•†æˆ·æ³¨å†Œ**
   - Agent æä¾›æ³¨å†Œé“¾æ¥
   - Agent å¸®åŠ©å•†æˆ·å¡«å†™ä¿¡æ¯

3. **å¸®åŠ©å•†æˆ·å®Œæˆå…¥é©»**
   - Agent å¼•å¯¼å•†æˆ·å®Œæˆå…¥é©»æµç¨‹
   - Agent å¸®åŠ©å•†æˆ·ä¸Šæ¶å•†å“

4. **å•†æˆ·å®Œæˆé¦–æ¬¡äº¤æ˜“**
   - Agent å¸®åŠ©å•†æˆ·å®Œæˆé¦–æ¬¡äº¤æ˜“
   - ç³»ç»Ÿè‡ªåŠ¨å‘æ”¾å¥–åŠ±

5. **è·å¾—é•¿æœŸåˆ†æˆ**
   - ç³»ç»Ÿè‡ªåŠ¨è·Ÿè¸ªå•†æˆ·äº¤æ˜“
   - æ¯å‘¨ç»“ç®—é•¿æœŸåˆ†æˆ

---

### 3.3 æ¨å¹¿åˆ†æˆè®¡ç®—é€»è¾‘

#### 3.3.1 æ¨å¹¿å…³ç³»è®°å½•

**æ•°æ®åº“è¡¨ï¼š`merchant_referrals`**
```sql
CREATE TABLE merchant_referrals (
  id UUID PRIMARY KEY,
  merchant_id UUID NOT NULL,
  referral_agent_id UUID NOT NULL,
  referral_type VARCHAR, -- 'agent' | 'user'
  registered_at TIMESTAMP,
  first_transaction_at TIMESTAMP,
  one_time_reward_paid BOOLEAN DEFAULT FALSE,
  one_time_reward_amount DECIMAL,
  long_term_commission_rate DECIMAL DEFAULT 0.005, -- 0.5%
  status VARCHAR, -- 'pending' | 'active' | 'inactive'
  created_at TIMESTAMP,
  updated_at TIMESTAMP
);
```

#### 3.3.2 åˆ†æˆè®¡ç®—æœåŠ¡

**`ReferralCommissionService`**ï¼š
```typescript
// è®¡ç®—æ¨å¹¿ Agent çš„é•¿æœŸåˆ†æˆ
async calculateReferralCommission(
  merchantId: string,
  transactionAmount: number,
): Promise<number> {
  const referral = await this.getActiveReferral(merchantId);
  if (!referral) return 0;
  
  return transactionAmount * referral.long_term_commission_rate;
}

// æ¯å‘¨ç»“ç®—æ¨å¹¿åˆ†æˆ
async settleReferralCommissions(weekStart: Date, weekEnd: Date) {
  const referrals = await this.getActiveReferrals();
  
  for (const referral of referrals) {
    const transactions = await this.getMerchantTransactions(
      referral.merchantId,
      weekStart,
      weekEnd,
    );
    
    const totalAmount = transactions.reduce((sum, t) => sum + t.amount, 0);
    const commission = totalAmount * referral.long_term_commission_rate;
    
    if (commission > 0) {
      await this.createCommissionRecord({
        payeeId: referral.referral_agent_id,
        payeeType: 'referral_agent',
        amount: commission,
        currency: 'USDC',
        period: { weekStart, weekEnd },
      });
    }
  }
}
```

---

## 4. Agent åä½œåˆ†æˆæœºåˆ¶

### 4.1 å¤š Agent åä½œåœºæ™¯

#### åœºæ™¯ 1ï¼šæ¨èé“¾ï¼ˆReferral Chainï¼‰

**æµç¨‹**ï¼š
1. Agent A æ¨èå•†æˆ·
2. Agent B æ¨èå•†å“
3. Agent C æ‰§è¡Œäº¤æ˜“

**åˆ†æˆåˆ†é…**ï¼š
- Agent Aï¼ˆæ¨èå•†æˆ·ï¼‰ï¼šå•†æˆ·äº¤æ˜“é¢çš„ 0.5%ï¼ˆé•¿æœŸåˆ†æˆï¼‰
- Agent Bï¼ˆæ¨èå•†å“ï¼‰ï¼šå•†å“ä½£é‡‘ç‡ Ã— 30%
- Agent Cï¼ˆæ‰§è¡Œäº¤æ˜“ï¼‰ï¼šå•†å“ä½£é‡‘ç‡ Ã— 70% æˆ– Agent åŸºç¡€åˆ†æˆï¼ˆå–è¾ƒå¤§å€¼ï¼‰
- PayMindï¼šå¹³å°æ‰‹ç»­è´¹

**ç¤ºä¾‹**ï¼š
- äº¤æ˜“é‡‘é¢ï¼š$1000
- å•†å“ä½£é‡‘ç‡ï¼š10%
- Agent A åˆ†æˆï¼š$1000 Ã— 0.5% = **$5**ï¼ˆé•¿æœŸåˆ†æˆï¼‰
- Agent B åˆ†æˆï¼š$1000 Ã— 10% Ã— 30% = **$30**
- Agent C åˆ†æˆï¼š$1000 Ã— 10% Ã— 70% = **$70**
- PayMind åˆ†æˆï¼š$1000 Ã— 1% = **$10**
- å•†æˆ·æ”¶å…¥ï¼š$1000 - $100 - $10 = **$890**

#### åœºæ™¯ 2ï¼šAgent åä½œæ‰§è¡Œ

**æµç¨‹**ï¼š
1. Agent A æœç´¢å’Œæ¯”ä»·
2. Agent B ä¸‹å•å’Œæ”¯ä»˜
3. Agent C è·Ÿè¸ªç‰©æµ

**åˆ†æˆåˆ†é…**ï¼š
- Agent Aï¼šAgent åŸºç¡€åˆ†æˆ Ã— 30%
- Agent Bï¼šAgent åŸºç¡€åˆ†æˆ Ã— 50%
- Agent Cï¼šAgent åŸºç¡€åˆ†æˆ Ã— 20%

---

## 5. åˆ†æˆç»“ç®—æœºåˆ¶

### 5.1 ç»“ç®—å‘¨æœŸ

| åˆ†æˆç±»å‹ | ç»“ç®—å‘¨æœŸ | è¯´æ˜ |
|---------|---------|------|
| **äº¤æ˜“åˆ†æˆï¼ˆæ‰§è¡Œ Agentï¼‰** | T+1 | äº¤æ˜“å®Œæˆå 1 å¤© |
| **å•†å“æ¨èåˆ†æˆ** | T+1 | äº¤æ˜“å®Œæˆå 1 å¤© |
| **å•†æˆ·æ¨å¹¿é•¿æœŸåˆ†æˆ** | T+7 | æ¯å‘¨ç»“ç®—ä¸€æ¬¡ |
| **ä¸€æ¬¡æ€§å¥–åŠ±** | ç«‹å³ | å•†æˆ·å®Œæˆé¦–æ¬¡äº¤æ˜“åç«‹å³ç»“ç®— |
| **å¹³å°æ‰‹ç»­è´¹** | T+1 | äº¤æ˜“å®Œæˆå 1 å¤© |

### 5.2 ç»“ç®—æ–¹å¼

#### 5.2.1 æ•°å­—è´§å¸ç»“ç®—ï¼ˆä¼˜å…ˆï¼‰

- **å¸ç§**ï¼šUSDC/USDT
- **é“¾**ï¼šEthereumã€Solanaã€BSCã€Polygonã€Base
- **æ–¹å¼**ï¼šæ™ºèƒ½åˆçº¦è‡ªåŠ¨ç»“ç®—

#### 5.2.2 æ³•å¸ç»“ç®—ï¼ˆå¯é€‰ï¼‰

- **æ–¹å¼**ï¼šé€šè¿‡ Provider è½¬æ¢ä¸ºæ³•å¸
- **æ‰‹ç»­è´¹**ï¼šProvider æ‰‹ç»­è´¹ï¼ˆçº¦ 1-2%ï¼‰
- **å‘¨æœŸ**ï¼šT+3ï¼ˆè½¬æ¢éœ€è¦æ—¶é—´ï¼‰

### 5.3 ç»“ç®—æµç¨‹

```
äº¤æ˜“å®Œæˆ
  â†“
è®°å½•åˆ†æˆï¼ˆCommission Recordï¼‰
  â†“
ç­‰å¾…ç»“ç®—æ¡ä»¶æ»¡è¶³
  â†“
åˆ›å»ºç»“ç®—ï¼ˆSettlementï¼‰
  â†“
æ‰§è¡Œç»“ç®—ï¼ˆæ™ºèƒ½åˆçº¦ï¼‰
  â†“
æ›´æ–°çŠ¶æ€ï¼ˆSettledï¼‰
```

---

## 6. é£è½®æ•ˆåº”è®¾è®¡

### 6.1 é£è½®æ¨¡å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PayMind ç”Ÿæ€é£è½®ï¼ˆåˆ†æˆé©±åŠ¨ï¼‰              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â‘  ç”¨æˆ·çœ‹åˆ° Auto-Earn æ”¶ç›Š
   â†“
â‘¡ æ›´å¤šç”¨æˆ·ä½¿ç”¨ PayMind Agent
   â†“
â‘¢ æ›´å¤šäº¤æ˜“ â†’ æ›´å¤š GMV â†’ æ›´å¤šåˆ†æˆ
   â†“
â‘£ Agent å¼€å‘è€…çœ‹åˆ°æ”¶ç›Šæœºä¼š
   â†“
â‘¤ æ›´å¤š Agent å¼€å‘è€…åŠ å…¥
   â†“
â‘¥ æ›´å¤š Agent ä¸Šæ¶ â†’ æ›´å¤šåŠŸèƒ½
   â†“
â‘¦ æ¨å¹¿ Agent çœ‹åˆ°åˆ†æˆæœºä¼š
   â†“
â‘§ æ›´å¤šæ¨å¹¿ Agent æ‰¾å•†æˆ·
   â†“
â‘¨ æ›´å¤šå•†æˆ·æ¥å…¥ â†’ æ›´å¤šå•†å“
   â†“
â‘© æ›´å¤šäº¤æ˜“ â†’ æ›´å¤šåˆ†æˆ
   â†“
   å›åˆ° â‘ ï¼ˆé£è½®åŠ é€Ÿï¼‰
```

### 6.2 å…³é”®é£è½®èŠ‚ç‚¹

#### èŠ‚ç‚¹ 1ï¼šAuto-Earn æ”¶ç›Šå±•ç¤º
- **ç›®æ ‡**ï¼šè®©ç”¨æˆ·çœ‹åˆ°å®é™…æ”¶ç›Š
- **å®ç°**ï¼šAuto-Earn é¢æ¿æ˜¾ç¤ºæ”¶ç›Š
- **æ•ˆæœ**ï¼šæ›´å¤šç”¨æˆ· â†’ æ›´å¤šä½¿ç”¨

#### èŠ‚ç‚¹ 2ï¼šAgent æ”¶ç›Šå±•ç¤º
- **ç›®æ ‡**ï¼šè®© Agent å¼€å‘è€…çœ‹åˆ°æ”¶ç›Š
- **å®ç°**ï¼šAgent åå°æ˜¾ç¤ºæ”¶ç›Šç»Ÿè®¡
- **æ•ˆæœ**ï¼šæ›´å¤š Agent å¼€å‘è€… â†’ æ›´å¤š Agent

#### èŠ‚ç‚¹ 3ï¼šæ¨å¹¿åˆ†æˆå±•ç¤º
- **ç›®æ ‡**ï¼šè®©æ¨å¹¿ Agent çœ‹åˆ°åˆ†æˆæœºä¼š
- **å®ç°**ï¼šæ¨å¹¿é¢æ¿æ˜¾ç¤ºåˆ†æˆç»Ÿè®¡
- **æ•ˆæœ**ï¼šæ›´å¤šæ¨å¹¿ Agent â†’ æ›´å¤šå•†æˆ·

#### èŠ‚ç‚¹ 4ï¼šå•†æˆ· GMV å±•ç¤º
- **ç›®æ ‡**ï¼šè®©å•†æˆ·çœ‹åˆ°é”€å”®å¢é•¿
- **å®ç°**ï¼šå•†æˆ·åå°æ˜¾ç¤º GMV å’Œè®¢å•
- **æ•ˆæœ**ï¼šæ›´å¤šå•†æˆ· â†’ æ›´å¤šå•†å“

---

## 7. åˆ†æˆæœºåˆ¶å®ç°è¦ç‚¹

### 7.1 æ•°æ®åº“è®¾è®¡

#### 7.1.1 æ¨å¹¿å…³ç³»è¡¨

```sql
CREATE TABLE merchant_referrals (
  id UUID PRIMARY KEY,
  merchant_id UUID NOT NULL,
  referral_agent_id UUID NOT NULL,
  referral_type VARCHAR, -- 'agent' | 'user'
  registered_at TIMESTAMP,
  first_transaction_at TIMESTAMP,
  one_time_reward_paid BOOLEAN DEFAULT FALSE,
  one_time_reward_amount DECIMAL,
  long_term_commission_rate DECIMAL DEFAULT 0.005,
  status VARCHAR,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
);
```

#### 7.1.2 æ¨å¹¿åˆ†æˆè®°å½•è¡¨

```sql
CREATE TABLE referral_commissions (
  id UUID PRIMARY KEY,
  referral_id UUID NOT NULL,
  merchant_id UUID NOT NULL,
  referral_agent_id UUID NOT NULL,
  transaction_id UUID,
  amount DECIMAL,
  currency VARCHAR,
  period_start TIMESTAMP,
  period_end TIMESTAMP,
  status VARCHAR, -- 'pending' | 'settled'
  settled_at TIMESTAMP,
  created_at TIMESTAMP
);
```

### 7.2 åç«¯æœåŠ¡è®¾è®¡

#### 7.2.1 ReferralService

```typescript
@Injectable()
export class ReferralService {
  // è®°å½•å•†æˆ·æ¨å¹¿å…³ç³»
  async createMerchantReferral(
    merchantId: string,
    referralAgentId: string,
    referralType: 'agent' | 'user',
  ): Promise<MerchantReferral> {
    // åˆ›å»ºæ¨å¹¿å…³ç³»è®°å½•
  }

  // æ£€æŸ¥å•†æˆ·é¦–æ¬¡äº¤æ˜“
  async checkFirstTransaction(merchantId: string): Promise<void> {
    // æ£€æŸ¥æ˜¯å¦é¦–æ¬¡äº¤æ˜“
    // å¦‚æœæ˜¯ï¼Œå‘æ”¾ä¸€æ¬¡æ€§å¥–åŠ±
  }

  // è®¡ç®—æ¨å¹¿ Agent çš„é•¿æœŸåˆ†æˆ
  async calculateReferralCommission(
    merchantId: string,
    transactionAmount: number,
  ): Promise<number> {
    // è®¡ç®—é•¿æœŸåˆ†æˆ
  }
}
```

#### 7.2.2 ReferralCommissionService

```typescript
@Injectable()
export class ReferralCommissionService {
  // æ¯å‘¨ç»“ç®—æ¨å¹¿åˆ†æˆ
  @Cron('0 0 * * 1') // æ¯å‘¨ä¸€æ‰§è¡Œ
  async settleWeeklyReferralCommissions() {
    // ç»“ç®—æ‰€æœ‰æ¨å¹¿ Agent çš„é•¿æœŸåˆ†æˆ
  }

  // å‘æ”¾ä¸€æ¬¡æ€§å¥–åŠ±
  async payOneTimeReward(referralId: string): Promise<void> {
    // å‘æ”¾ä¸€æ¬¡æ€§å¥–åŠ±
  }
}
```

---

## 8. æ€»ç»“

### 8.1 æ ¸å¿ƒåˆ›æ–°

1. **æ¨å¹¿ Agent é•¿æœŸåˆ†æˆ**ï¼šè®© Agent ä¸»åŠ¨æ‰¾å•†æˆ·ï¼Œè·å¾—æ°¸ä¹…æ”¶ç›Š
2. **å¤š Agent åä½œåˆ†æˆ**ï¼šé¼“åŠ± Agent åä½œï¼Œå½¢æˆç½‘ç»œæ•ˆåº”
3. **é€æ˜å…¬å¹³çš„åˆ†æˆè§„åˆ™**ï¼šæ‰€æœ‰è§„åˆ™å…¬å¼€é€æ˜ï¼Œå»ºç«‹ä¿¡ä»»

### 8.2 é£è½®æ•ˆåº”

é€šè¿‡åˆ†æˆæœºåˆ¶ï¼ŒPayMind å°†å½¢æˆå¼ºå¤§çš„é£è½®æ•ˆåº”ï¼š
- æ›´å¤šç”¨æˆ· â†’ æ›´å¤š Agent â†’ æ›´å¤šå•†æˆ· â†’ æ›´å¤šäº¤æ˜“ â†’ æ›´å¤šåˆ†æˆ â†’ æ›´å¤šç”¨æˆ·

### 8.3 è½åœ°å¯è¡Œæ€§

æ‰€æœ‰æœºåˆ¶éƒ½åŸºäºç°æœ‰æŠ€æœ¯æ ˆï¼Œå¯ä»¥å¿«é€Ÿå®ç°ï¼š
- åˆ†æˆè®¡ç®—ï¼šåŸºäºç°æœ‰çš„ `CommissionCalculatorService`
- æ¨å¹¿ç³»ç»Ÿï¼šæ–°å¢ `ReferralService` å’Œ `ReferralCommissionService`
- ç»“ç®—ç³»ç»Ÿï¼šåŸºäºç°æœ‰çš„ç»“ç®—ç³»ç»Ÿ

---

**ä¸‹ä¸€æ­¥**ï¼šæ ¹æ®æ­¤æ–‡æ¡£å®ç°æ¨å¹¿åˆ†æˆç³»ç»Ÿå’Œ Agent å¿«é€Ÿç”ŸæˆåŠŸèƒ½ã€‚

