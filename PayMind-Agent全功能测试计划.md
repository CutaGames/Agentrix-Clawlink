# PayMind Agent 全功能测试计划

**生成日期**: 2025-01-21  
**测试范围**: 用户Agent、商家Agent、开发者Agent所有功能

---

## 📋 测试前检查清单

### ✅ 前端界面检查

| 功能 | 组件位置 | 状态 | 备注 |
|------|---------|------|------|
| 沙盒调试 | `Sandbox.tsx` | ✅ 已存在 | 需要验证API连接 |
| 代码生成 | `CodeGenerator.tsx` | ✅ 已存在 | 需要验证API连接 |
| 营销助手 | `MerchantAgentApp.tsx` | ✅ 已存在 | 需要验证功能完整 |
| DevOps | `AgentSidebar.tsx` | ✅ 已存在 | 需要验证功能完整 |
| 合约助手 | `AgentSidebar.tsx` | ✅ 已存在 | 需要验证功能完整 |
| 工单与日志 | `AgentSidebar.tsx` | ✅ 已存在 | 需要验证功能完整 |

### ✅ 后端API检查

| 功能 | 处理函数 | API端点 | 状态 | 备注 |
|------|---------|---------|------|------|
| 沙盒调试 | `handleSandbox` | `/agent/chat` (P0) | ✅ 完成 | 通过语义识别 |
| DevOps | `handleDevOps` | `/agent/chat` (P0) | ✅ 完成 | 通过语义识别 |
| 合约助手 | `handleContractHelper` | `/agent/chat` (P0) | ✅ 完成 | 通过语义识别 |
| 工单与日志 | `handleTicketsAndLogs` | `/agent/chat` (P0) | ✅ 完成 | 通过语义识别 |
| 代码生成 | `handleCodeGeneration` | `/agent/chat` (P0)<br>`/agent/generate-code` | ✅ 完成 | 双重支持 |
| 营销助手 | `handleMarketing` | `/agent/chat` (P0) | ✅ 完成 | 通过语义识别 |
| 沙盒执行 | `SandboxService.execute` | `/sandbox/execute` | ✅ 完成 | 独立API |

### ⚠️ SDK检查

| 功能 | SDK方法 | 状态 | 备注 |
|------|---------|------|------|
| 语义搜索 | `marketplace.searchProducts` | ✅ 完成 | 已实现 |
| 商品管理 | `merchants.createProduct` | ✅ 完成 | 已实现 |
| 订单管理 | `agents.createOrder` | ✅ 完成 | 已实现 |
| 沙盒调试 | - | ⚠️ 待补充 | 建议添加 |
| 代码生成 | - | ⚠️ 待补充 | 建议添加 |

---

## 🧪 全功能测试用例

### 一、用户Agent功能测试

#### 1.1 支付相关功能

**测试用例 1.1.1: 费用估算**
```
输入: "估算一下100美元的手续费"
预期: 返回费用估算结果，包含不同支付方式的费用对比
验证点:
- ✅ 语义识别正确
- ✅ 返回结构化数据
- ✅ 费用计算准确
```

**测试用例 1.1.2: 风险评估**
```
输入: "评估这笔500美元交易的风险"
预期: 返回风险评估结果，包含风险等级和建议
验证点:
- ✅ 语义识别正确
- ✅ 返回风险评估数据
- ✅ 风险等级合理
```

**测试用例 1.1.3: KYC状态查询**
```
输入: "我的KYC状态"
预期: 返回KYC认证状态和详细信息
验证点:
- ✅ 语义识别正确
- ✅ 返回KYC状态
- ✅ 信息准确
```

#### 1.2 电商功能

**测试用例 1.2.1: 商品搜索（语义检索）**
```
输入: "帮我找iPhone 15"
预期: 返回相关商品列表，包含价格、库存等信息
验证点:
- ✅ 语义识别正确
- ✅ 返回商品列表
- ✅ 搜索结果相关度高
- ✅ 包含价格、库存等关键信息
```

**测试用例 1.2.2: 比价**
```
输入: "比价一下这个商品"
预期: 返回价格对比报告，显示不同商家的价格
验证点:
- ✅ 语义识别正确
- ✅ 返回比价数据
- ✅ 价格信息准确
```

**测试用例 1.2.3: 加入购物车**
```
输入: "把这个商品加入购物车"
预期: 商品成功加入购物车，返回确认信息
验证点:
- ✅ 语义识别正确
- ✅ 商品ID提取正确
- ✅ 购物车更新成功
- ✅ 返回确认信息
```

**测试用例 1.2.4: 查看购物车**
```
输入: "查看购物车"
预期: 返回购物车内容，包含商品列表和总价
验证点:
- ✅ 语义识别正确
- ✅ 返回购物车内容
- ✅ 商品信息完整
- ✅ 总价计算正确
```

**测试用例 1.2.5: 下单**
```
输入: "下单购买这个商品"
预期: 创建订单并返回订单信息
验证点:
- ✅ 语义识别正确
- ✅ 订单创建成功
- ✅ 返回订单ID和详情
- ✅ 触发支付流程
```

**测试用例 1.2.6: 查看订单**
```
输入: "查看我的订单"
预期: 返回订单列表，包含订单状态、商品信息等
验证点:
- ✅ 语义识别正确
- ✅ 返回订单列表
- ✅ 订单信息完整
- ✅ 状态正确
```

**测试用例 1.2.7: 物流跟踪**
```
输入: "查询订单123的物流信息"
预期: 返回物流跟踪信息，包含物流状态和时间线
验证点:
- ✅ 语义识别正确
- ✅ 订单ID提取正确
- ✅ 返回物流信息
- ✅ 时间线完整
```

#### 1.3 个人管理功能

**测试用例 1.3.1: 账单助手**
```
输入: "帮我分析一下这个月的账单"
预期: 返回账单分析结果，包含支出分类、趋势等
验证点:
- ✅ 语义识别正确
- ✅ 返回账单分析
- ✅ 数据准确
```

**测试用例 1.3.2: 钱包管理**
```
输入: "查看我的钱包余额"
预期: 返回钱包列表和余额信息
验证点:
- ✅ 语义识别正确
- ✅ 返回钱包信息
- ✅ 余额准确
```

**测试用例 1.3.3: 自动购买优化**
```
输入: "优化我的自动购买设置"
预期: 返回订阅优化建议和节省金额
验证点:
- ✅ 语义识别正确
- ✅ 返回优化建议
- ✅ 建议合理
```

---

### 二、商家Agent功能测试

#### 2.1 商品管理

**测试用例 2.1.1: 注册商户**
```
输入: "我要注册成为商家"
预期: 用户角色更新为merchant，返回确认信息
验证点:
- ✅ 语义识别正确
- ✅ 角色更新成功
- ✅ 返回确认信息
```

**测试用例 2.1.2: 上传商品（实物）**
```
输入: "上传商品：iPhone 15，价格5999元，库存100件"
预期: 商品创建成功，返回商品ID和详情
验证点:
- ✅ 语义识别正确
- ✅ 商品信息提取完整
- ✅ 商品创建成功
- ✅ 商品已索引到搜索系统
```

**测试用例 2.1.3: 上传商品（服务）**
```
输入: "上传服务：在线咨询，价格200元/小时"
预期: 服务类商品创建成功
验证点:
- ✅ 语义识别正确
- ✅ 商品类型识别为service
- ✅ 商品创建成功
```

**测试用例 2.1.4: 上传商品（链上资产）**
```
输入: "上传NFT：数字艺术品，价格0.5 ETH"
预期: NFT商品创建成功
验证点:
- ✅ 语义识别正确
- ✅ 商品类型识别为nft
- ✅ 商品创建成功
```

#### 2.2 订单管理

**测试用例 2.2.1: 查看订单**
```
输入: "查看我的订单"
预期: 返回商家订单列表，包含订单状态、商品信息等
验证点:
- ✅ 语义识别正确
- ✅ 返回订单列表
- ✅ 只显示该商家的订单
- ✅ 订单信息完整
```

**测试用例 2.2.2: 发货**
```
输入: "发货订单123，物流单号SF123456789"
预期: 订单状态更新为已发货，物流信息创建成功
验证点:
- ✅ 语义识别正确
- ✅ 订单ID和物流单号提取正确
- ✅ 订单状态更新成功
- ✅ 物流信息创建成功
- ✅ 用户收到通知
```

#### 2.3 营销功能

**测试用例 2.3.1: 创建优惠券**
```
输入: "创建一张50元的优惠券"
预期: 优惠券创建成功，返回优惠券信息
验证点:
- ✅ 语义识别正确
- ✅ 金额提取正确
- ✅ 优惠券创建成功（如果已实现）
- ⚠️ 或返回开发中提示
```

**测试用例 2.3.2: 营销分析**
```
输入: "分析一下营销数据"
预期: 返回营销数据分析报告
验证点:
- ✅ 语义识别正确
- ✅ 返回分析数据（如果已实现）
- ⚠️ 或返回开发中提示
```

#### 2.4 收款与分析

**测试用例 2.4.1: 收款管理**
```
输入: "生成一个100元的支付链接"
预期: 支付链接生成成功，返回链接和二维码
验证点:
- ✅ 语义识别正确
- ✅ 金额提取正确
- ✅ 支付链接生成成功
- ✅ 返回链接和二维码
```

**测试用例 2.4.2: 订单分析**
```
输入: "分析一下订单数据"
预期: 返回订单分析报告，包含销售额、转化率等
验证点:
- ✅ 语义识别正确
- ✅ 返回分析数据
- ✅ 数据准确
```

**测试用例 2.4.3: 对账**
```
输入: "对账2025-01-20"
预期: 返回对账结果，包含匹配和差异
验证点:
- ✅ 语义识别正确
- ✅ 日期提取正确
- ✅ 返回对账结果
- ✅ 数据准确
```

---

### 三、开发者Agent功能测试

#### 3.1 SDK与API

**测试用例 3.1.1: SDK生成器**
```
输入: "生成TypeScript SDK"
预期: 返回TypeScript SDK代码示例
验证点:
- ✅ 语义识别正确
- ✅ 语言识别正确
- ✅ 返回SDK代码
- ✅ 代码格式正确
```

**测试用例 3.1.2: API助手**
```
输入: "生成API调用代码"
预期: 返回API调用代码示例
验证点:
- ✅ 语义识别正确
- ✅ 返回代码示例
- ✅ 代码可用
```

**测试用例 3.1.3: 代码生成**
```
输入: "生成支付代码"
预期: 返回支付相关代码示例
验证点:
- ✅ 语义识别正确
- ✅ 代码类型识别正确
- ✅ 返回代码示例
- ✅ 代码格式正确
```

#### 3.2 开发工具

**测试用例 3.2.1: 沙盒调试**
```
输入: "测试这段代码：const client = new PayMind({ apiKey: 'test' });"
预期: 代码在沙盒中执行，返回执行结果
验证点:
- ✅ 语义识别正确
- ✅ 代码提取正确
- ✅ 沙盒执行成功
- ✅ 返回执行结果
- ✅ 前端Sandbox组件显示结果
```

**测试用例 3.2.2: DevOps自动化**
```
输入: "配置DevOps自动化"
预期: 返回DevOps配置指南或功能说明
验证点:
- ✅ 语义识别正确
- ✅ 返回配置信息
- ✅ 信息完整
```

**测试用例 3.2.3: 合约助手 - 生成模板**
```
输入: "生成合约模板"
预期: 返回智能合约模板代码
验证点:
- ✅ 语义识别正确
- ✅ 返回合约模板
- ✅ 模板格式正确
```

**测试用例 3.2.4: 合约助手 - Gas估算**
```
输入: "估算Ethereum链的Gas费用"
预期: 返回Gas费用估算，包含不同交易类型的费用
验证点:
- ✅ 语义识别正确
- ✅ 链类型识别正确
- ✅ 返回Gas估算
- ✅ 费用合理
```

**测试用例 3.2.5: 工单与日志**
```
输入: "查看工单列表"
预期: 返回工单列表，包含工单状态、描述等
验证点:
- ✅ 语义识别正确
- ✅ 返回工单列表
- ✅ 信息完整
```

**测试用例 3.2.6: Webhook配置**
```
输入: "配置Webhook"
预期: 返回Webhook配置指南或配置界面
验证点:
- ✅ 语义识别正确
- ✅ 返回配置信息
- ✅ 信息完整
```

---

## 🔍 集成测试

### 测试场景 1: 完整电商流程

**步骤**:
1. 商家注册 → "我要注册成为商家"
2. 商家上传商品 → "上传商品：iPhone 15，价格5999元"
3. 用户搜索商品 → "帮我找iPhone"
4. 用户比价 → "比价一下这个商品"
5. 用户加入购物车 → "加入购物车"
6. 用户下单 → "下单购买"
7. 用户支付 → 自动触发支付流程
8. 商家查看订单 → "查看我的订单"
9. 商家发货 → "发货订单XXX，物流单号SF123456"
10. 用户查看物流 → "查询订单XXX的物流信息"

**验证点**:
- ✅ 每个步骤的语义识别正确
- ✅ 数据流转正确
- ✅ 状态更新及时
- ✅ 通知推送成功

### 测试场景 2: 开发者工作流

**步骤**:
1. 生成SDK → "生成TypeScript SDK"
2. 生成API代码 → "生成API调用代码"
3. 沙盒测试 → "测试这段代码：..."
4. 查看工单 → "查看工单列表"
5. 配置Webhook → "配置Webhook"

**验证点**:
- ✅ 每个步骤的语义识别正确
- ✅ 代码生成可用
- ✅ 沙盒执行成功
- ✅ 信息展示完整

---

## 📊 测试结果记录表

| 测试用例ID | 功能 | 输入 | 预期结果 | 实际结果 | 状态 | 备注 |
|-----------|------|------|---------|---------|------|------|
| 1.1.1 | 费用估算 | "估算100美元手续费" | 返回费用估算 | | ⏳ 待测试 | |
| 1.2.1 | 商品搜索 | "帮我找iPhone" | 返回商品列表 | | ⏳ 待测试 | |
| 2.1.1 | 注册商户 | "我要注册成为商家" | 角色更新成功 | | ⏳ 待测试 | |
| 3.2.1 | 沙盒调试 | "测试代码" | 执行成功 | | ⏳ 待测试 | |

---

## 🚀 测试执行建议

### 阶段1: 基础功能测试（优先级：P0）
- ✅ 所有语义识别功能
- ✅ 核心电商流程（搜索、下单、支付）
- ✅ 商家商品管理
- ✅ 订单和物流跟踪

### 阶段2: 高级功能测试（优先级：P1）
- ✅ 开发者工具（SDK、API、沙盒）
- ✅ 营销功能
- ✅ 合约助手
- ✅ 工单与日志

### 阶段3: 集成测试（优先级：P2）
- ✅ 完整业务流程
- ✅ 跨功能协作
- ✅ 错误处理
- ✅ 性能测试

---

## 📝 测试环境准备

1. **前端环境**:
   - 访问 `http://localhost:3000/agent-enhanced`
   - 确保已登录（用户/商家/开发者角色）

2. **后端环境**:
   - 确保后端服务运行在 `http://localhost:3001`
   - 数据库连接正常
   - 第三方API配置（如物流API）已设置

3. **测试数据**:
   - 准备测试用户账号
   - 准备测试商品数据
   - 准备测试订单数据

### ✅ 已完成的测试数据播种

- 运行脚本：`cd backend && npx ts-node -r tsconfig-paths/register scripts/seed-test-data.ts`
- 账号统一密码：`Test@123`

| 角色 | 账号 | PayMind ID | 说明 |
|------|------|------------|------|
| 个人用户 | `personal.tester@paymind.com` | `pm-user-tester` | 用于语义搜索 / 购物车 / 订单 / 支付 / 物流全链路 |
| 商家用户 | `merchant.tester@paymind.com` | `pm-merchant-tester` | 拥有 `user + merchant` 角色，可用于商品管理/营销/清结算等 |
| 开发者用户 | `developer.tester@paymind.com` | `pm-developer-tester` | 拥有 `user + agent` 角色，用于 SDK / API / 沙盒 / DevOps |

已自动上架的商品（均在 `merchant.tester@paymind.com` 名下）：
- **跨境智能POS套件**（实物，CNY）
- **Web3 结算智能合约顾问**（服务，USD）
- **Metaverse 店面访问NFT**（链上资产，ETH）

自动生成的订单：
- 个人用户已针对以上三种商品各下单一次，覆盖实物/服务/NFT 全流程，方便语义搜索、订单、物流等测试。

---

## ✅ 测试完成标准

- [ ] 所有P0功能测试通过
- [ ] 所有P1功能测试通过
- [ ] 集成测试通过
- [ ] 无严重bug
- [ ] 性能满足要求
- [ ] 用户体验良好

---

## 🔧 问题跟踪

如发现问题，请记录：
1. 问题描述
2. 复现步骤
3. 预期行为
4. 实际行为
5. 截图/日志
6. 优先级

---

**测试负责人**: _______________  
**测试日期**: _______________  
**测试结果**: _______________

