# PayMind Agent Builder 和插件完整测试计划

**测试日期**: 2025-01-21  
**版本**: V2.5.0  
**测试范围**: Agent Builder 全功能 + 插件市场

---

## 📋 测试概述

本测试计划覆盖 Agent Builder 的所有功能模块，包括：
- 模板选择和配置
- 能力装配（表单模式 + 高级工作流模式）
- 规则模板系统
- SaaS 部署和 Docker 导出
- 插件市场
- 模板市场和付费订阅

---

## 🎯 测试环境准备

### 1. 数据库准备

```bash
# 运行测试数据脚本
cd backend
npm run seed:test-data
```

**测试账号**:
- 个人用户: `personal.tester@paymind.com` / `Test@123`
- 商家用户: `merchant.tester@paymind.com` / `Test@123`
- 开发者用户: `developer.tester@paymind.com` / `Test@123`

### 2. 前端启动

```bash
cd paymindfrontend
npm run dev
```

**访问地址**: `http://localhost:3000`

### 3. 后端启动

```bash
cd backend
npm run start:dev
```

**API 地址**: `http://localhost:3001`

---

## 🧪 测试用例

### 一、Agent Builder 基础功能测试

#### TC-001: 模板库浏览和选择

**测试步骤**:
1. 访问 `http://localhost:3000/agent-builder`
2. 浏览模板库，查看不同分类的模板
3. 使用搜索功能搜索模板
4. 点击模板卡片，查看模板详情
5. 选择一个模板，进入配置流程

**预期结果**:
- ✅ 模板列表正确显示
- ✅ 分类筛选正常工作
- ✅ 搜索功能正常
- ✅ 模板详情弹窗显示正确
- ✅ 选择模板后进入配置流程

**测试入口**: `http://localhost:3000/agent-builder`

---

#### TC-002: 表单式能力装配（默认模式）

**测试步骤**:
1. 在 Agent Builder 步骤 3，确认显示"能力装配"界面
2. 查看 Core 能力（必选，已锁定）
3. 勾选/取消 Advanced 能力
4. 尝试添加自定义 OpenAPI Schema
5. 查看已选能力摘要

**预期结果**:
- ✅ Core 能力显示为必选且已勾选
- ✅ Advanced 能力可以自由勾选
- ✅ 自定义 OpenAPI Schema 输入框正常
- ✅ 已选能力摘要正确显示

**测试入口**: `http://localhost:3000/agent-builder` → 选择模板 → 步骤 3

---

#### TC-003: 高级工作流编辑器

**测试步骤**:
1. 在步骤 3，点击"切换到高级工作流编辑器"
2. 点击"+ 添加节点"，添加不同类型的节点
3. 配置节点参数
4. 点击"验证工作流"，查看验证结果
5. 点击"预览"，查看执行顺序
6. 点击"从表单模式导入能力"

**预期结果**:
- ✅ 可以切换到高级模式
- ✅ 节点添加和配置正常
- ✅ 工作流验证功能正常
- ✅ 预览功能显示执行顺序
- ✅ 从表单模式导入功能正常

**测试入口**: `http://localhost:3000/agent-builder` → 步骤 3 → 切换到高级模式

---

#### TC-004: 规则模板系统

**测试步骤**:
1. 在 Agent Builder 中集成规则模板系统（或单独测试）
2. 浏览预设规则模板
3. 选择一个规则模板并添加
4. 使用自然语言描述创建自定义规则
5. 测试规则验证功能
6. 查看已选规则列表

**预期结果**:
- ✅ 规则模板列表正确显示
- ✅ 可以添加预设规则
- ✅ 自然语言转规则功能正常
- ✅ 规则验证通过/失败提示正确
- ✅ 已选规则列表正确显示

**测试入口**: 需要在 Agent Generator 中集成，或创建独立测试页面

---

#### TC-005: SaaS 托管部署

**测试步骤**:
1. 完成 Agent 配置，进入步骤 5（预览 & 部署）
2. 选择"SaaS 托管"导出类型
3. 点击"下载导出包"或"一键部署"
4. 查看部署状态
5. 获取访问链接

**预期结果**:
- ✅ SaaS 托管选项正确显示
- ✅ 部署请求成功发送
- ✅ 部署状态正确更新（pending → deploying → active）
- ✅ 访问链接正确生成（格式：`paymind.ai/agent/xxx`）

**测试入口**: `http://localhost:3000/agent-builder` → 完成配置 → 步骤 5

---

#### TC-006: Docker 导出

**测试步骤**:
1. 在步骤 5，选择"Docker"导出类型
2. 点击"下载导出包"
3. 解压 ZIP 文件
4. 检查文件结构（Dockerfile、docker-compose.yml、agent.js 等）
5. 尝试本地构建和运行

**预期结果**:
- ✅ ZIP 包正确下载
- ✅ 文件结构完整
- ✅ Dockerfile 内容正确
- ✅ 可以成功构建 Docker 镜像

**测试入口**: `http://localhost:3000/agent-builder` → 步骤 5 → 选择 Docker

---

### 二、插件市场功能测试

#### TC-007: 插件市场浏览

**测试步骤**:
1. 访问插件市场页面
2. 浏览插件列表
3. 使用搜索功能
4. 使用分类筛选
5. 使用排序功能（最受欢迎、最高评分、最新、价格）

**预期结果**:
- ✅ 插件列表正确显示
- ✅ 搜索功能正常
- ✅ 分类筛选正常
- ✅ 排序功能正常
- ✅ 插件信息完整（名称、描述、价格、评分、下载量）

**测试入口**: 需要创建插件市场页面

---

#### TC-008: 免费插件安装

**测试步骤**:
1. 在插件市场找到一个免费插件
2. 点击"安装"按钮
3. 查看安装状态
4. 在"已安装插件"列表中查看
5. 尝试卸载插件

**预期结果**:
- ✅ 免费插件可以直接安装
- ✅ 安装成功提示正确
- ✅ 已安装插件列表正确显示
- ✅ 卸载功能正常

**测试入口**: 插件市场页面

---

#### TC-009: 付费插件购买和安装

**测试步骤**:
1. 在插件市场找到一个付费插件
2. 点击"购买"按钮
3. 完成支付流程（模拟）
4. 插件自动安装
5. 查看已安装插件

**预期结果**:
- ✅ 付费插件显示价格
- ✅ 购买流程正常
- ✅ 支付成功后自动安装
- ✅ 已安装插件列表更新

**测试入口**: 插件市场页面

---

#### TC-010: 插件版本管理

**测试步骤**:
1. 安装一个插件
2. 查看插件当前版本
3. 如果有新版本，点击"更新版本"
4. 验证版本更新成功

**预期结果**:
- ✅ 插件版本信息正确显示
- ✅ 版本更新功能正常
- ✅ 更新后版本号正确

**测试入口**: 插件市场 → 已安装插件

---

#### TC-011: 插件依赖管理

**测试步骤**:
1. 找到一个有依赖的插件
2. 尝试安装该插件（未安装依赖）
3. 查看错误提示
4. 先安装依赖插件
5. 再次安装主插件

**预期结果**:
- ✅ 依赖信息正确显示
- ✅ 未安装依赖时提示错误
- ✅ 安装依赖后可以成功安装主插件

**测试入口**: 插件市场

---

### 三、模板市场功能测试

#### TC-012: 模板评分和评论

**测试步骤**:
1. 在模板库中选择一个模板
2. 查看模板的评分和评论
3. 创建一个评论（需要先使用该模板创建 Agent）
4. 更新评论
5. 删除评论

**预期结果**:
- ✅ 模板评分正确显示
- ✅ 评论列表正确显示
- ✅ 可以创建评论
- ✅ 可以更新和删除自己的评论
- ✅ 模板平均评分自动更新

**测试入口**: 模板详情页面

---

#### TC-013: 模板付费订阅

**测试步骤**:
1. 找到一个付费模板
2. 查看模板价格和订阅信息
3. 尝试使用免费模板（应该成功）
4. 尝试使用付费模板（应该提示需要订阅）
5. 购买模板订阅（模拟）
6. 再次尝试使用付费模板（应该成功）

**预期结果**:
- ✅ 付费模板正确标识
- ✅ 免费模板可以直接使用
- ✅ 付费模板需要订阅才能使用
- ✅ 订阅购买流程正常
- ✅ 订阅后可以正常使用模板

**测试入口**: 模板库 → 模板详情

---

### 四、集成测试

#### TC-014: 完整 Agent 生成流程

**测试步骤**:
1. 选择模板
2. 配置基本信息（名称、描述）
3. 配置能力（表单模式）
4. 配置规则（可选）
5. 配置授权和支付
6. 预览代码
7. 选择导出方式（SaaS 或 Docker）
8. 完成部署

**预期结果**:
- ✅ 所有步骤正常完成
- ✅ 数据在各步骤间正确传递
- ✅ 最终 Agent 成功创建和部署
- ✅ 可以访问部署的 Agent

**测试入口**: `http://localhost:3000/agent-builder`

---

#### TC-015: 插件增强 Agent 功能

**测试步骤**:
1. 创建一个 Agent
2. 安装一个插件（如"数据分析增强"）
3. 在 Agent 配置中启用插件能力
4. 部署 Agent
5. 测试插件功能是否生效

**预期结果**:
- ✅ 插件可以安装到 Agent
- ✅ 插件能力可以在 Agent 中使用
- ✅ 部署后插件功能正常

**测试入口**: Agent Builder → 插件市场 → Agent 配置

---

## 🎨 前端测试界面

### 测试入口页面

创建统一的测试入口页面，方便快速访问各个功能模块。

**文件**: `paymindfrontend/pages/agent-builder-test.tsx`

**功能**:
- 列出所有测试场景
- 提供快速跳转链接
- 显示测试状态和结果

---

## 📊 测试数据准备

### 测试模板

运行 `backend/scripts/seed-test-data.ts` 后，将生成：
- 3 个官方模板（购物比价、商家运营、开发者 SDK）
- 每个模板包含完整配置

### 测试插件

需要创建测试插件数据（可以在 seed 脚本中添加）

---

## ✅ 测试检查清单

### 功能完整性

- [ ] 模板库浏览和选择
- [ ] 表单式能力装配
- [ ] 高级工作流编辑器
- [ ] 规则模板系统
- [ ] SaaS 托管部署
- [ ] Docker 导出
- [ ] 插件市场浏览
- [ ] 插件安装/卸载
- [ ] 插件版本管理
- [ ] 插件依赖管理
- [ ] 模板评分和评论
- [ ] 模板付费订阅

### 用户体验

- [ ] 界面响应速度
- [ ] 错误提示清晰
- [ ] 加载状态显示
- [ ] 多语言支持
- [ ] 移动端适配

### 数据一致性

- [ ] 前后端数据同步
- [ ] 状态管理正确
- [ ] 缓存更新及时

---

## 🐛 已知问题

1. **SaaS 部署**: 当前为模拟实现，需要集成真实的云平台 API
2. **支付流程**: 模板和插件购买需要集成支付服务
3. **插件执行**: 插件实际执行逻辑需要实现

---

## 📝 测试报告模板

### 测试结果记录

| 测试用例 | 状态 | 备注 |
|---------|------|------|
| TC-001 | ✅/❌ | |
| TC-002 | ✅/❌ | |
| ... | ... | |

### 问题记录

| 问题ID | 描述 | 严重程度 | 状态 |
|--------|------|---------|------|
| BUG-001 | | P0/P1/P2 | 待修复/已修复 |

---

**测试计划版本**: V1.0  
**最后更新**: 2025-01-21

