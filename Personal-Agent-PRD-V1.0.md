# Agentrix Personal Agent PRD V1.0

## 1. 产品概览 (Product Overview)

### 1.1 产品定位
Agentrix Personal Agent 是面向普通用户的“账户级智能资产助理”。它以 **Agentrix ID** 作为主身份，默认提供 **MPC 钱包**一键生成，并通过渐进式授权让用户在不理解 Web3 的情况下完成：资产查看、风险提示、空投发现与领取、收益策略推荐与执行、自动化任务管理。

### 1.2 目标与成功标准 (North Star + KPI)
*   **North Star**: 新用户在 3 分钟内完成：注册/登录 → 生成 MPC 钱包 → 进入首页并看到“可理解的价值”（空投/收益建议/资产概览）。
*   **核心 KPI (MVP)**:
    *   **激活率**: 注册后 24h 内完成“生成 MPC 钱包 + 首次进入 Agent 首页”的比例。
    *   **信任建立**: 授权中心打开率、授权设置完成率、授权撤销率。
    *   **执行效率**: 一键执行转化率（建议 → 执行）、执行成功率。
    *   **真实价值**: 净收益（收益 - gas - 手续费）、可领空投发现数、成功领取数。
    *   **风险控制**: 异常交易拦截率、用户投诉率。

### 1.3 用户画像
1.  **Web3 新手 (核心)**: 无钱包经验，对助记词恐惧，希望像 Web2 一样登录即用。
2.  **轻度 Web3 用户**: 有 MetaMask/OKX，想要更省心的策略与提醒。
3.  **进阶用户**: 希望配置策略、限额自动化、审计与可回放。

### 1.4 产品原则
*   **安全第一**: 默认“只读”开启，不自动花钱；执行必须先建立信任。
*   **可控性**: 自动化必须“限额 + 白名单 + 可撤销”，高风险动作强制二次确认。
*   **透明性**: 任何自动执行均需“可解释 + 可回放”。

---

## 2. 核心用户旅程 (User Journeys)

### 2.1 新手最短路径 (3 分钟)
1.  **登录**: 邮箱/手机号/Google/Passkey。
2.  **钱包生成**: “使用 Agentrix MPC 钱包（推荐）” → 一键生成地址 → 自动绑定 Agentrix ID。
3.  **进入首页**: 
    *   资产概览（支持充值/连接外部钱包）。
    *   空投检测（展示发现/风险/成本收益）。
    *   AutoEarn 建议（模拟展示）。
4.  **首次动作**: 引导完成一次低风险动作（如领取低风险空投）。

### 2.2 有钱包用户路径
1.  **登录** → 连接 MetaMask/OKX → 通过签名绑定到 Agentrix ID → 导入资产。
2.  **执行选择**: 可选择将 MPC 作为“执行钱包”以降低外部钱包交互复杂度。

### 2.3 渐进式自动化启用
*   **阶段 0**: 只读（默认）。
*   **阶段 1**: 一键确认执行（半自动）。
*   **阶段 2**: 限额自动执行（全自动，受 Policy 约束）。

---

## 3. 功能需求 (Functional Requirements)

### 3.1 登录与账户 (Agentrix ID)
*   **需求**: 支持邮箱/SSO/Passkey；自动创建 Agentrix ID；新设备登录风控。
*   **实现状态**: 已实现 Google OAuth 和 Web3 钱包登录。
*   **验收标准**: 登录到首页 ≤ 60 秒；新设备登录有明确提示。

### 3.2 钱包体系 (MPC + 外部钱包)
*   **需求**: 
    *   MPC 钱包一键生成（支持 EVM）。
    *   外部钱包绑定（MetaMask, OKX）。
    *   多钱包管理：展示“当前执行钱包”。
*   **实现状态**: 已支持 MetaMask/OKX 绑定；MPC 钱包生成逻辑已在后端就绪。

### 3.3 授权中心 (Policy Engine)
*   **需求**: 
    *   **授权模板**: 新手（只读）、稳健（小额限额）、进阶（高限额）。
    *   **授权维度**: 动作类型（swap/stake等）、资产范围、协议白名单、额度限制。
    *   **可视化审计**: 最近授权变更、自动执行记录、一键暂停 (Kill Switch)。
*   **实现状态**: 后端 `PolicyEngine` 已具备基础逻辑，前端需完善可视化配置界面。

### 3.4 首页与控制台 (Agent Dashboard)
*   **需求**: 
    *   资产概览：总资产（法币计价）+ 分链/分币种。
    *   收益概览：近 7/30 天收益。
    *   模块入口：空投模块、AutoEarn 模块。
    *   时间线：“发生了什么”最近执行记录。
*   **实现状态**: `UniversalAgentLayout` 框架已搭建，具体数据面板开发中。

### 3.5 空投检测 (Airdrop Discovery)
*   **需求**: 
    *   发现：基于链上活动/白名单。
    *   评分：安全评分 + 成本收益预估。
    *   领取：一键确认领取；风险提示（钓鱼/授权风险）。
*   **实现状态**: 后端 `AirdropService` 已实现基础检测逻辑。

### 3.6 AutoEarn (收益策略)
*   **需求**: 
    *   输入：风险偏好（保守/平衡/激进）。
    *   输出：策略建议（收益率、风险点、锁仓说明）。
    *   执行：一键执行（阶段 1）；自动复投（阶段 2）。
*   **实现状态**: `AutoEarnPanel` 前端组件已完成，支持策略展示和模拟执行。

### 3.7 任务与调度 (Automation Orchestrator)
*   **需求**: 
    *   触发类型：时间（每日/每周）、事件（余额变化）、条件（收益率阈值）。
    *   任务管理：启用/暂停/失败重试；任务日志回放。
*   **实现状态**: 后端 `AgentRuntime` 已支持基础任务调度。

### 3.8 通知 (Notifications)
*   **需求**: 站内通知 + 邮件；事件包括空投可领、执行成功/失败、风控拦截。
*   **实现状态**: 基础通知框架已建立。

---

## 4. 技术架构 (Technical Architecture)

### 4.1 后端模块 (`backend/src/modules/user-agent`)
*   `BudgetService`: 预算管理与超支预警。
*   `TransactionClassificationService`: 基于 Gemini AI 的账单分类。
*   `KYCReuseService`: 跨商户身份复用。
*   `SubscriptionService`: 订阅与定期支付识别。

### 4.2 前端组件 (`frontend/components/agent`)
*   `UnifiedAgentChat`: 核心对话交互入口。
*   `UniversalAgentLayout`: 统一的功能导航与侧边栏。
*   `AutoEarnPanel`: 收益策略管理面板。

---

## 5. 里程碑范围 (MVP Roadmap)

### MVP-0 (1-2 周): 整合底座
*   Agentrix ID + MPC 一键生成。
*   授权中心最小可用版（限额 + 动作白名单）。
*   执行记录模型落地。

### MVP-1 (2-4 周): 只读价值闭环
*   资产概览 + 空投发现（只提示）+ AutoEarn 建议（只模拟）。
*   站内通知系统。

### MVP-2 (4-6 周): 半自动价值闭环
*   空投一键领取（白名单协议）。
*   AutoEarn 一键执行（稳健策略）。
*   Pre-flight 模拟与风险提示。

### MVP-3 (6-8 周): 限额自动化
*   自动复投/迁移（受 Policy 约束）。
*   Kill Switch、任务调度、风控升级。
