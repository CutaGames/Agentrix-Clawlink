# PayMind 测试场景使用指南

## 📋 概述

本指南说明如何使用 PayMind 测试场景来验证统一支付流程和佣金分配机制。

## 🚀 快速开始

### 第一步：创建测试商品

为测试账户 `pm-1763463490911-91zf91wu2` 创建测试商品：

```bash
cd backend
npx ts-node scripts/create-test-products.ts
```

脚本会创建以下测试商品：

1. **📚 高级阅读服务 - QuickPay 体验**
   - 价格：0.1 USDT
   - 支付方式：QuickPay (X402)
   - 资产类型：服务
   - 用途：测试小额快速支付

2. **🎮 NFT 游戏道具 - 传奇之剑**
   - 价格：10 USDT
   - 支付方式：数字货币钱包
   - 资产类型：NFT
   - 用途：测试 NFT 商品支付和交付

3. **💳 高级会员服务 - Stripe 支付**
   - 价格：500 RMB
   - 支付方式：Stripe（模拟）
   - 资产类型：聚合 Web2
   - 用途：测试佣金分配机制

4. **🛍️ 实物商品 - 智能手表**
   - 价格：2999 RMB
   - 支付方式：钱包支付
   - 资产类型：实物
   - 用途：测试完整物流流程

5. **🎨 虚拟商品 - 数字艺术收藏**
   - 价格：50 USDT
   - 支付方式：钱包支付
   - 资产类型：虚拟
   - 用途：测试虚拟商品交付

### 第二步：访问测试场景页面

1. 打开浏览器访问：`http://localhost:3000/test-scenarios`
2. 查看所有可用的测试场景
3. 选择要测试的场景

### 第三步：测试购买流程

#### 场景 1：QuickPay 小额支付测试

1. 选择 "QuickPay 小额支付测试" 场景
2. 点击 "高级阅读服务" 商品
3. 使用 X402 协议完成支付（0.1 USDT）
4. 验证：
   - 支付是否成功
   - 佣金是否正确分配
   - 订单状态是否正确更新

#### 场景 2：钱包支付 NFT 商品测试

1. 选择 "钱包支付 NFT 商品测试" 场景
2. 点击 "NFT 游戏道具" 商品
3. 连接数字货币钱包
4. 完成支付（10 USDT）
5. 验证：
   - NFT 是否正确交付
   - 佣金分配机制
   - 订单和佣金记录

#### 场景 3：Stripe 支付测试

1. 选择 "Stripe 支付测试" 场景
2. 点击 "高级会员服务" 商品
3. 模拟 Stripe 支付流程（500 RMB）
4. 验证：
   - 佣金分配机制
   - 结算周期
   - 不同资产类型的分佣

#### 场景 4：实物商品完整流程

1. 选择 "实物商品完整流程" 场景
2. 选择实物商品
3. 完成支付
4. 模拟物流配送
5. 验证：
   - 支付流程
   - 物流状态更新
   - 结算和佣金分配

## 🔍 验证要点

### 支付流程验证

- [ ] 支付是否成功完成
- [ ] 订单状态是否正确更新
- [ ] 支付方式是否正确识别
- [ ] 错误处理是否正常

### 佣金分配验证

- [ ] PayMind 固定收入是否正确
- [ ] 推广 Agent 分成是否正确
- [ ] 执行 Agent 分成是否正确
- [ ] 不同资产类型的佣金率是否正确
- [ ] 不同 Agent 类型的分佣是否正确

### 结算周期验证

- [ ] 结算触发时间是否正确设置
- [ ] 结算到期时间是否正确计算
- [ ] 自动结算是否正常工作
- [ ] 不同资产类型的结算周期是否正确

## 📊 测试账户信息

- **PayMind ID**: `pm-1763463490911-91zf91wu2`
- **角色**: Merchant（商户）
- **测试商品数量**: 5 个

## 🛠️ 故障排除

### 问题：脚本运行失败，提示找不到用户

**解决方案**：
1. 确保测试账户已注册并登录过系统
2. 检查 PayMind ID 是否正确：`pm-1763463490911-91zf91wu2`
3. 如果账户不存在，先在前端注册该账户

### 问题：商品未显示在 Marketplace

**解决方案**：
1. 检查商品状态是否为 `active`
2. 刷新页面
3. 检查 API 是否正常返回数据

### 问题：支付流程失败

**解决方案**：
1. 检查后端服务是否正常运行
2. 检查合约地址是否正确配置
3. 检查钱包连接是否正常
4. 查看后端日志获取详细错误信息

## 📝 下一步

完成基本测试后，可以：

1. **测试不同 Agent 类型的分佣**
   - 创建不同类型的 Agent
   - 测试不同 Agent 的分佣机制

2. **测试不同资产类型的分佣**
   - 测试实物、服务、虚拟、NFT 等不同资产类型
   - 验证每种资产类型的佣金率是否正确

3. **测试结算周期**
   - 验证不同资产类型的结算周期
   - 测试自动结算功能

4. **性能测试**
   - 测试高并发支付场景
   - 测试大量订单的处理能力

## 🔗 相关链接

- Marketplace 页面：`http://localhost:3000/marketplace`
- Agent 页面：`http://localhost:3000/agent`
- 测试场景页面：`http://localhost:3000/test-scenarios`
- API 文档：`http://localhost:3001/api/docs`

